KIDS Distribution saved on Mar 18, 2015@22:27:21
AWARE software with 1.1.6 release
**KIDS**:AWARE 1.2^

**INSTALL NAME**
AWARE 1.2
"BLD",8874,0)
AWARE 1.2^^0^3150318^n
"BLD",8874,4,0)
^9.64PA^19008.2^5
"BLD",8874,4,101.15,0)
101.15
"BLD",8874,4,101.15,222)
n^y^f^^n^^y^o^n
"BLD",8874,4,101.15,224)
I $P($G(^ORD(101.15,+Y,0)),"^",1)="write4comobject"
"BLD",8874,4,19007,0)
19007
"BLD",8874,4,19007,222)
y^y^f^^^^n
"BLD",8874,4,19008,0)
19008
"BLD",8874,4,19008,222)
y^y^f^^^^n
"BLD",8874,4,19008.1,0)
19008.1
"BLD",8874,4,19008.1,222)
y^y^f^^n^^y^o^n
"BLD",8874,4,19008.2,0)
19008.2
"BLD",8874,4,19008.2,222)
y^y^f^^^^n
"BLD",8874,4,"B",101.15,101.15)

"BLD",8874,4,"B",19007,19007)

"BLD",8874,4,"B",19008,19008)

"BLD",8874,4,"B",19008.1,19008.1)

"BLD",8874,4,"B",19008.2,19008.2)

"BLD",8874,6.3)
33
"BLD",8874,"KRN",0)
^9.67PA^779.2^20
"BLD",8874,"KRN",.4,0)
.4
"BLD",8874,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",8874,"KRN",.401,0)
.401
"BLD",8874,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",8874,"KRN",.402,0)
.402
"BLD",8874,"KRN",.402,"NM",0)
^9.68A^^
"BLD",8874,"KRN",.403,0)
.403
"BLD",8874,"KRN",.5,0)
.5
"BLD",8874,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",8874,"KRN",.84,0)
.84
"BLD",8874,"KRN",3.6,0)
3.6
"BLD",8874,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",8874,"KRN",3.8,0)
3.8
"BLD",8874,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",8874,"KRN",9.2,0)
9.2
"BLD",8874,"KRN",9.8,0)
9.8
"BLD",8874,"KRN",9.8,"NM",0)
^9.68A^23^18
"BLD",8874,"KRN",9.8,"NM",6,0)
ORWCOM^^0^B1575721
"BLD",8874,"KRN",9.8,"NM",7,0)
VEFAALRE^^0^B244082712
"BLD",8874,"KRN",9.8,"NM",8,0)
VEFAALR1^^0^B246639783
"BLD",8874,"KRN",9.8,"NM",9,0)
VEFAALR2^^0^B82371541
"BLD",8874,"KRN",9.8,"NM",10,0)
VEFAALR4^^0^B221387387
"BLD",8874,"KRN",9.8,"NM",11,0)
VEFAALR5^^0^B1641346
"BLD",8874,"KRN",9.8,"NM",12,0)
VEFAALR6^^0^B141064223
"BLD",8874,"KRN",9.8,"NM",13,0)
VEFAALC1^^0^B29702120
"BLD",8874,"KRN",9.8,"NM",14,0)
VEFAALC2^^0^B5063079
"BLD",8874,"KRN",9.8,"NM",15,0)
VEFACSP1^^0^B21989402
"BLD",8874,"KRN",9.8,"NM",16,0)
VEFAKB01^^0^B27573667
"BLD",8874,"KRN",9.8,"NM",17,0)
VEFAKB02^^0^B126966783
"BLD",8874,"KRN",9.8,"NM",18,0)
VEFAALR3^^0^B3683498
"BLD",8874,"KRN",9.8,"NM",19,0)
VEFAALR7^^0^B103453138
"BLD",8874,"KRN",9.8,"NM",20,0)
VEFAALR8^^0^B263895010
"BLD",8874,"KRN",9.8,"NM",21,0)
VEFAALR9^^0^B229982290
"BLD",8874,"KRN",9.8,"NM",22,0)
VEFAALRA^^0^B103624988
"BLD",8874,"KRN",9.8,"NM",23,0)
VEFAKB03^^0^B12180480
"BLD",8874,"KRN",9.8,"NM","B","ORWCOM",6)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALC1",13)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALC2",14)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR1",8)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR2",9)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR3",18)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR4",10)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR5",11)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR6",12)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR7",19)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR8",20)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALR9",21)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALRA",22)

"BLD",8874,"KRN",9.8,"NM","B","VEFAALRE",7)

"BLD",8874,"KRN",9.8,"NM","B","VEFACSP1",15)

"BLD",8874,"KRN",9.8,"NM","B","VEFAKB01",16)

"BLD",8874,"KRN",9.8,"NM","B","VEFAKB02",17)

"BLD",8874,"KRN",9.8,"NM","B","VEFAKB03",23)

"BLD",8874,"KRN",19,0)
19
"BLD",8874,"KRN",19,"NM",0)
^9.68A^5^3
"BLD",8874,"KRN",19,"NM",3,0)
VEFAALRE^^0
"BLD",8874,"KRN",19,"NM",4,0)
VEFA AWARE ALERT CACHE BUILDER^^0
"BLD",8874,"KRN",19,"NM",5,0)
VEFA AWARE GET ALERT CACHE^^0
"BLD",8874,"KRN",19,"NM","B","VEFA AWARE ALERT CACHE BUILDER",4)

"BLD",8874,"KRN",19,"NM","B","VEFA AWARE GET ALERT CACHE",5)

"BLD",8874,"KRN",19,"NM","B","VEFAALRE",3)

"BLD",8874,"KRN",19.1,0)
19.1
"BLD",8874,"KRN",19.1,"NM",0)
^9.68A^3^3
"BLD",8874,"KRN",19.1,"NM",1,0)
VEFA AWARE ADD/EDIT KB RULE^^0
"BLD",8874,"KRN",19.1,"NM",2,0)
VEFA AWARE ALL ALERT CACHE^^0
"BLD",8874,"KRN",19.1,"NM",3,0)
VEFA AWARE OWN ALERT CACHE^^0
"BLD",8874,"KRN",19.1,"NM","B","VEFA AWARE ADD/EDIT KB RULE",1)

"BLD",8874,"KRN",19.1,"NM","B","VEFA AWARE ALL ALERT CACHE",2)

"BLD",8874,"KRN",19.1,"NM","B","VEFA AWARE OWN ALERT CACHE",3)

"BLD",8874,"KRN",101,0)
101
"BLD",8874,"KRN",101,"NM",0)
^9.68A^^
"BLD",8874,"KRN",409.61,0)
409.61
"BLD",8874,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",8874,"KRN",771,0)
771
"BLD",8874,"KRN",779.2,0)
779.2
"BLD",8874,"KRN",870,0)
870
"BLD",8874,"KRN",8989.51,0)
8989.51
"BLD",8874,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",8874,"KRN",8989.51,"NM",1,0)
ORWCOM VEFA PAT CHART CLOSEOUT^^0
"BLD",8874,"KRN",8989.51,"NM","B","ORWCOM VEFA PAT CHART CLOSEOUT",1)

"BLD",8874,"KRN",8989.52,0)
8989.52
"BLD",8874,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",8874,"KRN",8994,0)
8994
"BLD",8874,"KRN",8994,"NM",0)
^9.68A^9^9
"BLD",8874,"KRN",8994,"NM",1,0)
VEFAALERTCAT^^0
"BLD",8874,"KRN",8994,"NM",2,0)
VEFALKPORD^^0
"BLD",8874,"KRN",8994,"NM",3,0)
VEFA ALERT DOC FOLLOWUPS^^0
"BLD",8874,"KRN",8994,"NM",4,0)
VEFA ALERT DOC ORDERS^^0
"BLD",8874,"KRN",8994,"NM",5,0)
VEFA CRIT ALERT TRACKED^^0
"BLD",8874,"KRN",8994,"NM",6,0)
VEFA CRIT ALERT VALUES^^0
"BLD",8874,"KRN",8994,"NM",7,0)
ORWCOM VEFA PT CLSCHART^^0
"BLD",8874,"KRN",8994,"NM",8,0)
VEFA AWARE ALERT CACHE^^0
"BLD",8874,"KRN",8994,"NM",9,0)
VEFA AWARE KB ALERT TYP CHK1^^0
"BLD",8874,"KRN",8994,"NM","B","ORWCOM VEFA PT CLSCHART",7)

"BLD",8874,"KRN",8994,"NM","B","VEFA ALERT DOC FOLLOWUPS",3)

"BLD",8874,"KRN",8994,"NM","B","VEFA ALERT DOC ORDERS",4)

"BLD",8874,"KRN",8994,"NM","B","VEFA AWARE ALERT CACHE",8)

"BLD",8874,"KRN",8994,"NM","B","VEFA AWARE KB ALERT TYP CHK1",9)

"BLD",8874,"KRN",8994,"NM","B","VEFA CRIT ALERT TRACKED",5)

"BLD",8874,"KRN",8994,"NM","B","VEFA CRIT ALERT VALUES",6)

"BLD",8874,"KRN",8994,"NM","B","VEFAALERTCAT",1)

"BLD",8874,"KRN",8994,"NM","B","VEFALKPORD",2)

"BLD",8874,"KRN","B",.4,.4)

"BLD",8874,"KRN","B",.401,.401)

"BLD",8874,"KRN","B",.402,.402)

"BLD",8874,"KRN","B",.403,.403)

"BLD",8874,"KRN","B",.5,.5)

"BLD",8874,"KRN","B",.84,.84)

"BLD",8874,"KRN","B",3.6,3.6)

"BLD",8874,"KRN","B",3.8,3.8)

"BLD",8874,"KRN","B",9.2,9.2)

"BLD",8874,"KRN","B",9.8,9.8)

"BLD",8874,"KRN","B",19,19)

"BLD",8874,"KRN","B",19.1,19.1)

"BLD",8874,"KRN","B",101,101)

"BLD",8874,"KRN","B",409.61,409.61)

"BLD",8874,"KRN","B",771,771)

"BLD",8874,"KRN","B",779.2,779.2)

"BLD",8874,"KRN","B",870,870)

"BLD",8874,"KRN","B",8989.51,8989.51)

"BLD",8874,"KRN","B",8989.52,8989.52)

"BLD",8874,"KRN","B",8994,8994)

"BLD",8874,"QUES",0)
^9.62^^
"BLD",8874,"REQB",0)
^9.611^^
"DATA",101.15,22,0)
write4comobject^{12DFC784-0612-11D6-88B8-009027AACCF2}
"DATA",19008.1,1,0)
AWARE ALERT PARAMETER^3150318.2227^14^^3150318.2227^3130311.192124
"FIA",101.15)
OE/RR COM OBJECTS
"FIA",101.15,0)
^ORD(101.15,
"FIA",101.15,0,0)
101.15
"FIA",101.15,0,1)
n^y^f^^n^^y^o^n
"FIA",101.15,0,10)

"FIA",101.15,0,11)
I $P($G(^ORD(101.15,+Y,0)),"^",1)="write4comobject"
"FIA",101.15,0,"RLRO")

"FIA",101.15,101.15)
0
"FIA",101.15,101.152)
0
"FIA",19007)
VEFA Tracked Critical Alert
"FIA",19007,0)
^DIZ(19007,
"FIA",19007,0,0)
19007
"FIA",19007,0,1)
y^y^f^^^^n
"FIA",19007,0,10)

"FIA",19007,0,11)

"FIA",19007,0,"RLRO")

"FIA",19007,19007)
0
"FIA",19007,19007.01)
0
"FIA",19007,19007.012)
0
"FIA",19007,19007.013)
0
"FIA",19007,19007.014)
0
"FIA",19007,19007.015)
0
"FIA",19007,19007.02)
0
"FIA",19007,19007.03)
0
"FIA",19007,19007.15)
0
"FIA",19007,19007.25)
0
"FIA",19007,19007.35)
0
"FIA",19008)
VEFA CRITICAL ALERT CATEGORY
"FIA",19008,0)
^DIZ(19008,
"FIA",19008,0,0)
19008
"FIA",19008,0,1)
y^y^f^^^^n
"FIA",19008,0,10)

"FIA",19008,0,11)

"FIA",19008,0,"RLRO")

"FIA",19008,19008)
0
"FIA",19008.1)
VEFA AWARE ALERT PARAMETER
"FIA",19008.1,0)
^DIZ(19008.1,
"FIA",19008.1,0,0)
19008.1
"FIA",19008.1,0,1)
y^y^f^^n^^y^o^n
"FIA",19008.1,0,10)

"FIA",19008.1,0,11)

"FIA",19008.1,0,"RLRO")

"FIA",19008.1,19008.1)
0
"FIA",19008.2)
VEFA AWARE ALERT CACHE
"FIA",19008.2,0)
^DIZ(19008.2,
"FIA",19008.2,0,0)
19008.2I
"FIA",19008.2,0,1)
y^y^f^^^^n
"FIA",19008.2,0,10)

"FIA",19008.2,0,11)

"FIA",19008.2,0,"RLRO")

"FIA",19008.2,19008.2)
0
"FIA",19008.2,19008.215)
0
"IX",101.15,101.15,"B",0)
101.15^B^Unique master cross reference^R^^F^IR^I^101.15^^^^^LS
"IX",101.15,101.15,"B",1)
S ^ORD(101.15,"B",$E(X,1,30),DA)=""
"IX",101.15,101.15,"B",2)
K ^ORD(101.15,"B",$E(X,1,30),DA)
"IX",101.15,101.15,"B",2.5)
K ^ORD(101.15,"B")
"IX",101.15,101.15,"B",11.1,0)
^.114IA^1^1
"IX",101.15,101.15,"B",11.1,1,0)
1^F^101.15^.01^30^1^F
"IX",101.15,101.15,"B",11.1,1,3)

"KEY",101.15,101.15,"A",0)
101.15^A^P^93
"KEY",101.15,101.15,"A",2,0)
^.312IA^1^1
"KEY",101.15,101.15,"A",2,1,0)
.01^101.15^1
"KEYPTR",101.15,101.15,"A")
101.15^B
"KRN",19,14286,-1)
0^3
"KRN",19,14286,0)
VEFAALRE^VEFA ALRE CONTEXT version 1.0.0.1^^B^^^^^^^^
"KRN",19,14286,99.1)
63242,58590
"KRN",19,14286,"RPC",0)
^19.05P^20^19
"KRN",19,14286,"RPC",2,0)
ORWORB FASTUSER
"KRN",19,14286,"RPC",3,0)
VEFALKPORD
"KRN",19,14286,"RPC",4,0)
VEFA CRIT ALERT TRACKED
"KRN",19,14286,"RPC",5,0)
VEFAALERTCAT
"KRN",19,14286,"RPC",6,0)
VEFA CRIT ALERT VALUES
"KRN",19,14286,"RPC",7,0)
VEFA ALERT DOC ORDERS
"KRN",19,14286,"RPC",8,0)
VEFA ALERT DOC FOLLOWUPS
"KRN",19,14286,"RPC",9,0)
DDR LISTER
"KRN",19,14286,"RPC",10,0)
DDR GETS ENTRY DATA
"KRN",19,14286,"RPC",11,0)
DDR VALIDATOR
"KRN",19,14286,"RPC",12,0)
DDR FILER
"KRN",19,14286,"RPC",13,0)
DDR GET DD HELP
"KRN",19,14286,"RPC",14,0)
DDR FINDER
"KRN",19,14286,"RPC",15,0)
DDR FIND1
"KRN",19,14286,"RPC",16,0)
ORWU USERINFO
"KRN",19,14286,"RPC",17,0)
ORWRP GET DEFAULT PRINTER
"KRN",19,14286,"RPC",18,0)
ORWU VERSRV
"KRN",19,14286,"RPC",20,0)
VEFA AWARE KB ALERT TYP CHK1
"KRN",19,14286,"U")
VEFA ALRE CONTEXT VERSION 1.0.
"KRN",19,14288,-1)
0^4
"KRN",19,14288,0)
VEFA AWARE ALERT CACHE BUILDER^AWARE ALERT CACHE BUILDER^^R^^^^^^^^
"KRN",19,14288,25)
COLLECT^VEFAALR4
"KRN",19,14288,"U")
AWARE ALERT CACHE BUILDER
"KRN",19,14289,-1)
0^5
"KRN",19,14289,0)
VEFA AWARE GET ALERT CACHE^Context for Alert Cache Retrieve^^B^^^^^^^^
"KRN",19,14289,99.1)
63172,62834
"KRN",19,14289,"RPC",0)
^19.05P^1^1
"KRN",19,14289,"RPC",1,0)
VEFA AWARE ALERT CACHE
"KRN",19,14289,"U")
CONTEXT FOR ALERT CACHE RETRIE
"KRN",19.1,687,-1)
0^2
"KRN",19.1,687,0)
VEFA AWARE ALL ALERT CACHE^View all alert cache
"KRN",19.1,688,-1)
0^3
"KRN",19.1,688,0)
VEFA AWARE OWN ALERT CACHE^View user's own alert cache
"KRN",19.1,689,-1)
0^1
"KRN",19.1,689,0)
VEFA AWARE ADD/EDIT KB RULE^Add or Edit KB Rule
"KRN",19.1,689,1,0)
^19.11^1^1^3140220^
"KRN",19.1,689,1,1,0)
With this key, user is permitted to add/edit Knowledge-Based rule using KB Editor.
"KRN",8989.51,837,-1)
0^1
"KRN",8989.51,837,0)
ORWCOM VEFA PAT CHART CLOSEOUT^COM Object on Patient Chart Closeout^0^^COM Object
"KRN",8989.51,837,1)
P^101.15^COM Object to Activate on Patient Chart Closeout
"KRN",8989.51,837,3)
I $P(^(0),"^",3)'="I"
"KRN",8989.51,837,20,0)
^8989.512^1^1^3110123^^^
"KRN",8989.51,837,20,1,0)
COM Object to Activate on CPRS GUI Patient Chart Closeout
"KRN",8989.51,837,30,0)
^8989.513I^4^4
"KRN",8989.51,837,30,1,0)
6^4.2
"KRN",8989.51,837,30,2,0)
5^4
"KRN",8989.51,837,30,3,0)
3^49
"KRN",8989.51,837,30,4,0)
1^200
"KRN",8994,3370,-1)
0^7
"KRN",8994,3370,0)
ORWCOM VEFA PT CLSCHART^PTCLS^ORWCOM^1^R^^^1
"KRN",8994,3370,1,0)
^8994.01^1^1^3010621^^
"KRN",8994,3370,1,1,0)
Returns COM Object entries from  different parameters.
"KRN",8994,3370,3,0)
^8994.03^1^1^3010621^^
"KRN",8994,3370,3,1,0)
Zero Node from File 101.15
"KRN",8994,3371,-1)
0^2
"KRN",8994,3371,0)
VEFALKPORD^LKPORD^VEFAALRE^1^P^^^^1
"KRN",8994,3371,1,0)
^8994.01^5^5^3110313^^
"KRN",8994,3371,1,1,0)
Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and check whether 
"KRN",8994,3371,1,2,0)
|TAB|;any ORDERS by user (DUZ)have been made from list of orders in in a possible defined VEFA ALERT TRACKING entry's Reminder Dialog 
"KRN",8994,3371,1,3,0)
|TAB|;(field), the dialog elements thereof containing the ORDER types (orderable iems) for such list to be compared with any actual orders 
"KRN",8994,3371,1,4,0)
|TAB|;by this user (DUZ) made after the date/time of the actual critical alert. 
"KRN",8994,3371,1,5,0)
|TAB|;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG.
"KRN",8994,3371,2,0)
^8994.02A^1^1
"KRN",8994,3371,2,1,0)
INPUT VALUE^1^120^1
"KRN",8994,3371,2,"B","INPUT VALUE",1)

"KRN",8994,3372,-1)
0^5
"KRN",8994,3372,0)
VEFA CRIT ALERT TRACKED^LOOKUP^VEFAALR1^1^P^^^^1
"KRN",8994,3372,2,0)
^8994.02A^1^1
"KRN",8994,3372,2,1,0)
INPUT VALUE^1^120^1
"KRN",8994,3372,2,"B","INPUT VALUE",1)

"KRN",8994,3373,-1)
0^1
"KRN",8994,3373,0)
VEFAALERTCAT^ALERTCAT^VEFAALR2^4^R^0^^1
"KRN",8994,3373,1,0)
^8994.01^1^1^3110530^^
"KRN",8994,3373,1,1,0)
RETURN ARRAY OF CRITICAL ALERT CATEGORIES AND THEIT NOTIFICATION TYPES
"KRN",8994,3374,-1)
0^6
"KRN",8994,3374,0)
VEFA CRIT ALERT VALUES^SPECALRT^VEFAALR2^1^R^0^^1^1
"KRN",8994,3374,1,0)
^^1^1^3110530^
"KRN",8994,3374,1,1,0)
RETURN REMINDER DIALOG AND TIU TEMPLATE FROM PASSED CRIT ALERT IN FILE 19007
"KRN",8994,3374,2,0)
^8994.02A^2^1
"KRN",8994,3374,2,2,0)
INPUT VALUE^1^120^1
"KRN",8994,3374,2,"B","INPUT VALUE",2)

"KRN",8994,3375,-1)
0^4
"KRN",8994,3375,0)
VEFA ALERT DOC ORDERS^ALERTORD^VEFAALR2^4^R^0^^1
"KRN",8994,3375,1,0)
^^1^1^3110531^
"KRN",8994,3375,1,1,0)
RETURN ORDERS IN ORDERS GROUP DIALOG AS DOCS OF REMINDER DIALOG
"KRN",8994,3375,2,0)
^8994.02A^1^1
"KRN",8994,3375,2,1,0)
INPUT VALUE^1^120^1
"KRN",8994,3375,2,1,1,0)
^^1^1^3110531^
"KRN",8994,3375,2,1,1,1,0)
RECORD NUMBER OF VEFA CRIT ALERT TRACKING FILE "ALERT TYPE"
"KRN",8994,3375,2,"B","INPUT VALUE",1)

"KRN",8994,3376,-1)
0^3
"KRN",8994,3376,0)
VEFA ALERT DOC FOLLOWUPS^ALERTFOL^VEFAALR2^4^R^0^^1
"KRN",8994,3376,1,0)
^^1^1^3110531^
"KRN",8994,3376,1,1,0)
RETURN LIST OF FOLLOWUPS AS DOCS OF FOLLOWUPS IN REMINDER DIALOG
"KRN",8994,3376,2,0)
^8994.02A^1^1
"KRN",8994,3376,2,1,0)
INPUT VALUE^1^120^1
"KRN",8994,3376,2,"B","INPUT VALUE",1)

"KRN",8994,3377,-1)
0^8
"KRN",8994,3377,0)
VEFA AWARE ALERT CACHE^EXTALERT^VEFAALR4^4^R^0^^1
"KRN",8994,3377,1,0)
^^1^1^3131126^
"KRN",8994,3377,1,1,0)
AWARE ALERT CACHE RETRIEVER FROM VISTA INTO SQL SERVER TABLES
"KRN",8994,3377,3,0)
^^1^1^3131126^
"KRN",8994,3377,3,1,0)
ARRAY OF ALERTS FOR EXTRACTED TIME PERIOD
"KRN",8994,3378,-1)
0^9
"KRN",8994,3378,0)
VEFA AWARE KB ALERT TYP CHK1^BASICCHK^VEFAALR4^1^R^0^^1^1
"KRN",8994,3378,1,0)
^8994.01^1^1^3131207^^^^
"KRN",8994,3378,1,1,0)
BASIC ALERT TYPE CHECKER
"KRN",8994,3378,2,0)
^8994.02A^2^1
"KRN",8994,3378,2,2,0)
INPUT VALUE^1^30^1
"KRN",8994,3378,2,"B","INPUT VALUE",2)

"KRN",8994,3378,3,0)
^8994.03^2^2^3131207^^^^
"KRN",8994,3378,3,1,0)
"OK" FOR NO ERROR, OR "ERR=XXXXXXXX" AS DESCRIBED ERROR SO CAC
"KRN",8994,3378,3,2,0)
CAN CORRECT ERROR
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
18
"RTN","ORWCOM")
0^6^B1575721
"RTN","ORWCOM",1,0)
ORWCOM ;SLC/JM - Wraps RPCs for COM Objects Hooks ;8/02/2001
"RTN","ORWCOM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109**;VEFA LOCAL MOD-Add Patient Closeout COM Object Dec 17, 1997;Build 33
"RTN","ORWCOM",3,0)
 Q
"RTN","ORWCOM",4,0)
DETAILS(ORY,ID) ; Returns Details about a specific COM Object
"RTN","ORWCOM",5,0)
 N NODE
"RTN","ORWCOM",6,0)
 S ORY=0
"RTN","ORWCOM",7,0)
 I +ID D
"RTN","ORWCOM",8,0)
 .S NODE=$G(^ORD(101.15,+ID,0))
"RTN","ORWCOM",9,0)
 .I NODE'="",$P(NODE,U,3)'="I" S ORY=ID_U_NODE
"RTN","ORWCOM",10,0)
 Q
"RTN","ORWCOM",11,0)
GETOBJ(ORY,PARAM,ORIDX) ; Returns COM Object info
"RTN","ORWCOM",12,0)
 N SRV,ID
"RTN","ORWCOM",13,0)
 S SRV=$$GET1^DIQ(200,DUZ,29,"I")
"RTN","ORWCOM",14,0)
 S ID=$$GET^XPAR(DUZ_";VA(200,^SRV.`"_+$G(SRV)_"^DIV^SYS",PARAM,ORIDX,"I")
"RTN","ORWCOM",15,0)
 D DETAILS(.ORY,ID)
"RTN","ORWCOM",16,0)
 Q
"RTN","ORWCOM",17,0)
PTOBJ(ORY) ; Returns Patient COM Object
"RTN","ORWCOM",18,0)
 D GETOBJ(.ORY,"ORWCOM PATIENT SELECTED",1)
"RTN","ORWCOM",19,0)
 Q
"RTN","ORWCOM",20,0)
ORDEROBJ(ORY,ORGRP) ; Returns Accept Order COM Object
"RTN","ORWCOM",21,0)
 D GETOBJ(.ORY,"ORWCOM ORDER ACCEPTED",ORGRP)
"RTN","ORWCOM",22,0)
 Q
"RTN","ORWCOM",23,0)
GETOBJS(ORY) ; Returns list of all active COM objects
"RTN","ORWCOM",24,0)
 N I,J,IDX,NODE
"RTN","ORWCOM",25,0)
 S I="",IDX=0
"RTN","ORWCOM",26,0)
 F  S I=$O(^ORD(101.15,"B",I)) Q:I=""  D
"RTN","ORWCOM",27,0)
 .S J=$O(^ORD(101.15,"B",I,0)) Q:'+J
"RTN","ORWCOM",28,0)
 .S NODE=$G(^ORD(101.15,J,0))
"RTN","ORWCOM",29,0)
 .I $P(NODE,U,3)'="I" D
"RTN","ORWCOM",30,0)
 ..S IDX=IDX+1
"RTN","ORWCOM",31,0)
 ..S ORY(IDX)=J_U_NODE
"RTN","ORWCOM",32,0)
 Q
"RTN","ORWCOM",33,0)
PTCLS(ORY) ; Returns Patient Chart Closeout COM Object
"RTN","ORWCOM",34,0)
 D GETOBJ(.ORY,"ORWCOM VEFA PAT CHART CLOSEOUT",1)
"RTN","ORWCOM",35,0)
 Q
"RTN","VEFAALC1")
0^13^B29702120
"RTN","VEFAALC1",1,0)
VEFAALC1 ;WOIFO/BT - VEFA AWARE ALERT CACHE API CALLED BY CSP PAGE ; 02/06/2014
"RTN","VEFAALC1",2,0)
 ;;1.0;VEFA ALRE;**1**;MAY 1, 2011;Build 33
"RTN","VEFAALC1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","VEFAALC1",4,0)
 ;;
"RTN","VEFAALC1",5,0)
 ; External Reference DBIA#
"RTN","VEFAALC1",6,0)
 ; ------------------------
"RTN","VEFAALC1",7,0)
 ; #2056   - GETS^DIQ (Supported)
"RTN","VEFAALC1",8,0)
 ; #2051   - LIST^DIC (Supported)
"RTN","VEFAALC1",9,0)
 ; #10104  - LOW^XLFSTR (Supported)
"RTN","VEFAALC1",10,0)
 ; #10104  - UP^XLFSTR (Supported)
"RTN","VEFAALC1",11,0)
 ;
"RTN","VEFAALC1",12,0)
GETALCH(VEFARSLT,USERNAME,DUZ,PROV,SERV,PAT,FOL7,SELPROV,SELSERV,SELPAT,FACILITY) ;Get Alert Cache records
"RTN","VEFAALC1",13,0)
 ;INPUT
"RTN","VEFAALC1",14,0)
 ;  USERNAME : User Name 
"RTN","VEFAALC1",15,0)
 ;             if user has key to see his/her own alert cache, screen result array with this user name
"RTN","VEFAALC1",16,0)
 ;  DUZ      : DUZ used to get the key
"RTN","VEFAALC1",17,0)
 ;  PROV     : Provider - if not All, screen result array with this provider
"RTN","VEFAALC1",18,0)
 ;  SERV     : Service  - if not All, screen result array with this service
"RTN","VEFAALC1",19,0)
 ;  PAT      : Patient  - if not All, screen result array with this patient
"RTN","VEFAALC1",20,0)
 ;  FOL7     : Follow-up > 7 Days  - if not All, screen result array with either follow-up >7 Days or not
"RTN","VEFAALC1",21,0)
 ;OUTPUT 
"RTN","VEFAALC1",22,0)
 ;  VEFARSLT : Result Array of Alert Cache based on criteria
"RTN","VEFAALC1",23,0)
 ;  SELPROV  : Result Array of providers
"RTN","VEFAALC1",24,0)
 ;  SELSERV  : Result Array of services
"RTN","VEFAALC1",25,0)
 ;  SELPAT   : Result Array of patients
"RTN","VEFAALC1",26,0)
 ;  FACILITY : Facility
"RTN","VEFAALC1",27,0)
 ;
"RTN","VEFAALC1",28,0)
 K @VEFARSLT
"RTN","VEFAALC1",29,0)
 QUIT:$G(USERNAME)=""
"RTN","VEFAALC1",30,0)
 QUIT:$G(DUZ)=""
"RTN","VEFAALC1",31,0)
 S FACILITY=""
"RTN","VEFAALC1",32,0)
 S:$G(PROV)="" PROV="(All)"
"RTN","VEFAALC1",33,0)
 S:$G(SERV)="" SERV="(All)"
"RTN","VEFAALC1",34,0)
 S:$G(FOL7)="" FOL7="(All)"
"RTN","VEFAALC1",35,0)
 S:$G(PAT)="" PAT="(All)"
"RTN","VEFAALC1",36,0)
 ;
"RTN","VEFAALC1",37,0)
 N FILE S FILE="19008.2"
"RTN","VEFAALC1",38,0)
 N IENS S IENS=""
"RTN","VEFAALC1",39,0)
 N FIELDS S FIELDS=".01;1;2;3;4;6;7;8;21;24"
"RTN","VEFAALC1",40,0)
 N FLAGS S FLAGS=""
"RTN","VEFAALC1",41,0)
 N NUMBER S NUMBER=""
"RTN","VEFAALC1",42,0)
 N FROM,PART
"RTN","VEFAALC1",43,0)
 N INDEX S INDEX="#"
"RTN","VEFAALC1",44,0)
 N SCREEN
"RTN","VEFAALC1",45,0)
 N IDENT S IDENT=""
"RTN","VEFAALC1",46,0)
 N TARGET,ERR
"RTN","VEFAALC1",47,0)
 ;
"RTN","VEFAALC1",48,0)
 N KEY D USRKEY^VEFAALR5(.KEY,DUZ)
"RTN","VEFAALC1",49,0)
 QUIT:KEY=0
"RTN","VEFAALC1",50,0)
 ;
"RTN","VEFAALC1",51,0)
 I KEY=1 D
"RTN","VEFAALC1",52,0)
 . ;S SCREEN="I $P($P(^(0),U,5),"" "")="""_USERNAME_""""
"RTN","VEFAALC1",53,0)
 . S SCREEN="I $P(^(0),U,5)="""_USERNAME_" - "_DUZ_""""
"RTN","VEFAALC1",54,0)
 . S INDEX="D"
"RTN","VEFAALC1",55,0)
 ;
"RTN","VEFAALC1",56,0)
 D LIST^DIC(FILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFAALC1",57,0)
 N LAST S LAST=$O(TARGET("DILIST","ID"," "),-1)
"RTN","VEFAALC1",58,0)
 N ID S ID=""
"RTN","VEFAALC1",59,0)
 ;
"RTN","VEFAALC1",60,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFAALC1",61,0)
 . N IEN S IEN=TARGET("DILIST",2,ID)
"RTN","VEFAALC1",62,0)
 . N ALERTID S ALERTID=TARGET("DILIST","ID",ID,.01)
"RTN","VEFAALC1",63,0)
 . N ALERTDT S ALERTDT=TARGET("DILIST","ID",ID,1)
"RTN","VEFAALC1",64,0)
 . S FACILITY=$G(TARGET("DILIST","ID",ID,2))
"RTN","VEFAALC1",65,0)
 . N SERVICE S SERVICE=TARGET("DILIST","ID",ID,3)
"RTN","VEFAALC1",66,0)
 . N PROVIDER S PROVIDER=TARGET("DILIST","ID",ID,4)
"RTN","VEFAALC1",67,0)
 . N PATIENT S PATIENT=TARGET("DILIST","ID",ID,6)
"RTN","VEFAALC1",68,0)
 . N ALERTCAT S ALERTCAT=TARGET("DILIST","ID",ID,7)
"RTN","VEFAALC1",69,0)
 . N ALERTTY S ALERTTY=TARGET("DILIST","ID",ID,8)
"RTN","VEFAALC1",70,0)
 . N FOL7DAYS S FOL7DAYS=TARGET("DILIST","ID",ID,21)
"RTN","VEFAALC1",71,0)
 . S FOL7DAYS=$S($$UP^XLFSTR(FOL7DAYS)="YES":"true",1:"false")
"RTN","VEFAALC1",72,0)
 . N FOLUP S FOLUP=TARGET("DILIST","ID",ID,24)
"RTN","VEFAALC1",73,0)
 . S FOLUP=$S($$UP^XLFSTR(FOLUP)="YES":"true",1:"false")
"RTN","VEFAALC1",74,0)
 . S SELPROV(PROVIDER)=""
"RTN","VEFAALC1",75,0)
 . S SELSERV(SERVICE)=""
"RTN","VEFAALC1",76,0)
 . S SELPAT(PATIENT)=""
"RTN","VEFAALC1",77,0)
 . I PROV'="(All)",PROV'=PROVIDER QUIT
"RTN","VEFAALC1",78,0)
 . I SERV'="(All)",SERV'=SERVICE QUIT
"RTN","VEFAALC1",79,0)
 . I PAT'="(All)",PAT'=PATIENT QUIT
"RTN","VEFAALC1",80,0)
 . I FOL7'="(All)",$$LOW^XLFSTR(FOL7)'=FOL7DAYS QUIT
"RTN","VEFAALC1",81,0)
 . N DFN S DFN=$O(^DPT("B",PATIENT,0))
"RTN","VEFAALC1",82,0)
 . N LINE S LINE="  {"
"RTN","VEFAALC1",83,0)
 . S LINE=LINE_"ien:'"_IEN_"',"
"RTN","VEFAALC1",84,0)
 . S LINE=LINE_"patient:'"_$$QUOTE^VEFACSP1(PATIENT)_"',"
"RTN","VEFAALC1",85,0)
 . S LINE=LINE_"dfn:'"_$$QUOTE^VEFACSP1(DFN)_"',"
"RTN","VEFAALC1",86,0)
 . S LINE=LINE_"alertid:'"_$$QUOTE^VEFACSP1(ALERTID)_"',"
"RTN","VEFAALC1",87,0)
 . S LINE=LINE_"date:'"_$$EX2YMD(ALERTDT)_"',"
"RTN","VEFAALC1",88,0)
 . ;S LINE=LINE_"facility:'"_$$QUOTE^VEFACSP1(FACILITY)_"',"
"RTN","VEFAALC1",89,0)
 . S LINE=LINE_"service:'"_$$QUOTE^VEFACSP1(SERVICE)_"',"
"RTN","VEFAALC1",90,0)
 . S LINE=LINE_"provider:'"_$$QUOTE^VEFACSP1(PROVIDER)_"',"
"RTN","VEFAALC1",91,0)
 . S LINE=LINE_"alertcategory:'"_$$QUOTE^VEFACSP1(ALERTCAT)_"',"
"RTN","VEFAALC1",92,0)
 . S LINE=LINE_"alerttype:'"_$$QUOTE^VEFACSP1(ALERTTY)_"',"
"RTN","VEFAALC1",93,0)
 . S LINE=LINE_"folup:'"_FOLUP_"',"
"RTN","VEFAALC1",94,0)
 . S LINE=LINE_"fol7days:'"_FOL7DAYS_"'}"
"RTN","VEFAALC1",95,0)
 . I ID<LAST S LINE=LINE_","
"RTN","VEFAALC1",96,0)
 . S @VEFARSLT@(ID)=LINE
"RTN","VEFAALC1",97,0)
 QUIT
"RTN","VEFAALC1",98,0)
 ;
"RTN","VEFAALC1",99,0)
GETDATA(DATA,IENS) ;Get single Alert Cache record for IENS
"RTN","VEFAALC1",100,0)
 ; INPUT
"RTN","VEFAALC1",101,0)
 ;   IENS : Internal Alert Cache Record ID
"RTN","VEFAALC1",102,0)
 ; OUTPUT
"RTN","VEFAALC1",103,0)
 ;   DATA : Alert Cache Record for IENS
"RTN","VEFAALC1",104,0)
 ;
"RTN","VEFAALC1",105,0)
 K DATA
"RTN","VEFAALC1",106,0)
 QUIT:$G(IENS)=""
"RTN","VEFAALC1",107,0)
 N FILE S FILE=19008.2
"RTN","VEFAALC1",108,0)
 N FIELDS S FIELDS=".01;1;2;3;4;5;6;7;8;9;10;11;12;13;14;16;17;18;19;20;21;22;23;24;25"
"RTN","VEFAALC1",109,0)
 N FLAGS S FLAGS=""
"RTN","VEFAALC1",110,0)
 N TARGET,ERR
"RTN","VEFAALC1",111,0)
 ;
"RTN","VEFAALC1",112,0)
 D GETS^DIQ(FILE,IENS,FIELDS,FLAGS,"TARGET","ERR")
"RTN","VEFAALC1",113,0)
 I '$D(ERR) D
"RTN","VEFAALC1",114,0)
 . N INDEX
"RTN","VEFAALC1",115,0)
 . F INDEX=.01,1:1:14,16:1:20,23,25 S DATA(INDEX)=$$QUOTE^VEFACSP1(TARGET(FILE,IENS_",",INDEX))
"RTN","VEFAALC1",116,0)
 . S DATA(24)=$S($$UP^XLFSTR(TARGET(FILE,IENS_",",24))="YES":"true",1:"false")
"RTN","VEFAALC1",117,0)
 . S DATA(21)=$S($$UP^XLFSTR(TARGET(FILE,IENS_",",21))="YES":"true",1:"false")
"RTN","VEFAALC1",118,0)
 . S DATA(22)=$S($$UP^XLFSTR(TARGET(FILE,IENS_",",22))="YES":"true",1:"false")
"RTN","VEFAALC1",119,0)
 Q
"RTN","VEFAALC1",120,0)
 ;
"RTN","VEFAALC1",121,0)
GETFOL(VEFARSLT,IENS) ;Get Alert Cache Followup data (multiple)
"RTN","VEFAALC1",122,0)
 ; INPUT
"RTN","VEFAALC1",123,0)
 ;   IENS     : Internal Alert Cache Record ID
"RTN","VEFAALC1",124,0)
 ; OUTPUT
"RTN","VEFAALC1",125,0)
 ;   VEFARSLT : Alert Cache Follow-up Records for IENS
"RTN","VEFAALC1",126,0)
 ;
"RTN","VEFAALC1",127,0)
 K VEFARSLT
"RTN","VEFAALC1",128,0)
 QUIT:$G(IENS)=""
"RTN","VEFAALC1",129,0)
 N FILE S FILE="19008.215"
"RTN","VEFAALC1",130,0)
 N FIELDS S FIELDS=".01;1"
"RTN","VEFAALC1",131,0)
 N FLAGS S FLAGS=""
"RTN","VEFAALC1",132,0)
 N NUMBER S NUMBER=""
"RTN","VEFAALC1",133,0)
 N FROM,PART
"RTN","VEFAALC1",134,0)
 N INDEX S INDEX="#"
"RTN","VEFAALC1",135,0)
 N SCREEN
"RTN","VEFAALC1",136,0)
 N IDENT S IDENT=""
"RTN","VEFAALC1",137,0)
 N TARGET,ERR
"RTN","VEFAALC1",138,0)
 ;
"RTN","VEFAALC1",139,0)
 D LIST^DIC(FILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFAALC1",140,0)
 N LAST S LAST=$O(TARGET("DILIST","ID"," "),-1)
"RTN","VEFAALC1",141,0)
 N ID S ID=""
"RTN","VEFAALC1",142,0)
 ;
"RTN","VEFAALC1",143,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFAALC1",144,0)
 . N IEN S IEN=TARGET("DILIST",2,ID)
"RTN","VEFAALC1",145,0)
 . N FOLACT S FOLACT=TARGET("DILIST","ID",ID,.01)
"RTN","VEFAALC1",146,0)
 . N FOLACTDT S FOLACTDT=TARGET("DILIST","ID",ID,1)
"RTN","VEFAALC1",147,0)
 . N LINE S LINE="  {"_"id:'"_IEN_"',"_"action:'"_$$QUOTE^VEFACSP1(FOLACT)_"',"_"date:'"_FOLACTDT_"'}"
"RTN","VEFAALC1",148,0)
 . S:ID<LAST LINE=LINE_","
"RTN","VEFAALC1",149,0)
 . S VEFARSLT(ID)=LINE
"RTN","VEFAALC1",150,0)
 Q
"RTN","VEFAALC1",151,0)
 ;
"RTN","VEFAALC1",152,0)
EX2YMD(DT) ;MMM DD, YYYY@HH:MM:SS to YYYY-MM-DD HH:MM:SS
"RTN","VEFAALC1",153,0)
 S DT=$$UP^XLFSTR(DT)
"RTN","VEFAALC1",154,0)
 N TIME S TIME=$P(DT,"@",2)
"RTN","VEFAALC1",155,0)
 S DT=$P(DT,"@")
"RTN","VEFAALC1",156,0)
 N YR S YR=$P(DT," ",3)
"RTN","VEFAALC1",157,0)
 N DD S DD=+$P(DT," ",2)
"RTN","VEFAALC1",158,0)
 N MM S MM=$F(",JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC,",","_$P(DT," ")_",")\4
"RTN","VEFAALC1",159,0)
 Q YR_"-"_MM_"-"_DD_" "_TIME
"RTN","VEFAALC2")
0^14^B5063079
"RTN","VEFAALC2",1,0)
VEFAALC2 ;WOIFO/BT - VEFA AWARE ALERT CATEGORY API CALLED BY CSP PAGE ; 01/22/2014
"RTN","VEFAALC2",2,0)
 ;;1.0;VEFA ALRE;**1**;MAY 1, 2011;Build 33
"RTN","VEFAALC2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","VEFAALC2",4,0)
 ;;
"RTN","VEFAALC2",5,0)
 ; External Reference DBIA#
"RTN","VEFAALC2",6,0)
 ; ------------------------
"RTN","VEFAALC2",7,0)
 ; #2053   - FILE^DIE (Supported)
"RTN","VEFAALC2",8,0)
 ; #2053   - UPDATE^DIE (Supported)
"RTN","VEFAALC2",9,0)
 ;
"RTN","VEFAALC2",10,0)
SAVE(TODO,IEN,RECORD,ERR) ;save Alert Category Record, return 1 (success), 0 (fail)
"RTN","VEFAALC2",11,0)
 ; INPUT
"RTN","VEFAALC2",12,0)
 ;   TODO   : add or edit
"RTN","VEFAALC2",13,0)
 ;   IEN    : ID of Alert Category Record to save
"RTN","VEFAALC2",14,0)
 ;   RECORD : Alert Category Record to save
"RTN","VEFAALC2",15,0)
 ; OUTPUT
"RTN","VEFAALC2",16,0)
 ;   ERR    : Error Message
"RTN","VEFAALC2",17,0)
 ; RETURN
"RTN","VEFAALC2",18,0)
 ;   1 - success
"RTN","VEFAALC2",19,0)
 ;   0 - failed
"RTN","VEFAALC2",20,0)
 ;
"RTN","VEFAALC2",21,0)
 S ERR=""
"RTN","VEFAALC2",22,0)
 N NAME S NAME=$P(RECORD,"^")
"RTN","VEFAALC2",23,0)
 N DESCR S DESCR=$P(RECORD,"^",2)
"RTN","VEFAALC2",24,0)
 N DELALERT S DELALERT=$P(RECORD,"^",3)
"RTN","VEFAALC2",25,0)
 N NOTFTYPE S NOTFTYPE=$P(RECORD,"^",4)
"RTN","VEFAALC2",26,0)
 N ACTION S ACTION=$P(RECORD,"^",5)
"RTN","VEFAALC2",27,0)
 N FDA,MSG
"RTN","VEFAALC2",28,0)
 ;
"RTN","VEFAALC2",29,0)
 I TODO="edit" D
"RTN","VEFAALC2",30,0)
 . I IEN="" S ERR="Invalid IEN" QUIT
"RTN","VEFAALC2",31,0)
 . I '$D(^DIZ(19008,IEN)) S ERR="Record doesn't exist" QUIT
"RTN","VEFAALC2",32,0)
 . S FDA(19008,IEN_",",1)=DELALERT
"RTN","VEFAALC2",33,0)
 . S FDA(19008,IEN_",",2)=ACTION
"RTN","VEFAALC2",34,0)
 . S FDA(19008,IEN_",",3)=DESCR
"RTN","VEFAALC2",35,0)
 . S FDA(19008,IEN_",",4)=NOTFTYPE
"RTN","VEFAALC2",36,0)
 . D FILE^DIE("E","FDA","MSG")
"RTN","VEFAALC2",37,0)
 ;
"RTN","VEFAALC2",38,0)
 I TODO="add" D
"RTN","VEFAALC2",39,0)
 . I NAME="" S ERR="Invalid Name" QUIT
"RTN","VEFAALC2",40,0)
 . I $D(^DIZ(19008,"B",NAME)) S ERR="<"_NAME_"> exists!" QUIT
"RTN","VEFAALC2",41,0)
 . S FDA(19008,"+1,",.01)=NAME
"RTN","VEFAALC2",42,0)
 . S FDA(19008,"+1,",1)=DELALERT
"RTN","VEFAALC2",43,0)
 . S FDA(19008,"+1,",2)=ACTION
"RTN","VEFAALC2",44,0)
 . S FDA(19008,"+1,",3)=DESCR
"RTN","VEFAALC2",45,0)
 . S FDA(19008,"+1,",4)=NOTFTYPE
"RTN","VEFAALC2",46,0)
 . D UPDATE^DIE("E","FDA","","MSG")
"RTN","VEFAALC2",47,0)
 ;
"RTN","VEFAALC2",48,0)
 QUIT:(ERR'="") 0
"RTN","VEFAALC2",49,0)
 ;
"RTN","VEFAALC2",50,0)
 I $D(MSG) D
"RTN","VEFAALC2",51,0)
 . N ERNO S ERNO=$O(MSG("DIERR",0))
"RTN","VEFAALC2",52,0)
 . S ERR=MSG("DIERR",ERNO,"TEXT",1)
"RTN","VEFAALC2",53,0)
 ;
"RTN","VEFAALC2",54,0)
 I '$D(MSG),TODO="add",NAME'="" S IEN=$O(^DIZ(19008,"B",NAME,0))
"RTN","VEFAALC2",55,0)
 ;
"RTN","VEFAALC2",56,0)
 Q (ERR="")
"RTN","VEFAALC2",57,0)
 ;
"RTN","VEFAALC2",58,0)
GETDELOP(DELOPTS) ;Get Alert Category Delete Options
"RTN","VEFAALC2",59,0)
 ; INPUT
"RTN","VEFAALC2",60,0)
 ;   NONE
"RTN","VEFAALC2",61,0)
 ; OUTPUT
"RTN","VEFAALC2",62,0)
 ;   DELOPTS : Reference arrays containing Alert Delete options
"RTN","VEFAALC2",63,0)
 ;
"RTN","VEFAALC2",64,0)
 S U = "^"
"RTN","VEFAALC2",65,0)
 N OPTIONS S OPTIONS=$P(^DD(19008,1,0),U,3)
"RTN","VEFAALC2",66,0)
 N IOPT
"RTN","VEFAALC2",67,0)
 F IOPT=1:1:$L(OPTIONS,";") D
"RTN","VEFAALC2",68,0)
 . N OPT S OPT=$P(OPTIONS,";",IOPT)
"RTN","VEFAALC2",69,0)
 . I OPT'="" D
"RTN","VEFAALC2",70,0)
 . . N DESCR S DESCR=$P(OPT,":",2)
"RTN","VEFAALC2",71,0)
 . . S DELOPTS(IOPT)=DESCR ;"<option value='"_DESCR_"'>"_DESCR_"</option>"
"RTN","VEFAALC2",72,0)
 Q
"RTN","VEFAALR1")
0^8^B246639783
"RTN","VEFAALR1",1,0)
VEFAALR1 ;IHV/VEFA - Module 2 for CPRS COM OBJECT [ 12/01/2010 ]
"RTN","VEFAALR1",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR1",3,0)
LOOKUP(RY,ZP) ;Do a lookup for a VEFA Tracked Critical Alert AND check if pointing to passd class in VEFA CRITICAL ALERT CATEGORY (in FILE (19008))
"RTN","VEFAALR1",4,0)
 ;;
"RTN","VEFAALR1",5,0)
 ; ZP = TYPE OF ALERT  ^ CLASS OF ALERT
"RTN","VEFAALR1",6,0)
 ; RY = 1 IF UNACKNOWLEDGED TYPE ALERT DEFINED
"RTN","VEFAALR1",7,0)
 ;
"RTN","VEFAALR1",8,0)
 K RY
"RTN","VEFAALR1",9,0)
 ;S RY="ASX" Q
"RTN","VEFAALR1",10,0)
 N VEFAVAL,VEFACLAS,VEFCIEN,VEFAPCL,VEFAALRT,VEFACIEN
"RTN","VEFAALR1",11,0)
 S VEFAALRT=$P(ZP,U,1) ;Type of Alert being looked up.
"RTN","VEFAALR1",12,0)
 S VEFACLAS=$P(ZP,U,2)
"RTN","VEFAALR1",13,0)
 S VEFAVAL=0
"RTN","VEFAALR1",14,0)
 S VEFAVAL=$O(^DIZ(19007,"B",VEFAALRT,VEFAVAL))
"RTN","VEFAALR1",15,0)
 I VEFAVAL'="" D
"RTN","VEFAALR1",16,0)
 .;MOD 8/9/2014 GOW IGNORE WHICH OF MULTIPLE ALERT CATEGORIES. ALERT TYPE IS UNIQUE USUALLY
"RTN","VEFAALR1",17,0)
 .;BUT IN CASE SAME NAMES WITH MULTIPLE SAME NAMEED ALERT TYPES WITH DIFFERENT CATEGORIES
"RTN","VEFAALR1",18,0)
 .;NOT OBJECT WITH INCORECT CATEGORY NOT FOUND WITH SAME NAMED (DUPLICATE) ALERT TYPES IN
"RTN","VEFAALR1",19,0)
 .; B CROSS REFERENCE WITH DLL PROCESSING. ALERT CACHE TRACKING DOES LOOK AT ALERT CATEGORY.
"RTN","VEFAALR1",20,0)
 .Q
"RTN","VEFAALR1",21,0)
 .;END MOD
"RTN","VEFAALR1",22,0)
 .;CHECK VEFA CRITICAL ALERT CATEGORY FILE ENTRY.
"RTN","VEFAALR1",23,0)
 .;COMPARE TO PASSED ALERT CATEGORY
"RTN","VEFAALR1",24,0)
 .;get class passed IEN
"RTN","VEFAALR1",25,0)
 .S VEFACIEN=0
"RTN","VEFAALR1",26,0)
 .S VEFACIEN=$O(^DIZ(19008,"B",VEFACLAS,VEFACIEN))
"RTN","VEFAALR1",27,0)
 .;GET POINTED TO CLASS OF VEFA ALERT (VEFAPCL)
"RTN","VEFAALR1",28,0)
 .S VEFAPCL=$P($G(^DIZ(19007,VEFAVAL,3)),"^",3)
"RTN","VEFAALR1",29,0)
 .;S ^XTMP("VEFAPCL")=VEFAPCL_"^"_VEFACIEN
"RTN","VEFAALR1",30,0)
 .I VEFAPCL'=VEFACIEN S VEFAVAL=0  ; NOT MATCH
"RTN","VEFAALR1",31,0)
 E  D
"RTN","VEFAALR1",32,0)
 .S VEFAVAL=0
"RTN","VEFAALR1",33,0)
 S RY=VEFAVAL
"RTN","VEFAALR1",34,0)
 Q
"RTN","VEFAALR1",35,0)
CAT(X) ;D0 AS X
"RTN","VEFAALR1",36,0)
 N VEFACNT,VEFACAT,VEFANOTF,VEFACATY,VEFAALNT,VEFADSPL,VEFACATN,VEFAUTCA,VEFAENTR,VEFANAME,VEFAACTV,VEFAALDT
"RTN","VEFAALR1",37,0)
 ;MOD 8/7/14 GOW
"RTN","VEFAALR1",38,0)
 N VEFACATT
"RTN","VEFAALR1",39,0)
 ;END MOD
"RTN","VEFAALR1",40,0)
 N D0
"RTN","VEFAALR1",41,0)
 S D0=X
"RTN","VEFAALR1",42,0)
 S VEFACATY=0  ; NOT CATEGORY CLASS
"RTN","VEFAALR1",43,0)
 ;GET NOTIFICATION TYPE FOR THIS ALERT
"RTN","VEFAALR1",44,0)
 S VEFAALNT=$P($P($P($G(^XTV(8992.1,D0,0)),"^",1),";",1),",",3)
"RTN","VEFAALR1",45,0)
 ;GET DATE CREATED
"RTN","VEFAALR1",46,0)
 S VEFAALDT=$P($G(^XTV(8992.1,D0,0)),"^",2)
"RTN","VEFAALR1",47,0)
 ;GET DISPLAY EXT THIS TYPE OF ALERT
"RTN","VEFAALR1",48,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,1)),"^",1)
"RTN","VEFAALR1",49,0)
 S VEFACAT=0
"RTN","VEFAALR1",50,0)
 F  S VEFACAT=$O(^DIZ(19008,"B",VEFACAT)) Q:VEFACAT=""  D
"RTN","VEFAALR1",51,0)
 .S VEFACNT=0
"RTN","VEFAALR1",52,0)
 .S VEFACNT=$O(^DIZ(19008,"B",VEFACAT,VEFACNT)) D
"RTN","VEFAALR1",53,0)
 ..;GET NOTIFICATION TYPE
"RTN","VEFAALR1",54,0)
 ..S VEFANOTF=$P($G(^DIZ(19008,VEFACNT,1)),"^",2)
"RTN","VEFAALR1",55,0)
 ..I VEFANOTF=VEFAALNT D
"RTN","VEFAALR1",56,0)
 ...I VEFACATY'=1 S VEFACATY=2
"RTN","VEFAALR1",57,0)
 ...S VEFACATN=$P($G(^DIZ(19008,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",58,0)
 ...I VEFADSPL[VEFACATN D
"RTN","VEFAALR1",59,0)
 ....I VEFACATY'=1 S VEFACATY=3
"RTN","VEFAALR1",60,0)
 ....; LOOP THROUGH UNIQUE VEFA TRACKED CRITICAL ALERTS
"RTN","VEFAALR1",61,0)
 ....S VEFAUTCA=0
"RTN","VEFAALR1",62,0)
 ....;MOD 8/7/14 GOW 
"RTN","VEFAALR1",63,0)
 ....;F  S VEFAUTCA=$O(^DIZ(19007,"B",VEFAUTCA)) Q:VEFAUTCA="" D
"RTN","VEFAALR1",64,0)
 ....F  S VEFAUTCA=$O(^DIZ(19007,"B",VEFAUTCA)) Q:(VEFAUTCA="")!(VEFACATY=1)  D
"RTN","VEFAALR1",65,0)
 .....;END MOD
"RTN","VEFAALR1",66,0)
 .....;GET ENTRY
"RTN","VEFAALR1",67,0)
 .....S VEFAENTR=0
"RTN","VEFAALR1",68,0)
 .....;MOD 8/89/2014 GOW 
"RTN","VEFAALR1",69,0)
 .....;S VEFAENTR=$O(^DIZ(19007,"B",VEFAUTCA,VEFAENTR))
"RTN","VEFAALR1",70,0)
 .....F  S VEFAENTR=$O(^DIZ(19007,"B",VEFAUTCA,VEFAENTR)) Q:(VEFAENTR="")!(VEFACATY=1)  D
"RTN","VEFAALR1",71,0)
 ......S VEFANAME=$P(^DIZ(19007,VEFAENTR,0),"^",1)
"RTN","VEFAALR1",72,0)
 ......S VEFAACTV=$P(^DIZ(19007,VEFAENTR,3),"^",4) ;ACTIVATION DATE OF SPECIFIC ALERT TYPE
"RTN","VEFAALR1",73,0)
 ......;MOD 8/7/14 GOW GET ALERT CATEGORY POINTER
"RTN","VEFAALR1",74,0)
 ......S VEFACATT=$P(^DIZ(19007,VEFAENTR,3),"^",3)
"RTN","VEFAALR1",75,0)
 ......;I (VEFADSPL[VEFANAME)&('(VEFAALDT<VEFAACTV)) S VEFACATY=1
"RTN","VEFAALR1",76,0)
 ......I (VEFADSPL[VEFANAME)&('(VEFAALDT<VEFAACTV))&(VEFACATT=VEFACNT) S VEFACATY=1
"RTN","VEFAALR1",77,0)
 .....;END MOD
"RTN","VEFAALR1",78,0)
 .....;W !,"VEFADSPL=",VEFADSPL," VEFAALDT=",VEFAALDT," VEFAACTV=",VEFAACTV,"VEFACATY=",VEFACATY
"RTN","VEFAALR1",79,0)
 I (VEFACATY=2)!(VEFACATY=3) S VEFACATY=0
"RTN","VEFAALR1",80,0)
 Q VEFACATY
"RTN","VEFAALR1",81,0)
SERVICE(X) ;
"RTN","VEFAALR1",82,0)
 ;RETURN SERVICE LINE OF INITIAL RECEIPIENT PROVIDER'S SERVICE LINE
"RTN","VEFAALR1",83,0)
 N VEFCNT,D0,VEFAPRV,VEFASYS,VEFAPRV1,VEFAPRV2,VEFALIST,VEFAPRV3,VEFAPRV4,VEFASYSS,PATIENT,ALERTID,PATIENT1
"RTN","VEFAALR1",84,0)
 N FACNAME,DEFALINS
"RTN","VEFAALR1",85,0)
 ;
"RTN","VEFAALR1",86,0)
 N ORDER
"RTN","VEFAALR1",87,0)
 S D0=X
"RTN","VEFAALR1",88,0)
 S VEFAPRV=0
"RTN","VEFAALR1",89,0)
 S VEFASYS="NUL"
"RTN","VEFAALR1",90,0)
 S VEFAPRV1="NUL"
"RTN","VEFAALR1",91,0)
 S VEFALIST=""
"RTN","VEFAALR1",92,0)
 S PATIENT=""
"RTN","VEFAALR1",93,0)
 ;F  S VEFAPRV=$O(^XTV(8992.1,D0,20,"B",VEFAPRV)) Q:(VEFAPRV="")!(VEFASYS'="NUL")  D
"RTN","VEFAALR1",94,0)
 F  S VEFAPRV=$O(^XTV(8992.1,D0,20,"B",VEFAPRV)) Q:(VEFAPRV="")  D
"RTN","VEFAALR1",95,0)
 .S VEFACNT=0
"RTN","VEFAALR1",96,0)
 .S VEFACNT=$O(^XTV(8992.1,D0,20,"B",VEFAPRV,VEFACNT)) I VEFACNT=1 D
"RTN","VEFAALR1",97,0)
 ..;TAKE FIRST "INITIAL RECIPIENT" TYPE AS ASSUMED ORDERING PROVIDER. COULD BE OTHERS INCLUDING LAB TECH, RADIOLOGIST, AND OE/RR TEAMS
"RTN","VEFAALR1",98,0)
 ..;GET SERVICE LINE (CLINIC) 
"RTN","VEFAALR1",99,0)
 ..S VEFAPRV2=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",100,0)
 ..I VEFAPRV2'="" D
"RTN","VEFAALR1",101,0)
 ...S VEFASYS=$P($G(^VA(200,VEFAPRV2,5)),"^",1)
"RTN","VEFAALR1",102,0)
 ...S VEFAPRV1=$P($G(^VA(200,VEFAPRV2,0)),"^",1)
"RTN","VEFAALR1",103,0)
 ...S VEFAPRV1=VEFAPRV1_" - "_VEFAPRV2
"RTN","VEFAALR1",104,0)
 ...;CORRECT ORDERING PROVIDER
"RTN","VEFAALR1",105,0)
 ...;GET ORDER FOR LAB ORDERS. TAKE AS IS FOR IMAGING ORDER FOR NOW
"RTN","VEFAALR1",106,0)
 ...S ORDER=$P($G(^XTV(8992.1,D0,2)),"@",1)
"RTN","VEFAALR1",107,0)
 ...I (ORDER'["~")&(ORDER'="") D
"RTN","VEFAALR1",108,0)
 ....;GET ORDERING PROVIDER FROM ORDER
"RTN","VEFAALR1",109,0)
 ....S VEFAPRV2=$P($G(^OR(100,ORDER,0)),"^",4)
"RTN","VEFAALR1",110,0)
 ....S VEFAPRV1=$P($G(^VA(200,VEFAPRV2,0)),"^",1)
"RTN","VEFAALR1",111,0)
 ....S VEFAPRV1=VEFAPRV1_" - "_VEFAPRV2
"RTN","VEFAALR1",112,0)
 ..I VEFASYS'="" D
"RTN","VEFAALR1",113,0)
 ...S VEFASYS=$P($G(^DIC(49,VEFASYS,0)),"^",1)
"RTN","VEFAALR1",114,0)
 ..E  D
"RTN","VEFAALR1",115,0)
 ...S VEFASYS="NUL"
"RTN","VEFAALR1",116,0)
 .;
"RTN","VEFAALR1",117,0)
 .S PATIENT1=""
"RTN","VEFAALR1",118,0)
 .S PATIENT=$P($G(^XTV(8992.1,D0,0)),"^",4)
"RTN","VEFAALR1",119,0)
 .I PATIENT'="" S PATIENT1=$P($G(^DPT(PATIENT,0)),"^",1)
"RTN","VEFAALR1",120,0)
 .S PATIENT1=PATIENT
"RTN","VEFAALR1",121,0)
 .S ALERTID=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR1",122,0)
 .;
"RTN","VEFAALR1",123,0)
 .D
"RTN","VEFAALR1",124,0)
 ..;TAKE FIRST "INITIAL RECIPIENT" TYPE AS ASSUMED ORDERING PROVIDER. COULD BE OTHERS INCLUDING LAB TECH, RADIOLOGIST, AND OE/RR TEAMS
"RTN","VEFAALR1",125,0)
 ..;GET SERVICE LINE (CLINIC) 
"RTN","VEFAALR1",126,0)
 ..S VEFAPRV4=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",127,0)
 ..I VEFAPRV4'="" D
"RTN","VEFAALR1",128,0)
 ...S VEFASYSS=$P($G(^VA(200,VEFAPRV4,5)),"^",1)
"RTN","VEFAALR1",129,0)
 ...S VEFAPRV3=$P($G(^VA(200,VEFAPRV4,0)),"^",1)
"RTN","VEFAALR1",130,0)
 ..I VEFASYSS'="" D
"RTN","VEFAALR1",131,0)
 ...S VEFASYSS=$P($G(^DIC(49,VEFASYSS,0)),"^",1)
"RTN","VEFAALR1",132,0)
 ..E  D
"RTN","VEFAALR1",133,0)
 ...S VEFASYSS="NUL"
"RTN","VEFAALR1",134,0)
 ..S VEFALIST=VEFALIST_VEFAPRV3_" - "_VEFAPRV4_";"
"RTN","VEFAALR1",135,0)
 ;GET FACILITY NAME FROM INSTITUTION FROM KERENEL SYSTEM PARAMETERS 'S DEFAULT INSTITUTION
"RTN","VEFAALR1",136,0)
 S FACNAME=""
"RTN","VEFAALR1",137,0)
 S DEFALINS=$P($G(^XTV(8989.3,1,"XUS")),"^",17)
"RTN","VEFAALR1",138,0)
 I DEFALINS'="" S FACNAME=$P($G(^DIC(4,DEFALINS,99)),"^",3)
"RTN","VEFAALR1",139,0)
 Q ALERTID_"^"_FACNAME_"^"_VEFASYS_"^"_VEFAPRV1_"^"_VEFALIST_"^"_PATIENT1_"^"_$E($$ALERT(X),1,60)
"RTN","VEFAALR1",140,0)
SERVIC1(X) ;
"RTN","VEFAALR1",141,0)
 ;RETURN SERVICE LINE OF INITIAL RECEIPIENT PROVIDER'S SERVICE LINE
"RTN","VEFAALR1",142,0)
 N VEFCNT,D0,VEFAPRV,VEFASYS,VEFAPRV1,VEFAPRV2
"RTN","VEFAALR1",143,0)
 S D0=X
"RTN","VEFAALR1",144,0)
 S VEFAPRV=0
"RTN","VEFAALR1",145,0)
 S VEFASYS="NUL"
"RTN","VEFAALR1",146,0)
 S VEFAPRV1="NUL"
"RTN","VEFAALR1",147,0)
 F  S VEFAPRV=$O(^XTV(8992.1,D0,20,"B",VEFAPRV)) Q:(VEFAPRV="")!(VEFASYS'="NUL")  D
"RTN","VEFAALR1",148,0)
 .S VEFACNT=0
"RTN","VEFAALR1",149,0)
 .S VEFACNT=$O(^XTV(8992.1,D0,20,"B",VEFAPRV,VEFACNT)) I VEFACNT=1 D
"RTN","VEFAALR1",150,0)
 ..;TAKE FIRST "INITIAL RECIPIENT" TYPE AS ASSUMED ORDERING PROVIDER. COULD BE OTHERS INCLUDING LAB TECH, RADIOLOGIST, AND OE/RR TEAMS
"RTN","VEFAALR1",151,0)
 ..;GET SERVICE LINE (CLINIC) 
"RTN","VEFAALR1",152,0)
 ..S VEFAPRV2=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",153,0)
 ..I VEFAPRV2'="" D
"RTN","VEFAALR1",154,0)
 ...S VEFASYS=$P($G(^VA(200,VEFAPRV2,5)),"^",1)
"RTN","VEFAALR1",155,0)
 ...S VEFAPRV1=$P($G(^VA(200,VEFAPRV2,0)),"^",1)
"RTN","VEFAALR1",156,0)
 ..I VEFASYS'="" D
"RTN","VEFAALR1",157,0)
 ...S VEFASYS=$P($G(^DIC(49,VEFASYS,0)),"^",1)
"RTN","VEFAALR1",158,0)
 ..E  D
"RTN","VEFAALR1",159,0)
 ...S VEFASYS="NUL"
"RTN","VEFAALR1",160,0)
 Q VEFASYS_"^"_VEFAPRV2_"^"_$E($$ALERT1(X),1,60)
"RTN","VEFAALR1",161,0)
STATUS(X) ;
"RTN","VEFAALR1",162,0)
 ;RETURN A RECIPINT'S UNACKNOWLEDGED STATUS^RENEW DATE^ACKNOWLEDGED OR DELETED DATE
"RTN","VEFAALR1",163,0)
 ;RENEW DATE MEANS NON-NULL PROCESSED DATE W/O DELETED DATE
"RTN","VEFAALR1",164,0)
 ;ACKNOWLEDGED DATE MEANS NON-NULL PROCESSED DATE AND DELETE DATE
"RTN","VEFAALR1",165,0)
 ;UNACKNOWLEDGED STATUS MEANS NULL PROCESSED DATE AND NULL DELETE DATE
"RTN","VEFAALR1",166,0)
 N VEFCNT,D0,VEFAPRV,VEFASYS,VEFAPRV1,VEFAPRV2,VEFAPROC,VEFADELE,VEFAOVER,VEFAENTR,VEFADATE,VEFADSPL,VEFADAT1,VEFALAST,VEFACNT2
"RTN","VEFAALR1",167,0)
 N VEFAPROV
"RTN","VEFAALR1",168,0)
 ;
"RTN","VEFAALR1",169,0)
 N Y
"RTN","VEFAALR1",170,0)
 S D0=X
"RTN","VEFAALR1",171,0)
 S VEFAPRV=0
"RTN","VEFAALR1",172,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR1",173,0)
 ;W !,"VEFADSPL=",VEFADSPL
"RTN","VEFAALR1",174,0)
 S VEFASYS="YES"  ; UNACKNOWLEDGED AS DEFAULT
"RTN","VEFAALR1",175,0)
 S VEFAOVER=0
"RTN","VEFAALR1",176,0)
 F  S VEFAPRV=$O(^XTV(8992.1,D0,20,"B",VEFAPRV)) Q:(VEFAPRV="")!(VEFAOVER=1)  D
"RTN","VEFAALR1",177,0)
 .S VEFACNT=0
"RTN","VEFAALR1",178,0)
 .S VEFACNT=$O(^XTV(8992.1,D0,20,"B",VEFAPRV,VEFACNT)) D
"RTN","VEFAALR1",179,0)
 ..;TAKE ALL "INITIAL RECIPIENT" TYPES AS ASSUMED ORDERING PROVIDER FIRST. COULD BE OTHERS INCLUDING LAB TECH, RADIOLOGIST, AND OE/RR TEAMS
"RTN","VEFAALR1",180,0)
 ..;GET SERVICE LINE (CLINIC) 
"RTN","VEFAALR1",181,0)
 ..S VEFAPRV2=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",182,0)
 ..I VEFAPRV2'="" D
"RTN","VEFAALR1",183,0)
 ...;GET PROCESSED DATE
"RTN","VEFAALR1",184,0)
 ...S VEFAPROC=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",4) I VEFAPROC'="" S Y=VEFAPROC X ^DD("DD") S VEFAPROC=Y
"RTN","VEFAALR1",185,0)
 ...;W !,VEFAPROC
"RTN","VEFAALR1",186,0)
 ...S VEFADELE=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",5) I VEFADELE'="" S Y=VEFADELE X ^DD("DD") S VEFADELE=Y
"RTN","VEFAALR1",187,0)
 ...;W !,VEFADELE
"RTN","VEFAALR1",188,0)
 ...;CHECK IF REALLY DELETED OR JUST RENEWED. LOOK INTO DINUM ALERT FILE ENTRY FOR PROVIDER DOING PROCESSING/DELETING/RENEWING
"RTN","VEFAALR1",189,0)
 ...; ACTUALLY ALL RECIPIENTS SHOULD BE RENEWED INCLUDING FIRST INITIAL RECIPIENT AS ORDERING PROVIDER
"RTN","VEFAALR1",190,0)
 ...S VEFADATE=$P($P($G(^XTV(8992.1,D0,0)),"^",1),";",3)-.01
"RTN","VEFAALR1",191,0)
 ...S VEFAENTR=""
"RTN","VEFAALR1",192,0)
 ...;I $G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)) I $P($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)),"^",2)=VEFADSPL S VEFAENTR=1 ;D1,0)
"RTN","VEFAALR1",193,0)
 ...;CHECK NEXT RECORD AS ONE MORE CHANCE SKIPPING OVER INFO ALERT IF STILL THERE TO CHECK :REAL' ALERT
"RTN","VEFAALR1",194,0)
 ...S VEFALAST=0
"RTN","VEFAALR1",195,0)
 ...S VEFACNT2=0
"RTN","VEFAALR1",196,0)
 ...F  S VEFADATE=$O(^XTV(8992,VEFAPRV2,"XQA",VEFADATE)) Q:(VEFALAST=1)!(VEFADATE="")  D
"RTN","VEFAALR1",197,0)
 ....;ADD .00000001
"RTN","VEFAALR1",198,0)
 ....;S VEFADAT1=VEFADATE+.00000001
"RTN","VEFAALR1",199,0)
 ....S VEFACNT2=VEFACNT2+1  ; CAN AT MOST BE 2
"RTN","VEFAALR1",200,0)
 ....;W !,VEFADAT1
"RTN","VEFAALR1",201,0)
 ....;W !,$G(^XTV(8992,VEFAPRV2,"XQA",VEFADAT1,0))
"RTN","VEFAALR1",202,0)
 ....;W !,VEFADSPL
"RTN","VEFAALR1",203,0)
 ....;W !,VEFAENTR
"RTN","VEFAALR1",204,0)
 ....;SOMETIMES HAS TO SKIP OVER ANY INFO ALERT
"RTN","VEFAALR1",205,0)
 ....I ($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0))) I $P($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)),"^",2)=VEFADSPL D
"RTN","VEFAALR1",206,0)
 .....S VEFAENTR=1 ;D1,0
"RTN","VEFAALR1",207,0)
 .....I (VEFAPROC'="") S VEFADELE=""
"RTN","VEFAALR1",208,0)
 ....;.W !,VEFAENTR
"RTN","VEFAALR1",209,0)
 ....I VEFACNT2=2 I (VEFAENTR="")&(VEFADELE'="") S VEFAPROC=""
"RTN","VEFAALR1",210,0)
 ....I (VEFAPROC'="")!(VEFADELE'="") S VEFASYS="" S VEFAOVER=1
"RTN","VEFAALR1",211,0)
 ....I (VEFACNT2=1)&($P($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)),"^",2)=VEFADSPL) S VEFALAST=1
"RTN","VEFAALR1",212,0)
 ....I (VEFACNT2=2) S VEFALAST=1
"RTN","VEFAALR1",213,0)
 S VEFAPROV=""  ; PROVIDER
"RTN","VEFAALR1",214,0)
 I (VEFAPROC'="")!(VEFADELE'="") D
"RTN","VEFAALR1",215,0)
 .; DINUM PROVIDER IN ALERT FILE TO NEW PERSON FILE
"RTN","VEFAALR1",216,0)
 .I VEFAPRV2'="" S VEFAPROV=$P($G(^VA(200,VEFAPRV2,0)),"^",1)_" - "_VEFAPRV2
"RTN","VEFAALR1",217,0)
 Q VEFASYS_"^"_VEFAPROC_"^"_VEFADELE_"^"_VEFAPROV
"RTN","VEFAALR1",218,0)
STATUS1(X) ;
"RTN","VEFAALR1",219,0)
 ;RETURN A RECIPINT'S UNACKNOWLEDGED STATUS^RENEW DATE^ACKNOWLEDGED OR DELETED DATE
"RTN","VEFAALR1",220,0)
 ;RENEW DATE MEANS NON-NULL PROCESSED DATE W/O DELETED DATE
"RTN","VEFAALR1",221,0)
 ;ACKNOWLEDGED DATE MEANS NON-NULL PROCESSED DATE AND DELETE DATE
"RTN","VEFAALR1",222,0)
 ;UNACKNOWLEDGED STATUS MEANS NULL PROCESSED DATE AND NULL DELETE DATE
"RTN","VEFAALR1",223,0)
 N VEFCNT,D0,VEFAPRV,VEFASYS,VEFAPRV1,VEFAPRV2,VEFAPROC,VEFADELE,VEFAOVER,VEFAENTR,VEFADATE,VEFADSPL,VEFADAT1,VEFALAST,VEFACNT2
"RTN","VEFAALR1",224,0)
 N VEFADEL1 ; LINEAR TEMPSON TIME FOR COMPARISON IN SUBSEQUENT CALL
"RTN","VEFAALR1",225,0)
 ;
"RTN","VEFAALR1",226,0)
 N VEFAPRO1
"RTN","VEFAALR1",227,0)
 S D0=X
"RTN","VEFAALR1",228,0)
 S VEFAPRV=0
"RTN","VEFAALR1",229,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR1",230,0)
 ;W !,"VEFADSPL=",VEFADSPL
"RTN","VEFAALR1",231,0)
 S VEFASYS="YES"  ; UNACKNOWLEDGED AS DEFAULT
"RTN","VEFAALR1",232,0)
 S VEFAOVER=0
"RTN","VEFAALR1",233,0)
 S VEFAPROC="" S VEFADELE=""
"RTN","VEFAALR1",234,0)
 F  S VEFAPRV=$O(^XTV(8992.1,D0,20,"B",VEFAPRV)) Q:(VEFAPRV="")!(VEFAOVER=1)  D
"RTN","VEFAALR1",235,0)
 .S VEFACNT=0
"RTN","VEFAALR1",236,0)
 .;I D0=264 S ^XTMP("WELCH","VEFAPRV",VEFAPRV)=VEFAPRV
"RTN","VEFAALR1",237,0)
 .S VEFACNT=$O(^XTV(8992.1,D0,20,"B",VEFAPRV,VEFACNT)) D
"RTN","VEFAALR1",238,0)
 ..;TAKE ALL "INITIAL RECIPIENT" TYPES AS ASSUMED ORDERING PROVIDER FIRST. COULD BE OTHERS INCLUDING LAB TECH, RADIOLOGIST, AND OE/RR TEAMS
"RTN","VEFAALR1",239,0)
 ..;GET SERVICE LINE (CLINIC) 
"RTN","VEFAALR1",240,0)
 ..S VEFAPRV2=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",241,0)
 ..I VEFAPRV2'="" D
"RTN","VEFAALR1",242,0)
 ...;GET PROCESSED DATE
"RTN","VEFAALR1",243,0)
 ...I VEFAPROC="" S VEFAPROC=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",4) I VEFAPROC'="" S VEFAPRO1=VEFAPROC S Y=VEFAPROC X ^DD("DD") S VEFAPROC=Y
"RTN","VEFAALR1",244,0)
 ...;W !,VEFAPROC
"RTN","VEFAALR1",245,0)
 ...I VEFADELE="" S VEFADELE=$P($G(^XTV(8992.1,D0,20,VEFACNT,0)),"^",5) I VEFADELE'="" S VEFADEL1=VEFADELE S Y=VEFADELE X ^DD("DD") S VEFADELE=Y
"RTN","VEFAALR1",246,0)
 ...;W !,VEFADELE
"RTN","VEFAALR1",247,0)
 ...;CHECK IF REALLY DELETED OR JUST RENEWED. LOOK INTO DINUM ALERT FILE ENTRY FOR PROVIDER DOING PROCESSING/DELETING/RENEWING
"RTN","VEFAALR1",248,0)
 ...; ACTUALLY ALL RECIPIENTS SHOULD BE RENEWED INCLUDING FIRST INITIAL RECIPIENT AS ORDERING PROVIDER
"RTN","VEFAALR1",249,0)
 ...S VEFADATE=$P($P($G(^XTV(8992.1,D0,0)),"^",1),";",3)-.01
"RTN","VEFAALR1",250,0)
 ...S VEFAENTR=""
"RTN","VEFAALR1",251,0)
 ...;I $G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)) I $P($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)),"^",2)=VEFADSPL S VEFAENTR=1 ;D1,0)
"RTN","VEFAALR1",252,0)
 ...;CHECK NEXT RECORD AS ONE MORE CHANCE SKIPPING OVER INFO ALERT IF STILL THERE TO CHECK :REAL' ALERT
"RTN","VEFAALR1",253,0)
 ...S VEFALAST=0
"RTN","VEFAALR1",254,0)
 ...S VEFACNT2=0
"RTN","VEFAALR1",255,0)
 ...F  S VEFADATE=$O(^XTV(8992,VEFAPRV2,"XQA",VEFADATE)) Q:(VEFALAST=1)!(VEFADATE="")  D
"RTN","VEFAALR1",256,0)
 ....;ADD .00000001
"RTN","VEFAALR1",257,0)
 ....;S VEFADAT1=VEFADATE+.00000001
"RTN","VEFAALR1",258,0)
 ....S VEFACNT2=VEFACNT2+1  ; CAN AT MOST BE 2
"RTN","VEFAALR1",259,0)
 ....;W !,VEFADAT1
"RTN","VEFAALR1",260,0)
 ....;W !,$G(^XTV(8992,VEFAPRV2,"XQA",VEFADAT1,0))
"RTN","VEFAALR1",261,0)
 ....;W !,VEFADSPL
"RTN","VEFAALR1",262,0)
 ....;W !,VEFAENTR
"RTN","VEFAALR1",263,0)
 ....;SOMETIMES HAS TO SKIP OVER ANY INFO ALERT
"RTN","VEFAALR1",264,0)
 ....;I D0=264 S ^XTMP("WELCH",VEFAPRV2,VEFACNT2)=VEFADATE_"^"_VEFADSPL
"RTN","VEFAALR1",265,0)
 ....I ($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0))) I $P($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)),"^",2)=VEFADSPL D
"RTN","VEFAALR1",266,0)
 .....;
"RTN","VEFAALR1",267,0)
 .....;I D0=264 S ^XTMP("WELCH","D0",VEFACNT2,VEFADATE)=VEFADELE_"^"_VEFAPROC
"RTN","VEFAALR1",268,0)
 .....S VEFAENTR=1 ;D1,0
"RTN","VEFAALR1",269,0)
 .....I (VEFAPROC'="") S VEFADELE=""
"RTN","VEFAALR1",270,0)
 ....;.W !,VEFAENTR
"RTN","VEFAALR1",271,0)
 ....I VEFACNT2=2 I (VEFAENTR="")&(VEFADELE'="") S VEFAPROC=""
"RTN","VEFAALR1",272,0)
 ....I (VEFAPROC'="")!(VEFADELE'="") S VEFASYS="" S VEFAOVER=1
"RTN","VEFAALR1",273,0)
 ....I (VEFACNT2=1)&($P($G(^XTV(8992,VEFAPRV2,"XQA",VEFADATE,0)),"^",2)=VEFADSPL) S VEFALAST=1
"RTN","VEFAALR1",274,0)
 ....I (VEFACNT2=2) S VEFALAST=1
"RTN","VEFAALR1",275,0)
 ;I D0=264 S ^XTMP("WELCH","ENDPRV")=VEFAPRV_"^"_VEFAOVER
"RTN","VEFAALR1",276,0)
 I VEFADELE'="" D  ; CONVERT BACK TO LINEAR TIME
"RTN","VEFAALR1",277,0)
 .S VEFADELE=VEFADEL1
"RTN","VEFAALR1",278,0)
 E  D
"RTN","VEFAALR1",279,0)
 .S VEFADELE=""
"RTN","VEFAALR1",280,0)
 ;NEW CODE 5/12/2014
"RTN","VEFAALR1",281,0)
 I VEFAPROC'="" D  ; CONVERT BACK TO LINEAR TIME
"RTN","VEFAALR1",282,0)
 .S VEFAPROC=VEFAPRO1
"RTN","VEFAALR1",283,0)
 E  D
"RTN","VEFAALR1",284,0)
 .S VEFAPROC=""
"RTN","VEFAALR1",285,0)
 ;ADJUSTMENT NEXT FOR SURROGATE RE-FORWARD BACK TO ORIGINATING PROVIDER. TEMPORARY FOR NOW. IF BOTH VEFADELE'="" AND VEFAPROC'=" S VEFADELE=""
"RTN","VEFAALR1",286,0)
 ;;;;;I (VEFADELE'="")&(VEFAPROC'="") S VEFADELE="" 
"RTN","VEFAALR1",287,0)
 Q VEFASYS_"^"_VEFAPROC_"^"_VEFADELE
"RTN","VEFAALR1",288,0)
ALERT(X) ;D0 AS X
"RTN","VEFAALR1",289,0)
 N VEFACNT,VEFACAT,VEFANOTF,VEFACATY,VEFAALNT,VEFADSPL,VEFACATN,VEFAUTCA,VEFAENTR,VEFANAME
"RTN","VEFAALR1",290,0)
 N D0
"RTN","VEFAALR1",291,0)
 ;MOD 8/7/14 GOW
"RTN","VEFAALR1",292,0)
 N VEFACATT
"RTN","VEFAALR1",293,0)
 ;END MOD
"RTN","VEFAALR1",294,0)
 S D0=X
"RTN","VEFAALR1",295,0)
 S VEFACATN=""
"RTN","VEFAALR1",296,0)
 S VEFANAME=""
"RTN","VEFAALR1",297,0)
 S VEFACATY=0  ; NOT CATEGORY CLASS
"RTN","VEFAALR1",298,0)
 ;GET NOTIFICATION TYPE FOR THIS ALERT
"RTN","VEFAALR1",299,0)
 S VEFAALNT=$P($P($P($G(^XTV(8992.1,D0,0)),"^",1),";",1),",",3)
"RTN","VEFAALR1",300,0)
 ;GET DISPLAY EXT THIS TYPE OF ALERT
"RTN","VEFAALR1",301,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,1)),"^",1)
"RTN","VEFAALR1",302,0)
 S VEFACAT=0
"RTN","VEFAALR1",303,0)
 F  S VEFACAT=$O(^DIZ(19008,"B",VEFACAT)) Q:(VEFACAT="")!(VEFACATY=1)  D
"RTN","VEFAALR1",304,0)
 .S VEFACNT=0
"RTN","VEFAALR1",305,0)
 .S VEFACNT=$O(^DIZ(19008,"B",VEFACAT,VEFACNT)) D
"RTN","VEFAALR1",306,0)
 ..;GET NOTIFICATION TYPE
"RTN","VEFAALR1",307,0)
 ..S VEFANOTF=$P($G(^DIZ(19008,VEFACNT,1)),"^",2)
"RTN","VEFAALR1",308,0)
 ..I VEFANOTF=VEFAALNT D
"RTN","VEFAALR1",309,0)
 ...I VEFACATY'=1 S VEFACATY=2
"RTN","VEFAALR1",310,0)
 ...S VEFACATN=$P($G(^DIZ(19008,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",311,0)
 ...I VEFADSPL[VEFACATN D
"RTN","VEFAALR1",312,0)
 ....I VEFACATY'=1 S VEFACATY=3
"RTN","VEFAALR1",313,0)
 ....; LOOP THROUGH UNIQUE VEFA TRACKED CRITICAL ALERTS
"RTN","VEFAALR1",314,0)
 ....S VEFAUTCA=0
"RTN","VEFAALR1",315,0)
 ....F  S VEFAUTCA=$O(^DIZ(19007,"B",VEFAUTCA)) Q:(VEFAUTCA="")!(VEFACATY=1)  D
"RTN","VEFAALR1",316,0)
 .....;GET ENTRY
"RTN","VEFAALR1",317,0)
 .....S VEFAENTR=0
"RTN","VEFAALR1",318,0)
 .....S VEFAENTR=$O(^DIZ(19007,"B",VEFAUTCA,VEFAENTR))
"RTN","VEFAALR1",319,0)
 .....S VEFANAME=$P(^DIZ(19007,VEFAENTR,0),"^",1)
"RTN","VEFAALR1",320,0)
 .....;MOD 8/7/14 GOW GET ALERT CATEGORY POINTER
"RTN","VEFAALR1",321,0)
 .....S VEFACATT=$P(^DIZ(19007,VEFAENTR,3),"^",3)
"RTN","VEFAALR1",322,0)
 .....;I (VEFADSPL[VEFANAME) S VEFACATY=1
"RTN","VEFAALR1",323,0)
 .....I (VEFADSPL[VEFANAME)&(VEFACATT=VEFACNT) S VEFACATY=1
"RTN","VEFAALR1",324,0)
 .....;END MOD
"RTN","VEFAALR1",325,0)
 I (VEFACATY=2)!(VEFACATY=3) S VEFACATY=0
"RTN","VEFAALR1",326,0)
 Q VEFACATN_" "_VEFANAME
"RTN","VEFAALR1",327,0)
ALERT1(X) ;D0 AS X
"RTN","VEFAALR1",328,0)
 N VEFACNT,VEFACAT,VEFANOTF,VEFACATY,VEFAALNT,VEFADSPL,VEFACATN,VEFAUTCA,VEFAENTR,VEFANAME
"RTN","VEFAALR1",329,0)
 N D0
"RTN","VEFAALR1",330,0)
 ;MOD 8/7/14 GOW
"RTN","VEFAALR1",331,0)
 N VEFACATT
"RTN","VEFAALR1",332,0)
 ;END MOD
"RTN","VEFAALR1",333,0)
 S D0=X
"RTN","VEFAALR1",334,0)
 S VEFACATN=""
"RTN","VEFAALR1",335,0)
 S VEFANAME=""
"RTN","VEFAALR1",336,0)
 S VEFACATY=0  ; NOT CATEGORY CLASS
"RTN","VEFAALR1",337,0)
 ;GET NOTIFICATION TYPE FOR THIS ALERT
"RTN","VEFAALR1",338,0)
 S VEFAALNT=$P($P($P($G(^XTV(8992.1,D0,0)),"^",1),";",1),",",3)
"RTN","VEFAALR1",339,0)
 ;GET DISPLAY EXT THIS TYPE OF ALERT
"RTN","VEFAALR1",340,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,1)),"^",1)
"RTN","VEFAALR1",341,0)
 S VEFACAT=0
"RTN","VEFAALR1",342,0)
 F  S VEFACAT=$O(^DIZ(19008,"B",VEFACAT)) Q:(VEFACAT="")!(VEFACATY=1)  D
"RTN","VEFAALR1",343,0)
 .S VEFACNT=0
"RTN","VEFAALR1",344,0)
 .S VEFACNT=$O(^DIZ(19008,"B",VEFACAT,VEFACNT)) D
"RTN","VEFAALR1",345,0)
 ..;GET NOTIFICATION TYPE
"RTN","VEFAALR1",346,0)
 ..S VEFANOTF=$P($G(^DIZ(19008,VEFACNT,1)),"^",2)
"RTN","VEFAALR1",347,0)
 ..I VEFANOTF=VEFAALNT D
"RTN","VEFAALR1",348,0)
 ...I VEFACATY'=1 S VEFACATY=2
"RTN","VEFAALR1",349,0)
 ...S VEFACATN=$P($G(^DIZ(19008,VEFACNT,0)),"^",1)
"RTN","VEFAALR1",350,0)
 ...I VEFADSPL[VEFACATN D
"RTN","VEFAALR1",351,0)
 ....I VEFACATY'=1 S VEFACATY=3
"RTN","VEFAALR1",352,0)
 ....; LOOP THROUGH UNIQUE VEFA TRACKED CRITICAL ALERTS
"RTN","VEFAALR1",353,0)
 ....S VEFAUTCA=0
"RTN","VEFAALR1",354,0)
 ....F  S VEFAUTCA=$O(^DIZ(19007,"B",VEFAUTCA)) Q:(VEFAUTCA="")!(VEFACATY=1)  D
"RTN","VEFAALR1",355,0)
 .....;GET ENTRY
"RTN","VEFAALR1",356,0)
 .....S VEFAENTR=0
"RTN","VEFAALR1",357,0)
 .....S VEFAENTR=$O(^DIZ(19007,"B",VEFAUTCA,VEFAENTR))
"RTN","VEFAALR1",358,0)
 .....S VEFANAME=$P(^DIZ(19007,VEFAENTR,0),"^",1)
"RTN","VEFAALR1",359,0)
 .....;MOD 8/7/14 GOW GET ALERT CATEGORY POINTER
"RTN","VEFAALR1",360,0)
 .....S VEFACATT=$P(^DIZ(19007,VEFAENTR,3),"^",3)
"RTN","VEFAALR1",361,0)
 .....;I (VEFADSPL[VEFANAME) S VEFACATY=1
"RTN","VEFAALR1",362,0)
 .....I (VEFADSPL[VEFANAME)&(VEFACATT=VEFACNT) S VEFACATY=1
"RTN","VEFAALR1",363,0)
 .....;END MOD
"RTN","VEFAALR1",364,0)
 I (VEFACATY=2)!(VEFACATY=3) S VEFACATY=0
"RTN","VEFAALR1",365,0)
 Q VEFANAME
"RTN","VEFAALR1",366,0)
FOLLOWUP(X) ;
"RTN","VEFAALR1",367,0)
 ;RETURN WHETHER ANY ORDER/FOLLOWUP ACTION HAS BEEN DONE. ACKNOW
"RTN","VEFAALR1",368,0)
 N D0,RY,VEFADFN,VEFAPRV,VEFADTIM,VEFARETN,VEFAFOLP,ZP,RY,VEFADSPL
"RTN","VEFAALR1",369,0)
 N VEFANAME
"RTN","VEFAALR1",370,0)
 N VEFADELD
"RTN","VEFAALR1",371,0)
 S D0=X
"RTN","VEFAALR1",372,0)
 S VEFADFN=$P($G(^XTV(8992.1,D0,0)),"^",4)
"RTN","VEFAALR1",373,0)
 S VEFADTIM=$P($P($G(^XTV(8992.1,D0,0)),"^",1),";",3)
"RTN","VEFAALR1",374,0)
 S VEFARETN=$$SERVIC1(X)
"RTN","VEFAALR1",375,0)
 S VEFANAME=$P(VEFARETN,"^",3)
"RTN","VEFAALR1",376,0)
 S VEFAPRV=$P(VEFARETN,"^",2)
"RTN","VEFAALR1",377,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR1",378,0)
 ;W !,"VEFADSPL=",VEFADSPL
"RTN","VEFAALR1",379,0)
 ;GET ACKNOWLEDGED(DELETED) DATE (IF ANY)
"RTN","VEFAALR1",380,0)
 S VEFADELD=$$STATUS1(X)
"RTN","VEFAALR1",381,0)
 S VEFADELD=$P(VEFADELD,"^",3)
"RTN","VEFAALR1",382,0)
 S ZP=VEFADFN_"^"_VEFAPRV_"^"_VEFANAME_"^"_VEFADTIM_"^"_VEFADELD
"RTN","VEFAALR1",383,0)
 ;W !,"ZP=",ZP
"RTN","VEFAALR1",384,0)
 S RY=""
"RTN","VEFAALR1",385,0)
 D LKPORD^VEFAALR2(.RY,ZP)  ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and check whether
"RTN","VEFAALR1",386,0)
 ;any ORDERS by user (DUZ)have been made from list of orders in in a possible defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR1",387,0)
 ;(field), the dialog elements thereof containing the ORDER types (orderable iems) for such list to be compared with any actual orders 
"RTN","VEFAALR1",388,0)
 ;by this user (DUZ) made after the date/time of the actual critical alert. 
"RTN","VEFAALR1",389,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR1",390,0)
 ; if 
"RTN","VEFAALR1",391,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT  ^ DELETED DATE/TIME(IF ANY)
"RTN","VEFAALR1",392,0)
 ;  RY= 0 (1ST PIECE=0) NO ORDERS FOUND YET
"RTN","VEFAALR1",393,0)
 ;  RY= 0_"^"_3  ; (1ST PIECE=0)MEANS ORDER(S) FOUND BUT NONE NOT COMPLETED OR READY FOR SIG OR NONE OF THOSE COMPLETED WITH SIG REQUIRED HAVE SIGNATURE
"RTN","VEFAALR1",394,0)
 ;  RY =2_"^"_1  (1ST PIECE=2) if at least one ORDER found satisfying criteria complete/signed
"RTN","VEFAALR1",395,0)
 ;  RY= 3_"^"_2  ;(1ST PIECE=3) MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALR1",396,0)
 ;  RY= 3_"^"_3  ; (1ST PIECE=3)MEANS NO REMINDER DIALOG FOUND IN ALERT TRACKINg FILE FOR THIS TYPE OF ALERT
"RTN","VEFAALR1",397,0)
 ;
"RTN","VEFAALR1",398,0)
 I RY=0 S RY="NO FAT ORDERS MADE" Q RY
"RTN","VEFAALR1",399,0)
 I $E(RY,1,1)=0 I $E(RY,3,3)=3 S RY="FAT ORDER(S) MADE BUT NOT COMPLETED OR SIGNED" Q RY
"RTN","VEFAALR1",400,0)
 I $E(RY,1,1)=2 I $E(RY,3,3)=1 S RY="ONE OR MORE FAT ORDERS/FOLLOW-UPS MADE" Q RY
"RTN","VEFAALR1",401,0)
 Q RY
"RTN","VEFAALR1",402,0)
ORDERCK1(X)  ; CONCANTENATED STRING OF ORDERS/FOLLOWUPS W/O ANY ORDERING PROVIDER ( NOT USED)
"RTN","VEFAALR1",403,0)
 N RY1,XX
"RTN","VEFAALR1",404,0)
 S XX=X
"RTN","VEFAALR1",405,0)
 S RY1=$$ORDERCK(XX)
"RTN","VEFAALR1",406,0)
 S RY1=$P(RY1,";",2,999)
"RTN","VEFAALR1",407,0)
 Q RY1
"RTN","VEFAALR1",408,0)
FOLLOWU1(X)  ; FAT  LOOK STATUS + EXTRA COLUMN FOR FAT PROVIDER ( IF FAT SATISFIED)
"RTN","VEFAALR1",409,0)
 N RY1,RY,XX,RY2
"RTN","VEFAALR1",410,0)
 S XX=X
"RTN","VEFAALR1",411,0)
 S RY2=""
"RTN","VEFAALR1",412,0)
 S RY1=$$ORDERCK(XX)
"RTN","VEFAALR1",413,0)
 S RY1=$P(RY1,";",1)
"RTN","VEFAALR1",414,0)
 I RY1'="" S RY2=$P($G(^VA(200,RY1,0)),"^",1)_" - "_RY1
"RTN","VEFAALR1",415,0)
 S RY=$$FOLLOWUP(XX)
"RTN","VEFAALR1",416,0)
 I RY="ONE OR MORE FAT ORDERS/FOLLOW-UPS MADE" S RY=RY_"^"_RY2 Q RY  ;S RY=RY_"^"_RY2 Q RY 
"RTN","VEFAALR1",417,0)
 S RY=RY_"^"
"RTN","VEFAALR1",418,0)
 Q RY
"RTN","VEFAALR1",419,0)
ORDERCK(X) ;
"RTN","VEFAALR1",420,0)
 ;RETURN LIST OF ORDER FOLLOWUP ACTION THAT HAVE BEEN DONE. FROM ACKNOWLEDGED (DELETED) ALERT DATE TIME OR CURENT TIME BACK TO DATE OF ALERT
"RTN","VEFAALR1",421,0)
 N D0,RY,VEFADFN,VEFAPRV,VEFADTIM,VEFARETN,VEFAFOLP,ZP,RY,VEFADSPL,VEFADELD
"RTN","VEFAALR1",422,0)
 N VEFANAME
"RTN","VEFAALR1",423,0)
 S D0=X
"RTN","VEFAALR1",424,0)
 S VEFADFN=$P($G(^XTV(8992.1,D0,0)),"^",4)
"RTN","VEFAALR1",425,0)
 S VEFADTIM=$P($P($G(^XTV(8992.1,D0,0)),"^",1),";",3)
"RTN","VEFAALR1",426,0)
 S VEFARETN=$$SERVIC1(X)
"RTN","VEFAALR1",427,0)
 S VEFANAME=$P(VEFARETN,"^",3)
"RTN","VEFAALR1",428,0)
 S VEFAPRV=$P(VEFARETN,"^",2)
"RTN","VEFAALR1",429,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR1",430,0)
 ;W !,"VEFADSPL=",VEFADSPL
"RTN","VEFAALR1",431,0)
 ;GET ACKNOWLEDGED(DELETED) DATE (IF ANY)
"RTN","VEFAALR1",432,0)
 S VEFADELD=$$STATUS1(X)
"RTN","VEFAALR1",433,0)
 S VEFADELD=$P(VEFADELD,"^",3)
"RTN","VEFAALR1",434,0)
 S ZP=VEFADFN_"^"_VEFAPRV_"^"_VEFANAME_"^"_VEFADTIM_"^"_VEFADELD
"RTN","VEFAALR1",435,0)
 ;W !,"ZP=",ZP
"RTN","VEFAALR1",436,0)
 S RY=""
"RTN","VEFAALR1",437,0)
 D LKPORDCK^VEFAALRE(.RY,ZP)  ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and RETURN list of
"RTN","VEFAALR1",438,0)
 ;any ORDERS by ordering provider user (DUZ) that have been made from list of available FAT (Follow-up Alert Tracking) orders in in specifi defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR1",439,0)
 ; multiples(and fields)with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list 
"RTN","VEFAALR1",440,0)
 ;to be compared with any actual orders NOT by any ordering provider user(s) (DUZ) made after the date/time of the actual critical alert UP to NOW or
"RTN","VEFAALR1",441,0)
 ;to date of acknowledgement(deletion) OR now time (if not passed). Do this search in reverse chronological order.
"RTN","VEFAALR1",442,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR1",443,0)
 ; INPUT 
"RTN","VEFAALR1",444,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT ^ DATE ACKNOWLEDGED(DELETED) 
"RTN","VEFAALR1",445,0)
 ; RETURN
"RTN","VEFAALR1",446,0)
 ;  RY= ORDERING PROVIDER OFORDER/FOLLOW-UP ACTION (IF ANY)FOLLOWED BY ";" AND THEN CONCATENATED STRING OF ACTUAL ORDERS MADE EACH SEPARATED WITH ";"
"RTN","VEFAALR1",447,0)
 ;  
"RTN","VEFAALR1",448,0)
 ;
"RTN","VEFAALR1",449,0)
 Q RY
"RTN","VEFAALR1",450,0)
NONFATRC ;
"RTN","VEFAALR1",451,0)
 ;LOOK FROM T-180 TO T IN ALERT TRACKING FILE TO FIND NON-FAT ALERT. THE SAME FUNCTION AS VEFAALCAT(NUMBER)=0 FOR ALL NON FAT ALERTS
"RTN","VEFAALR1",452,0)
 ;
"RTN","VEFAALR1",453,0)
 D NONFATRC^VEFAALR3
"RTN","VEFAALR1",454,0)
 Q
"RTN","VEFAALR1",455,0)
DATEFMT(X) ;
"RTN","VEFAALR1",456,0)
 N DATETIME
"RTN","VEFAALR1",457,0)
 ;
"RTN","VEFAALR1",458,0)
 N Y
"RTN","VEFAALR1",459,0)
 S DATETIME=X
"RTN","VEFAALR1",460,0)
 S Y=DATETIME X ^DD("DD") S DATETIME=Y
"RTN","VEFAALR1",461,0)
 Q DATETIME
"RTN","VEFAALR1",462,0)
ALSP(PRPT,FILE,ARR) ; Selection of (A)LL or (S)pecific values from a given file
"RTN","VEFAALR1",463,0)
 ; Input: PRPT  - Piece 1: Label for the PROMPT to be asked for the 
"RTN","VEFAALR1",464,0)
 ;                         selection (in the plural) - e.g. "Providers"
"RTN","VEFAALR1",465,0)
 ;                Piece 2: Singular of piece 1 -  e.g. "Provider"
"RTN","VEFAALR1",466,0)
 ;                Example: "Specialties^Specialty"
"RTN","VEFAALR1",467,0)
 ;        FILE  - File global root (e.g., "^IBE(356.8," ) that the values
"RTN","VEFAALR1",468,0)
 ;                will be selected from
"RTN","VEFAALR1",469,0)
 ;        ARR   - Name of the array that will contain the specific values
"RTN","VEFAALR1",470,0)
 ;                (must be passed as a reference value ".ARR")
"RTN","VEFAALR1",471,0)
 ; Output: ARR  - "S" - Specific values OR "^"
"RTN","VEFAALR1",472,0)
 ;                The values will be returned in the array indicated in
"RTN","VEFAALR1",473,0)
 ;                ARR parameter 
"RTN","VEFAALR1",474,0)
 ;
"RTN","VEFAALR1",475,0)
 D ALSP^VEFAALR3(PRPT,FILE,ARR)
"RTN","VEFAALR1",476,0)
 Q
"RTN","VEFAALR2")
0^9^B82371541
"RTN","VEFAALR2",1,0)
VEFAALR2 ;IHV/VEFA - RPC Routine for CPRS COM OBJECT [ 12/01/2010 ]
"RTN","VEFAALR2",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR2",3,0)
 ;
"RTN","VEFAALR2",4,0)
LKPORD(RY,ZP) ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and check whether 
"RTN","VEFAALR2",5,0)
 ;any ORDERS by ordering provider user (DUZ)have been made from list of orders in in a possible defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR2",6,0)
 ;(field), and with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list to be compared with any actual orders 
"RTN","VEFAALR2",7,0)
 ;by this user (DUZ) made after the date/time of the actual critical alert. 
"RTN","VEFAALR2",8,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR2",9,0)
 ; if 
"RTN","VEFAALR2",10,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT  ^ DELETED DATE/IME
"RTN","VEFAALR2",11,0)
 ;  RY= 0 (1ST PIECE=0) NO ORDERS FOUND YET
"RTN","VEFAALR2",12,0)
 ;  RY= 0_"^"_3  ; (1ST PIECE=0)MEANS ORDER(S) FOUND BUT NONE NOT COMPLETED OR READY FOR SIG OR NONE OF THOSE COMPLETED WITH SIG REQUIRED HAVE SIGNATURE
"RTN","VEFAALR2",13,0)
 ;  RY =2_"^"_1  (1ST PIECE=2) if at least one ORDER OR FOLLOWUP ACTION found satisfying criteria complete/signed
"RTN","VEFAALR2",14,0)
 ;  RY= 3_"^"_2  ;(1ST PIECE=3) MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALR2",15,0)
 ;  RY= 3_"^"_3  ; (1ST PIECE=3)MEANS NO REMINDER DIALOG FOUND IN ALERT TRACKINg FILE FOR THIS TYPE OF ALERT
"RTN","VEFAALR2",16,0)
 ;
"RTN","VEFAALR2",17,0)
 N VEFADFN,VEFADUZ,VEFAALRT,VEFAADTT,VEFARMDL
"RTN","VEFAALR2",18,0)
 N VEFACNT,VEFACNT1,VEFACNT2
"RTN","VEFAALR2",19,0)
 N DISABLE,REMDIALG,DIALOGTY,DIALOGEL,RESOLTYP,ORDRITM,COUNTER,CNTORD,CNT1,ORDER,CNTTIMO,CNTTIMA,REVERST,CNTPAT,ORDERCK
"RTN","VEFAALR2",20,0)
 N RYY,ACTION,ACTIONK,SIGSTAT
"RTN","VEFAALR2",21,0)
 N FOLLUPCT,FOLLOWAC
"RTN","VEFAALR2",22,0)
 N VHEALTH,OVERFLAG,VHEALF,FOLLOWUP,VISITPTR
"RTN","VEFAALR2",23,0)
 N DELETEDT
"RTN","VEFAALR2",24,0)
 N ACTIVE,COUNTER1,ORDERITEM,REMTYPE,VHEALFT
"RTN","VEFAALR2",25,0)
 ;K RY
"RTN","VEFAALR2",26,0)
 S RY=0
"RTN","VEFAALR2",27,0)
 S COUNTER=0 ; FOR ORDERS
"RTN","VEFAALR2",28,0)
 S COUNTER1=0  ; FOR FOLLOWUP ACTIONS
"RTN","VEFAALR2",29,0)
 K ^TMP($J,"ORDERITEM")
"RTN","VEFAALR2",30,0)
 K ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALR2",31,0)
 S VEFADFN=$P(ZP,U,1) S VEFADUZ=$P(ZP,U,2) S VEFAALRT=$P(ZP,U,3) S VEFAADTT=$P(ZP,U,4) S DELETEDT=$P(ZP,U,5)
"RTN","VEFAALR2",32,0)
 ;
"RTN","VEFAALR2",33,0)
 ;first CHECK if type of alert if in VEFA ALERT TRACKING file
"RTN","VEFAALR2",34,0)
 S VEFACNT=0
"RTN","VEFAALR2",35,0)
 ;
"RTN","VEFAALR2",36,0)
 S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALR2",37,0)
 S ACTIVE=0
"RTN","VEFAALR2",38,0)
 I VEFACNT'="" D
"RTN","VEFAALR2",39,0)
 .S ACTIVE=$P($G(^DIZ(19007,VEFACNT,3)),"^",5)
"RTN","VEFAALR2",40,0)
 .I ACTIVE="" S ACTIVE=0
"RTN","VEFAALR2",41,0)
 I (VEFACNT'="")&(ACTIVE) D
"RTN","VEFAALR2",42,0)
 .;
"RTN","VEFAALR2",43,0)
 .; RECORD # in VEFA TRACKED ALERTS file
"RTN","VEFAALR2",44,0)
 .; get reminder dialog 
"RTN","VEFAALR2",45,0)
 .S VEFARMDL=$P($G(^DIZ(19007,VEFACNT,3)),U,1) ;
"RTN","VEFAALR2",46,0)
 .I VEFARMDL'="" D
"RTN","VEFAALR2",47,0)
 ..;
"RTN","VEFAALR2",48,0)
 ..;GO TO FILE 801.41
"RTN","VEFAALR2",49,0)
 ..;CHECK IF DISABLED
"RTN","VEFAALR2",50,0)
 ..S DISABLE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,3)
"RTN","VEFAALR2",51,0)
 ..I (DISABLE=0)!(DISABLE="") D
"RTN","VEFAALR2",52,0)
 ...;
"RTN","VEFAALR2",53,0)
 ...;CHECK REMINDER TYPE AS "REMINDER DIALOG"
"RTN","VEFAALR2",54,0)
 ...S REMTYPE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,4)
"RTN","VEFAALR2",55,0)
 ...I REMTYPE="R" D
"RTN","VEFAALR2",56,0)
 ....;
"RTN","VEFAALR2",57,0)
 ....; LOOK THROUGH DIALOG GROUPS AND THEIR ELEMENTS TO FIND ORDERABLE ANY ORDER ITEMS.
"RTN","VEFAALR2",58,0)
 ....S VEFACNT=0
"RTN","VEFAALR2",59,0)
 ....F  S VEFACNT=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT)) Q:VEFACNT=""  D
"RTN","VEFAALR2",60,0)
 .....;GET INTERNAL ENTRY #
"RTN","VEFAALR2",61,0)
 .....S VEFACNT1=0
"RTN","VEFAALR2",62,0)
 .....S VEFACNT1=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT,VEFACNT1))
"RTN","VEFAALR2",63,0)
 .....;
"RTN","VEFAALR2",64,0)
 .....I VEFACNT1'="" D
"RTN","VEFAALR2",65,0)
 ......; GET DIALOG GROUP OR DIRECT DIALOG ELEMENT (ASSUME FOR NOW ONLY DIALOG GROUP WITH ORDERS)
"RTN","VEFAALR2",66,0)
 ......S REMDIALG=$P($G(^PXRMD(801.41,VEFARMDL,10,VEFACNT1,0)),U,2)
"RTN","VEFAALR2",67,0)
 ......;
"RTN","VEFAALR2",68,0)
 ......I REMDIALG'="" D
"RTN","VEFAALR2",69,0)
 .......; CHECK IF DIALOG GROUP
"RTN","VEFAALR2",70,0)
 .......S DIALOGTY=$P($G(^PXRMD(801.41,REMDIALG,0)),U,4)
"RTN","VEFAALR2",71,0)
 .......I DIALOGTY="G" D   ; DIALOG GROUP
"RTN","VEFAALR2",72,0)
 ........;
"RTN","VEFAALR2",73,0)
 ........S VEFACNT2=0 ; GET DIALOG ELEMENTS INSIDE THIS DIALOG GROUP
"RTN","VEFAALR2",74,0)
 ........F  S VEFACNT2=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2)) Q:VEFACNT2=""  D
"RTN","VEFAALR2",75,0)
 .........;GET INTERNAL ENTRY #
"RTN","VEFAALR2",76,0)
 .........S DIALOGEL=0
"RTN","VEFAALR2",77,0)
 .........S DIALOGEL=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2,DIALOGEL))
"RTN","VEFAALR2",78,0)
 .........; DIALOG ELEMENT
"RTN","VEFAALR2",79,0)
 .........;
"RTN","VEFAALR2",80,0)
 .........S DIALOGEL=$P($G(^PXRMD(801.41,REMDIALG,10,DIALOGEL,0)),U,2)
"RTN","VEFAALR2",81,0)
 .........;
"RTN","VEFAALR2",82,0)
 .........;CHECK "ORDER" RESOLUTION TYPE FIRST
"RTN","VEFAALR2",83,0)
 .........S RESOLTYP=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,3)
"RTN","VEFAALR2",84,0)
 .........I RESOLTYP=3 D
"RTN","VEFAALR2",85,0)
 ..........;GET ORDERABLE ITEMS FILE ENTRY AS POSSIBLE FOLLOW-UP ACTION CHOICE. STORE INTO ^TMP($J,"ORDERITEM,COUNTER) ARRAY
"RTN","VEFAALR2",86,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7)
"RTN","VEFAALR2",87,0)
 ..........; NOW LOOK AT ORDERS IF ANY AND CHECK DATE/TIME > DATE/TIME OF PASSED CRIT ALERT
"RTN","VEFAALR2",88,0)
 ..........S COUNTER=COUNTER+1
"RTN","VEFAALR2",89,0)
 ..........;
"RTN","VEFAALR2",90,0)
 ..........S ^TMP($J,"ORDERITEM",COUNTER)=ORDERITEM
"RTN","VEFAALR2",91,0)
 ..........;new section
"RTN","VEFAALR2",92,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR2",93,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR2",94,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR2",95,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR2",96,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR2",97,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR2",98,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR2",99,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR2",100,0)
 ..........;end section
"RTN","VEFAALR2",101,0)
 .........E  D
"RTN","VEFAALR2",102,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR2",103,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR2",104,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR2",105,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR2",106,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR2",107,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR2",108,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR2",109,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR2",110,0)
 ....;  NOW GET ORDERS BY PATIENT AND PROVIDER (DUZ) DOESN'T CARE AS ORDER COULD BE MADE AMONG ANY PROVIDE IN OE/RR GROUP DEFINED
"RTN","VEFAALR2",111,0)
 ....; FOR SPECIFIC CRIT ALERT PROCESSING.BUT SHOULD MOST LIKELY BE MADE BY ORDERING PROVIDER. GET ORDERS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALR2",112,0)
 ....;UNTIL DATE/TIME OF ANY ORDER < 
"RTN","VEFAALR2",113,0)
 ....;DATE/TIME OF CRIT ALERT,OR NO ORDER FOUND IS ENCOUNTERED. SEARCH AMONG ORDERITEM LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALR2",114,0)
 ....;GO BY PATIENT FIRST
"RTN","VEFAALR2",115,0)
 ....S CNTTIMO=0  ; DATE/TIME OF ORDER ABD CNTTIMA DATE/TIME OF UNACK CRIT ALERT
"RTN","VEFAALR2",116,0)
 ....S CNTPAT=VEFADFN_";DPT("
"RTN","VEFAALR2",117,0)
 ....;
"RTN","VEFAALR2",118,0)
 ....F  S CNTTIMO=$O(^OR(100,"AC",CNTPAT,CNTTIMO)) S REVERST=9999999-CNTTIMO Q:(CNTTIMO="")!(VEFAADTT>REVERST)!(RY="0_""^""_3")!(RY="2_""^""_1")  D
"RTN","VEFAALR2",119,0)
 .....S ORDER=0
"RTN","VEFAALR2",120,0)
 .....I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALR2",121,0)
 .....S ORDER=$O(^OR(100,"AC",CNTPAT,CNTTIMO,ORDER))
"RTN","VEFAALR2",122,0)
 .....;
"RTN","VEFAALR2",123,0)
 .....I ORDER'="" D
"RTN","VEFAALR2",124,0)
 ......;
"RTN","VEFAALR2",125,0)
 ......S CNT1=0  ; SEARCH MULTIPLE ORDERABLE ITEMS WITHIN 1 ORDER
"RTN","VEFAALR2",126,0)
 ......F  S CNT1=$O(^OR(100,ORDER,.1,"B",CNT1)) Q:(CNT1="")  D
"RTN","VEFAALR2",127,0)
 .......S CNTORD=CNT1
"RTN","VEFAALR2",128,0)
 .......;
"RTN","VEFAALR2",129,0)
 .......;S CNTORD=$P($G(^OR(100,ORDER,.1,CNT1,0)),"^",1)
"RTN","VEFAALR2",130,0)
 .......;CHECK IF AT LEAST ONE ORDERABLE ITEM OF ORDER AMONG LIST OF ORDERABLE ITEMS FOR FOLLOW-UP ACTION
"RTN","VEFAALR2",131,0)
 .......S COUNTER=0
"RTN","VEFAALR2",132,0)
 .......F  S COUNTER=$O(^TMP($J,"ORDERITEM",COUNTER)) Q:COUNTER=""  D
"RTN","VEFAALR2",133,0)
 ........S ORDERCK=$G(^TMP($J,"ORDERITEM",COUNTER))
"RTN","VEFAALR2",134,0)
 ........;
"RTN","VEFAALR2",135,0)
 ........I ORDERCK=CNTORD D
"RTN","VEFAALR2",136,0)
 .........S RYY=2  ; FOUND
"RTN","VEFAALR2",137,0)
 .........S SIGSTAT=1
"RTN","VEFAALR2",138,0)
 .........;NOT CHECK IF SIGNATURE REQUIRED AND SIGNATURE ITSELF
"RTN","VEFAALR2",139,0)
 .........I $P($G(^OR(100,ORDER,0)),"^",16)=2 D      ;ORES
"RTN","VEFAALR2",140,0)
 ..........S ACTION=0
"RTN","VEFAALR2",141,0)
 ..........S SIGSTAT=0
"RTN","VEFAALR2",142,0)
 ..........F  S ACTION=$O(^OR(100,ORDER,8,ACTION)) Q:(ACTION="")!(ACTION="C")  D
"RTN","VEFAALR2",143,0)
 ...........S ACTIONK=ACTION
"RTN","VEFAALR2",144,0)
 ...........S SIGSTAT=$P($G(^OR(100,ORDER,8,ACTION,0)),"^",4)
"RTN","VEFAALR2",145,0)
 ..........; CHECK FOR SIG STAT=1 FOR SIGNED ORDER ("ELECTRONIC") 
"RTN","VEFAALR2",146,0)
 ..........I RY'[1 S RY=RYY_"^"_SIGSTAT  ;SIGSTAT = 1 MEANS NO SIG REQUIRED OR SIG REQUIRED AND FOUND 
"RTN","VEFAALR2",147,0)
 .........E  D
"RTN","VEFAALR2",148,0)
 ..........S RY=RYY_"^"_1
"RTN","VEFAALR2",149,0)
 .........;
"RTN","VEFAALR2",150,0)
 ......;
"RTN","VEFAALR2",151,0)
 ......I RY'=0 I RY'[1 S RY=0_"^"_3      ; IE. IF RY NOT= 2_"^"_1 S RY=0_"^"_3
"RTN","VEFAALR2",152,0)
 ....;
"RTN","VEFAALR2",153,0)
 ....I RY=0 D
"RTN","VEFAALR2",154,0)
 .....;
"RTN","VEFAALR2",155,0)
 .....;  NOW GET V HEALTH FACTORS BY PATIENT 
"RTN","VEFAALR2",156,0)
 .....; FOR SPECIFIC CRIT ALERT PROCESSING.GET V HEALTH FACTORS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALR2",157,0)
 .....;UNTIL DATE/TIME OF ANY FOLLOWUP ACTION (V HEALTH FACTOR)< 
"RTN","VEFAALR2",158,0)
 .....;DATE/TIME OF CRIT ALERT,OR NO V  HEALTH FACTOR FOUND IS ENCOUNTERED. SEARCH AMONG FOLLOWUP LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALR2",159,0)
 .....;GO BY PATIENT FIRST
"RTN","VEFAALR2",160,0)
 .....S VHEALTH=""
"RTN","VEFAALR2",161,0)
 .....S OVERFLAG=0
"RTN","VEFAALR2",162,0)
 .....F  S VHEALTH=$O(^AUPNVHF("C",VEFADFN,VHEALTH),-1) Q:(VHEALTH="")!(OVERFLAG=1)  D
"RTN","VEFAALR2",163,0)
 ......S VISITPTR=$P($G(^AUPNVHF(VHEALTH,0)),"^",3)
"RTN","VEFAALR2",164,0)
 ......I VISITPTR'="" S REVERST=$P($G(^AUPNVSIT(VISITPTR,0)),"^",1)
"RTN","VEFAALR2",165,0)
 ......;
"RTN","VEFAALR2",166,0)
 ......;
"RTN","VEFAALR2",167,0)
 ......I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALR2",168,0)
 ......I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALR2",169,0)
 ......S VHEALFT=$P($G(^AUPNVHF(VHEALTH,0)),"^",1)
"RTN","VEFAALR2",170,0)
 ......;
"RTN","VEFAALR2",171,0)
 ......;CHECK IF THIS HEALTH FACTOR WITHIN DATE/TIME ALLOWED IS ONE OF FOLLOWUP ACTION HEALTH FACTORS
"RTN","VEFAALR2",172,0)
 ......S COUNTER1=0
"RTN","VEFAALR2",173,0)
 ......F  S COUNTER1=$O(^TMP($J,"FOLLOWUPITEM",COUNTER1)) Q:(COUNTER1="")  D
"RTN","VEFAALR2",174,0)
 .......S FOLLOWUP=$G(^TMP($J,"FOLLOWUPITEM",COUNTER1))
"RTN","VEFAALR2",175,0)
 .......;
"RTN","VEFAALR2",176,0)
 .......I FOLLOWUP[VHEALFT D
"RTN","VEFAALR2",177,0)
 ........S RY=2_"^"_1
"RTN","VEFAALR2",178,0)
 ....;
"RTN","VEFAALR2",179,0)
 ....;
"RTN","VEFAALR2",180,0)
 ....;
"RTN","VEFAALR2",181,0)
 ....;
"RTN","VEFAALR2",182,0)
 .E  D
"RTN","VEFAALR2",183,0)
 ..S RY=3_"^"_3  ; MEANS NO REMINDER DIALOG FOUND
"RTN","VEFAALR2",184,0)
 E  D
"RTN","VEFAALR2",185,0)
 .S RY=3_"^"_2  ; MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALR2",186,0)
 Q
"RTN","VEFAALR2",187,0)
ALERTCAT(ORY) ;return current Alert categories
"RTN","VEFAALR2",188,0)
 N NAME,IEN,J
"RTN","VEFAALR2",189,0)
 K ^TMP("ORVEFACAT",$J)
"RTN","VEFAALR2",190,0)
 S J=0
"RTN","VEFAALR2",191,0)
 S NAME=""
"RTN","VEFAALR2",192,0)
 F  S NAME=$O(^DIZ(19008,"B",NAME)) Q:NAME=""  D
"RTN","VEFAALR2",193,0)
 .S IEN=0 S IEN=$O(^DIZ(19008,"B",NAME,IEN))
"RTN","VEFAALR2",194,0)
 .S J=J+1,^TMP("ORVEFACAT",$J,J)=$P($G(^DIZ(19008,IEN,0)),"^",1)_"^"_$P($G(^DIZ(19008,IEN,1)),"^",2)  ; FIELDS .01 CRIT ALERT CATEGORY AND 4 NOTIFICATION NOTIFICATION TYPE
"RTN","VEFAALR2",195,0)
 S ^TMP("ORVEFACAT",$J)=""
"RTN","VEFAALR2",196,0)
 S ORY=$NA(^TMP("ORVEFACAT",$J))
"RTN","VEFAALR2",197,0)
 Q
"RTN","VEFAALR2",198,0)
ALERTORD(ORY,ZP) ; RETURN LIST OF ORDERS IN SUB FILE AS DOCUMENTED IN CRIT ALERT TRACKING FILE 19007
"RTN","VEFAALR2",199,0)
 ;                 ZP AS INPUT AS CRIT ALERT TYPE (INTERNAL RECORD NUMBER=IEN)
"RTN","VEFAALR2",200,0)
 ;                 ORY RETURN ARRAY OF LIST OF ORDERS
"RTN","VEFAALR2",201,0)
 ;
"RTN","VEFAALR2",202,0)
 N NAME,IEN,J
"RTN","VEFAALR2",203,0)
 K ^TMP("ORVEFAORD",$J)
"RTN","VEFAALR2",204,0)
 S J=0
"RTN","VEFAALR2",205,0)
 S IEN=ZP
"RTN","VEFAALR2",206,0)
 S NAME=0
"RTN","VEFAALR2",207,0)
 F  S NAME=$O(^DIZ(19007,IEN,1,"B",NAME)) Q:NAME=""  D
"RTN","VEFAALR2",208,0)
 .S J=J+1,^TMP("ORVEFAORD",$J,J)=NAME
"RTN","VEFAALR2",209,0)
 S ^TMP("ORVEFAORD",$J)=""
"RTN","VEFAALR2",210,0)
 S ORY=$NA(^TMP("ORVEFAORD",$J))
"RTN","VEFAALR2",211,0)
 Q
"RTN","VEFAALR2",212,0)
ALERTFOL(ORY,ZP) ; RETURN LIST OF FOLOWUPS IN SUB FILE AS DOCUMENTED IN CRIT ALERT TRACKING FILE 19007
"RTN","VEFAALR2",213,0)
 ;                 ZP AS INPUT AS CRIT ALERT TYPE (INTERNAL RECORD NUMBER=IEN)
"RTN","VEFAALR2",214,0)
 ;                 ORY RETURN ARRAY OF LIST OF FOLLOWUPS
"RTN","VEFAALR2",215,0)
 ;
"RTN","VEFAALR2",216,0)
 N NAME,IEN,J
"RTN","VEFAALR2",217,0)
 K ^TMP("ORVEFAFOL",$J)
"RTN","VEFAALR2",218,0)
 S J=0
"RTN","VEFAALR2",219,0)
 S IEN=ZP
"RTN","VEFAALR2",220,0)
 S NAME=0
"RTN","VEFAALR2",221,0)
 F  S NAME=$O(^DIZ(19007,IEN,2,"B",NAME)) Q:NAME=""  D
"RTN","VEFAALR2",222,0)
 .S J=J+1,^TMP("ORVEFAFOL",$J,J)=NAME
"RTN","VEFAALR2",223,0)
 S ^TMP("ORVEFAFOL",$J)=""
"RTN","VEFAALR2",224,0)
 S ORY=$NA(^TMP("ORVEFAFOL",$J))
"RTN","VEFAALR2",225,0)
 Q
"RTN","VEFAALR2",226,0)
SPECALRT(RY,ZP) ;
"RTN","VEFAALR2",227,0)
 ;TAKE FIRSTFLAG AS INPUT IN ZP( ALERT TYPE ) IN FILE 19007
"RTN","VEFAALR2",228,0)
 ;DO LOOKUP
"RTN","VEFAALR2",229,0)
 N REMINDER,NAME,IEN,TIUTEMPL
"RTN","VEFAALR2",230,0)
 S RY=""
"RTN","VEFAALR2",231,0)
 S REMINDER=""
"RTN","VEFAALR2",232,0)
 S TIUTEMPL=""
"RTN","VEFAALR2",233,0)
 S NAME=ZP
"RTN","VEFAALR2",234,0)
 S IEN=0
"RTN","VEFAALR2",235,0)
 S IEN=$O(^DIZ(19007,"B",NAME,IEN))
"RTN","VEFAALR2",236,0)
 I IEN'="" D
"RTN","VEFAALR2",237,0)
 .S REMINDER=$P($G(^DIZ(19007,IEN,3)),"^",1)
"RTN","VEFAALR2",238,0)
 .I REMINDER'="" S REMINDER=$P($G(^PXRMD(801.41,REMINDER,0)),"^",1)  ; TYPE = REMINDER DIALOG
"RTN","VEFAALR2",239,0)
 .S TIUTEMPL=$P($G(^DIZ(19007,IEN,3)),"^",2)
"RTN","VEFAALR2",240,0)
 .I TIUTEMPL'="" S TIUTEMPL=$P($G(^TIU(8927,TIUTEMPL,0)),"^",1)
"RTN","VEFAALR2",241,0)
 I (REMINDER'="")&(TIUTEMPL'="") S RY=IEN_"^"_REMINDER_"^"_TIUTEMPL_"^"
"RTN","VEFAALR2",242,0)
 Q
"RTN","VEFAALR3")
0^18^B3683498
"RTN","VEFAALR3",1,0)
VEFAALR3 ;IHV/VEFA - Module 3 for CPRS COM OBJECT [ 12/01/2010 ]
"RTN","VEFAALR3",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR3",3,0)
NONFATRC ;
"RTN","VEFAALR3",4,0)
 ;LOOK FROM T-180 TO T IN ALERT TRACKING FILE TO FIND NON-FAT ALERT. THE SAME FUNCTION AS VEFAALCAT(NUMBER)=0 FOR ALL NON FAT ALERTS
"RTN","VEFAALR3",5,0)
 ;
"RTN","VEFAALR3",6,0)
 N CNT,DATE,XX,DATETIME,ARRAY,NOW,ALERT,PATIENT,STATUS
"RTN","VEFAALR3",7,0)
 D NOW^%DTC S NOW=% K %
"RTN","VEFAALR3",8,0)
 S DATE=NOW-180-.01
"RTN","VEFAALR3",9,0)
 F  S DATE=$O(^XTV(8992.1,"B",DATE)) Q:(DATE>NOW)!(DATE="")  D
"RTN","VEFAALR3",10,0)
 .S CNT=0
"RTN","VEFAALR3",11,0)
 .F  S CNT=$O(^XTV(8992.1,"B",DATE,CNT)) Q:CNT=""  D
"RTN","VEFAALR3",12,0)
 ..S XX=$$CAT^VEFAALR1(CNT)
"RTN","VEFAALR3",13,0)
 ..I XX=0 D
"RTN","VEFAALR3",14,0)
 ...S ARRAY=$$SERVICE^VEFAALR1(CNT)
"RTN","VEFAALR3",15,0)
 ...S ARRAY=$P(ARRAY,"^",1,6)
"RTN","VEFAALR3",16,0)
 ...S PATIENT=$P(ARRAY,"^",6)
"RTN","VEFAALR3",17,0)
 ...;S ALERTID=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR3",18,0)
 ...S ALERT=$P($G(^XTV(8992.1,CNT,1)),U,1)
"RTN","VEFAALR3",19,0)
 ...S ALERT=$P(ALERT,": ",2)
"RTN","VEFAALR3",20,0)
 ...S ARRAY=ARRAY_"^"_ALERT_"^" ; FILL IN ALERT TYPE LATER
"RTN","VEFAALR3",21,0)
 ...S DATETIME=$P($G(^XTV(8992.1,CNT,0)),U,2)
"RTN","VEFAALR3",22,0)
 ...S Y=DATETIME X ^DD("DD") S DATETIME=Y
"RTN","VEFAALR3",23,0)
 ...K Y
"RTN","VEFAALR3",24,0)
 ...S ARRAY=ARRAY_DATETIME
"RTN","VEFAALR3",25,0)
 ...S ARRAY=ARRAY_"^NOT TRACKED^^" ; FOR FAT ORDER DONE, FAT PROVIDER
"RTN","VEFAALR3",26,0)
 ...S STATUS=$$STATUS^VEFAALR1(CNT)
"RTN","VEFAALR3",27,0)
 ...S ARRAY=ARRAY_STATUS ; $$STATUS^VEFAALR1(CNT)
"RTN","VEFAALR3",28,0)
 ...S ARRAY=ARRAY_"^^" ; FOR NO LISTED FAT ORDERS/FOLLOW-UPS
"RTN","VEFAALR3",29,0)
 ...I (ALERT'["UNSIGNED")&(ALERT'["New consult")&(ALERT'["Order requires")&(ALERT'["New order(s)")&(ALERT'["NO-ID")&(PATIENT'="")&(ALERT'="")&(ALERT'["discontinued") W ARRAY,!
"RTN","VEFAALR3",30,0)
 Q
"RTN","VEFAALR4")
0^10^B221387387
"RTN","VEFAALR4",1,0)
VEFAALR4 ;GOW/THC VEFA - Module for AWARE report gathering into an Alert Audit Log or Cache[ 12/01/2010 ]
"RTN","VEFAALR4",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR4",3,0)
 ;; ALSO RPC FOR RETRIEVING VEFA AWARE ALERT CACHE FORM VISTA INTO SQL SERVER TABLES
"RTN","VEFAALR4",4,0)
COLLECT ;
"RTN","VEFAALR4",5,0)
 ;;DAILY TASK WITH OPTION VEFA AWARE ALERT CACHE BUILDER
"RTN","VEFAALR4",6,0)
 ;;AWARE AUDIT LOG DATA AS VEFA AWARE ALERT CACHE FOR RECENT 2 WEEKS OF ACTIVITY. 
"RTN","VEFAALR4",7,0)
 ;;
"RTN","VEFAALR4",8,0)
 ;;ALSO TAKE OLDEST DAILY DATA FROM THIS CACHE AND FTP TO WINDOWS SERVER MACHINE WITH SQL SERVER
"RTN","VEFAALR4",9,0)
 ;;
"RTN","VEFAALR4",10,0)
 ;;TRUNCATE VEFA AWARE ALERT CACHE FOR DATE/TIME BEYOND TWO WEEKS+1 DAY
"RTN","VEFAALR4",11,0)
 ;;
"RTN","VEFAALR4",12,0)
 ;;UPDATE LAST STARTDATE VALUE INTO VEFA ALERT PARAMETER FILE
"RTN","VEFAALR4",13,0)
 ;;
"RTN","VEFAALR4",14,0)
 ;;DETAIL STEPS:
"RTN","VEFAALR4",15,0)
 ;;COLLECT alerts OVER DATE RANGE 2 WEEKS BACK ( or from last 2 weeks back date in VEFA ALERT 
"RTN","VEFAALR4",16,0)
 ;;PARAMETER file + 1 day) up to CURRENT TIME
"RTN","VEFAALR4",17,0)
 ;;check if alert belongs to CRITICAL ALERT TRACKING FILE with proper ALERT CATEGORY
"RTN","VEFAALR4",18,0)
 ;;         $$CAT^VEFAALR1(D0) 
"RTN","VEFAALR4",19,0)
 ;;Collect by service or actually by alert id, facility then service and then alert generating provider, ETC
"RTN","VEFAALR4",20,0)
 ;;
"RTN","VEFAALR4",21,0)
 ;;For each entry(D0), output an incrementally increasing comma delimited array calling these routines:
"RTN","VEFAALR4",22,0)
 ;;         $$SERVICE^VEFAALR1(D0)      Initial identifying fields including ALERT ID ( 5 fields)
"RTN","VEFAALR4",23,0)
 ;;         $$ALERT2^VEFAALR9(D0)       ALERT type and category
"RTN","VEFAALR4",24,0)
 ;;         $$STATUS1^VEFAALR1(D0)      RETURN A RECIPIENT'S UNACKNOWLEDGED STATUS^RENEW DATE^ACKNOWLEDGED OR DELETED DATE
"RTN","VEFAALR4",25,0)
 ;;         $$FOLLOWU1^VEFAALR6(D0)     Whether Followup has been done with FAT Status and Follow-up Provider if any 
"RTN","VEFAALR4",26,0)
 ;;         $$ORDERCK2^VEFAALR9(D0)      Follow-up provider , then List of Followup-Actions made (working backwards from current date
"RTN","VEFAALR4",27,0)
 ;;                                     to date of deletion/acknowledgement and made only up
"RTN","VEFAALR4",28,0)
 ;;                                     to any date of deletion/ack or current date from date of
"RTN","VEFAALR4",29,0)
 ;;                                     alert generation
"RTN","VEFAALR4",30,0)
 ;;Read/parse records collected and then file each record as record in the VEFA AWARE ALERT CACHE file ( daily)
"RTN","VEFAALR4",31,0)
 ;;
"RTN","VEFAALR4",32,0)
 D COLLECT^VEFAALR9
"RTN","VEFAALR4",33,0)
 Q
"RTN","VEFAALR4",34,0)
EXTALERT(ORY,ZP) ; RETURN LIST OF ALERT AUDIT LOGS (CACHE) OF ALERTS TO STORE INTO SQL TABLES
"RTN","VEFAALR4",35,0)
 ;FOR PERIOD FROM EXTRACT STRTDATE UP TO BUT NOT INCLUDING PROCESS STRTDATE .UPON EXTRACT, THEN
"RTN","VEFAALR4",36,0)
 ; UPDATE EXTRACT STRT DATE IF NECESSARY UP TO PROCESS STRTDATE
"RTN","VEFAALR4",37,0)
 ;
"RTN","VEFAALR4",38,0)
 ;                 NO INPUT 
"RTN","VEFAALR4",39,0)
 ;                 ORY RETURN ARRAY OF LIST OF GATHERED ALERTS 
"RTN","VEFAALR4",40,0)
 ;NOW UPDATE TO SQL SERVER MACHINE WITH RPC TRANSFER OF CACHE DATA ( FROM NUMBER OF DAYS 
"RTN","VEFAALR4",41,0)
 ; IN CACHE WINDOW
"RTN","VEFAALR4",42,0)
 ; SUCH AS 30 DAYS AGO OR EARLIER IF MACHINE WAS DOWN)
"RTN","VEFAALR4",43,0)
 ;TAKE EXTRACT STRTDATE DATA UP TO AND THROUGH (TODAYS DATE). 
"RTN","VEFAALR4",44,0)
 ;;
"RTN","VEFAALR4",45,0)
 ;;
"RTN","VEFAALR4",46,0)
 ;;RPC AFTER TRANSFER SHOULD UPDATE EXTRACT STRTDATE= EXTRACT DATE 
"RTN","VEFAALR4",47,0)
 ;;RPC AFTER TRANSFER SHOULD TRUNCATE VEFA AWARE ALERT CACHE FOR DATE/TIME BEFORE EXTRACT STRTDATE 
"RTN","VEFAALR4",48,0)
 ;;WHICH IS UP TO CACHE WINDOW (I.E 30 DAYS)+1 DAY BACK FROM TODAY'S DATE.
"RTN","VEFAALR4",49,0)
 ;;
"RTN","VEFAALR4",50,0)
 D EXTALERT^VEFAALR7(.ORY,ZP)
"RTN","VEFAALR4",51,0)
 Q
"RTN","VEFAALR4",52,0)
 ;
"RTN","VEFAALR4",53,0)
BASICCHK(RY,ZP) ;
"RTN","VEFAALR4",54,0)
 ;TAKE  INPUT IN ZP( ALERT TYPE ) IN FILE 19007. 
"RTN","VEFAALR4",55,0)
 ;BASIC CHECKS
"RTN","VEFAALR4",56,0)
 ;
"RTN","VEFAALR4",57,0)
 ;WHEN REMINDER DIALOG VALUE ENTERED IN FILE 19007 
"RTN","VEFAALR4",58,0)
 ;
"RTN","VEFAALR4",59,0)
 ;DO LOOKUP for all ORDER DIALOG AND FOLLOW-UP ITEMS INCLUDED IN DIALOG AND FOLLOWUP GROUP(S) RESPECTIVELY
"RTN","VEFAALR4",60,0)
 ;Also look FOR REMINDER DIALOG NAMES TO CONFORM TO NOTATION "AW"_STATION+UNIQUE CODE OF ALERT TYPE+DESCCRIPTION
"RTN","VEFAALR4",61,0)
 ; , I.E. AS "AW500 PSA PAT OPTED NO TREAT" FOR AWARE from station 500 and description following.
"RTN","VEFAALR4",62,0)
 ;
"RTN","VEFAALR4",63,0)
 ; CHECK UNIQUENESS AMONG associated REMINDER DIALOGs with "Order Dialog Text" and 
"RTN","VEFAALR4",64,0)
 ; "Followup Dialog Box Text" values: 
"RTN","VEFAALR4",65,0)
 ;DO LOOKUP of Dialog/Progress Note text to check for matching entries needed with 
"RTN","VEFAALR4",66,0)
 ;Orders Dialog Box Text or Followup Dialog Box Text included in this WP field included 
"RTN","VEFAALR4",67,0)
 ;in at least one line of text.
"RTN","VEFAALR4",68,0)
 ;
"RTN","VEFAALR4",69,0)
 ;Build array of Alert Order Dialog and Followup Item Texts with matching REMINDER DIALOG 
"RTN","VEFAALR4",70,0)
 ;and INTERNAL ENTRY number of Reminder Order Dialog or Follow-up text foind from trace
"RTN","VEFAALR4",71,0)
 ;through Reminder Dialog type Reminder dialog to all its groups and elements correlated to
"RTN","VEFAALR4",72,0)
 ;element box text(s) in the VEFA Tracked Critical Alert(the ALERT TYPE)file (19007).
"RTN","VEFAALR4",73,0)
 ;
"RTN","VEFAALR4",74,0)
 ; 
"RTN","VEFAALR4",75,0)
 ;Check for duplicates or missing entries and report back as error
"RTN","VEFAALR4",76,0)
 ;
"RTN","VEFAALR4",77,0)
 ;Check if any 3rd group as single item for Followup Comments in WP text on Reminder dialog as 
"RTN","VEFAALR4",78,0)
 ; as TYPE "prompt".
"RTN","VEFAALR4",79,0)
 ;
"RTN","VEFAALR4",80,0)
 ;Also check for proper same NOTATION for the REMINDER DIALOG group type reminde dialogs with 
"RTN","VEFAALR4",81,0)
 ;notation as described above, as well as main REMINDER DIALOG type reminder dialog name itself 
"RTN","VEFAALR4",82,0)
 ;as in example "AW500 PSA" ONLY w/o any further description.
"RTN","VEFAALR4",83,0)
 ;
"RTN","VEFAALR4",84,0)
 ;S RY ="OK" or "ERR=error comment...." sufficient for a CAC to fix error.
"RTN","VEFAALR4",85,0)
 D BASICCHK^VEFAALR8(.RY,ZP)
"RTN","VEFAALR4",86,0)
 Q
"RTN","VEFAALR4",87,0)
 ;
"RTN","VEFAALR4",88,0)
NAME(DA1,X) ;
"RTN","VEFAALR4",89,0)
 ;NAME OF DESIRED ELEMENT NAME IN ALERT TYPE FILE ENTRY'S ORDERS/FOLLOWUP/COMMENTS MULTIPLE ENTRY
"RTN","VEFAALR4",90,0)
 ;SET X ="AW"_(ORIGINAL SITE NO) (ALERT TYPE MNEUMONIC) X
"RTN","VEFAALR4",91,0)
 ;I.E. X=ORDER PSA AGAIN , S X="AW500 PSA ORDER PSA AGAIN
"RTN","VEFAALR4",92,0)
 ;
"RTN","VEFAALR4",93,0)
 ;
"RTN","VEFAALR4",94,0)
 I X'[("AW"_$P($G(^DIZ(19007,DA1,3)),"^",8)_" "_$P($G(^DIZ(19007,DA1,3)),"^",9)) S X="AW"_$P($G(^DIZ(19007,DA1,3)),"^",8)_" "_$P($G(^DIZ(19007,DA1,3)),"^",9)_" "_X
"RTN","VEFAALR4",95,0)
 Q X
"RTN","VEFAALR4",96,0)
CHKNAME(DA1,X) ;
"RTN","VEFAALR4",97,0)
 N RET
"RTN","VEFAALR4",98,0)
 S RET=X
"RTN","VEFAALR4",99,0)
 ;S RET=0
"RTN","VEFAALR4",100,0)
 ;CHECK ALERT TYPE FILE ENTRY'S ORIGINAL SITE NO AND ALERT TYPE MNEUMONIC. IF "" RETURN 1
"RTN","VEFAALR4",101,0)
 ;I ($P($G(^DIZ(19007,DA1,3)),"^",8)="")!($P($G(^DIZ(19007,DA1,3)),"^",9)="") S RET=1
"RTN","VEFAALR4",102,0)
 I X'[("AW"_$P($G(^DIZ(19007,DA1,3)),"^",8)_" "_$P($G(^DIZ(19007,DA1,3)),"^",9)) S RET=""
"RTN","VEFAALR4",103,0)
 Q RET
"RTN","VEFAALR4",104,0)
CHKNOTI(DA,X) ;
"RTN","VEFAALR4",105,0)
 N RET
"RTN","VEFAALR4",106,0)
 S RET=1
"RTN","VEFAALR4",107,0)
 ;COULD EXPAND LIST LATER, BUT SOME PROBABLY SOME NOT APPLICABLE. COME FROM OE/RR NOTIFICATIONS FILE 
"RTN","VEFAALR4",108,0)
 ;CHECK CRITICAL ALERT CATEGORY FILE ENTRY TO BE EITHER BE   NF_ABNORMAL_IMAGING_RESULTS      = 25; OR NF_CRITICAL_LAB_RESULTS          = 57; FOR NOW
"RTN","VEFAALR4",109,0)
 ;I (($P($G(^DIZ(19008,DA,1)),"^",2)=25)!($P($G(^DIZ(19008,DA,1)),"^",2)=57)) S RET=0
"RTN","VEFAALR4",110,0)
 ;mod 8/4/14 gow add new notificaton type for Amended/Abnormal Image 53
"RTN","VEFAALR4",111,0)
 I (X=25)!(X=57)!(X=53) S RET=0
"RTN","VEFAALR4",112,0)
 Q RET
"RTN","VEFAALR4",113,0)
GETNOTF(RET) ; Return list of Notification Type
"RTN","VEFAALR4",114,0)
 K RET N NOTF
"RTN","VEFAALR4",115,0)
 ;mod 8/4/14 gow add new notificaton type for Amended/Abnormal Image 53
"RTN","VEFAALR4",116,0)
 F NOTF=25,53,57 D
"RTN","VEFAALR4",117,0)
 . S RET(NOTF)=$P($G(^ORD(100.9,NOTF,0)),U)
"RTN","VEFAALR4",118,0)
 Q
"RTN","VEFAALR4",119,0)
REMDIAL(X) ;
"RTN","VEFAALR4",120,0)
 N TYPE,RET
"RTN","VEFAALR4",121,0)
 S RET=0
"RTN","VEFAALR4",122,0)
 S TYPE=""
"RTN","VEFAALR4",123,0)
 I X'="" S TYPE=$P($G(^PXRMD(801.41,X,0)),"^",4)
"RTN","VEFAALR4",124,0)
 I TYPE'="R" S RET=1
"RTN","VEFAALR4",125,0)
 ;S ^XTMP("GE")=X
"RTN","VEFAALR4",126,0)
 Q RET
"RTN","VEFAALR4",127,0)
INITDAT(DA) ;
"RTN","VEFAALR4",128,0)
 N RET
"RTN","VEFAALR4",129,0)
 S RET=0
"RTN","VEFAALR4",130,0)
 ;PREVENT OVERRIDE OF INITIALIZATION OF INITDATE FOR ALERT TYPE
"RTN","VEFAALR4",131,0)
 I $P($G(^DIZ(19007,DA,3)),"^",4)'="" S RET=1
"RTN","VEFAALR4",132,0)
 Q RET
"RTN","VEFAALR4",133,0)
LKPORDCK(RY,ZP) ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and RETURN list of 
"RTN","VEFAALR4",134,0)
 ;any ORDERS by ordering provider user (DUZ) that have been made from list of available FAT (Follow-up Alert Tracking) orders in in specifi defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR4",135,0)
 ; multiples(and fields)with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list 
"RTN","VEFAALR4",136,0)
 ;to be compared with any actual orders by ordering provider user(s) (DUZ) made after the date/time of the actual critical alert UP to NOW or
"RTN","VEFAALR4",137,0)
 ;to date of acknowledgement(deletion) OR now time (if not passed). Do this search in reverse chronological order.
"RTN","VEFAALR4",138,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR4",139,0)
 ; INPUT 
"RTN","VEFAALR4",140,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT ^ DATE ACKNOWLEDGED(DELETED) 
"RTN","VEFAALR4",141,0)
 ; RETURN
"RTN","VEFAALR4",142,0)
 ;  RY= (PROVIDER FOR ORDERS/FOLLOW-UPS * ACKGT7D FLAG(0 OR 1) * FOLLGT7D ( 0 OR 1)) * REVERST1 (FOLOWUP(S) DONE) ; THEN (CONCATENATED STRINGS OF ACTUAL ORDERS/FOLLOWUPS * DATE/TIMEOF SUCH) EACH SPEARATED WITH ";"
"RTN","VEFAALR4",143,0)
 ;
"RTN","VEFAALR4",144,0)
 ;
"RTN","VEFAALR4",145,0)
 N VEFADFN,VEFADUZ,VEFAALRT,VEFAADTT,VEFARMDL
"RTN","VEFAALR4",146,0)
 N VEFACNT,VEFACNT1,VEFACNT2
"RTN","VEFAALR4",147,0)
 N DISABLE,REMDIALG,DIALOGTY,DIALOGEL,RESOLTYP,ORDRITM,COUNTER,CNTORD,CNT1,ORDER,CNTTIMO,CNTTIMA,REVERST,CNTPAT,ORDERCK,COUNTERF
"RTN","VEFAALR4",148,0)
 N RYY,ACTION,ACTIONK,SIGSTAT
"RTN","VEFAALR4",149,0)
 N DELETEDT,ORDRITEM
"RTN","VEFAALR4",150,0)
 N FOLLUPCT,FOLLOWAC
"RTN","VEFAALR4",151,0)
 N VHEALTH,OVERFLAG,VHEALF,FOLLOWUP,VISITPTR
"RTN","VEFAALR4",152,0)
 N FOLLOWU1
"RTN","VEFAALR4",153,0)
 N AGENTPRM,AGENTPRV,COUNTER1,ACTIVE
"RTN","VEFAALR4",154,0)
 N ACKGT7D,REVERST1,FOLLGT7D
"RTN","VEFAALR4",155,0)
 N VHEALFT
"RTN","VEFAALR4",156,0)
 N INITDATE
"RTN","VEFAALR4",157,0)
 ;
"RTN","VEFAALR4",158,0)
 N ORDERITEM,REMTYPE,X1,X2
"RTN","VEFAALR4",159,0)
 ;K RY
"RTN","VEFAALR4",160,0)
 S RY=0
"RTN","VEFAALR4",161,0)
 S AGENTPRV=""
"RTN","VEFAALR4",162,0)
 S COUNTER=0
"RTN","VEFAALR4",163,0)
 S COUNTER1=0
"RTN","VEFAALR4",164,0)
 K ^TMP($J,"ORDERITEM")
"RTN","VEFAALR4",165,0)
 K ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALR4",166,0)
 K ^TMP($J,"ORDERITEMFOUND")
"RTN","VEFAALR4",167,0)
 S VEFADFN=$P(ZP,U,1) S VEFADUZ=$P(ZP,U,2) S VEFAALRT=$P(ZP,U,3) S VEFAADTT=$P(ZP,U,4) S DELETEDT=$P(ZP,U,5)
"RTN","VEFAALR4",168,0)
 ;
"RTN","VEFAALR4",169,0)
 ;first CHECK if type of alert if in VEFA ALERT TRACKING file
"RTN","VEFAALR4",170,0)
 S VEFACNT=0
"RTN","VEFAALR4",171,0)
 ;
"RTN","VEFAALR4",172,0)
 S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALR4",173,0)
 S ACTIVE=0
"RTN","VEFAALR4",174,0)
 S INITDATE=0
"RTN","VEFAALR4",175,0)
 ;CHECK IF ACTIVE
"RTN","VEFAALR4",176,0)
 ;S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALR4",177,0)
 I VEFACNT'="" D
"RTN","VEFAALR4",178,0)
 .S ACTIVE=$P($G(^DIZ(19007,VEFACNT,3)),"^",5)
"RTN","VEFAALR4",179,0)
 .I ACTIVE="" S ACTIVE=0
"RTN","VEFAALR4",180,0)
 .S INITDATE=$P($G(^DIZ(19007,VEFACNT,3)),"^",4)
"RTN","VEFAALR4",181,0)
 .I INITDATE="" S INITDATE=0
"RTN","VEFAALR4",182,0)
 ;I (VEFACNT'="")&(ACTIVE) D
"RTN","VEFAALR4",183,0)
 I (VEFACNT'="")&(INITDATE'=0)&(VEFAADTT>INITDATE) D
"RTN","VEFAALR4",184,0)
 .;
"RTN","VEFAALR4",185,0)
 .; RECORD # in VEFA TRACKED ALERTS file
"RTN","VEFAALR4",186,0)
 .; get reminder dialog 
"RTN","VEFAALR4",187,0)
 .S VEFARMDL=$P($G(^DIZ(19007,VEFACNT,3)),U,1) ;
"RTN","VEFAALR4",188,0)
 .I VEFARMDL'="" D
"RTN","VEFAALR4",189,0)
 ..;
"RTN","VEFAALR4",190,0)
 ..;GO TO FILE 801.41
"RTN","VEFAALR4",191,0)
 ..;CHECK IF DISABLED
"RTN","VEFAALR4",192,0)
 ..S DISABLE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,3)
"RTN","VEFAALR4",193,0)
 ..;I (DISABLE=0)!(DISABLE="") D
"RTN","VEFAALR4",194,0)
 ..D
"RTN","VEFAALR4",195,0)
 ...;
"RTN","VEFAALR4",196,0)
 ...;CHECK REMINDER TYPE AS "REMINDER DIALOG"
"RTN","VEFAALR4",197,0)
 ...S REMTYPE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,4)
"RTN","VEFAALR4",198,0)
 ...I REMTYPE="R" D
"RTN","VEFAALR4",199,0)
 ....;
"RTN","VEFAALR4",200,0)
 ....; LOOK THROUGH DIALOG GROUPS AND THEIR ELEMENTS TO FIND ORDERABLE ANY ORDER ITEMS.
"RTN","VEFAALR4",201,0)
 ....S VEFACNT=0
"RTN","VEFAALR4",202,0)
 ....F  S VEFACNT=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT)) Q:VEFACNT=""  D
"RTN","VEFAALR4",203,0)
 .....;GET INTERNAL ENTRY #
"RTN","VEFAALR4",204,0)
 .....S VEFACNT1=0
"RTN","VEFAALR4",205,0)
 .....S VEFACNT1=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT,VEFACNT1))
"RTN","VEFAALR4",206,0)
 .....;
"RTN","VEFAALR4",207,0)
 .....I VEFACNT1'="" D
"RTN","VEFAALR4",208,0)
 ......; GET DIALOG GROUP OR DIRECT DIALOG ELEMENT (ASSUME FOR NOW ONLY DIALOG GROUP WITH ORDERS)
"RTN","VEFAALR4",209,0)
 ......S REMDIALG=$P($G(^PXRMD(801.41,VEFARMDL,10,VEFACNT1,0)),U,2)
"RTN","VEFAALR4",210,0)
 ......;
"RTN","VEFAALR4",211,0)
 ......I REMDIALG'="" D
"RTN","VEFAALR4",212,0)
 .......; CHECK IF DIALOG GROUP
"RTN","VEFAALR4",213,0)
 .......S DIALOGTY=$P($G(^PXRMD(801.41,REMDIALG,0)),U,4)
"RTN","VEFAALR4",214,0)
 .......I DIALOGTY="G" D   ; DIALOG GROUP
"RTN","VEFAALR4",215,0)
 ........;
"RTN","VEFAALR4",216,0)
 ........S VEFACNT2=0 ; GET DIALOG ELEMENTS INSIDE THIS DIALOG GROUP
"RTN","VEFAALR4",217,0)
 ........F  S VEFACNT2=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2)) Q:VEFACNT2=""  D
"RTN","VEFAALR4",218,0)
 .........;GET INTERNAL ENTRY #
"RTN","VEFAALR4",219,0)
 .........S DIALOGEL=0
"RTN","VEFAALR4",220,0)
 .........S DIALOGEL=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2,DIALOGEL))
"RTN","VEFAALR4",221,0)
 .........; DIALOG ELEMENT
"RTN","VEFAALR4",222,0)
 .........;
"RTN","VEFAALR4",223,0)
 .........S DIALOGEL=$P($G(^PXRMD(801.41,REMDIALG,10,DIALOGEL,0)),U,2)
"RTN","VEFAALR4",224,0)
 .........;
"RTN","VEFAALR4",225,0)
 .........;CHECK "ORDER" RESOLUTION TYPE FIRST
"RTN","VEFAALR4",226,0)
 .........S RESOLTYP=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,3)
"RTN","VEFAALR4",227,0)
 .........I RESOLTYP=3 D
"RTN","VEFAALR4",228,0)
 ..........;GET ORDERABLE ITEMS FILE ENTRY AS POOSIBLE FOLLOW-UP ACTION CHOICE. STORE INTO ^TMP($J,"ORDERITEM,COUNTER) ARRAY
"RTN","VEFAALR4",229,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7)
"RTN","VEFAALR4",230,0)
 ..........; NOW LOOK AT ORDERS IF ANY AND CHECK DATE/TIME > DATE/TIME OF PASSED CRIT ALERT
"RTN","VEFAALR4",231,0)
 ..........S COUNTER=COUNTER+1
"RTN","VEFAALR4",232,0)
 ..........;
"RTN","VEFAALR4",233,0)
 ..........S ^TMP($J,"ORDERITEM",COUNTER)=ORDERITEM
"RTN","VEFAALR4",234,0)
 ..........;new section to allow health factor to resolve with non-specific orderable item (like anti-biotics in general)
"RTN","VEFAALR4",235,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR4",236,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR4",237,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR4",238,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR4",239,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR4",240,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR4",241,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR4",242,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR4",243,0)
 ..........;end section
"RTN","VEFAALR4",244,0)
 .........E  D
"RTN","VEFAALR4",245,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR4",246,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR4",247,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR4",248,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR4",249,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR4",250,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR4",251,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR4",252,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR4",253,0)
 ....;  NOW GET ORDERS BY PATIENT AND PROVIDER (DUZ) DOESN'T CARE AS ORDER COULD BE MADE AMONG ANY PROVIDER IN OE/RR GROUP DEFINED
"RTN","VEFAALR4",254,0)
 ....; 
"RTN","VEFAALR4",255,0)
 ....; FOR SPECIFIC CRIT ALERT PROCESSING.BUT SHOULD MOST LIKELY BE MADE BY ORDERING PROVIDER. GET ORDERS STARTING IN REVERSE TIME
"RTN","VEFAALR4",256,0)
 ....; ORDER UNTIL DATE/TIME OF ANY ORDER < 
"RTN","VEFAALR4",257,0)
 ....;DATE/TIME OF CRIT ALERT,OR NO ORDER FOUND IS ENCOUNTERED. SEARCH AMONG ORDERITEM LIST F FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALR4",258,0)
 ....;GO BY PATIENT FIRST
"RTN","VEFAALR4",259,0)
 ....S CNTTIMO=0  ; DATE/TIME OF ORDER ABD CNTTIMA DATE/TIME OF UNACK CRIT ALERT
"RTN","VEFAALR4",260,0)
 ....S CNTPAT=VEFADFN_";DPT("
"RTN","VEFAALR4",261,0)
 ....;
"RTN","VEFAALR4",262,0)
 ....;W !
"RTN","VEFAALR4",263,0)
 ....;ZW ^TMP($J,"ORDERITEM")
"RTN","VEFAALR4",264,0)
 ....;S COUNTERF=0  ; COUNTER OF ORDERS FOUND
"RTN","VEFAALR4",265,0)
 ....;if ACK DATE AS DELETEDT'="" THEN FIGURE IF DELETEDT >ACK DATE+7 DAYS
"RTN","VEFAALR4",266,0)
 ....;SAME FOR EARLIEST FOLLOWUP ORDER DATE(S). INITIALIZE BELOW
"RTN","VEFAALR4",267,0)
 ....S REVERST1=""
"RTN","VEFAALR4",268,0)
 ....;I DELETEDT'="" S X1=DELETEDT S X2=-7 I VEFAADTT<X S ACKGT7D=1 E  S ACKGT7D=0
"RTN","VEFAALR4",269,0)
 ....S ACKGT7D=0 ; DEFAULT EVEN W/O DELETEDT DATE YET. CHECK ID ALREADY 7 DAYS PASS (IF SO MAK ACKGT7D=1)
"RTN","VEFAALR4",270,0)
 ....D NOW^%DTC S X1=% S X2=-7 D C^%DTC K % I VEFAADTT<X S ACKGT7D=1
"RTN","VEFAALR4",271,0)
 ....I DELETEDT'="" S X1=DELETEDT S X2=-7 D C^%DTC S ACKGT7D=0 I VEFAADTT<X S ACKGT7D=1
"RTN","VEFAALR4",272,0)
 ....S OVERFLAG=0
"RTN","VEFAALR4",273,0)
 ....F  S CNTTIMO=$O(^OR(100,"AC",CNTPAT,CNTTIMO)) S REVERST=9999999-CNTTIMO Q:(CNTTIMO="")!(VEFAADTT>REVERST)!(OVERFLAG=1)  D
"RTN","VEFAALR4",274,0)
 .....;CHECK ONLY IS LESS THAN DELETED DATE/TIME IF PASSED
"RTN","VEFAALR4",275,0)
 .....I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALR4",276,0)
 .....I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALR4",277,0)
 .....S ORDER=0
"RTN","VEFAALR4",278,0)
 .....S ORDER=$O(^OR(100,"AC",CNTPAT,CNTTIMO,ORDER))
"RTN","VEFAALR4",279,0)
 .....;
"RTN","VEFAALR4",280,0)
 .....;
"RTN","VEFAALR4",281,0)
 .....I ORDER'="" D
"RTN","VEFAALR4",282,0)
 ......;S AGENTPRM=$P($G(^OR(100,D0,0)),"^",4) ; MAYBE PROVIDER
"RTN","VEFAALR4",283,0)
 ......S CNT1=0 ; SEARCH MULTIPLE ORDERABLE ITEMS WITHIN 1 ORDER
"RTN","VEFAALR4",284,0)
 ......F  S CNT1=$O(^OR(100,ORDER,.1,"B",CNT1)) Q:(CNT1="")  D
"RTN","VEFAALR4",285,0)
 .......S CNTORD=CNT1
"RTN","VEFAALR4",286,0)
 .......;
"RTN","VEFAALR4",287,0)
 .......;S CNTORD=$P($G(^OR(100,ORDER,.1,CNT1,0)),"^",1)
"RTN","VEFAALR4",288,0)
 .......;CHECK AMONG ALL ACTUAL ORDERABLE ITEMS OF ORDER AMONG LIST OF ORDERABLE ITEMS FOR FOLLOW-UP ACTION.LIST ONLY ONE OCCURENCE IN ARRAY
"RTN","VEFAALR4",289,0)
 .......S COUNTER=0
"RTN","VEFAALR4",290,0)
 .......F  S COUNTER=$O(^TMP($J,"ORDERITEM",COUNTER)) Q:COUNTER=""  D
"RTN","VEFAALR4",291,0)
 ........S ORDERCK=$G(^TMP($J,"ORDERITEM",COUNTER))
"RTN","VEFAALR4",292,0)
 ........;
"RTN","VEFAALR4",293,0)
 ........I ORDERCK=CNTORD D
"RTN","VEFAALR4",294,0)
 .........;S AGENTPRV=$P($G(^OR(100,D0,0)),"^",4) ; ACTUAL AGENT PROVIDER OF ORDER
"RTN","VEFAALR4",295,0)
 .........S RYY=2  ; FOUND
"RTN","VEFAALR4",296,0)
 .........;ORDERABLE ITEM NAME
"RTN","VEFAALR4",297,0)
 .........I ORDERCK'="" D
"RTN","VEFAALR4",298,0)
 ..........S ORDRITEM=$P($G(^ORD(101.43,ORDERCK,0)),"^",1)
"RTN","VEFAALR4",299,0)
 ..........S ^TMP($J,"ORDERITEMFOUND",ORDRITEM_"*"_REVERST)=""
"RTN","VEFAALR4",300,0)
 ..........S REVERST1=REVERST  ; GO BACK IN REVERSE TIME. SAVE OLDEST ORDER/FOLLOWUP TIME FOUND ( UP TO DELETED /ACKED DATE IF ANY) 
"RTN","VEFAALR4",301,0)
 ..........I ($P($G(^OR(100,ORDER,0)),"^",4)'="")&(AGENTPRV="") S AGENTPRV=$P($G(^OR(100,ORDER,0)),"^",4) ; ACTUAL AGENT PROVIDER OF ORDER
"RTN","VEFAALR4",302,0)
 ..........;W !,"AGENTPRV=",AGENTPRV
"RTN","VEFAALR4",303,0)
 .........S SIGSTAT=1
"RTN","VEFAALR4",304,0)
 .........;NOT CHECK IF SIGNATURE REQUIRED AND SIGNATURE ITSELF
"RTN","VEFAALR4",305,0)
 .........I $P($G(^OR(100,ORDER,0)),"^",16)=2 D      ;ORES
"RTN","VEFAALR4",306,0)
 ..........S ACTION=0
"RTN","VEFAALR4",307,0)
 ..........S SIGSTAT=0
"RTN","VEFAALR4",308,0)
 ..........F  S ACTION=$O(^OR(100,ORDER,8,ACTION)) Q:(ACTION="")!(ACTION="C")  D
"RTN","VEFAALR4",309,0)
 ...........S ACTIONK=ACTION
"RTN","VEFAALR4",310,0)
 ...........S SIGSTAT=$P($G(^OR(100,ORDER,8,ACTION,0)),"^",4)
"RTN","VEFAALR4",311,0)
 ..........; CHECK FOR SIG STAT=1 FOR SIGNED ORDER ("ELECTRONIC") 
"RTN","VEFAALR4",312,0)
 ..........I RY'[1 S RY=RYY_"^"_SIGSTAT  ;SIGSTAT = 1 MEANS NO SIG REQUIRED OR SIG REQUIRED AND FOUND 
"RTN","VEFAALR4",313,0)
 .........E  D
"RTN","VEFAALR4",314,0)
 ..........S RY=RYY_"^"_1
"RTN","VEFAALR4",315,0)
 .........;
"RTN","VEFAALR4",316,0)
 ......;
"RTN","VEFAALR4",317,0)
 ......I RY'=0 I RY'[1 S RY=0_"^"_3      ; IE. IF RY NOT= 2_"^"_1 S RY=0_"^"_3
"RTN","VEFAALR4",318,0)
 ....;
"RTN","VEFAALR4",319,0)
 ....D
"RTN","VEFAALR4",320,0)
 .....;
"RTN","VEFAALR4",321,0)
 .....;  NOW GET V HEALTH FACTORS BY PATIENT 
"RTN","VEFAALR4",322,0)
 .....; FOR SPECIFIC CRIT ALERT PROCESSING.GET V HEALTH FACTORS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALR4",323,0)
 .....;UNTIL DATE/TIME OF ANY FOLLOWUP ACTION (V HEALTH FACTOR)< 
"RTN","VEFAALR4",324,0)
 .....;DATE/TIME OF CRIT ALERT,OR NO V  HEALTH FACTOR FOUND IS ENCOUNTERED. SEARCH AMONG FOLLOWUP LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALR4",325,0)
 .....;GO BY PATIENT FIRST
"RTN","VEFAALR4",326,0)
 .....S VHEALTH=999999999999
"RTN","VEFAALR4",327,0)
 .....S OVERFLAG=0
"RTN","VEFAALR4",328,0)
 .....;W !
"RTN","VEFAALR4",329,0)
 .....;ZW ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALR4",330,0)
 .....F  S VHEALTH=$O(^AUPNVHF("C",VEFADFN,VHEALTH),-1) Q:(VHEALTH="")!(OVERFLAG=1)  D
"RTN","VEFAALR4",331,0)
 ......S VISITPTR=$P($G(^AUPNVHF(VHEALTH,0)),"^",3)
"RTN","VEFAALR4",332,0)
 ......I VISITPTR'="" S REVERST=$P($G(^AUPNVSIT(VISITPTR,0)),"^",1)
"RTN","VEFAALR4",333,0)
 ......;
"RTN","VEFAALR4",334,0)
 ......;
"RTN","VEFAALR4",335,0)
 ......I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALR4",336,0)
 ......I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALR4",337,0)
 ......S VHEALFT=$P($G(^AUPNVHF(VHEALTH,0)),"^",1)
"RTN","VEFAALR4",338,0)
 ......;;;;;I VHEALFT=500158 S ^XTMP("AAA4","500158")=VEFADFN_"^"_VHEALTH
"RTN","VEFAALR4",339,0)
 ......;CHECK IF THIS HEALTH FACTOR WITHIN DATE/TIME ALLOWED IS ONE OF FOLLOWUP ACTION HEALTH FACTORS
"RTN","VEFAALR4",340,0)
 ......S COUNTER1=0
"RTN","VEFAALR4",341,0)
 ......F  S COUNTER1=$O(^TMP($J,"FOLLOWUPITEM",COUNTER1)) Q:(COUNTER1="")  D
"RTN","VEFAALR4",342,0)
 .......S FOLLOWUP=$G(^TMP($J,"FOLLOWUPITEM",COUNTER1))
"RTN","VEFAALR4",343,0)
 .......;S ^XTMP("AAAA",COUNTER1)=FOLLOWUP_"^"_VHEALFT
"RTN","VEFAALR4",344,0)
 .......I FOLLOWUP[VHEALFT D
"RTN","VEFAALR4",345,0)
 ........S FOLLOWU1=$P(FOLLOWUP,";",1)
"RTN","VEFAALR4",346,0)
 ........I FOLLOWU1'="" D
"RTN","VEFAALR4",347,0)
 .........S FOLLOWU1=$P($G(^AUTTHF(FOLLOWU1,0)),"^",1)
"RTN","VEFAALR4",348,0)
 .........I ($P($G(^AUPNVHF(VHEALTH,12)),"^",4)'="")&(AGENTPRV="") S AGENTPRV=$P($G(^AUPNVHF(VHEALTH,12)),"^",4) ;
"RTN","VEFAALR4",349,0)
 .........;W !,"AGENTPRV=",AGENTPRV
"RTN","VEFAALR4",350,0)
 .........S ^TMP($J,"ORDERITEMFOUND",FOLLOWU1_"*"_REVERST)=""  ; S RY=2_"^"_1
"RTN","VEFAALR4",351,0)
 .........S REVERST1=REVERST  ; GO BACK IN REVERSE TIME. SAVE OLDEST ORDER/FOLLOWUP TIME FOUND ( UP TO DELETED /ACKED DATE IF ANY) 
"RTN","VEFAALR4",352,0)
 ....;
"RTN","VEFAALR4",353,0)
 ....;
"RTN","VEFAALR4",354,0)
 ....;
"RTN","VEFAALR4",355,0)
 ....;
"RTN","VEFAALR4",356,0)
 ...E  D
"RTN","VEFAALR4",357,0)
 ....S RY=3_"^"_3  ; MEANS NO REMINDER DIALOG FOUND A SDIALOG ELEMENT NOT A REMINDER TYPE
"RTN","VEFAALR4",358,0)
 .E  D
"RTN","VEFAALR4",359,0)
 ..S RY=3_"^"_3  ; MEANS NO REMINDER DIALOG FOUND
"RTN","VEFAALR4",360,0)
 E  D
"RTN","VEFAALR4",361,0)
 .S RY=3_"^"_2  ; MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT
"RTN","VEFAALR4",362,0)
 I ($P(RY,"^",1)=3)&(($P(RY,"^",2)=3)!($P(RY,"^",2)=2)) Q 
"RTN","VEFAALR4",363,0)
 ;DO LOOP OF ORDERS FOUND RETURNED CONCATENATED WITH ";"
"RTN","VEFAALR4",364,0)
 S FOLLGT7D=0 ; DEFAULT EVEN W/O REVERST1 DATE YET. CHECK IF ALREADY 7 DAYS PASS (IF SO MAKE FOLLGT7D=1)
"RTN","VEFAALR4",365,0)
 D NOW^%DTC S X1=% S X2=-7 D C^%DTC K % I VEFAADTT<X S FOLLGT7D=1
"RTN","VEFAALR4",366,0)
 I ($D(REVERST1)) D
"RTN","VEFAALR4",367,0)
 . I REVERST1'="" S X1=REVERST1 S X2=-7 D C^%DTC S FOLLGT7D=0 I VEFAADTT<X S FOLLGT7D=1
"RTN","VEFAALR4",368,0)
 S RY=""
"RTN","VEFAALR4",369,0)
 S RY=$G(AGENTPRV)_"*"_$G(ACKGT7D)_"*"_$G(FOLLGT7D)_"*"_$G(REVERST1)_";"
"RTN","VEFAALR4",370,0)
 S COUNTERF=0
"RTN","VEFAALR4",371,0)
 F  S COUNTERF=$O(^TMP($J,"ORDERITEMFOUND",COUNTERF)) Q:COUNTERF=""  D
"RTN","VEFAALR4",372,0)
 .S RY=RY_COUNTERF_";"
"RTN","VEFAALR4",373,0)
 Q
"RTN","VEFAALR4",374,0)
VALIDTYP(Y) ; SCREEN ON KIDS BUILD TO RETURN VALID VEFA TRACKED CRITICAL ALERT TYPES
"RTN","VEFAALR4",375,0)
 I $P($G(^DIZ(19007,Y,0)),"^",1)="[PROSTATE SPECIFIC ANTIGEN]" Q 1
"RTN","VEFAALR4",376,0)
 I $P($G(^DIZ(19007,Y,0)),"^",1)="[OCCULT BLOOD]" Q 1
"RTN","VEFAALR4",377,0)
 ;MOD 8/22/2014 GOW ADJUST NAME  CHANGE CHEST 2 V TO CHEST 2 VIEWS FRONT
"RTN","VEFAALR4",378,0)
 ;I $P($G(^DIZ(19007,Y,0)),"^",1)="CHEST 2 V" Q 1
"RTN","VEFAALR4",379,0)
 I $P($G(^DIZ(19007,Y,0)),"^",1)="CHEST 2 VIEWS FRONT" Q 1
"RTN","VEFAALR4",380,0)
 ;END MOD
"RTN","VEFAALR4",381,0)
 I $P($G(^DIZ(19007,Y,0)),"^",1)="MAMMOGRAM" Q 1
"RTN","VEFAALR4",382,0)
 ;MOD 8/22/2014 GOW ALLOW RELAXING CRITERIA FOR SITES TO SAVE THEIR KB DATABASE FROM
"RTN","VEFAALR4",383,0)
 ;TEST ACOUNT WITH ADDITIONAL ALERT TYPES  TO SAVE NEW KB DATA KIDS BUILD AND MOVE
"RTN","VEFAALR4",384,0)
 ;IT TO PRODUCTION. HOWEVER FOR SAVING ORIGINAL KB DATA KIDS FILE AS TEMPLATE KB
"RTN","VEFAALR4",385,0)
 ;DATABASE KIDS FILE, PUT BACK TO "Q 0" 
"RTN","VEFAALR4",386,0)
 ;Q 0
"RTN","VEFAALR4",387,0)
 Q 1
"RTN","VEFAALR4",388,0)
VALIDCAT(Y) ; SCREEN ON KIDS BUILD TO RETURN VALID VEFA ALERT CATEGORIES
"RTN","VEFAALR4",389,0)
 I $P($G(^DIZ(19008,Y,0)),"^",1)="Abnl Imaging Reslt, Needs Attn:" Q 1
"RTN","VEFAALR4",390,0)
 I $P($G(^DIZ(19008,Y,0)),"^",1)="Critical labs -" Q 1
"RTN","VEFAALR4",391,0)
 ;MOD 8/22/2014 GOW ALLOW RELAXING CRITERIA FOR SITES TO SAVE THEIR KB DATABASE FROM
"RTN","VEFAALR4",392,0)
 ;TEST ACOUNT WITH ADDITIONAL ALERT CATEGORIES TO SAVE NEW KB DATA KIDS BUILD AND MOVE
"RTN","VEFAALR4",393,0)
 ;IT TO PRODUCTION. HOWEVER FOR SAVING ORIGINAL KB DATA KIDS FILE AS TEMPLATE KB
"RTN","VEFAALR4",394,0)
 ;DATABASE KIDS FILE, PUT BACK TO "Q 0" 
"RTN","VEFAALR4",395,0)
 ;Q 0
"RTN","VEFAALR4",396,0)
 Q 1
"RTN","VEFAALR4",397,0)
VALIDORI(Y) ; SCREEN ON ORDERABLE ITEMS INTO PRODUCTION ACCOUNT FROM TEST ACCOUNT
"RTN","VEFAALR4",398,0)
 I $E($P($G(^ORD(101.43,+Y,0)),"^",1),1,4)="VEFA" Q 1
"RTN","VEFAALR4",399,0)
 Q 0
"RTN","VEFAALR4",400,0)
VALIDORD(Y) ;SCREEN ON ORDER DIALOGS INTO PRODUCTION ACCOUNT FROM TEST ACCOUNT
"RTN","VEFAALR4",401,0)
 I $E($P($G(^ORD(101.41,+Y,0)),"^",1),1,4)="VEFA" Q 1
"RTN","VEFAALR4",402,0)
 Q 0
"RTN","VEFAALR5")
0^11^B1641346
"RTN","VEFAALR5",1,0)
VEFAALR5 ;WOIFO/BT - VEFA AWARE KEY APIS for Alert Cache viewer and KB Editor; 01/15/2014
"RTN","VEFAALR5",2,0)
 ;;1.0;VEFA AWARE;**1,4**;17-January-2014;Build 33
"RTN","VEFAALR5",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","VEFAALR5",4,0)
 ;;
"RTN","VEFAALR5",5,0)
 ;
"RTN","VEFAALR5",6,0)
 ; External Reference DBIA#
"RTN","VEFAALR5",7,0)
 ; ------------------------
"RTN","VEFAALR5",8,0)
 ; #10076 - ^XUSEC GLOBAL (Supported)
"RTN","VEFAALR5",9,0)
 ; #2343  - DEA^XUSER     (Supported)
"RTN","VEFAALR5",10,0)
 QUIT
"RTN","VEFAALR5",11,0)
 ;
"RTN","VEFAALR5",12,0)
USRKEY(LEVEL,DUZ) ;
"RTN","VEFAALR5",13,0)
 ; LEVEL : User Key Security Level 
"RTN","VEFAALR5",14,0)
 ;         RETURN value (passed in by reference)
"RTN","VEFAALR5",15,0)
 ;         0 : User has no right to view Alert Cache
"RTN","VEFAALR5",16,0)
 ;         1 : User has right to only view his/her own Alert Cache
"RTN","VEFAALR5",17,0)
 ;         2 : User has right to see all Alert Cache
"RTN","VEFAALR5",18,0)
 ; 
"RTN","VEFAALR5",19,0)
 S LEVEL=0
"RTN","VEFAALR5",20,0)
 I $D(^XUSEC("XUPROG",DUZ)) S LEVEL=2
"RTN","VEFAALR5",21,0)
 I 'LEVEL,$D(^XUSEC("VEFA AWARE ALL ALERT CACHE",DUZ)) S LEVEL=2
"RTN","VEFAALR5",22,0)
 I 'LEVEL,$D(^XUSEC("VEFA AWARE OWN ALERT CACHE",DUZ)) S LEVEL=1
"RTN","VEFAALR5",23,0)
 I 'LEVEL D
"RTN","VEFAALR5",24,0)
 . S DUZ(2)="" ;NOT USED for this session
"RTN","VEFAALR5",25,0)
 . S:$$DEA^XUSER(1,DUZ)'="" LEVEL=1 ;User has DEA# 
"RTN","VEFAALR5",26,0)
 QUIT
"RTN","VEFAALR5",27,0)
 ;
"RTN","VEFAALR5",28,0)
HASKBKEY(DUZ) ; Return 1 if user has programmer key or owns KB Key, 0 otherwise
"RTN","VEFAALR5",29,0)
 N KEY S KEY="VEFA AWARE ADD/EDIT KB RULE"
"RTN","VEFAALR5",30,0)
 QUIT:$D(^XUSEC("XUPROG",DUZ)) 1
"RTN","VEFAALR5",31,0)
 QUIT:$D(^XUSEC(KEY,DUZ)) 1
"RTN","VEFAALR5",32,0)
 QUIT 0
"RTN","VEFAALR5",33,0)
 ;
"RTN","VEFAALR5",34,0)
ISPROG(DUZ) ;  Return number > 0  if user has programmer key 0 otherwise
"RTN","VEFAALR5",35,0)
 QUIT $D(^XUSEC("XUPROG",DUZ))
"RTN","VEFAALR6")
0^12^B141064223
"RTN","VEFAALR6",1,0)
VEFAALR6 ;GOW/THC VEFA - Module for AWARE report gathering into an Alert Audit Log or Cache[ 12/01/2010 ]
"RTN","VEFAALR6",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR6",3,0)
FOLLOWU1(X)  ; FAT  LOOK STATUS + EXTRA COLUMN FOR FAT PROVIDER ( IF FAT SATISFIED)
"RTN","VEFAALR6",4,0)
 N RY1,RY,XX,RY2
"RTN","VEFAALR6",5,0)
 S XX=X
"RTN","VEFAALR6",6,0)
 S RY2=""
"RTN","VEFAALR6",7,0)
 S RY1=$$ORDERCK(XX)
"RTN","VEFAALR6",8,0)
 S RY1=$P(RY1,";",1)
"RTN","VEFAALR6",9,0)
 I RY1'="" S RY2=$P($G(^VA(200,RY1,0)),"^",1)_" - "_RY1
"RTN","VEFAALR6",10,0)
 S RY=$$FOLLOWUP(XX)
"RTN","VEFAALR6",11,0)
 ;START MOD 1/30/2015 FOR FAT WORDING REMOVAL
"RTN","VEFAALR6",12,0)
 I RY="ONE OR MORE ORDERS/FOLLOW-UPS MADE" S RY=RY_"^"_RY2 Q RY  ;S RY=RY_"^"_RY2 Q RY
"RTN","VEFAALR6",13,0)
 ;I RY="ONE OR MORE FAT ORDERS/FOLLOW-UPS MADE" S RY=RY_"^"_RY2 Q RY  ;S RY=RY_"^"_RY2 Q RY
"RTN","VEFAALR6",14,0)
 ;END MOD  
"RTN","VEFAALR6",15,0)
 S RY=RY_"^"
"RTN","VEFAALR6",16,0)
 Q RY
"RTN","VEFAALR6",17,0)
ORDERCK(X) ;
"RTN","VEFAALR6",18,0)
 ;RETURN LIST OF ORDER FOLLOWUP ACTION THAT HAVE BEEN DONE. FROM ACKNOWLEDGED (DELETED) ALERT DATE TIME OR CURENT TIME BACK TO DATE OF ALERT
"RTN","VEFAALR6",19,0)
 N D0,RY,VEFADFN,VEFAPRV,VEFADTIM,VEFARETN,VEFAFOLP,ZP,RY,VEFADSPL,VEFADELD
"RTN","VEFAALR6",20,0)
 N VEFANAME
"RTN","VEFAALR6",21,0)
 S D0=X
"RTN","VEFAALR6",22,0)
 S VEFADFN=$P($G(^XTV(8992.1,D0,0)),"^",4)
"RTN","VEFAALR6",23,0)
 S VEFADTIM=$P($P($G(^XTV(8992.1,D0,0)),"^",1),";",3)
"RTN","VEFAALR6",24,0)
 S VEFARETN=$$SERVIC1^VEFAALR1(X)
"RTN","VEFAALR6",25,0)
 S VEFANAME=$P(VEFARETN,"^",3)
"RTN","VEFAALR6",26,0)
 S VEFAPRV=$P(VEFARETN,"^",2)
"RTN","VEFAALR6",27,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR6",28,0)
 ;W !,"VEFADSPL=",VEFADSPL
"RTN","VEFAALR6",29,0)
 ;GET ACKNOWLEDGED(DELETED) DATE (IF ANY)
"RTN","VEFAALR6",30,0)
 S VEFADELD=$$STATUS1^VEFAALR1(X)
"RTN","VEFAALR6",31,0)
 S VEFADELD="" ;$P(VEFADELD,"^",3) 2/24/15
"RTN","VEFAALR6",32,0)
 S ZP=VEFADFN_"^"_VEFAPRV_"^"_VEFANAME_"^"_VEFADTIM_"^"_VEFADELD
"RTN","VEFAALR6",33,0)
 ;W !,"ZP=",ZP
"RTN","VEFAALR6",34,0)
 S RY=""
"RTN","VEFAALR6",35,0)
 D LKPORDCK(.RY,ZP)  ;
"RTN","VEFAALR6",36,0)
 ;D LKPORDCK^VEFAALRE(.RY,ZP)  ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and RETURN list of
"RTN","VEFAALR6",37,0)
 ;any ORDERS by ordering provider user (DUZ) that have been made from list of available FAT (Follow-up Alert Tracking) orders in in specifi defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR6",38,0)
 ; multiples(and fields)with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list 
"RTN","VEFAALR6",39,0)
 ;to be compared with any actual orders NOT by any ordering provider user(s) (DUZ) made after the date/time of the actual critical alert UP to NOW or
"RTN","VEFAALR6",40,0)
 ;to date of acknowledgement(deletion) OR now time (if not passed). Do this search in reverse chronological order.
"RTN","VEFAALR6",41,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR6",42,0)
 ; INPUT 
"RTN","VEFAALR6",43,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT ^ DATE ACKNOWLEDGED(DELETED) 
"RTN","VEFAALR6",44,0)
 ; RETURN
"RTN","VEFAALR6",45,0)
 ;  RY= ORDERING PROVIDER OFORDER/FOLLOW-UP ACTION (IF ANY)FOLLOWED BY ";" AND THEN CONCATENATED STRING OF ACTUAL ORDERS MADE EACH SEPARATED WITH ";"
"RTN","VEFAALR6",46,0)
 ;  
"RTN","VEFAALR6",47,0)
 ;
"RTN","VEFAALR6",48,0)
 Q RY
"RTN","VEFAALR6",49,0)
FOLLOWUP(X) ;
"RTN","VEFAALR6",50,0)
 ;RETURN WHETHER ANY ORDER/FOLLOWUP ACTION HAS BEEN DONE. ACKNOW
"RTN","VEFAALR6",51,0)
 N D0,RY,VEFADFN,VEFAPRV,VEFADTIM,VEFARETN,VEFAFOLP,ZP,RY,VEFADSPL
"RTN","VEFAALR6",52,0)
 N VEFANAME
"RTN","VEFAALR6",53,0)
 N VEFADELD
"RTN","VEFAALR6",54,0)
 S D0=X
"RTN","VEFAALR6",55,0)
 S VEFADFN=$P($G(^XTV(8992.1,D0,0)),"^",4)
"RTN","VEFAALR6",56,0)
 S VEFADTIM=$P($P($G(^XTV(8992.1,D0,0)),"^",1),";",3)
"RTN","VEFAALR6",57,0)
 S VEFARETN=$$SERVIC1^VEFAALR1(X)
"RTN","VEFAALR6",58,0)
 S VEFANAME=$P(VEFARETN,"^",3)
"RTN","VEFAALR6",59,0)
 S VEFAPRV=$P(VEFARETN,"^",2)
"RTN","VEFAALR6",60,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR6",61,0)
 ;W !,"VEFADSPL=",VEFADSPL
"RTN","VEFAALR6",62,0)
 ;GET ACKNOWLEDGED(DELETED) DATE (IF ANY)
"RTN","VEFAALR6",63,0)
 S VEFADELD=$$STATUS1^VEFAALR1(X)
"RTN","VEFAALR6",64,0)
 S VEFADELD="" ;$P(VEFADELD,"^",3) 2/24/15
"RTN","VEFAALR6",65,0)
 S ZP=VEFADFN_"^"_VEFAPRV_"^"_VEFANAME_"^"_VEFADTIM_"^"_VEFADELD
"RTN","VEFAALR6",66,0)
 ;W !,"ZP=",ZP
"RTN","VEFAALR6",67,0)
 S RY=""
"RTN","VEFAALR6",68,0)
 D LKPORD^VEFAALRA(.RY,ZP) ;
"RTN","VEFAALR6",69,0)
 ;D LKPORD^VEFAALR2(.RY,ZP)  ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and check whether
"RTN","VEFAALR6",70,0)
 ;any ORDERS by user (DUZ)have been made from list of orders in in a possible defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR6",71,0)
 ;(field), the dialog elements thereof containing the ORDER types (orderable iems) for such list to be compared with any actual orders 
"RTN","VEFAALR6",72,0)
 ;by this user (DUZ) made after the date/time of the actual critical alert. 
"RTN","VEFAALR6",73,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR6",74,0)
 ; if 
"RTN","VEFAALR6",75,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT  ^ DELETED DATE/TIME(IF ANY)
"RTN","VEFAALR6",76,0)
 ;  RY= 0 (1ST PIECE=0) NO ORDERS FOUND YET
"RTN","VEFAALR6",77,0)
 ;  RY= 0_"^"_3  ; (1ST PIECE=0)MEANS ORDER(S) FOUND BUT NONE NOT COMPLETED OR READY FOR SIG OR NONE OF THOSE COMPLETED WITH SIG REQUIRED HAVE SIGNATURE
"RTN","VEFAALR6",78,0)
 ;  RY =2_"^"_1  (1ST PIECE=2) if at least one ORDER found satisfying criteria complete/signed
"RTN","VEFAALR6",79,0)
 ;  RY= 3_"^"_2  ;(1ST PIECE=3) MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALR6",80,0)
 ;  RY= 3_"^"_3  ; (1ST PIECE=3)MEANS NO REMINDER DIALOG FOUND IN ALERT TRACKINg FILE FOR THIS TYPE OF ALERT
"RTN","VEFAALR6",81,0)
 ;
"RTN","VEFAALR6",82,0)
 ;LOCAL MOD GOW 1/30/2015 REMOVE FAT WORDING
"RTN","VEFAALR6",83,0)
 I RY=0 S RY="NO ORDERS/FOLLOW-UPS MADE" Q RY
"RTN","VEFAALR6",84,0)
 I $E(RY,1,1)=0 I $E(RY,3,3)=3 S RY="ORDER(S) MADE BUT NOT COMPLETED OR SIGNED" Q RY
"RTN","VEFAALR6",85,0)
 I $E(RY,1,1)=2 I $E(RY,3,3)=1 S RY="ONE OR MORE ORDERS/FOLLOW-UPS MADE" Q RY
"RTN","VEFAALR6",86,0)
 ;I RY=0 S RY="NO FAT ORDERS MADE" Q RY
"RTN","VEFAALR6",87,0)
 ;I $E(RY,1,1)=0 I $E(RY,3,3)=3 S RY="FAT ORDER(S) MADE BUT NOT COMPLETED OR SIGNED" Q RY
"RTN","VEFAALR6",88,0)
 ;I $E(RY,1,1)=2 I $E(RY,3,3)=1 S RY="ONE OR MORE FAT ORDERS/FOLLOW-UPS MADE" Q RY
"RTN","VEFAALR6",89,0)
 Q RY
"RTN","VEFAALR6",90,0)
LKPORDCK(RY,ZP) ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and RETURN list of 
"RTN","VEFAALR6",91,0)
 ;any ORDERS by ordering provider user (DUZ) that have been made from list of available FAT (Follow-up Alert Tracking) orders in in specifi defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR6",92,0)
 ; multiples(and fields)with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list 
"RTN","VEFAALR6",93,0)
 ;to be compared with any actual orders by ordering provider user(s) (DUZ) made after the date/time of the actual critical alert UP to NOW or
"RTN","VEFAALR6",94,0)
 ;to date of acknowledgement(deletion) OR now time (if not passed). Do this search in reverse chronological order.
"RTN","VEFAALR6",95,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR6",96,0)
 ; INPUT 
"RTN","VEFAALR6",97,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT ^ DATE ACKNOWLEDGED(DELETED) 
"RTN","VEFAALR6",98,0)
 ; RETURN
"RTN","VEFAALR6",99,0)
 ;  RY= PROVIDER FOR ORDERS/FOLLOW-UPS  & THEN CONCATENATED STRING OF ACTUAL ORDERS MADE EACH SPEARATED WITH ";"
"RTN","VEFAALR6",100,0)
 ;
"RTN","VEFAALR6",101,0)
 ;
"RTN","VEFAALR6",102,0)
 N VEFADFN,VEFADUZ,VEFAALRT,VEFAADTT,VEFARMDL
"RTN","VEFAALR6",103,0)
 N VEFACNT,VEFACNT1,VEFACNT2
"RTN","VEFAALR6",104,0)
 N DISABLE,REMDIALG,DIALOGTY,DIALOGEL,RESOLTYP,ORDRITM,COUNTER,CNTORD,CNT1,ORDER,CNTTIMO,CNTTIMA,REVERST,CNTPAT,ORDERCK,COUNTERF
"RTN","VEFAALR6",105,0)
 N RYY,ACTION,ACTIONK,SIGSTAT
"RTN","VEFAALR6",106,0)
 N DELETEDT,ORDRITEM
"RTN","VEFAALR6",107,0)
 N FOLLUPCT,FOLLOWAC
"RTN","VEFAALR6",108,0)
 N VHEALTH,OVERFLAG,VHEALF,FOLLOWUP,VISITPTR
"RTN","VEFAALR6",109,0)
 N FOLLOWU1
"RTN","VEFAALR6",110,0)
 N AGENTPRM,AGENTPRV,COUNTER1,ACTIVE
"RTN","VEFAALR6",111,0)
 N INITDATE
"RTN","VEFAALR6",112,0)
 ;
"RTN","VEFAALR6",113,0)
 N ORDERITEM,REMTYPE,VHEALFT
"RTN","VEFAALR6",114,0)
 ;K RY
"RTN","VEFAALR6",115,0)
 S RY=0
"RTN","VEFAALR6",116,0)
 S AGENTPRV=""
"RTN","VEFAALR6",117,0)
 S COUNTER=0
"RTN","VEFAALR6",118,0)
 S COUNTER1=0
"RTN","VEFAALR6",119,0)
 K ^TMP($J,"ORDERITEM")
"RTN","VEFAALR6",120,0)
 K ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALR6",121,0)
 K ^TMP($J,"ORDERITEMFOUND")
"RTN","VEFAALR6",122,0)
 S VEFADFN=$P(ZP,U,1) S VEFADUZ=$P(ZP,U,2) S VEFAALRT=$P(ZP,U,3) S VEFAADTT=$P(ZP,U,4) S DELETEDT=$P(ZP,U,5)
"RTN","VEFAALR6",123,0)
 ;
"RTN","VEFAALR6",124,0)
 ;first CHECK if type of alert if in VEFA ALERT TRACKING file
"RTN","VEFAALR6",125,0)
 S VEFACNT=0
"RTN","VEFAALR6",126,0)
 ;
"RTN","VEFAALR6",127,0)
 S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALR6",128,0)
 S ACTIVE=0
"RTN","VEFAALR6",129,0)
 S INITDATE=0
"RTN","VEFAALR6",130,0)
 ;CHECK IF ACTIVE
"RTN","VEFAALR6",131,0)
 ;S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALR6",132,0)
 I VEFACNT'="" D
"RTN","VEFAALR6",133,0)
 .S ACTIVE=$P($G(^DIZ(19007,VEFACNT,3)),"^",5)
"RTN","VEFAALR6",134,0)
 .I ACTIVE="" S ACTIVE=0
"RTN","VEFAALR6",135,0)
 .S INITDATE=$P($G(^DIZ(19007,VEFACNT,3)),"^",4)
"RTN","VEFAALR6",136,0)
 .I INITDATE="" S INITDATE=0
"RTN","VEFAALR6",137,0)
 ;I (VEFACNT'="")&(ACTIVE) D
"RTN","VEFAALR6",138,0)
 I (VEFACNT'="")&(INITDATE'=0) D
"RTN","VEFAALR6",139,0)
 .;
"RTN","VEFAALR6",140,0)
 .; RECORD # in VEFA TRACKED ALERTS file
"RTN","VEFAALR6",141,0)
 .; get reminder dialog 
"RTN","VEFAALR6",142,0)
 .S VEFARMDL=$P($G(^DIZ(19007,VEFACNT,3)),U,1) ;
"RTN","VEFAALR6",143,0)
 .I VEFARMDL'="" D
"RTN","VEFAALR6",144,0)
 ..;
"RTN","VEFAALR6",145,0)
 ..;GO TO FILE 801.41
"RTN","VEFAALR6",146,0)
 ..;CHECK IF DISABLED
"RTN","VEFAALR6",147,0)
 ..S DISABLE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,3)
"RTN","VEFAALR6",148,0)
 ..I (DISABLE=0)!(DISABLE="") D
"RTN","VEFAALR6",149,0)
 ...;
"RTN","VEFAALR6",150,0)
 ...;CHECK REMINDER TYPE AS "REMINDER DIALOG"
"RTN","VEFAALR6",151,0)
 ...S REMTYPE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,4)
"RTN","VEFAALR6",152,0)
 ...I REMTYPE="R" D
"RTN","VEFAALR6",153,0)
 ....;
"RTN","VEFAALR6",154,0)
 ....; LOOK THROUGH DIALOG GROUPS AND THEIR ELEMENTS TO FIND ORDERABLE ANY ORDER ITEMS.
"RTN","VEFAALR6",155,0)
 ....S VEFACNT=0
"RTN","VEFAALR6",156,0)
 ....F  S VEFACNT=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT)) Q:VEFACNT=""  D
"RTN","VEFAALR6",157,0)
 .....;GET INTERNAL ENTRY #
"RTN","VEFAALR6",158,0)
 .....S VEFACNT1=0
"RTN","VEFAALR6",159,0)
 .....S VEFACNT1=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT,VEFACNT1))
"RTN","VEFAALR6",160,0)
 .....;
"RTN","VEFAALR6",161,0)
 .....I VEFACNT1'="" D
"RTN","VEFAALR6",162,0)
 ......; GET DIALOG GROUP OR DIRECT DIALOG ELEMENT (ASSUME FOR NOW ONLY DIALOG GROUP WITH ORDERS)
"RTN","VEFAALR6",163,0)
 ......S REMDIALG=$P($G(^PXRMD(801.41,VEFARMDL,10,VEFACNT1,0)),U,2)
"RTN","VEFAALR6",164,0)
 ......;
"RTN","VEFAALR6",165,0)
 ......I REMDIALG'="" D
"RTN","VEFAALR6",166,0)
 .......; CHECK IF DIALOG GROUP
"RTN","VEFAALR6",167,0)
 .......S DIALOGTY=$P($G(^PXRMD(801.41,REMDIALG,0)),U,4)
"RTN","VEFAALR6",168,0)
 .......I DIALOGTY="G" D   ; DIALOG GROUP
"RTN","VEFAALR6",169,0)
 ........;
"RTN","VEFAALR6",170,0)
 ........S VEFACNT2=0 ; GET DIALOG ELEMENTS INSIDE THIS DIALOG GROUP
"RTN","VEFAALR6",171,0)
 ........F  S VEFACNT2=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2)) Q:VEFACNT2=""  D
"RTN","VEFAALR6",172,0)
 .........;GET INTERNAL ENTRY #
"RTN","VEFAALR6",173,0)
 .........S DIALOGEL=0
"RTN","VEFAALR6",174,0)
 .........S DIALOGEL=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2,DIALOGEL))
"RTN","VEFAALR6",175,0)
 .........; DIALOG ELEMENT
"RTN","VEFAALR6",176,0)
 .........;
"RTN","VEFAALR6",177,0)
 .........S DIALOGEL=$P($G(^PXRMD(801.41,REMDIALG,10,DIALOGEL,0)),U,2)
"RTN","VEFAALR6",178,0)
 .........;
"RTN","VEFAALR6",179,0)
 .........;CHECK "ORDER" RESOLUTION TYPE FIRST
"RTN","VEFAALR6",180,0)
 .........S RESOLTYP=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,3)
"RTN","VEFAALR6",181,0)
 .........I RESOLTYP=3 D
"RTN","VEFAALR6",182,0)
 ..........;GET ORDERABLE ITEMS FILE ENTRY AS POOSIBLE FOLLOW-UP ACTION CHOICE. STORE INTO ^TMP($J,"ORDERITEM,COUNTER) ARRAY
"RTN","VEFAALR6",183,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7)
"RTN","VEFAALR6",184,0)
 ..........; NOW LOOK AT ORDERS IF ANY AND CHECK DATE/TIME > DATE/TIME OF PASSED CRIT ALERT
"RTN","VEFAALR6",185,0)
 ..........S COUNTER=COUNTER+1
"RTN","VEFAALR6",186,0)
 ..........;
"RTN","VEFAALR6",187,0)
 ..........S ^TMP($J,"ORDERITEM",COUNTER)=ORDERITEM
"RTN","VEFAALR6",188,0)
 ..........;new section to allow health factor to resolve with non-specific orderable item (like anti-biotics in general)
"RTN","VEFAALR6",189,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR6",190,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR6",191,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR6",192,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR6",193,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR6",194,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR6",195,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR6",196,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR6",197,0)
 ..........;end section
"RTN","VEFAALR6",198,0)
 .........E  D
"RTN","VEFAALR6",199,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR6",200,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR6",201,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR6",202,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR6",203,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR6",204,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR6",205,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR6",206,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR6",207,0)
 ....;  NOW GET ORDERS BY PATIENT AND PROVIDER (DUZ) DOESN'T CARE AS ORDER COULD BE MADE AMONG ANY PROVIDER IN OE/RR GROUP DEFINED
"RTN","VEFAALR6",208,0)
 ....; 
"RTN","VEFAALR6",209,0)
 ....; FOR SPECIFIC CRIT ALERT PROCESSING.BUT SHOULD MOST LIKELY BE MADE BY ORDERING PROVIDER. GET ORDERS STARTING IN REVERSE TIME
"RTN","VEFAALR6",210,0)
 ....; ORDER UNTIL DATE/TIME OF ANY ORDER < 
"RTN","VEFAALR6",211,0)
 ....;DATE/TIME OF CRIT ALERT,OR NO ORDER FOUND IS ENCOUNTERED. SEARCH AMONG ORDERITEM LIST F FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALR6",212,0)
 ....;GO BY PATIENT FIRST
"RTN","VEFAALR6",213,0)
 ....S CNTTIMO=0  ; DATE/TIME OF ORDER ABD CNTTIMA DATE/TIME OF UNACK CRIT ALERT
"RTN","VEFAALR6",214,0)
 ....S CNTPAT=VEFADFN_";DPT("
"RTN","VEFAALR6",215,0)
 ....;
"RTN","VEFAALR6",216,0)
 ....;W !
"RTN","VEFAALR6",217,0)
 ....;ZW ^TMP($J,"ORDERITEM")
"RTN","VEFAALR6",218,0)
 ....;S COUNTERF=0  ; COUNTER OF ORDERS FOUND
"RTN","VEFAALR6",219,0)
 ....F  S CNTTIMO=$O(^OR(100,"AC",CNTPAT,CNTTIMO)) S REVERST=9999999-CNTTIMO Q:(CNTTIMO="")!(VEFAADTT>REVERST)  D
"RTN","VEFAALR6",220,0)
 .....;CHECK ONLY IS LESS THAN DELETED DATE/TIME IF PASSED
"RTN","VEFAALR6",221,0)
 .....I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALR6",222,0)
 .....I VEFAADTT>REVERST Q
"RTN","VEFAALR6",223,0)
 .....S ORDER=0
"RTN","VEFAALR6",224,0)
 .....S ORDER=$O(^OR(100,"AC",CNTPAT,CNTTIMO,ORDER))
"RTN","VEFAALR6",225,0)
 .....;
"RTN","VEFAALR6",226,0)
 .....;
"RTN","VEFAALR6",227,0)
 .....I ORDER'="" D
"RTN","VEFAALR6",228,0)
 ......;S AGENTPRM=$P($G(^OR(100,D0,0)),"^",4) ; MAYBE PROVIDER
"RTN","VEFAALR6",229,0)
 ......S CNT1=0  ; SEARCH MULTIPLE ORDERABLE ITEMS WITHIN 1 ORDER
"RTN","VEFAALR6",230,0)
 ......F  S CNT1=$O(^OR(100,ORDER,.1,"B",CNT1)) Q:(CNT1="")  D
"RTN","VEFAALR6",231,0)
 .......S CNTORD=CNT1
"RTN","VEFAALR6",232,0)
 .......;
"RTN","VEFAALR6",233,0)
 .......;S CNTORD=$P($G(^OR(100,ORDER,.1,CNT1,0)),"^",1)
"RTN","VEFAALR6",234,0)
 .......;CHECK AMONG ALL ACTUAL ORDERABLE ITEMS OF ORDER AMONG LIST OF ORDERABLE ITEMS FOR FOLLOW-UP ACTION.LIST ONLY ONE OCCURENCE IN ARRAY
"RTN","VEFAALR6",235,0)
 .......S COUNTER=0
"RTN","VEFAALR6",236,0)
 .......F  S COUNTER=$O(^TMP($J,"ORDERITEM",COUNTER)) Q:COUNTER=""  D
"RTN","VEFAALR6",237,0)
 ........S ORDERCK=$G(^TMP($J,"ORDERITEM",COUNTER))
"RTN","VEFAALR6",238,0)
 ........;
"RTN","VEFAALR6",239,0)
 ........I ORDERCK=CNTORD D
"RTN","VEFAALR6",240,0)
 .........;S AGENTPRV=$P($G(^OR(100,D0,0)),"^",4) ; ACTUAL AGENT PROVIDER OF ORDER
"RTN","VEFAALR6",241,0)
 .........S RYY=2  ; FOUND
"RTN","VEFAALR6",242,0)
 .........;ORDERABLE ITEM NAME
"RTN","VEFAALR6",243,0)
 .........I ORDERCK'="" D
"RTN","VEFAALR6",244,0)
 ..........S ORDRITEM=$P($G(^ORD(101.43,ORDERCK,0)),"^",1)
"RTN","VEFAALR6",245,0)
 ..........S ^TMP($J,"ORDERITEMFOUND",ORDRITEM)=""
"RTN","VEFAALR6",246,0)
 ..........I ($P($G(^OR(100,ORDER,0)),"^",4)'="")&(AGENTPRV="") S AGENTPRV=$P($G(^OR(100,ORDER,0)),"^",4) ; ACTUAL AGENT PROVIDER OF ORDER
"RTN","VEFAALR6",247,0)
 ..........;W !,"AGENTPRV=",AGENTPRV
"RTN","VEFAALR6",248,0)
 .........S SIGSTAT=1
"RTN","VEFAALR6",249,0)
 .........;NOT CHECK IF SIGNATURE REQUIRED AND SIGNATURE ITSELF
"RTN","VEFAALR6",250,0)
 .........I $P($G(^OR(100,ORDER,0)),"^",16)=2 D      ;ORES
"RTN","VEFAALR6",251,0)
 ..........S ACTION=0
"RTN","VEFAALR6",252,0)
 ..........S SIGSTAT=0
"RTN","VEFAALR6",253,0)
 ..........F  S ACTION=$O(^OR(100,ORDER,8,ACTION)) Q:(ACTION="")!(ACTION="C")  D
"RTN","VEFAALR6",254,0)
 ...........S ACTIONK=ACTION
"RTN","VEFAALR6",255,0)
 ...........S SIGSTAT=$P($G(^OR(100,ORDER,8,ACTION,0)),"^",4)
"RTN","VEFAALR6",256,0)
 ..........; CHECK FOR SIG STAT=1 FOR SIGNED ORDER ("ELECTRONIC") 
"RTN","VEFAALR6",257,0)
 ..........I RY'[1 S RY=RYY_"^"_SIGSTAT  ;SIGSTAT = 1 MEANS NO SIG REQUIRED OR SIG REQUIRED AND FOUND 
"RTN","VEFAALR6",258,0)
 .........E  D
"RTN","VEFAALR6",259,0)
 ..........S RY=RYY_"^"_1
"RTN","VEFAALR6",260,0)
 .........;
"RTN","VEFAALR6",261,0)
 ......;
"RTN","VEFAALR6",262,0)
 ......I RY'=0 I RY'[1 S RY=0_"^"_3      ; IE. IF RY NOT= 2_"^"_1 S RY=0_"^"_3
"RTN","VEFAALR6",263,0)
 ....;
"RTN","VEFAALR6",264,0)
 ....D
"RTN","VEFAALR6",265,0)
 .....;
"RTN","VEFAALR6",266,0)
 .....;  NOW GET V HEALTH FACTORS BY PATIENT 
"RTN","VEFAALR6",267,0)
 .....; FOR SPECIFIC CRIT ALERT PROCESSING.GET V HEALTH FACTORS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALR6",268,0)
 .....;UNTIL DATE/TIME OF ANY FOLLOWUP ACTION (V HEALTH FACTOR)< 
"RTN","VEFAALR6",269,0)
 .....;DATE/TIME OF CRIT ALERT,OR NO V  HEALTH FACTOR FOUND IS ENCOUNTERED. SEARCH AMONG FOLLOWUP LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALR6",270,0)
 .....;GO BY PATIENT FIRST
"RTN","VEFAALR6",271,0)
 .....S VHEALTH=999999999999
"RTN","VEFAALR6",272,0)
 .....S OVERFLAG=0
"RTN","VEFAALR6",273,0)
 .....;W !
"RTN","VEFAALR6",274,0)
 .....;ZW ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALR6",275,0)
 .....F  S VHEALTH=$O(^AUPNVHF("C",VEFADFN,VHEALTH),-1) Q:(VHEALTH="")!(OVERFLAG=1)  D
"RTN","VEFAALR6",276,0)
 ......S VISITPTR=$P($G(^AUPNVHF(VHEALTH,0)),"^",3)
"RTN","VEFAALR6",277,0)
 ......I VISITPTR'="" S REVERST=$P($G(^AUPNVSIT(VISITPTR,0)),"^",1)
"RTN","VEFAALR6",278,0)
 ......;
"RTN","VEFAALR6",279,0)
 ......;
"RTN","VEFAALR6",280,0)
 ......I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALR6",281,0)
 ......I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALR6",282,0)
 ......S VHEALFT=$P($G(^AUPNVHF(VHEALTH,0)),"^",1)
"RTN","VEFAALR6",283,0)
 ......;;;;;I VHEALFT=500158 S ^XTMP("AAA4","500158")=VEFADFN_"^"_VHEALTH
"RTN","VEFAALR6",284,0)
 ......;CHECK IF THIS HEALTH FACTOR WITHIN DATE/TIME ALLOWED IS ONE OF FOLLOWUP ACTION HEALTH FACTORS
"RTN","VEFAALR6",285,0)
 ......S COUNTER1=0
"RTN","VEFAALR6",286,0)
 ......F  S COUNTER1=$O(^TMP($J,"FOLLOWUPITEM",COUNTER1)) Q:(COUNTER1="")  D
"RTN","VEFAALR6",287,0)
 .......S FOLLOWUP=$G(^TMP($J,"FOLLOWUPITEM",COUNTER1))
"RTN","VEFAALR6",288,0)
 .......;S ^XTMP("AAAA",COUNTER1)=FOLLOWUP_"^"_VHEALFT
"RTN","VEFAALR6",289,0)
 .......I FOLLOWUP[VHEALFT D
"RTN","VEFAALR6",290,0)
 ........S FOLLOWU1=$P(FOLLOWUP,";",1)
"RTN","VEFAALR6",291,0)
 ........I FOLLOWU1'="" D
"RTN","VEFAALR6",292,0)
 .........S FOLLOWU1=$P($G(^AUTTHF(FOLLOWU1,0)),"^",1)
"RTN","VEFAALR6",293,0)
 .........I ($P($G(^AUPNVHF(VHEALTH,12)),"^",4)'="")&(AGENTPRV="") S AGENTPRV=$P($G(^AUPNVHF(VHEALTH,12)),"^",4) ;
"RTN","VEFAALR6",294,0)
 .........;W !,"AGENTPRV=",AGENTPRV
"RTN","VEFAALR6",295,0)
 .........S ^TMP($J,"ORDERITEMFOUND",FOLLOWU1)=""   ; S RY=2_"^"_1
"RTN","VEFAALR6",296,0)
 ....;
"RTN","VEFAALR6",297,0)
 ....;
"RTN","VEFAALR6",298,0)
 ....;
"RTN","VEFAALR6",299,0)
 ....;
"RTN","VEFAALR6",300,0)
 .E  D
"RTN","VEFAALR6",301,0)
 ..S RY=3_"^"_3  ; MEANS NO REMINDER DIALOG FOUND
"RTN","VEFAALR6",302,0)
 E  D
"RTN","VEFAALR6",303,0)
 .S RY=3_"^"_2  ; MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALR6",304,0)
 ;DO LOOP OF ORDERS FOUND RETURNED CONCATENATED WITH ";"
"RTN","VEFAALR6",305,0)
 S RY=""
"RTN","VEFAALR6",306,0)
 S RY=AGENTPRV_";"
"RTN","VEFAALR6",307,0)
 S COUNTERF=0
"RTN","VEFAALR6",308,0)
 F  S COUNTERF=$O(^TMP($J,"ORDERITEMFOUND",COUNTERF)) Q:COUNTERF=""  D
"RTN","VEFAALR6",309,0)
 .S RY=RY_COUNTERF_";"
"RTN","VEFAALR6",310,0)
 Q
"RTN","VEFAALR7")
0^19^B103453138
"RTN","VEFAALR7",1,0)
VEFAALR7 ;GOW/THC VEFA - Module for AWARE RPC FOR RETRIEVING VEFA AWARE ALERT CACHE FORM VISTA INTO SQL SERVER TABLES
"RTN","VEFAALR7",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR7",3,0)
 ;; ALSO RPC FOR RETRIEVING VEFA AWARE ALERT CACHE FORM VISTA INTO SQL SERVER TABLES
"RTN","VEFAALR7",4,0)
EXTALERT(ORY,ZP) ; RETURN LIST OF ALERT AUDIT LOGS (CACHE) OF ALERTS TO STORE INTO SQL TABLES
"RTN","VEFAALR7",5,0)
 ;FOR PERIOD FROM EXTRACT STRTDATE UP TO BUT NOT INCLUDING PROCESS STRTDATE .UPON EXTRACT, THEN
"RTN","VEFAALR7",6,0)
 ; UPDATE EXTRACT STRT DATE IF NECESSARY UP TO PROCESS STRTDATE
"RTN","VEFAALR7",7,0)
 ;
"RTN","VEFAALR7",8,0)
 ;                 NO INPUT 
"RTN","VEFAALR7",9,0)
 ;                 ORY RETURN ARRAY OF LIST OF GATHERED ALERTS 
"RTN","VEFAALR7",10,0)
 ;NOW UPDATE TO SQL SERVER MACHINE WITH RPC TRANSFER OF CACHE DATA ( FROM NUMBER OF DAYS 
"RTN","VEFAALR7",11,0)
 ; IN CACHE WINDOW
"RTN","VEFAALR7",12,0)
 ; SUCH AS 30 DAYS AGO OR EARLIER IF MACHINE WAS DOWN)
"RTN","VEFAALR7",13,0)
 ;TAKE EXTRACT STRTDATE DATA UP TO AND THROUGH (TODAYS DATE). 
"RTN","VEFAALR7",14,0)
 ;;
"RTN","VEFAALR7",15,0)
 ;;
"RTN","VEFAALR7",16,0)
 ;;RPC AFTER TRANSFER SHOULD UPDATE EXTRACT STRTDATE= EXTRACT DATE 
"RTN","VEFAALR7",17,0)
 ;;RPC AFTER TRANSFER SHOULD TRUNCATE VEFA AWARE ALERT CACHE FOR DATE/TIME BEFORE EXTRACT STRTDATE 
"RTN","VEFAALR7",18,0)
 ;;WHICH IS UP TO CACHE WINDOW (I.E 30 DAYS)+1 DAY BACK FROM TODAY'S DATE.
"RTN","VEFAALR7",19,0)
 ;;
"RTN","VEFAALR7",20,0)
 N NAME,IEN,J,K,DATETIME,EXTSTDAT,PRSTDATE,ICOUNT,ALERTID,I,NAME,FUDATETI,ICOUNT2,FOUND,DATEEND,STATION,ALERTTYP
"RTN","VEFAALR7",21,0)
 N FUDATETI,STATION1,INSTITUT
"RTN","VEFAALR7",22,0)
 N FOLLGT7D,FOLLLT7D,ALERTID1,DATETIM1,MON,FULL,MONTH,YR,DAY,HR,MIN,SEC,DATETIM2,DATETIMH,FIRST,ALERTV,ORDERPRV
"RTN","VEFAALR7",23,0)
 N ORDERPID,ACKRENDT,DELETED,FOLLUPID,SECS
"RTN","VEFAALR7",24,0)
 ;
"RTN","VEFAALR7",25,0)
 N FULLD
"RTN","VEFAALR7",26,0)
 ;MOD 8/21/14 GOW
"RTN","VEFAALR7",27,0)
 N ORGATYP,ENDDATE
"RTN","VEFAALR7",28,0)
 ;END MOD
"RTN","VEFAALR7",29,0)
 ;
"RTN","VEFAALR7",30,0)
 K ^TMP("VEFAFOL",$J)
"RTN","VEFAALR7",31,0)
 K ^TMP("VEFAKB",$J)
"RTN","VEFAALR7",32,0)
 ;
"RTN","VEFAALR7",33,0)
 ;GET PROCESS START DATETIME
"RTN","VEFAALR7",34,0)
 S PRSTDATE=$P($G(^DIZ(19008.1,1,0)),"^",2)
"RTN","VEFAALR7",35,0)
 I PRSTDATE="" S ^TMP("VEFAFOL",$J)="" S ORY=$NA(^TMP("VEFAFOL",$J)) Q
"RTN","VEFAALR7",36,0)
 S FOUND=0
"RTN","VEFAALR7",37,0)
 S WINDOW=$P($G(^DIZ(19008.1,1,0)),"^",3)
"RTN","VEFAALR7",38,0)
 I WINDOW="" S ^TMP("VEFAFOL",$J)="" S ORY=$NA(^TMP("VEFAFOL",$J)) Q
"RTN","VEFAALR7",39,0)
 D NOW^%DTC S PRSTDATE=% K %
"RTN","VEFAALR7",40,0)
 S X1=PRSTDATE,X2=-(WINDOW+1) D C^%DTC S EXTSTDAT=X
"RTN","VEFAALR7",41,0)
 ;GET EXTRACT START DATETIME
"RTN","VEFAALR7",42,0)
 ;;;;;S EXTSTDAT=$P($G(^DIZ(19008.1,1,0)),"^",6)
"RTN","VEFAALR7",43,0)
 ;I EXTSTDAT=PRSTDATE
"RTN","VEFAALR7",44,0)
 ;;;;I EXTSTDAT="" D
"RTN","VEFAALR7",45,0)
 ;;;.S X1=PRSTDATE,X2=-31 D C^%DTC S EXTSTDAT=X
"RTN","VEFAALR7",46,0)
 ;;;.S $P(^DIZ(19008.1,1,0),"^",6)=EXTSTDAT
"RTN","VEFAALR7",47,0)
 ;S K=0
"RTN","VEFAALR7",48,0)
 S STATION=""
"RTN","VEFAALR7",49,0)
 S INSTITUT=$P($G(^XTV(8989.3,1,"XUS")),"^",17) ;DEFAULT INSTITUTION
"RTN","VEFAALR7",50,0)
 I INSTITUT'="" S STATION=$P($G(^DIC(4,INSTITUT,99)),"^",1)
"RTN","VEFAALR7",51,0)
 S DATETIME=EXTSTDAT
"RTN","VEFAALR7",52,0)
 D NOW^%DTC S DATEEND=%  ;TEMPORAILY
"RTN","VEFAALR7",53,0)
 ;MOD 8/21/14 GOW FOR TESTING PURPOSES AND FOR USE IN TEST ACCOUNT ONLY: END DATE AFTER 
"RTN","VEFAALR7",54,0)
 ;(DATE %NOW -CACHE WINDOW(DAY)) 
"RTN","VEFAALR7",55,0)
 ;BACK IN TIME AS END DATE AS LAST DATE TO RETRIEVE ALERT DATA IN THIS RPC FROM ALERT CACHE 
"RTN","VEFAALR7",56,0)
 ;FOR A SMALLER CAPTURE BUT GETTING A REALIST DATA CAPTURE AS WOULD OCCUR IN A REAL 
"RTN","VEFAALR7",57,0)
 ;CACHE WINDOW TO BE DETERMINED WITHOUT EXCEEDING THE TIME PERIOD CHOSEN FOR TESTING
"RTN","VEFAALR7",58,0)
 ;(THE TIME PERIOD NO LESS THAN SEVEN DAYS),BUT WITH CAPABILITY AS WITH THE USE OF 
"RTN","VEFAALR7",59,0)
 ;RECENT MIRRORED PRODUCTION DATA THAT IS CURRENTLY AVAIALABLE IN A TEST ACCOUNT,CAN BE
"RTN","VEFAALR7",60,0)
 ;HELP FIND A REPRESENTATIVE DURATION FOR SPECIFIC TIME PERIOD TO USE IN PRODUCTION 
"RTN","VEFAALR7",61,0)
 ;UNDER TYPICAL PRODUCTION LEVEL LOADING CONDITIONS.
"RTN","VEFAALR7",62,0)
 ;NORMALLY UNDER NORMAL RUNNING AND NOT IN TEST MODE, ENDDATE IN VEFA ALERT PARAMETER
"RTN","VEFAALR7",63,0)
 ;FILE SHOULD BE SET TO NULL.
"RTN","VEFAALR7",64,0)
 S ENDDATE=$P($G(^DIZ(19008.1,1,0)),"^",4)
"RTN","VEFAALR7",65,0)
 I ENDDATE'="" S DATEEND=ENDDATE
"RTN","VEFAALR7",66,0)
 ;END MOD
"RTN","VEFAALR7",67,0)
 ;F  S DATETIME=$O(^DIZ(19008.2,"C",DATETIME)) Q:(DATETIME>=PRSTDATE)!(DATETIME="")  D TEMPORAILY COMMENT OUT
"RTN","VEFAALR7",68,0)
 F  S DATETIME=$O(^DIZ(19008.2,"C",DATETIME)) Q:(DATETIME>=DATEEND)!(DATETIME="")  D   ;TEMPORAILY
"RTN","VEFAALR7",69,0)
 .S ICOUNT=0
"RTN","VEFAALR7",70,0)
 .F  S ICOUNT=$O(^DIZ(19008.2,"C",DATETIME,ICOUNT)) Q:ICOUNT=""  D
"RTN","VEFAALR7",71,0)
 ..S J=-1
"RTN","VEFAALR7",72,0)
 ..S FOUND=1
"RTN","VEFAALR7",73,0)
 ..S ALERTID=$P($G(^DIZ(19008.2,ICOUNT,0)),"^",1)
"RTN","VEFAALR7",74,0)
 ..;MOD 8/8/14 GOW
"RTN","VEFAALR7",75,0)
 ..S ALERTID1=$P($G(ALERTID),";",1)_";"
"RTN","VEFAALR7",76,0)
 ..;S ALERTID1=$P($G(ALERTID),";",1)_";"_$P($G(ALERTID),";",2)
"RTN","VEFAALR7",77,0)
 ..;END MOD
"RTN","VEFAALR7",78,0)
 ..;MOD 8/21/14 GOW USE ORIG ALERT TYPE AND SAVE IT
"RTN","VEFAALR7",79,0)
 ..;GET ALERT TYPE
"RTN","VEFAALR7",80,0)
 ..;S ALERTTYP=$P($G(^DIZ(19008.2,ICOUNT,1)),"^",4)
"RTN","VEFAALR7",81,0)
 ..S ALERTTYP=$P($G(^DIZ(19008.2,ICOUNT,6)),"^",3)
"RTN","VEFAALR7",82,0)
 ..S ORGATYP=ALERTTYP
"RTN","VEFAALR7",83,0)
 ..;END MOD
"RTN","VEFAALR7",84,0)
 ..;ALERT TYPE ORIGINATING STATION
"RTN","VEFAALR7",85,0)
 ..S STATION1=""
"RTN","VEFAALR7",86,0)
 ..I ALERTTYP'="" D
"RTN","VEFAALR7",87,0)
 ...S ALERTTYP=$O(^DIZ(19007,"B",ALERTTYP,0))
"RTN","VEFAALR7",88,0)
 ...I ALERTTYP="" Q  ;ERROR
"RTN","VEFAALR7",89,0)
 ...S STATION1=$P($G(^DIZ(19007,ALERTTYP,3)),"^",8)
"RTN","VEFAALR7",90,0)
 ..;MOD 8/21/14 GOW ALLOW OTHER ALERT TYPES BEYOND 1ST 4 
"RTN","VEFAALR7",91,0)
 ..;I (ALERTTYP="")!(ALERTTYP>4) Q
"RTN","VEFAALR7",92,0)
 ..I (ALERTTYP="") Q
"RTN","VEFAALR7",93,0)
 ..;END MOD
"RTN","VEFAALR7",94,0)
 ..;MOD GOW 8/21/14 ESTABLISH GENERIC ALERT TYPE 
"RTN","VEFAALR7",95,0)
 ..S ALERTTYP=$P($G(^DIZ(19008.2,ICOUNT,1)),"^",4)
"RTN","VEFAALR7",96,0)
 ..;END MOD
"RTN","VEFAALR7",97,0)
 ..;HEADER LINE
"RTN","VEFAALR7",98,0)
 ..S ^TMP("VEFAFOL",$J,0)="STATION_DATETIME_ALERTID"_"^"_"ALERTID"_"^"_"DATETIME1"_"^"_"FACILITY NAME"_"^"_"SERVICE1"_"^"_"ORDERING PROVIDER"_"^"
"RTN","VEFAALR7",99,0)
 ..S ^TMP("VEFAFOL",$J,0)=^TMP("VEFAFOL",$J,0)_"ALERT RECIPIENTS"_"^"_"SPARE"_"^"_"ALERT CATEGORY"_"^"_"ALERT TYPE"_"^"_"VALUE1"_"^"_"UNACKSTATUS"_"^"_"ACKRENEWDATE"_"^"
"RTN","VEFAALR7",100,0)
 ..S ^TMP("VEFAFOL",$J,0)=^TMP("VEFAFOL",$J,0)_"DELETEDATE"_"^"_"FAT STATUS"_"^"_"FAT PROVIDER"_"^"_"FOLLOW_UPPROVIDERID"_"^"_"CLINIC"_"^"_"PATIENTID"_"^"
"RTN","VEFAALR7",101,0)
 ..S ^TMP("VEFAFOL",$J,0)=^TMP("VEFAFOL",$J,0)_"ALERT RESULTOR"_"^"_"RESULTOR PERSON CLASS"_"^"_"ALERT TYPE ORIG STATION"_"^"_"FOLLOWUPGT7D"_"^"_"ACKGT7D"_"^"_"FOLLOWUPLT7D"_"^"
"RTN","VEFAALR7",102,0)
 ..;MOD 8/8/2014 GOW . MAKE SURE ONLY 1 RECORD SENT AT A TIME. NO APPENDING TO SAME RECORD
"RTN","VEFAALR7",103,0)
 ..K ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)
"RTN","VEFAALR7",104,0)
 ..;END MOD
"RTN","VEFAALR7",105,0)
 ..F  S J=J+1 Q:J>5  D
"RTN","VEFAALR7",106,0)
 ...I (J'=4) D
"RTN","VEFAALR7",107,0)
 ....I '$G(^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)) D
"RTN","VEFAALR7",108,0)
 .....;J=0
"RTN","VEFAALR7",109,0)
 .....;FORMAT DATETIME
"RTN","VEFAALR7",110,0)
 .....S DATETIM1=$P($G(^DIZ(19008.2,ICOUNT,J)),"^",2)
"RTN","VEFAALR7",111,0)
 .....S MON=$E(DATETIM1,4,7)
"RTN","VEFAALR7",112,0)
 .....S FULLD=$$FMTE^XLFDT(DATETIM1,1)
"RTN","VEFAALR7",113,0)
 .....;S DATETIM1=FULLD
"RTN","VEFAALR7",114,0)
 .....;CONVERT TO HL7 DATE/TIME. CLOSE TO SQL DATE/TIME
"RTN","VEFAALR7",115,0)
 .....S DATETIM2=$$FMTHL7^XLFDT(DATETIM1)
"RTN","VEFAALR7",116,0)
 .....S DATETIMH=$E(DATETIM2,1,4)_"-"_$E(DATETIM2,5,6)_"-"_$E(DATETIM2,7,8)_" "_$E(DATETIM2,9,10)_":"_$E(DATETIM2,11,12)_":"
"RTN","VEFAALR7",117,0)
 .....S SECS=$E(DATETIM2,13,14)_".000" I $E(SECS,1,1)="-" S $E(SECS,1,1)="0" ; HANDLE "-O" SECS HL7 CONVERSION ERROR FOR 0 SECONDS
"RTN","VEFAALR7",118,0)
 .....S DATETIMH=DATETIMH_SECS
"RTN","VEFAALR7",119,0)
 .....;FORMATTING FOR ORDERING PROVIDER. TAKE OUT ID AS NEEDED W/O FOR USE IN DYNAMIC LOOKUP TABLE
"RTN","VEFAALR7",120,0)
 .....S ORDERPRV=$P($P($G(^DIZ(19008.2,ICOUNT,J)),"^",5)," - ",1)_"["_$P($P($G(^DIZ(19008.2,ICOUNT,J)),"^",5)," - ",2)_"]"
"RTN","VEFAALR7",121,0)
 .....S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)=STATION_"-"_DATETIME_"-"_ALERTID1_"^"_ALERTID_"^"_DATETIMH_"^"_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",3,4)_"^"_ORDERPRV_"^"
"RTN","VEFAALR7",122,0)
 ....E  D
"RTN","VEFAALR7",123,0)
 .....I J=1 S ALERTV=$P($G(^DIZ(19008.2,ICOUNT,6)),"^",1)
"RTN","VEFAALR7",124,0)
 .....;MOD GOW 8/21/14 USE SPARE FOR ORIG ALERT TYPE
"RTN","VEFAALR7",125,0)
 .....;I J=1 S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)=^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",1,1)_"^"_""_"^"_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",3,4)_"^"_ALERTV_"^"
"RTN","VEFAALR7",126,0)
 .....I J=1 S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)=^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",1,1)_"^"_ORGATYP_"^"_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",3,4)_"^"_ALERTV_"^"
"RTN","VEFAALR7",127,0)
 .....; END MOD
"RTN","VEFAALR7",128,0)
 .....I J=2 D
"RTN","VEFAALR7",129,0)
 ......;CONVERT TO HL7 DATE/TIME. CLOSE TO SQL DATE/TIME
"RTN","VEFAALR7",130,0)
 ......S DATETIM1=$P($G(^DIZ(19008.2,ICOUNT,J)),"^",2)
"RTN","VEFAALR7",131,0)
 ......S ACKRENDT=""
"RTN","VEFAALR7",132,0)
 ......I DATETIM1'="" D
"RTN","VEFAALR7",133,0)
 .......S DATETIM2=$$FMTHL7^XLFDT(DATETIM1)
"RTN","VEFAALR7",134,0)
 .......S ACKRENDT=$E(DATETIM2,1,4)_"-"_$E(DATETIM2,5,6)_"-"_$E(DATETIM2,7,8)_" "_$E(DATETIM2,9,10)_":"_$E(DATETIM2,11,12)_":"
"RTN","VEFAALR7",135,0)
 .......S SECS=$E(DATETIM2,13,14)_".000" I $E(SECS,1,1)="-" S $E(SECS,1,1)="0" ; HANDLE "-O" SECS HL7 CONVERSION ERROR FOR 0 SECONDS
"RTN","VEFAALR7",136,0)
 .......S ACKRENDT=ACKRENDT_SECS
"RTN","VEFAALR7",137,0)
 ......;CONVERT TO HL7 DATE/TIME. CLOSE TO SQL DATE/TIME
"RTN","VEFAALR7",138,0)
 ......S DATETIM1=$P($G(^DIZ(19008.2,ICOUNT,J)),"^",3)
"RTN","VEFAALR7",139,0)
 ......S DELETED=""
"RTN","VEFAALR7",140,0)
 ......I DATETIM1'="" D
"RTN","VEFAALR7",141,0)
 .......S DATETIM2=$$FMTHL7^XLFDT(DATETIM1)
"RTN","VEFAALR7",142,0)
 .......S DELETED=$E(DATETIM2,1,4)_"-"_$E(DATETIM2,5,6)_"-"_$E(DATETIM2,7,8)_" "_$E(DATETIM2,9,10)_":"_$E(DATETIM2,11,12)_":"
"RTN","VEFAALR7",143,0)
 .......S SECS=$E(DATETIM2,13,14)_".000" I $E(SECS,1,1)="-" S $E(SECS,1,1)="0" ; HANDLE "-O" SECS HL7 CONVERSION ERROR FOR 0 SECONDS
"RTN","VEFAALR7",144,0)
 .......S DELETED=DELETED_SECS
"RTN","VEFAALR7",145,0)
 .....I J=2 S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)=^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",1)_"^"_ACKRENDT_"^"_DELETED_"^"_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",4)_"^"
"RTN","VEFAALR7",146,0)
 .....I J=3 S FOLLUPID=$P($P($G(^DIZ(19008.2,ICOUNT,3)),"^",2)," - ",2) I FOLLUPID="" S FOLLUPID=0
"RTN","VEFAALR7",147,0)
 .....I J=3 S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)=^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",1,1)_"^"_FOLLUPID_"^"
"RTN","VEFAALR7",148,0)
 .....I J=5 D
"RTN","VEFAALR7",149,0)
 ......;TOGGLE FOLLOWUPGT7D INTO FOLLOWUPLT7D FOR REPORTS
"RTN","VEFAALR7",150,0)
 ......S FOLLGT7D=$P($G(^DIZ(19008.2,ICOUNT,J)),"^",6)
"RTN","VEFAALR7",151,0)
 ......I FOLLGT7D=1 D
"RTN","VEFAALR7",152,0)
 .......S FOLLLT7D=0
"RTN","VEFAALR7",153,0)
 ......E  D
"RTN","VEFAALR7",154,0)
 .......S FOLLLT7D=1
"RTN","VEFAALR7",155,0)
 .....I J=5 S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)=^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1)_$P($G(^DIZ(19008.2,ICOUNT,J)),"^",1,7)_"^"_FOLLLT7D_"^"
"RTN","VEFAALR7",156,0)
 ....;I $G(^DIZ(19008.2,ICOUNT,J)) S ^TMP("VEFAFOL",$J,ALERTID,J)=$G(^DIZ(19008.2,ICOUNT,J))
"RTN","VEFAALR7",157,0)
 ..S NAME=0
"RTN","VEFAALR7",158,0)
 ..S K=0
"RTN","VEFAALR7",159,0)
 ..;FOLLOW-UP ACTIONS NEXT
"RTN","VEFAALR7",160,0)
 ..;HEADER FIRST 
"RTN","VEFAALR7",161,0)
 ..S FIRST=0
"RTN","VEFAALR7",162,0)
 ..;S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1,"FOLLOWUP",0)="STATION-DATETIME-ALERTID1"_"^"_"FOLLOWUP"_"^"_"FOLLOWUPDATETIME"
"RTN","VEFAALR7",163,0)
 ..F  S NAME=$O(^DIZ(19008.2,ICOUNT,4,"B",NAME)) Q:NAME=""  D
"RTN","VEFAALR7",164,0)
 ...S FIRST=1
"RTN","VEFAALR7",165,0)
 ...S ICOUNT2=0
"RTN","VEFAALR7",166,0)
 ...S ICOUNT2=$O(^DIZ(19008.2,ICOUNT,4,"B",NAME,ICOUNT2))
"RTN","VEFAALR7",167,0)
 ...I ICOUNT2'="" S FUDATETI=$P($G(^DIZ(19008.2,ICOUNT,4,ICOUNT2,0)),"^",2)
"RTN","VEFAALR7",168,0)
 ...;FORMAT DATETIME
"RTN","VEFAALR7",169,0)
 ...S DATETIM1=$P($G(^DIZ(19008.2,ICOUNT,4,ICOUNT2,0)),"^",2)
"RTN","VEFAALR7",170,0)
 ...S MON=$E(DATETIM1,4,7)
"RTN","VEFAALR7",171,0)
 ...S FULLD=$$FMTE^XLFDT(DATETIM1,1)
"RTN","VEFAALR7",172,0)
 ...;S DATETIM1=FULLD
"RTN","VEFAALR7",173,0)
 ...;CONVERT TO HL7 DATE/TIME. CLOSE TO SQL DATE/TIME
"RTN","VEFAALR7",174,0)
 ...S DATETIM2=$$FMTHL7^XLFDT(DATETIM1)
"RTN","VEFAALR7",175,0)
 ...S DATETIMH=$E(DATETIM2,1,4)_"-"_$E(DATETIM2,5,6)_"-"_$E(DATETIM2,7,8)_" "_$E(DATETIM2,9,10)_":"_$E(DATETIM2,11,12)_":"_"00"_".000"
"RTN","VEFAALR7",176,0)
 ...S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1,"FOLLOWUP",ICOUNT2)=STATION_"-"_DATETIME_"-"_ALERTID1_"^"_"FOLLOWUP"_"^"_$P($G(^DIZ(19008.2,ICOUNT,4,ICOUNT2,0)),"^",1)_"^"_DATETIMH_"^"
"RTN","VEFAALR7",177,0)
 ..I FIRST=0 D
"RTN","VEFAALR7",178,0)
 ...; SEND FAKE FOLLOWUP TO ALLOW INNER JOINS TO ALWAYS BE FOUND IN MS SQL REPORTING SERVICE. LATER MAKE INVISIBLE
"RTN","VEFAALR7",179,0)
 ...S DATETIM2=$$FMTHL7^XLFDT(DATETIME)
"RTN","VEFAALR7",180,0)
 ...;MOD GOW 8/5/2014 ACCOUNT FOR ILLEGAL SECONDS FOR SQL DATE/TIME
"RTN","VEFAALR7",181,0)
 ...;S DATETIMH=$E(DATETIM2,1,4)_"-"_$E(DATETIM2,5,6)_"-"_$E(DATETIM2,7,8)_" "_$E(DATETIM2,9,10)_":"_$E(DATETIM2,11,12)_":"_$E(DATETIM2,13,14)_".000"
"RTN","VEFAALR7",182,0)
 ...S DATETIMH=$E(DATETIM2,1,4)_"-"_$E(DATETIM2,5,6)_"-"_$E(DATETIM2,7,8)_" "_$E(DATETIM2,9,10)_":"_$E(DATETIM2,11,12)_":"
"RTN","VEFAALR7",183,0)
 ...S SECS=$E(DATETIM2,13,14)_".000" I $E(SECS,1,1)="-" S $E(SECS,1,1)="0" ; HANDLE "-O" SECS HL7 CONVERSION ERROR FOR 0 SECONDS
"RTN","VEFAALR7",184,0)
 ...S DATETIMH=DATETIMH_SECS
"RTN","VEFAALR7",185,0)
 ...;END MOD 
"RTN","VEFAALR7",186,0)
 ...S ^TMP("VEFAFOL",$J,STATION_"-"_DATETIME_"-"_ALERTID1,"FOLLOWUP",1)=STATION_"-"_DATETIME_"-"_ALERTID1_"^"_"FOLLOWUP"_"^"_"DUMMY FOLLOWUP"_"^"_DATETIMH_"^"
"RTN","VEFAALR7",187,0)
 S ^TMP("VEFAFOL",$J)=""
"RTN","VEFAALR7",188,0)
 S ORY=$NA(^TMP("VEFAFOL",$J))
"RTN","VEFAALR7",189,0)
 ;ADD KB EXTRACT HERE FOR ALERT CATEGORY AND ALERT FOLLOWUP PER FACILITY
"RTN","VEFAALR7",190,0)
 ;
"RTN","VEFAALR7",191,0)
 ;SAVE LAST EXTRACT STRTDATE AS PROCESS DATETIME-(CACHE WINDOW+1) 
"RTN","VEFAALR7",192,0)
 I FOUND D
"RTN","VEFAALR7",193,0)
 .;S X1=PRSTDATE,X2=-31 D C^%DTC S EXTSTDAT=X
"RTN","VEFAALR7",194,0)
 .S $P(^DIZ(19008.1,1,0),"^",6)=EXTSTDAT
"RTN","VEFAALR7",195,0)
 ;
"RTN","VEFAALR7",196,0)
 K X,X1,X2
"RTN","VEFAALR7",197,0)
 ;TRUNCATE VEFA AWARE CACHE
"RTN","VEFAALR7",198,0)
 D DELCACHE
"RTN","VEFAALR7",199,0)
 Q
"RTN","VEFAALR7",200,0)
 ;
"RTN","VEFAALR7",201,0)
DELCACHE ;
"RTN","VEFAALR7",202,0)
 N EXTSTDAT,IEN,OVER,WINDOW,PRSTDATE,DATETIME,FLAG
"RTN","VEFAALR7",203,0)
 ;DELETE ENTRIES WHOSE DATE/TIME IS LESS THAN (NOW DATE/TIME-CACHE WINDOW OF OPPORTUNITY)
"RTN","VEFAALR7",204,0)
 ; 
"RTN","VEFAALR7",205,0)
 ;READ START EXTRACTION DATE BASED ON CACHE WINDOW 
"RTN","VEFAALR7",206,0)
 ;
"RTN","VEFAALR7",207,0)
 S WINDOW=$P($G(^DIZ(19008.1,1,0)),"^",3)
"RTN","VEFAALR7",208,0)
 ;;W !,"WINDOW=",WINDOW
"RTN","VEFAALR7",209,0)
 I WINDOW="" Q
"RTN","VEFAALR7",210,0)
 D NOW^%DTC S PRSTDATE=%
"RTN","VEFAALR7",211,0)
 S X1=PRSTDATE,X2=-(WINDOW+1) D C^%DTC S EXTSTDAT=X
"RTN","VEFAALR7",212,0)
 ;S EXTSTDAT=$P($G(^DIZ(19008.1,1,0)),"^",6)
"RTN","VEFAALR7",213,0)
 ;;W !,"EXTSTDAT=",EXTSTDAT," PRSTDATE=",PRSTDATE
"RTN","VEFAALR7",214,0)
 I EXTSTDAT="" Q
"RTN","VEFAALR7",215,0)
 S OVER=0
"RTN","VEFAALR7",216,0)
 S DATETIME=0
"RTN","VEFAALR7",217,0)
 S FLAG=0
"RTN","VEFAALR7",218,0)
 ;;W !,"EXTSTDAT=",EXTSTDAT," PRSTDATE=",PRSTDATE
"RTN","VEFAALR7",219,0)
 F  S DATETIME=$O(^DIZ(19008.2,"C",DATETIME)) Q:(DATETIME="")!(OVER)  D
"RTN","VEFAALR7",220,0)
 .I DATETIME>EXTSTDAT S OVER=1 Q
"RTN","VEFAALR7",221,0)
 .S IEN=0 S IEN=$O(^DIZ(19008.2,"C",DATETIME,IEN))
"RTN","VEFAALR7",222,0)
 .;W !,"IEN=",IEN
"RTN","VEFAALR7",223,0)
 .;I FLAG=0 I IEN'="" W !,"IEN=",IEN S DIK="^DIZ(19008.2,",DA=IEN D ^DIK
"RTN","VEFAALR7",224,0)
 .I FLAG=0 I IEN'="" S DIK="^DIZ(19008.2,",DA=IEN D ^DIK
"RTN","VEFAALR7",225,0)
 .K DIK,DA
"RTN","VEFAALR7",226,0)
 Q
"RTN","VEFAALR8")
0^20^B263895010
"RTN","VEFAALR8",1,0)
VEFAALR8 ;GOW/THC VEFA - Module for AWARE KB Editor Validator
"RTN","VEFAALR8",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR8",3,0)
 ;; 
"RTN","VEFAALR8",4,0)
 ; MOD GOW 11/24/14 CORRECT ANY SUBSCRIPT ERROR
"RTN","VEFAALR8",5,0)
BASICCHK(RY,ZP) ;
"RTN","VEFAALR8",6,0)
 ;TAKE  INPUT IN ZP( ALERT TYPE ) IN FILE 19007. 
"RTN","VEFAALR8",7,0)
 ;BASIC CHECKS
"RTN","VEFAALR8",8,0)
 ;
"RTN","VEFAALR8",9,0)
 ;WHEN REMINDER DIALOG VALUE ENTERED IN FILE 19007 
"RTN","VEFAALR8",10,0)
 ;
"RTN","VEFAALR8",11,0)
 ;DO LOOKUP for all ORDER DIALOG AND FOLLOW-UP ITEMS INCLUDED IN DIALOG AND FOLLOWUP GROUP(S) RESPECTIVELY
"RTN","VEFAALR8",12,0)
 ;Also look FOR REMINDER DIALOG NAMES TO CONFORM TO NOTATION "AW"_STATION+UNIQUE CODE OF ALERT TYPE+DESCCRIPTION
"RTN","VEFAALR8",13,0)
 ; , I.E. AS "AW500 PSA PAT OPTED NO TREAT" FOR AWARE from station 500 and description following.
"RTN","VEFAALR8",14,0)
 ;
"RTN","VEFAALR8",15,0)
 ; CHECK UNIQUENESS AMONG associated REMINDER DIALOGs with "Order Dialog Text" and 
"RTN","VEFAALR8",16,0)
 ; "Followup Dialog Box Text" values: 
"RTN","VEFAALR8",17,0)
 ;DO LOOKUP of Dialog/Progress Note text to check for matching entries needed with 
"RTN","VEFAALR8",18,0)
 ;Orders Dialog Box Text or Followup Dialog Box Text included in this WP field included 
"RTN","VEFAALR8",19,0)
 ;in at least one line of text.
"RTN","VEFAALR8",20,0)
 ;
"RTN","VEFAALR8",21,0)
 ;Build array of Alert Order Dialog and Followup Item Texts with matching REMINDER DIALOG 
"RTN","VEFAALR8",22,0)
 ;and INTERNAL ENTRY number of Reminder Order Dialog or Follow-up text foind from trace
"RTN","VEFAALR8",23,0)
 ;through Reminder Dialog type Reminder dialog to all its groups and elements correlated to
"RTN","VEFAALR8",24,0)
 ;element box text(s) in the VEFA Tracked Critical Alert(the ALERT TYPE)file (19007).
"RTN","VEFAALR8",25,0)
 ;
"RTN","VEFAALR8",26,0)
 ; 
"RTN","VEFAALR8",27,0)
 ;Check for duplicates or missing entries and report back as error
"RTN","VEFAALR8",28,0)
 ;
"RTN","VEFAALR8",29,0)
 ;Check if any 3rd group as single item for Followup Comments in WP text on Reminder dialog as 
"RTN","VEFAALR8",30,0)
 ; as TYPE "prompt".
"RTN","VEFAALR8",31,0)
 ;
"RTN","VEFAALR8",32,0)
 ;Also check for proper same NOTATION for the REMINDER DIALOG group type reminde dialogs with 
"RTN","VEFAALR8",33,0)
 ;notation as described above, as well as main REMINDER DIALOG type reminder dialog name itself 
"RTN","VEFAALR8",34,0)
 ;as in example "AW500 PSA" ONLY w/o any further description.
"RTN","VEFAALR8",35,0)
 ;
"RTN","VEFAALR8",36,0)
 ;S RY ="OK" or "ERR=error comment...." sufficient for a CAC to fix error.
"RTN","VEFAALR8",37,0)
 ;    
"RTN","VEFAALR8",38,0)
 N REMINDER,NAME,IEN
"RTN","VEFAALR8",39,0)
 N VEFADFN,VEFADUZ,VEFAALRT,VEFAADTT,VEFARMDL
"RTN","VEFAALR8",40,0)
 N VEFACNT,VEFACNT1,VEFACNT2
"RTN","VEFAALR8",41,0)
 N DISABLE,REMDIALG,DIALOGTY,DIALOGEL,RESOLTYP,ORDRITM,COUNTER,CNTORD,CNT1,ORDER,CNTTIMO,CNTTIMA
"RTN","VEFAALR8",42,0)
 N REVERST,CNTPAT,ORDERCK
"RTN","VEFAALR8",43,0)
 N RYY,ACTION,ACTIONK,SIGSTAT
"RTN","VEFAALR8",44,0)
 N FOLLUPCT,FOLLOWAC
"RTN","VEFAALR8",45,0)
 N VHEALTH,OVERFLAG,VHEALF,FOLLOWUP,VISITPTR,ACTIVE,COUNTER1,COUNTER2,PTR,REMELEM,BOXTEXT,IENS,DR
"RTN","VEFAALR8",46,0)
 N DIALOGN,VALUE,ORDERITEM,FINDING,ALERTGEN,ORDITEMN,ORDITEMD,ORDERDLG,ORDERDLR,ORDRDIGR,ORDRPKG
"RTN","VEFAALR8",47,0)
 N ORDRDPKG,ORDRFOLU,ORDERDLN,AWSITE,ORDITEMR,ORDRDPK1,ORDRPK1
"RTN","VEFAALR8",48,0)
 N FOLLHEAL,OVER,REMTYPE
"RTN","VEFAALR8",49,0)
 ;
"RTN","VEFAALR8",50,0)
 N FILE
"RTN","VEFAALR8",51,0)
 S RY=""
"RTN","VEFAALR8",52,0)
 I $G(ZP)="" S RY="Invalid Alert Type Name" QUIT
"RTN","VEFAALR8",53,0)
 ;
"RTN","VEFAALR8",54,0)
 S REMINDER=""
"RTN","VEFAALR8",55,0)
 S NAME=ZP
"RTN","VEFAALR8",56,0)
 S IEN=$O(^DIZ(19007,"B",NAME,0))
"RTN","VEFAALR8",57,0)
 I IEN="" S RY="Alert Type Not Found" QUIT
"RTN","VEFAALR8",58,0)
 S REMINDER=$P($G(^DIZ(19007,IEN,3)),"^",1)
"RTN","VEFAALR8",59,0)
 I REMINDER="" S RY="Reminder Dialog Not Found" QUIT
"RTN","VEFAALR8",60,0)
 ;
"RTN","VEFAALR8",61,0)
 ;.S ACTIVE=$P($G(^DIZ(19007,IEN,3)),"^",5)
"RTN","VEFAALR8",62,0)
 ;.I ACTIVE="" S ACTIVE=0
"RTN","VEFAALR8",63,0)
 ;I REMINDER'="" S REMINDER=$P($G(^PXRMD(801.41,REMINDER,0)),"^",1)  ; TYPE = REMINDER DIALOG
"RTN","VEFAALR8",64,0)
 ;I (REMINDER'="")&(TIUTEMPL'="") S RY=IEN_"^"_REMINDER_"^"_TIUTEMPL_"^"
"RTN","VEFAALR8",65,0)
 ;
"RTN","VEFAALR8",66,0)
 ;REMINDER DIALOG DEFINED. NOW DO BASIC CHECKS
"RTN","VEFAALR8",67,0)
 ;FOLLOW PATH FIRST WITH Reminder Dialog groups (1ST GROUP IS FOR ORDERS) AND 2ND FOR (FOLLOW-UP COMMENTS),
"RTN","VEFAALR8",68,0)
 ;3RD FOR FOLLOWUP COMMENTS WP field.
"RTN","VEFAALR8",69,0)
 ;K RY
"RTN","VEFAALR8",70,0)
 S RY=0
"RTN","VEFAALR8",71,0)
 S COUNTER=0 ; FOR ORDERS
"RTN","VEFAALR8",72,0)
 S COUNTER1=0  ; FOR FOLLOWUP ACTIONS
"RTN","VEFAALR8",73,0)
 S COUNTER2=0 ; FOR UNIQUE DESIRED REMINDER DIALOG ELEMENT NAMES
"RTN","VEFAALR8",74,0)
 K ^TMP($J,"ORDERITEM")
"RTN","VEFAALR8",75,0)
 K ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALR8",76,0)
 ;determine AWSITE = "AW"_SITE ( i.e. AW500 )
"RTN","VEFAALR8",77,0)
 S AWSITE="AW"_$P($G(^DIZ(19007,IEN,3)),"^",8)
"RTN","VEFAALR8",78,0)
 K ^TMP($J,"REMINDER ELEMENTS")
"RTN","VEFAALR8",79,0)
 ;PREPARE LST OF DESIRED REMINDER DIALOG ELEMENT NAMES
"RTN","VEFAALR8",80,0)
 ;GO THRU LIST OF TEXT BOX DATA IN ALERT TYPE RECORD
"RTN","VEFAALR8",81,0)
 ;FIRST IN DESIRED ORDER GROUP
"RTN","VEFAALR8",82,0)
 S BOXTEXT=0
"RTN","VEFAALR8",83,0)
 F  S BOXTEXT=$O(^DIZ(19007,IEN,1,"B",BOXTEXT)) Q:BOXTEXT=""  D
"RTN","VEFAALR8",84,0)
 .S PTR=0
"RTN","VEFAALR8",85,0)
 .S PTR=$O(^DIZ(19007,IEN,1,"B",BOXTEXT,PTR))
"RTN","VEFAALR8",86,0)
 .S IENS=PTR_","_IEN
"RTN","VEFAALR8",87,0)
 .S DR=.3 ;DESIRED ELEMENT NAME
"RTN","VEFAALR8",88,0)
 .S REMELEM=$$GET1^DIQ(19007.01,IENS,DR,"I") ;W !,REMELEM ;
"RTN","VEFAALR8",89,0)
 .S DR=.7 ;ORDERABLE ITEM NAME REQUIRED (NO/YES)
"RTN","VEFAALR8",90,0)
 .S ORDITEMR=$$GET1^DIQ(19007.01,IENS,DR,"I") ;W !,REMELEM 
"RTN","VEFAALR8",91,0)
 .S DR=3.5
"RTN","VEFAALR8",92,0)
 .S ORDRDPKG=$$GET1^DIQ(19007.01,IENS,DR,"I") ;W !,ORDRDPKG ; 
"RTN","VEFAALR8",93,0)
 .S COUNTER2=COUNTER2+1
"RTN","VEFAALR8",94,0)
 .S ^TMP($J,"REMINDER DIALOG",COUNTER2)=REMELEM_U_PTR_U_ORDRDPKG_U_"19007.01"_U_BOXTEXT_U_ORDITEMR
"RTN","VEFAALR8",95,0)
 ;
"RTN","VEFAALR8",96,0)
 ;SECOND IN DESIRED FOLLOWUP ACTION GROUP
"RTN","VEFAALR8",97,0)
 S BOXTEXT=0
"RTN","VEFAALR8",98,0)
 F  S BOXTEXT=$O(^DIZ(19007,IEN,2,"B",BOXTEXT)) Q:BOXTEXT=""  D
"RTN","VEFAALR8",99,0)
 .S PTR=0
"RTN","VEFAALR8",100,0)
 .S PTR=$O(^DIZ(19007,IEN,2,"B",BOXTEXT,PTR))
"RTN","VEFAALR8",101,0)
 .S IENS=PTR_","_IEN
"RTN","VEFAALR8",102,0)
 .S DR=.3 ;DESIRED ELEMENT NAME
"RTN","VEFAALR8",103,0)
 .S REMELEM=$$GET1^DIQ(19007.02,IENS,DR,"I") ;W !,REMELEM ;
"RTN","VEFAALR8",104,0)
 .S DR=.7 ;ORDERABLE ITEM NAME REQUIRED (NO/YES)
"RTN","VEFAALR8",105,0)
 .S ORDITEMR=$$GET1^DIQ(19007.02,IENS,DR,"I") ;W !,REMELEM 
"RTN","VEFAALR8",106,0)
 .S DR=3.5
"RTN","VEFAALR8",107,0)
 .S ORDRDPKG=$$GET1^DIQ(19007.02,IENS,DR,"I") ;W !,ORDRDPKG ; 
"RTN","VEFAALR8",108,0)
 .S COUNTER2=COUNTER2+1
"RTN","VEFAALR8",109,0)
 .S ^TMP($J,"REMINDER DIALOG",COUNTER2)=REMELEM_U_PTR_U_ORDRDPKG_U_"19007.02"_U_BOXTEXT_U_ORDITEMR
"RTN","VEFAALR8",110,0)
 ;
"RTN","VEFAALR8",111,0)
 ;
"RTN","VEFAALR8",112,0)
 ;THIRD IN DESIRED COMMENTS GROUP
"RTN","VEFAALR8",113,0)
 S BOXTEXT=0
"RTN","VEFAALR8",114,0)
 F  S BOXTEXT=$O(^DIZ(19007,IEN,4,"B",BOXTEXT)) Q:BOXTEXT=""  D
"RTN","VEFAALR8",115,0)
 .S PTR=0
"RTN","VEFAALR8",116,0)
 .S PTR=$O(^DIZ(19007,IEN,4,"B",BOXTEXT,PTR))
"RTN","VEFAALR8",117,0)
 .S IENS=PTR_","_IEN
"RTN","VEFAALR8",118,0)
 .S DR=.3 ;DESIRED ELEMENT NAME
"RTN","VEFAALR8",119,0)
 .S REMELEM=$$GET1^DIQ(19007.03,IENS,DR,"I") ;W !,REMELEM ;
"RTN","VEFAALR8",120,0)
 .S DR=.7 ;ORDERABLE ITEM NAME REQUIRED (NO/YES)
"RTN","VEFAALR8",121,0)
 .S ORDITEMR=$$GET1^DIQ(19007.03,IENS,DR,"I") ;W !,REMELEM 
"RTN","VEFAALR8",122,0)
 .S DR=3.5
"RTN","VEFAALR8",123,0)
 .S ORDRDPKG=$$GET1^DIQ(19007.03,IENS,DR,"I") ;W !,ORDRDPKG ; 
"RTN","VEFAALR8",124,0)
 .S COUNTER2=COUNTER2+1
"RTN","VEFAALR8",125,0)
 .S ^TMP($J,"REMINDER DIALOG",COUNTER2)=REMELEM_U_PTR_U_ORDRDPKG_U_"19007.03"_U_BOXTEXT_U_ORDITEMR
"RTN","VEFAALR8",126,0)
 ;
"RTN","VEFAALR8",127,0)
 ;S VEFADFN=$P(ZP,U,1) S VEFADUZ=$P(ZP,U,2) S VEFAALRT=$P(ZP,U,3) S VEFAADTT=$P(ZP,U,4)
"RTN","VEFAALR8",128,0)
 ;
"RTN","VEFAALR8",129,0)
 ;first CHECK if type of alert if in VEFA ALERT TRACKING file
"RTN","VEFAALR8",130,0)
 S VEFACNT=IEN
"RTN","VEFAALR8",131,0)
 D
"RTN","VEFAALR8",132,0)
 .;
"RTN","VEFAALR8",133,0)
 .; RECORD # in VEFA TRACKED ALERTS file
"RTN","VEFAALR8",134,0)
 .; get reminder dialog 
"RTN","VEFAALR8",135,0)
 .S VEFARMDL=REMINDER ;
"RTN","VEFAALR8",136,0)
 .I VEFARMDL'="" D
"RTN","VEFAALR8",137,0)
 ..;
"RTN","VEFAALR8",138,0)
 ..;GO TO FILE 801.41
"RTN","VEFAALR8",139,0)
 ..;CHECK IF DISABLED
"RTN","VEFAALR8",140,0)
 ..S DISABLE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,3)
"RTN","VEFAALR8",141,0)
 ..I (DISABLE=0)!(DISABLE="") D
"RTN","VEFAALR8",142,0)
 ...;
"RTN","VEFAALR8",143,0)
 ...;CHECK REMINDER TYPE AS "REMINDER DIALOG"
"RTN","VEFAALR8",144,0)
 ...S REMTYPE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,4)
"RTN","VEFAALR8",145,0)
 ...I REMTYPE="R" D
"RTN","VEFAALR8",146,0)
 ....;
"RTN","VEFAALR8",147,0)
 ....; LOOK THROUGH DIALOG GROUPS AND THEIR ELEMENTS TO FIND ORDERABLE ANY ORDER ITEMS.
"RTN","VEFAALR8",148,0)
 ....S VEFACNT=0
"RTN","VEFAALR8",149,0)
 ....F  S VEFACNT=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT)) Q:(VEFACNT="")!(RY'=0)  D
"RTN","VEFAALR8",150,0)
 .....;GET INTERNAL ENTRY #
"RTN","VEFAALR8",151,0)
 .....S VEFACNT1=0
"RTN","VEFAALR8",152,0)
 .....S VEFACNT1=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT,VEFACNT1))
"RTN","VEFAALR8",153,0)
 .....;
"RTN","VEFAALR8",154,0)
 .....I VEFACNT1'="" D
"RTN","VEFAALR8",155,0)
 ......; GET DIALOG GROUP OR DIRECT DIALOG ELEMENT (ASSUME FOR NOW ONLY DIALOG GROUP WITH ORDERS)
"RTN","VEFAALR8",156,0)
 ......S REMDIALG=$P($G(^PXRMD(801.41,VEFARMDL,10,VEFACNT1,0)),U,2)
"RTN","VEFAALR8",157,0)
 ......;
"RTN","VEFAALR8",158,0)
 ......I REMDIALG'="" D
"RTN","VEFAALR8",159,0)
 .......; CHECK IF DIALOG GROUP
"RTN","VEFAALR8",160,0)
 .......S DIALOGTY=$P($G(^PXRMD(801.41,REMDIALG,0)),U,4)
"RTN","VEFAALR8",161,0)
 .......I DIALOGTY="G" D   ; DIALOG GROUP
"RTN","VEFAALR8",162,0)
 ........;
"RTN","VEFAALR8",163,0)
 ........S VEFACNT2=0 ; GET DIALOG ELEMENTS INSIDE THIS DIALOG GROUP
"RTN","VEFAALR8",164,0)
 ........F  S VEFACNT2=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2)) Q:(VEFACNT2="")!(RY'=0)  D
"RTN","VEFAALR8",165,0)
 .........;GET INTERNAL ENTRY #
"RTN","VEFAALR8",166,0)
 .........S DIALOGEL=0
"RTN","VEFAALR8",167,0)
 .........S DIALOGEL=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2,DIALOGEL))
"RTN","VEFAALR8",168,0)
 .........; DIALOG ELEMENT
"RTN","VEFAALR8",169,0)
 .........;
"RTN","VEFAALR8",170,0)
 .........S DIALOGEL=$P($G(^PXRMD(801.41,REMDIALG,10,DIALOGEL,0)),U,2)
"RTN","VEFAALR8",171,0)
 .........;
"RTN","VEFAALR8",172,0)
 .........;GET NAME OF DIALOG ELEMENT
"RTN","VEFAALR8",173,0)
 .........S DIALOGN=$P($G(^PXRMD(801.41,DIALOGEL,0)),U,1)
"RTN","VEFAALR8",174,0)
 .........;COMPARE TO SEE IF FOUND MATCH AND NOT DUPLICATE MATCH
"RTN","VEFAALR8",175,0)
 .........S COUNTER2=0
"RTN","VEFAALR8",176,0)
 .........S OVER=0
"RTN","VEFAALR8",177,0)
 .........F  S COUNTER2=$O(^TMP($J,"REMINDER DIALOG",COUNTER2)) Q:(OVER'=0)!(COUNTER2="")  D
"RTN","VEFAALR8",178,0)
 ..........S VALUE=$P($G(^TMP($J,"REMINDER DIALOG",COUNTER2)),"^",1)
"RTN","VEFAALR8",179,0)
 ..........I VALUE=DIALOGN D
"RTN","VEFAALR8",180,0)
 ...........I $P($G(^TMP($J,"REMINDER DIALOG",COUNTER2)),"^",7)'=1 D
"RTN","VEFAALR8",181,0)
 ............S $P(^TMP($J,"REMINDER DIALOG",COUNTER2),"^",7)=1
"RTN","VEFAALR8",182,0)
 ............S ORDRDPKG=$P($G(^TMP($J,"REMINDER DIALOG",COUNTER2)),"^",3) ; DESIRED PKG IN ASSOCIATED ORDER DIALOG 
"RTN","VEFAALR8",183,0)
 ............S ORDRFOLU=$P($G(^TMP($J,"REMINDER DIALOG",COUNTER2)),"^",4) ; ORDER OR FOLLOWUP GROUP SUB FILE #
"RTN","VEFAALR8",184,0)
 ............S BOXTEXT=$P($G(^TMP($J,"REMINDER DIALOG",COUNTER2)),"^",5) ; BOX TEST IN ORDER OR FOLLOWUP GROUP SUB FILE #
"RTN","VEFAALR8",185,0)
 ............S ORDITEMR=$P($G(^TMP($J,"REMINDER DIALOG",COUNTER2)),"^",6) ;ORDERABLE ITEM REQUIRED 
"RTN","VEFAALR8",186,0)
 ............S OVER=$P($G(^TMP($J,"REMINDER DIALOG",COUNTER2)),"^",2) ;INTERNAL ENTRY IN ALERT TYPE GROUP FILE
"RTN","VEFAALR8",187,0)
 ...........E  D
"RTN","VEFAALR8",188,0)
 ............S OVER=-1
"RTN","VEFAALR8",189,0)
 ............I RY=0 S RY="ERR="_"Duplicate dialog element name = "_DIALOGN
"RTN","VEFAALR8",190,0)
 .........I OVER=0 S OVER=-1 I RY=0 D
"RTN","VEFAALR8",191,0)
 ..........S RY="Continue "_"by entering the reminder dialog element "_DIALOGN_" into the Desired Element Name field of the associated(next)KB Element."
"RTN","VEFAALR8",192,0)
 ..........;S RY="ERR="_"Missing or Misnamed dialog element name "_DIALOGN_" without leading AW_Site"_" Alert Type Mneumonic (i.e. AW500 XXX). Desired Element Name value should also be filled"
"RTN","VEFAALR8",193,0)
 .........I OVER=-1 Q
"RTN","VEFAALR8",194,0)
 .........S ALERTGEN=OVER ;ALERT TYPE GROUP INTERNAL ENTRY NUMBER FOR WRITE/UPDATING
"RTN","VEFAALR8",195,0)
 .........;
"RTN","VEFAALR8",196,0)
 .........;READ FROM REMINDER ELEMENT AND WRITE ANY DIALOG/PROGRESS NOTE TEXT HERE BACK INTO ALERT TYPE FILE
"RTN","VEFAALR8",197,0)
 .........;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
"RTN","VEFAALR8",198,0)
 .........;
"RTN","VEFAALR8",199,0)
 .........D GETPROG^VEFAALRA(DIALOGEL)  ; GET PROGRESS NOTE TEXT FORM REMINDER DIALOG ELEMENT
"RTN","VEFAALR8",200,0)
 .........D WRITPROG^VEFAALRA(IEN,ORDRFOLU,ALERTGEN)
"RTN","VEFAALR8",201,0)
 .........;CHECK "ORDER" RESOLUTION TYPE FIRST
"RTN","VEFAALR8",202,0)
 .........S RESOLTYP=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,3)
"RTN","VEFAALR8",203,0)
 .........I RESOLTYP=3 D
"RTN","VEFAALR8",204,0)
 ..........;GET ORDERABLE ITEMS FILE ENTRY AS POSSIBLE FOLLOW-UP ACTION CHOICE. STORE INTO ^TMP($J,"ORDERITEM,COUNTER) ARRAY
"RTN","VEFAALR8",205,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7)
"RTN","VEFAALR8",206,0)
 ..........;CHECK ORDERABLE ITEM REQUIRED
"RTN","VEFAALR8",207,0)
 ..........S OVER=0
"RTN","VEFAALR8",208,0)
 ..........I (ORDITEMR=1) D
"RTN","VEFAALR8",209,0)
 ...........I ORDERITEM="" S OVER=1 I RY=0 S RY="ERR="_"NO ORDERABLE ITEM FOUND IN ORDER DIALOG "_DIALOGN_" WHEN ONE IS REQUIRED"
"RTN","VEFAALR8",210,0)
 ..........; NOW LOOK AT ORDERS IF ANY AND CHECK DATE/TIME > DATE/TIME OF PASSED CRIT ALERT
"RTN","VEFAALR8",211,0)
 ..........I OVER=1 Q
"RTN","VEFAALR8",212,0)
 ..........S COUNTER=COUNTER+1
"RTN","VEFAALR8",213,0)
 ..........;
"RTN","VEFAALR8",214,0)
 ..........S ^TMP($J,"ORDERITEM",COUNTER)=ORDERITEM
"RTN","VEFAALR8",215,0)
 ..........;GET ORDERABLE ITEM NAME
"RTN","VEFAALR8",216,0)
 ..........I ORDERITEM'="" D
"RTN","VEFAALR8",217,0)
 ...........S ORDITEMN=$P($G(^ORD(101.43,ORDERITEM,0)),"^",1)  ; CHECK ^GLOBAL FOR ORDERABLE ITEM
"RTN","VEFAALR8",218,0)
 ...........;GET DISPLAY GROUP 
"RTN","VEFAALR8",219,0)
 ..........E  D
"RTN","VEFAALR8",220,0)
 ...........S ORDITEMN=""
"RTN","VEFAALR8",221,0)
 ..........;GET ORDERABLE ITEM DISPLAY GROUP
"RTN","VEFAALR8",222,0)
 ..........IF ORDERITEM'="" D
"RTN","VEFAALR8",223,0)
 ...........S ORDITEMD=$P($G(^ORD(101.43,ORDERITEM,0)),"^",5)  ; CHECK ^GLOBAL AND PIECE FOR ORDERABLE ITEM DISPLAY GROUP
"RTN","VEFAALR8",224,0)
 ...........;I ORDITEMD'="" S ORDRITEMD=$P($G(^ORDGRP(ORDITEMD,0)),"^",1)  ; CHECK ^GLOBAL AND PIECE FOR DISPLAY GROUP
"RTN","VEFAALR8",225,0)
 ..........E  D
"RTN","VEFAALR8",226,0)
 ...........S ORDITEMD=""
"RTN","VEFAALR8",227,0)
 ..........;ORDER DIALOG TYPE FINDING HERE. FINDING MUST EXIST. HAS TO BE ORDER DIALOG TYPE. FIND DISPLAY GROUP
"RTN","VEFAALR8",228,0)
 ..........;AND ORDER DIALOG PACKAGE HAS TO MATCH DESIRED PACKAGE ENTRY.
"RTN","VEFAALR8",229,0)
 ..........;
"RTN","VEFAALR8",230,0)
 ..........S ORDERDLG=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,5)  ;CHECK PIECE, NODE ETC
"RTN","VEFAALR8",231,0)
 ..........;CHECK IF ORDER DIALOG (QUICK ORDER) ONLY
"RTN","VEFAALR8",232,0)
 ..........;GET ORGER DIALOG VALUE AS FINDING TYPE IN FORM "500156;ORD(101.41," WHERE NUMERIC LIKE xxxxxxx check global
"RTN","VEFAALR8",233,0)
 ..........;500156 IS INTERNAL # FOR ORDER DIALOG RECORD NUMBER
"RTN","VEFAALR8",234,0)
 ..........S ORDERDLR="" ; ORDER DIALOG RECORD NUMBER
"RTN","VEFAALR8",235,0)
 ..........I ORDERDLG["ORD(101.41," D
"RTN","VEFAALR8",236,0)
 ...........S ORDERDLR=$P(ORDERDLG,";",1)
"RTN","VEFAALR8",237,0)
 ..........S ORDRDIGR="" S ORDRPKG=""
"RTN","VEFAALR8",238,0)
 ..........S OVER=0
"RTN","VEFAALR8",239,0)
 ..........S ORDERDLN="" ; ORDER DIALOG NAME
"RTN","VEFAALR8",240,0)
 ..........I (ORDERDLR'="") D
"RTN","VEFAALR8",241,0)
 ...........S ORDERDLN=$P($G(^ORD(101.41,ORDERDLR,0)),"^",1) ; ORDER DIALOG NAME ,FIND CORRECT ORDER DIALOG PIECE, NODE 
"RTN","VEFAALR8",242,0)
 ...........S ORDRDIGR=$P($G(^ORD(101.41,ORDERDLR,0)),"^",5) ; DISPLAY GROUP ,FIND CORRECT ORDER DIALOG PIECE, NODE 
"RTN","VEFAALR8",243,0)
 ...........S ORDRPKG=$P($G(^ORD(101.41,ORDERDLR,0)),"^",7)  ; PACKAGE ,FIND CORRECT ORDER DIALOG PIECE, NODE 
"RTN","VEFAALR8",244,0)
 ..........;I (ORDERDLG'="")&(ORDERDLN["AWSITE" D
"RTN","VEFAALR8",245,0)
 ..........I (ORDERDLG'="") D
"RTN","VEFAALR8",246,0)
 ...........;
"RTN","VEFAALR8",247,0)
 ..........E  D
"RTN","VEFAALR8",248,0)
 ...........;UPDATE ALERT TYPE FILE TO POINT OF ERROR, THEN QUIT WITH RETURN RY
"RTN","VEFAALR8",249,0)
 ...........K FDA,FDAIEN,OROUT
"RTN","VEFAALR8",250,0)
 ...........S FILE=ORDRFOLU ; ORDER OR FOLLOW UP ACTION MULTIPLE
"RTN","VEFAALR8",251,0)
 ...........S IENS=ALERTGEN_","_IEN_","
"RTN","VEFAALR8",252,0)
 ...........S FDA(46,FILE,IENS,.01)=BOXTEXT
"RTN","VEFAALR8",253,0)
 ...........S FDA(46,FILE,IENS,.5)=ORDITEMN  ;  
"RTN","VEFAALR8",254,0)
 ...........S FDA(46,FILE,IENS,1)=ORDITEMD  ;
"RTN","VEFAALR8",255,0)
 ...........D FILE^DIE("","FDA(46)","OROUT(46)")
"RTN","VEFAALR8",256,0)
 ...........I $D(OROUT(46,"DIERR")) I RY=0 S RY="ORDER/FOLLOW-UP/COMMENTS GROUP ENTRY ERROR= "_BOXTEXT_" "_OROUT(46,"DIERR",1,"TEXT",1) S OVER=1 K FDA(46),OROUT(46) Q
"RTN","VEFAALR8",257,0)
 ...........K FDA(46),OROUT(46)
"RTN","VEFAALR8",258,0)
 ...........I ORDERDLG="" I RY=0 S RY="ERR="_"NO FINDING ORDER DIALOG FOUND FOR DIALOG ELEMENT "_DIALOGN
"RTN","VEFAALR8",259,0)
 ...........;I ORDERDLG'="" I RY=0 S RY="ERR="_"ORDER DIALOG NAME FOR DIALOG ELEMENT "_DIALOGN_ "NOT INCLUDING "AW"_SITE
"RTN","VEFAALR8",260,0)
 ...........S OVER=1
"RTN","VEFAALR8",261,0)
 ..........I OVER=1 Q
"RTN","VEFAALR8",262,0)
 ..........;CHECK IF THERE IS DESIRED PACKAGE WITH AN ORDER DIALOG 
"RTN","VEFAALR8",263,0)
 ..........I ORDRDPKG="" D
"RTN","VEFAALR8",264,0)
 ...........S OVER=1 I RY=0 S RY="ERR="_"FOR DEFINED ORDER DIALOG "_ORDERDLN_" IN DIALOG ELEMENT "_DIALOGN_" DOES NOT HAVE DESIRED PACKAGE"
"RTN","VEFAALR8",265,0)
 ..........I OVER=1 Q
"RTN","VEFAALR8",266,0)
 ..........;CHECK INTERNAL ORDRPKG AGAINST INTERNAL DESIRED PACKAGE IF ORDRPKG IS DEFINED
"RTN","VEFAALR8",267,0)
 ..........S OVER=0
"RTN","VEFAALR8",268,0)
 ..........I ORDRDPKG'="" D
"RTN","VEFAALR8",269,0)
 ...........I ORDRDPKG'=ORDRPKG S OVER=1
"RTN","VEFAALR8",270,0)
 ..........I OVER=1 D  Q
"RTN","VEFAALR8",271,0)
 ...........;UPDATE ALERT TYPE FILE TO POINT OF ERROR, THEN QUIT WITH RETURN RY
"RTN","VEFAALR8",272,0)
 ...........K FDA,FDAIEN,OROUT
"RTN","VEFAALR8",273,0)
 ...........S FILE=ORDRFOLU ; ORDER OR FOLLOW UP ACTION 0R COMMENTS MULTIPLE
"RTN","VEFAALR8",274,0)
 ...........S IENS=ALERTGEN_","_IEN_","
"RTN","VEFAALR8",275,0)
 ...........S FDA(46,FILE,IENS,.01)=BOXTEXT
"RTN","VEFAALR8",276,0)
 ...........S FDA(46,FILE,IENS,.5)=ORDITEMN  ;  
"RTN","VEFAALR8",277,0)
 ...........S FDA(46,FILE,IENS,1)=ORDITEMD  ;
"RTN","VEFAALR8",278,0)
 ...........S FDA(46,FILE,IENS,1.5)=ORDERDLN  ; 
"RTN","VEFAALR8",279,0)
 ...........S FDA(46,FILE,IENS,2)=ORDRDIGR  ;  
"RTN","VEFAALR8",280,0)
 ...........D FILE^DIE("","FDA(46)","OROUT(46)")
"RTN","VEFAALR8",281,0)
 ...........I $D(OROUT(46,"DIERR")) I RY=0 S RY="ORDER/FOLLOW-UP/COMMENTS GROUP ENTRY ERROR= "_BOXTEXT_" "_OROUT(46,"DIERR",1,"TEXT",1) S OVER=1 K FDA(46),OROUT(46) Q
"RTN","VEFAALR8",282,0)
 ...........K FDA(46),OROUT(46)
"RTN","VEFAALR8",283,0)
 ...........; MOD GOW 11/24/14 CORRECT ANY SUBSCRIPT ERROR
"RTN","VEFAALR8",284,0)
 ...........;S ORDRDPK1=$P($G(^DIC(9.4,ORDRDPKG,0)),"^",1)
"RTN","VEFAALR8",285,0)
 ...........;S ORDRPK1=$P($G(^DIC(9.4,ORDRPKG,0)),"^",1)
"RTN","VEFAALR8",286,0)
 ...........S ORDRDPK1="" I ORDRDPKG'="" S ORDRDPK1=$P($G(^DIC(9.4,ORDRDPKG,0)),"^",1)
"RTN","VEFAALR8",287,0)
 ...........S ORDRPK1="" I ORDRPKG'="" S ORDRPK1=$P($G(^DIC(9.4,ORDRPKG,0)),"^",1)
"RTN","VEFAALR8",288,0)
 ...........;END MOD
"RTN","VEFAALR8",289,0)
 ...........I RY=0 S RY="ERR="_"DESIRED PACKAGE "_ORDRDPK1_" FOR DIALOG ELEMENT "_DIALOGN_" NOT MATCHING PACKAGE "_ORDRPK1_" IN ORDER DIALOG "_ORDERDLN
"RTN","VEFAALR8",290,0)
 ..........;
"RTN","VEFAALR8",291,0)
 ..........;new section. Also allow health factor to resolve with non-specifc orderable item (like anti-biotics in general)
"RTN","VEFAALR8",292,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR8",293,0)
 ..........S OVER=1
"RTN","VEFAALR8",294,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR8",295,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR8",296,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR8",297,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 
"RTN","VEFAALR8",298,0)
 ...........;500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR8",299,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR8",300,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR8",301,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR8",302,0)
 ............I (OVER=0)!(OVER=2) D
"RTN","VEFAALR8",303,0)
 .............S OVER=2
"RTN","VEFAALR8",304,0)
 ............E  D
"RTN","VEFAALR8",305,0)
 .............S OVER=0
"RTN","VEFAALR8",306,0)
 .............S FOLLHEAL=$P(FOLLOWAC,";",1)
"RTN","VEFAALR8",307,0)
 .............I FOLLHEAL'="" S FOLLHEAL=$P($G(^AUTTHF(FOLLHEAL,0)),"^",1) ;;GOW ADDED 2/8/2014
"RTN","VEFAALR8",308,0)
 ..........I OVER=1 D
"RTN","VEFAALR8",309,0)
 ...........I RY=0 S RY="ERR="_"NO HEALTH FACTOR FOUND AS ADDITIONAL FINDING IN DIALOG ELEMENT "_DIALOGN
"RTN","VEFAALR8",310,0)
 ..........;I OVER=2 D
"RTN","VEFAALR8",311,0)
 ..........;.I RY=0 S RY="ERR="_"MULTIPLE HEALTH FACTORS FOUND AS ADDITIONAL FINDING IN DIALOG ELEMENT "_DIALOGN
"RTN","VEFAALR8",312,0)
 ..........;I (OVER=1)!(OVER=2) Q
"RTN","VEFAALR8",313,0)
 ..........I (OVER=1) Q
"RTN","VEFAALR8",314,0)
 ..........;NOW WRITE CORRECT VALUES UP TO AND INCLUDING HEALTH FACTOR FOUND AS ADDITIONAL FINDING
"RTN","VEFAALR8",315,0)
 ..........K FDA,FDAIEN,OROUT
"RTN","VEFAALR8",316,0)
 ..........S FILE=ORDRFOLU ; ORDER OR FOLLOW UP ACTION MULTIPLE
"RTN","VEFAALR8",317,0)
 ..........S IENS=ALERTGEN_","_IEN_","
"RTN","VEFAALR8",318,0)
 ..........S FDA(46,FILE,IENS,.01)=BOXTEXT
"RTN","VEFAALR8",319,0)
 ..........S FDA(46,FILE,IENS,.5)=ORDITEMN  ;  
"RTN","VEFAALR8",320,0)
 ..........S FDA(46,FILE,IENS,1)=ORDITEMD  ;
"RTN","VEFAALR8",321,0)
 ..........S FDA(46,FILE,IENS,1.5)=ORDERDLN  ; 
"RTN","VEFAALR8",322,0)
 ..........S FDA(46,FILE,IENS,2)=ORDRDIGR  ;  
"RTN","VEFAALR8",323,0)
 ..........S FDA(46,FILE,IENS,4)=FOLLHEAL  ;
"RTN","VEFAALR8",324,0)
 ..........S FDA(46,FILE,IENS,7)=ORDRPKG  ;
"RTN","VEFAALR8",325,0)
 ..........D FILE^DIE("","FDA(46)","OROUT(46)")
"RTN","VEFAALR8",326,0)
 ..........I $D(OROUT(46,"DIERR")) I RY=0 S RY="ORDER/FOLLOW-UP/COMMENTS GROUP ENTRY ERROR= "_BOXTEXT_" "_OROUT(46,"DIERR",1,"TEXT",1) S OVER=1 K FDA(46),OROUT(46) Q
"RTN","VEFAALR8",327,0)
 ..........K FDA(46),OROUT(46)
"RTN","VEFAALR8",328,0)
 ..........;end new section
"RTN","VEFAALR8",329,0)
 .........E  D
"RTN","VEFAALR8",330,0)
 ..........;IF in any group, check resolution type as not "ordered", flag as error any found orderable item or order dialog 
"RTN","VEFAALR8",331,0)
 ..........;or other finding type in this 2nd group. Flag as error
"RTN","VEFAALR8",332,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7) I ORDERITEM'="" I RY=0 D
"RTN","VEFAALR8",333,0)
 ...........S RY="ERR="_"Orderable item found in Non-Orderable dialog element "_DIALOGN
"RTN","VEFAALR8",334,0)
 ..........I ORDERITEM'="" Q
"RTN","VEFAALR8",335,0)
 ..........S FINDING=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,5) I FINDING'="" I RY=0 D   ;check piece 5 ? for FINDNG OR order dialog ******
"RTN","VEFAALR8",336,0)
 ...........S RY="ERR="_"Finding item found in Non-Orderable dialog element. "_DIALOGN
"RTN","VEFAALR8",337,0)
 ..........I FINDING'="" Q
"RTN","VEFAALR8",338,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALR8",339,0)
 ..........S OVER=1
"RTN","VEFAALR8",340,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALR8",341,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALR8",342,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALR8",343,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALR8",344,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALR8",345,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALR8",346,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALR8",347,0)
 ............;WRITE HF ONLY INTO ALERT TYPE FILE HERE
"RTN","VEFAALR8",348,0)
 ............I (OVER=0)!(OVER=2) D
"RTN","VEFAALR8",349,0)
 .............S OVER=2
"RTN","VEFAALR8",350,0)
 ............E  D
"RTN","VEFAALR8",351,0)
 .............S OVER=0
"RTN","VEFAALR8",352,0)
 .............S FOLLHEAL=$P(FOLLOWAC,";",1)
"RTN","VEFAALR8",353,0)
 .............I FOLLHEAL'="" S FOLLHEAL=$P($G(^AUTTHF(FOLLHEAL,0)),"^",1) ;;GOW ADDED 2/8/2014
"RTN","VEFAALR8",354,0)
 ..........I OVER=1 D
"RTN","VEFAALR8",355,0)
 ...........I RY=0 S RY="ERR="_"NO HEALTH FACTOR FOUND AS ADDITIONAL FINDING IN DIALOG ELEMENT "_DIALOGN
"RTN","VEFAALR8",356,0)
 ..........;I OVER=2 D
"RTN","VEFAALR8",357,0)
 ..........;.I RY=0 S RY="ERR="_"MULTIPLE HEALTH FACTORS FOUND AS ADDITIONAL FINDING IN DIALOG ELEMENT "_DIALOGN
"RTN","VEFAALR8",358,0)
 ..........;I (OVER=1)!(OVER=2) Q
"RTN","VEFAALR8",359,0)
 ..........I (OVER=1) Q
"RTN","VEFAALR8",360,0)
 ..........;NOW WRITE CORRECT VALUES UP TO AND INCLUDING HEALTH FACTOR FOUND AS ADDITIONAL FINDING
"RTN","VEFAALR8",361,0)
 ..........K FDA,FDAIEN,OROUT
"RTN","VEFAALR8",362,0)
 ..........S FILE=ORDRFOLU ; ORDER OR FOLLOW UP ACTION MULTIPLE
"RTN","VEFAALR8",363,0)
 ..........S IENS=ALERTGEN_","_IEN_","
"RTN","VEFAALR8",364,0)
 ..........S FDA(46,FILE,IENS,.01)=BOXTEXT
"RTN","VEFAALR8",365,0)
 ..........S FDA(46,FILE,IENS,4)=FOLLHEAL  ;
"RTN","VEFAALR8",366,0)
 ..........D FILE^DIE("","FDA(46)","OROUT(46)")
"RTN","VEFAALR8",367,0)
 ..........I $D(OROUT(46,"DIERR")) I RY=0 S RY="ORDER/FOLLOW-UP/COMMENT GROUP ENTRY ERROR= "_BOXTEXT_" "_OROUT(46,"DIERR",1,"TEXT",1) S OVER=1 K FDA(46),OROUT(46) Q
"RTN","VEFAALR8",368,0)
 ..........K FDA(46),OROUT(46)
"RTN","VEFAALR8",369,0)
 I RY=0 S RY="OK ALL VALIDITY CHECKS PASSED"
"RTN","VEFAALR8",370,0)
 ;3/15/15 Temporary for now GOW
"RTN","VEFAALR8",371,0)
 S RY="OK ALL VALIDITY CHECKS PASSED"
"RTN","VEFAALR8",372,0)
 ;END MOD
"RTN","VEFAALR8",373,0)
 Q
"RTN","VEFAALR8",374,0)
 ;
"RTN","VEFAALR9")
0^21^B229982290
"RTN","VEFAALR9",1,0)
VEFAALR9 ;GOW/THC VEFA - Module for AWARE report gathering into an Alert Audit Log or Cache[ 12/01/2010 ]
"RTN","VEFAALR9",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALR9",3,0)
 ;; 
"RTN","VEFAALR9",4,0)
COLLECT ;
"RTN","VEFAALR9",5,0)
 ;;DAILY TASK WITH OPTION VEFA AWARE ALERT CACHE BUILDER
"RTN","VEFAALR9",6,0)
 ;;AWARE AUDIT LOG DATA AS VEFA AWARE ALERT CACHE FOR RECENT 2 WEEKS OF ACTIVITY. 
"RTN","VEFAALR9",7,0)
 ;;
"RTN","VEFAALR9",8,0)
 ;;ALSO TAKE OLDEST DAILY DATA FROM THIS CACHE AND FTP TO WINDOWS SERVER MACHINE WITH SQL SERVER
"RTN","VEFAALR9",9,0)
 ;;
"RTN","VEFAALR9",10,0)
 ;;TRUNCATE VEFA AWARE ALERT CACHE FOR DATE/TIME BEYOND TWO WEEKS+1 DAY
"RTN","VEFAALR9",11,0)
 ;;
"RTN","VEFAALR9",12,0)
 ;;UPDATE LAST STARTDATE VALUE INTO VEFA ALERT PARAMETER FILE
"RTN","VEFAALR9",13,0)
 ;;
"RTN","VEFAALR9",14,0)
 ;;DETAIL STEPS:
"RTN","VEFAALR9",15,0)
 ;;COLLECT alerts OVER DATE RANGE 2 WEEKS BACK ( or from last 2 weeks back date in VEFA ALERT 
"RTN","VEFAALR9",16,0)
 ;;PARAMETER file + 1 day) up to CURRENT TIME
"RTN","VEFAALR9",17,0)
 ;;check if alert belongs to CRITICAL ALERT TRACKING FILE with proper ALERT CATEGORY
"RTN","VEFAALR9",18,0)
 ;;         $$CAT^VEFAALR1(D0) 
"RTN","VEFAALR9",19,0)
 ;;Collect by service or actually by alert id, facility then service and then alert generating provider, ETC
"RTN","VEFAALR9",20,0)
 ;;
"RTN","VEFAALR9",21,0)
 ;;For each entry(D0), output an incrementally increasing comma delimited array calling these routines:
"RTN","VEFAALR9",22,0)
 ;;         $$SERVICE^VEFAALR1(D0)      Initial identifying fields including ALERT ID ( 5 fields)
"RTN","VEFAALR9",23,0)
 ;;         $$ALERT2^VEFAALR9(D0)       ALERT type and category
"RTN","VEFAALR9",24,0)
 ;;         $$STATUS1^VEFAALR1(D0)      RETURN A RECIPIENT'S UNACKNOWLEDGED STATUS^RENEW DATE^ACKNOWLEDGED OR DELETED DATE
"RTN","VEFAALR9",25,0)
 ;;         $$FOLLOWU1^VEFAALR6(D0)     Whether Followup has been done with FAT Status and Follow-up Provider if any 
"RTN","VEFAALR9",26,0)
 ;;         $$ORDERCK2^VEFAALR9(D0)      Follow-up provider , then List of Followup-Actions made (working backwards from current date
"RTN","VEFAALR9",27,0)
 ;;                                     to date of deletion/acknowledgement and made only up
"RTN","VEFAALR9",28,0)
 ;;                                     to any date of deletion/ack or current date from date of
"RTN","VEFAALR9",29,0)
 ;;                                     alert generation
"RTN","VEFAALR9",30,0)
 ;;Read/parse records collected and then file each record as record in the VEFA AWARE ALERT CACHE file ( daily)
"RTN","VEFAALR9",31,0)
 ;;
"RTN","VEFAALR9",32,0)
 N DATESTRT,DATEEND,D0,DATECRET,RECORD,DATETIME,ALERTID,FACNAME,SERVICE,CLINIC,PROVIDER
"RTN","VEFAALR9",33,0)
 N LISTVALUE,PATIENT,PATID,ALERTC,ALERTTYP,VEFASYS,VEFAPROC,VEFADELE,FATSTAT,FATPROC
"RTN","VEFAALR9",34,0)
 N FATPROV,FOLLUPPR,ALERTIDN,RECORD1,PATIENTID,ORIGINATOR,FULLD,MON,STATION,ALERTTY1
"RTN","VEFAALR9",35,0)
 N ACKGT7D,FOLLUPP1,FOLLGT7D
"RTN","VEFAALR9",36,0)
 N COUNT1,FILE,IENALTR,INITDATE,PRSTDATE
"RTN","VEFAALR9",37,0)
 N FOLLOWU
"RTN","VEFAALR9",38,0)
 ;MOD 8/21/14 GOW
"RTN","VEFAALR9",39,0)
 N ORGATYP,ENDDATE
"RTN","VEFAALR9",40,0)
 N PATIEN,REVERSDT,EXAMCASE,NODE
"RTN","VEFAALR9",41,0)
 ;END MOD
"RTN","VEFAALR9",42,0)
 ;
"RTN","VEFAALR9",43,0)
 N VALUE,WINDOW,X1,X2,ORDER
"RTN","VEFAALR9",44,0)
 ;MOD 8/22/14 GOW ADD LOCK FOR SINGLE TASK
"RTN","VEFAALR9",45,0)
 ;
"RTN","VEFAALR9",46,0)
 S ^XTMP("VEFAALR4")=1
"RTN","VEFAALR9",47,0)
 L +^XTMP("VEFAALR4"):5 I '$T Q
"RTN","VEFAALR9",48,0)
 ;
"RTN","VEFAALR9",49,0)
 ;END MOD
"RTN","VEFAALR9",50,0)
 ;;first detemine date range
"RTN","VEFAALR9",51,0)
 D NOW^%DTC S DATEEND=% K %
"RTN","VEFAALR9",52,0)
 ;S X1=%,X2=-14 D C^%DTC S DATEEND=X  TEMPORAILY OUTPUT JUST TO NOW TIME
"RTN","VEFAALR9",53,0)
 ;NEXT DATESTRT
"RTN","VEFAALR9",54,0)
 ;FIND LAST DATE START IN VEFA ALERT PARAMETERS FILE
"RTN","VEFAALR9",55,0)
 S DATESTRT=$P($G(^DIZ(19008.1,1,0)),"^",2)
"RTN","VEFAALR9",56,0)
 I DATESTRT="" D
"RTN","VEFAALR9",57,0)
 .;S X1=%,X2=-31 D C^%DTC S DATESTRT=X
"RTN","VEFAALR9",58,0)
 .;MOD GOW 8/22/14 S X1=2990114,X2=-15 D C^%DTC S DATESTRT=X  ;TEMPORARY FOR TESTING BUILDING ENTRIES
"RTN","VEFAALR9",59,0)
 .S DATESTRT=DATEEND  
"RTN","VEFAALR9",60,0)
 E  D
"RTN","VEFAALR9",61,0)
 .;S X1=DATESTRT,X2=1 D C^%DTC S DATESTRT=X   ;TEMPORARY FOR TESTING MBUILDING ENTRIES
"RTN","VEFAALR9",62,0)
 S $P(^DIZ(19008.1,1,0),"^",2)=DATESTRT  ;TEMPORARY FOR TESTING WITH EXTRACTION
"RTN","VEFAALR9",63,0)
 ;
"RTN","VEFAALR9",64,0)
 ;
"RTN","VEFAALR9",65,0)
 ;PARAMETERIZE CODE
"RTN","VEFAALR9",66,0)
 S WINDOW=$P($G(^DIZ(19008.1,1,0)),"^",3)
"RTN","VEFAALR9",67,0)
 I WINDOW="" Q
"RTN","VEFAALR9",68,0)
 ;MOD 8/21/14 GOW FOR TESTING PURPOSES AND FOR USE IN TEST ACCOUNT ONLY: END DATE AFTER 
"RTN","VEFAALR9",69,0)
 ;(DATE %NOW -CACHE WINDOW(DAY)) 
"RTN","VEFAALR9",70,0)
 ;BACK IN TIME AS END DATE AS LAST DATE TO DISCOVER ALERT DATA IN ALERT CACHE FOR A 
"RTN","VEFAALR9",71,0)
 ;SMALLER CAPTURE BUT FOR GETTING A REALIST DATA CAPTURE AS WOULD OCCUR IN A SMALLER 
"RTN","VEFAALR9",72,0)
 ;CACHE WINDOW TO BE DETERMINED WITHOUT EXCEEDING THE TIME PERIOD CHOSEN FOR TESTING
"RTN","VEFAALR9",73,0)
 ;(THE TIME PERIOD NO LESS THAN SEVEN DAYS),BUT WITH CAPABILITY AS WITH THE USE OF 
"RTN","VEFAALR9",74,0)
 ;RECENT MIRRORED PRODUCTION DATA THAT IS CURRENTLY AVAIALABLE IN A TEST ACCOUNT,CAN BE
"RTN","VEFAALR9",75,0)
 ;HELP FIND A REPRESENTATIVE DURATION FOR SPECIFIC TIME PERIOD TO USE IN PRODUCTION 
"RTN","VEFAALR9",76,0)
 ;UNDER TYPICAL PRODUCTION LEVEL LOADING CONDITIONS.
"RTN","VEFAALR9",77,0)
 ;NORMALLY UNDER NORMAL RUNNING AND NOT IN TEST MODE, ENDDATE IN VEFA ALERT PARAMETER
"RTN","VEFAALR9",78,0)
 ;FILE SHOULD BE SET TO NULL.
"RTN","VEFAALR9",79,0)
 S ENDDATE=$P($G(^DIZ(19008.1,1,0)),"^",4)
"RTN","VEFAALR9",80,0)
 I ENDDATE'="" S DATEEND=ENDDATE
"RTN","VEFAALR9",81,0)
 ;END MOD
"RTN","VEFAALR9",82,0)
 D NOW^%DTC S PRSTDATE=% K %
"RTN","VEFAALR9",83,0)
 S X1=PRSTDATE,X2=-(WINDOW) D C^%DTC S DATESTRT=X
"RTN","VEFAALR9",84,0)
 ;
"RTN","VEFAALR9",85,0)
 ;
"RTN","VEFAALR9",86,0)
 ;FOR LOOP OVER ALERT TRACKING FILE ENTRIES BY DATE/TIME IN DATE RANGE
"RTN","VEFAALR9",87,0)
 ;FIND ONES THAT ARE TRACKED BY AWARE
"RTN","VEFAALR9",88,0)
 S DATECRET=DATESTRT
"RTN","VEFAALR9",89,0)
 ;MOD 8/21/14 GOW CHECK FOR ENDDATE IF NON=NULL
"RTN","VEFAALR9",90,0)
 ;F  S DATECRET=$O(^XTV(8992.1,"D",DATECRET)) Q:DATECRET=""  D
"RTN","VEFAALR9",91,0)
 F  S DATECRET=$O(^XTV(8992.1,"D",DATECRET)) Q:(DATECRET="")!(DATECRET>DATEEND)  D
"RTN","VEFAALR9",92,0)
 .I '((DATECRET>DATESTRT)&(DATECRET<DATEEND)) Q
"RTN","VEFAALR9",93,0)
 .;END MOD
"RTN","VEFAALR9",94,0)
 .S D0=0
"RTN","VEFAALR9",95,0)
 .F  S D0=$O(^XTV(8992.1,"D",DATECRET,D0)) Q:D0=""  D
"RTN","VEFAALR9",96,0)
 ..I $$CAT^VEFAALR1(D0) D  ;AWARE TRACKED ALERT
"RTN","VEFAALR9",97,0)
 ...;Colect basic alert information
"RTN","VEFAALR9",98,0)
 ...S RECORD=$$SERVICE^VEFAALR1(D0)
"RTN","VEFAALR9",99,0)
 ...;Q ALERTID_"^"_FACNAME_"^"_VEFASYS_"^"_VEFAPRV1_"^"_VEFALIST_"^"_PATIENT1_"^"_$E($$ALERT(X),1,60)
"RTN","VEFAALR9",100,0)
 ...;Collect Tracked Alert data including type and category
"RTN","VEFAALR9",101,0)
 ...S RECORD=RECORD_"^"_$$ALERT2^VEFAALR9(D0)
"RTN","VEFAALR9",102,0)
 ...;Q VEFACATN_" "_VEFANAME
"RTN","VEFAALR9",103,0)
 ...;RETURN A RECIPINT'S UNACKNOWLEDGED STATUS^PROCESSES RENEW/ACK DATE^DELETED DATE
"RTN","VEFAALR9",104,0)
 ...;RENEW DATE MEANS NON-NULL PROCESSED DATE W/O DELETED DATE
"RTN","VEFAALR9",105,0)
 ...;ACKNOWLEDGED DATE MEANS NON-NULL PROCESSED DATE AND DELETE DATE
"RTN","VEFAALR9",106,0)
 ...;UNACKNOWLEDGED STATUS MEANS NULL PROCESSED DATE AND NULL DELETE DATE
"RTN","VEFAALR9",107,0)
 ...S RECORD=RECORD_"^"_$$STATUS1^VEFAALR1(D0)
"RTN","VEFAALR9",108,0)
 ...;Q VEFASYS_"^"_VEFAPROC_"^"_VEFADELE
"RTN","VEFAALR9",109,0)
 ...S RECORD=RECORD_"^"_$$FOLLOWU1^VEFAALR6(D0) ; BEFORE $$FOLLOWU1^VEFAALR1
"RTN","VEFAALR9",110,0)
 ...;FAT  LOOK STATUS + EXTRA COLUMN FOR FAT PROVIDER ( IF FAT SATISFIED)
"RTN","VEFAALR9",111,0)
 ...;NOW GET FOLLOW-UP PROVIDER AND LIST OF FOLLOW-UP ACTIONS SEPARATED WITH A ";" 
"RTN","VEFAALR9",112,0)
 ...S RECORD1=$$ORDERCK2^VEFAALR9(D0) ;$$ORDERCK^VEFAALR1(D0)
"RTN","VEFAALR9",113,0)
 ...;NEXT READ AND PARSE 
"RTN","VEFAALR9",114,0)
 ...S ALERTID=$P(RECORD,"^",1)
"RTN","VEFAALR9",115,0)
 ...S DATETIME=$P(ALERTID,";",3)  ; ALERT DATE/TIME
"RTN","VEFAALR9",116,0)
 ...S ORIGINATOR=$P(ALERTID,";",2)
"RTN","VEFAALR9",117,0)
 ...I ORIGINATOR'="" S ORIGINATOR=$P($G(^XTV(8992,ORIGINATOR,0)),"^",1)
"RTN","VEFAALR9",118,0)
 ...I ORIGINATOR'="" S ORIGINATOR=$P($G(^VA(200,ORIGINATOR,0)),"^",1)
"RTN","VEFAALR9",119,0)
 ...;S ALERTID=$P(ALERTID,";",1)
"RTN","VEFAALR9",120,0)
 ...S FACNAME=$P(RECORD,"^",2)
"RTN","VEFAALR9",121,0)
 ...S SERVICE=$P(RECORD,"^",3)
"RTN","VEFAALR9",122,0)
 ...S IENALTR=0  ; ALERT TRACKING IEN
"RTN","VEFAALR9",123,0)
 ...S CLINIC="?" ;
"RTN","VEFAALR9",124,0)
 ...S IENALTR=$O(^XTV(8992.1,"B",ALERTID,IENALTR))
"RTN","VEFAALR9",125,0)
 ...I IENALTR'="" S ORDER=$P($P($G(^XTV(8992.1,IENALTR,2)),"^",1),"@",1)
"RTN","VEFAALR9",126,0)
 ...I (ORDER="")!($G(^XTV(8992.1,IENALTR,2))'["@") D
"RTN","VEFAALR9",127,0)
 ....S CLINIC="?" ;TEMPORARILY ="" INSTEAD OF COMPUTATION , $P(RECORD,"^",5)  ; UNUSED FOR NOW OR UNDEFINED . COULD BE DETERMINED FROM 
"RTN","VEFAALR9",128,0)
 ....;MOD 8/22/2014 GOW FOR IMAGING ALERTS, DETERMINE REQUESTING LOCATION
"RTN","VEFAALR9",129,0)
 ....;ASSUME TYPICAL ALERT AS "OR,PATIEN,25,....... WHERE PATIEN IS PATIENT IEN AS 2ND PIECE
"RTN","VEFAALR9",130,0)
 ....S PATIEN=$P(ALERTID,",",2)
"RTN","VEFAALR9",131,0)
 ....I PATIEN'="" D
"RTN","VEFAALR9",132,0)
 .....;GET REVERSE EXAM DT
"RTN","VEFAALR9",133,0)
 .....S REVERSDT=$P($G(^XTV(8992.1,IENALTR,2)),"~",1)
"RTN","VEFAALR9",134,0)
 .....;GET CASE #
"RTN","VEFAALR9",135,0)
 .....S EXAMCASE=$P($G(^XTV(8992.1,IENALTR,2)),"~",2)
"RTN","VEFAALR9",136,0)
 .....I (REVERSDT="")!(EXAMCASE="") Q
"RTN","VEFAALR9",137,0)
 .....;OTHERWISE DETERMINE REQUESTING LOCATION FOR EXAM FROM RAD/NUC MED PATIENT FILE
"RTN","VEFAALR9",138,0)
 .....S NODE=$G(^RADPT(PATIEN,"DT",REVERSDT,"P",EXAMCASE,0))
"RTN","VEFAALR9",139,0)
 .....S CLINIC=$P(NODE,"^",22)
"RTN","VEFAALR9",140,0)
 .....I CLINIC="" S CLINIC="?" Q
"RTN","VEFAALR9",141,0)
 .....S CLINIC=$P($G(^SC(CLINIC,0)),"^",1)
"RTN","VEFAALR9",142,0)
 .....I CLINIC="" S CLINIC="?" Q
"RTN","VEFAALR9",143,0)
 ....;END MOD 
"RTN","VEFAALR9",144,0)
 ...E  D
"RTN","VEFAALR9",145,0)
 ....S CLINIC=$P($G(^OR(100,ORDER,0)),"^",10) S CLINIC=$P(CLINIC,";",1)
"RTN","VEFAALR9",146,0)
 ....I CLINIC'="" D
"RTN","VEFAALR9",147,0)
 .....S CLINIC=$P($G(^SC(CLINIC,0)),"^",1)          ;158;SC(
"RTN","VEFAALR9",148,0)
 ....E  D
"RTN","VEFAALR9",149,0)
 .....S CLINIC="?"
"RTN","VEFAALR9",150,0)
 ....I CLINIC="" S CLINIC="?"
"RTN","VEFAALR9",151,0)
 ...;PHYSICAL LOCATION IN ORIGINAL ORDER FILE ENTRY FOR ALERT ITSELF
"RTN","VEFAALR9",152,0)
 ...S PROVIDER=$P(RECORD,"^",4) ; WHEN DETERMINING ORDERING PROVIDER ( FROM ORDERABLE ITEM, 
"RTN","VEFAALR9",153,0)
 ...;LAST ORDER BEFORE PATIENT'S 
"RTN","VEFAALR9",154,0)
 ...;ALERT TYPE OCCURED .THERE IS ALSO GENERATED BY ( PERSON) FOR ALERT FOR PERSON GENERATING
"RTN","VEFAALR9",155,0)
 ...; ALERT WHEN A VALUE WAS EVALUATED AS CRITICAL , ETC. LIKE RADIOLOGIST FOR A X-RAY ORDER.
"RTN","VEFAALR9",156,0)
 ...S LISTVALUE=$P(RECORD,"^",5) ; ALL RECIPIENTS
"RTN","VEFAALR9",157,0)
 ...S PATIENTID=$P(RECORD,"^",6) ;PATIENT ID
"RTN","VEFAALR9",158,0)
 ...I PATIENTID'="" D
"RTN","VEFAALR9",159,0)
 ....S PATIENT=$P($G(^DPT(PATIENTID,0)),"^",1)
"RTN","VEFAALR9",160,0)
 ...E  D
"RTN","VEFAALR9",161,0)
 ....S PATIENT=""
"RTN","VEFAALR9",162,0)
 ...;S PATID=$P(RECORD,"^",9) ; FOR UNIQUE INTERNAL IDENTIFIER, BUT NOT PATIENT IDENTIFIER FOR 
"RTN","VEFAALR9",163,0)
 ...;LATER SQL STORAGE.
"RTN","VEFAALR9",164,0)
 ...S ALERTC=$P(RECORD,"^",8) ; ALERT CATEGORY
"RTN","VEFAALR9",165,0)
 ...S ALERTTYP=$P(RECORD,"^",9) ; ALERT TYPE
"RTN","VEFAALR9",166,0)
 ...S STATION=""
"RTN","VEFAALR9",167,0)
 ...S ALERTTY1=""
"RTN","VEFAALR9",168,0)
 ...S INITDATE=""
"RTN","VEFAALR9",169,0)
 ...;MOD GOW 8/21/14 INITIALIZE ORIG ALERT TYPE
"RTN","VEFAALR9",170,0)
 ...S ORGATYP=""
"RTN","VEFAALR9",171,0)
 ...;END MOD
"RTN","VEFAALR9",172,0)
 ...I ALERTTYP'="" D
"RTN","VEFAALR9",173,0)
 ....;MOD 8/21/14 STORE INTO ORIG ALERT TYPE
"RTN","VEFAALR9",174,0)
 ....S ORGATYP=ALERTTYP
"RTN","VEFAALR9",175,0)
 ....S ALERTTY1=$O(^DIZ(19007,"B",ALERTTYP,0))
"RTN","VEFAALR9",176,0)
 ....I ALERTTY1="" Q  ;ERROR
"RTN","VEFAALR9",177,0)
 ....S STATION=$P($G(^DIZ(19007,ALERTTY1,3)),"^",8)
"RTN","VEFAALR9",178,0)
 ....S INITDATE=$P($G(^DIZ(19007,ALERTTY1,3)),"^",4) ;INPUT TRANSFORM IN PLACE FOR NOT CHANGING VALUE ONCE ENTERED
"RTN","VEFAALR9",179,0)
 ...I ALERTTY1="" Q
"RTN","VEFAALR9",180,0)
 ...I INITDATE="" Q
"RTN","VEFAALR9",181,0)
 ...;CHECK IF ALERTDATE > INITIATION DATE 
"RTN","VEFAALR9",182,0)
 ...I DATETIME<INITDATE Q
"RTN","VEFAALR9",183,0)
 ...;MOD 8/11/2014 GOW USE GENERIC NAME INSTEAD OF SPECIFIC ALERT TYPE NAME
"RTN","VEFAALR9",184,0)
 ...S ALERTTYP=$P($G(^DIZ(19007,ALERTTY1,5)),"^",2)
"RTN","VEFAALR9",185,0)
 ...I ALERTTYP="" Q ; QUIT ON ERROR CONDITION
"RTN","VEFAALR9",186,0)
 ...;END MOD
"RTN","VEFAALR9",187,0)
 ...S VEFASYS=$P(RECORD,"^",10)  ; UNACKNOWLEDGE STATUS
"RTN","VEFAALR9",188,0)
 ...S VEFAPROC=$P(RECORD,"^",11) ; RENEW/ACK PROCESS DATE TIME
"RTN","VEFAALR9",189,0)
 ...S MON=$E(VEFAPROC,4,7)
"RTN","VEFAALR9",190,0)
 ...S FULLD=$$FMTE^XLFDT(VEFAPROC,1)
"RTN","VEFAALR9",191,0)
 ...;;;;;;S VEFAPROC=FULLD
"RTN","VEFAALR9",192,0)
 ...;S MON=$E(VEFAPROC,4,7)
"RTN","VEFAALR9",193,0)
 ...;S FULLD=$$FMTE^XLFDT(VEFAPROC,1)
"RTN","VEFAALR9",194,0)
 ...;S FULLD=$P($G(FULLD),",",2)
"RTN","VEFAALR9",195,0)
 ...;S FULLD=$E(FULLD,2,5)
"RTN","VEFAALR9",196,0)
 ...;S VEFAPROC=FULLD_MON
"RTN","VEFAALR9",197,0)
 ...S VEFADELE=$P(RECORD,"^",12) ; DELETE DATE/TIME
"RTN","VEFAALR9",198,0)
 ...S MON=$E(VEFADELE,4,7)
"RTN","VEFAALR9",199,0)
 ...S FULLD=$$FMTE^XLFDT(VEFADELE,1)
"RTN","VEFAALR9",200,0)
 ...;S FULLD=$P($G(FULLD),",",2)
"RTN","VEFAALR9",201,0)
 ...;S FULLD=$E(FULLD,2,5)
"RTN","VEFAALR9",202,0)
 ...;S VEFADELE=FULLD_MON
"RTN","VEFAALR9",203,0)
 ...;;;;;S VEFADELE=FULLD
"RTN","VEFAALR9",204,0)
 ...S FATSTAT=$P(RECORD,"^",13)
"RTN","VEFAALR9",205,0)
 ...S FATPROC="" ; TEMPORAILY $P(RECORD,"^",16)
"RTN","VEFAALR9",206,0)
 ...S FATPROV=$P(RECORD,"^",14)
"RTN","VEFAALR9",207,0)
 ...S FOLLUPP1=$P(RECORD1,";",1) ; FOLLOW-UP PROVIDER
"RTN","VEFAALR9",208,0)
 ...S FOLLUPPR=$P(FOLLUPP1,"*",1)
"RTN","VEFAALR9",209,0)
 ...S ACKGT7D=$P(FOLLUPP1,"*",2)
"RTN","VEFAALR9",210,0)
 ...S FOLLGT7D=$P(FOLLUPP1,"*",3)
"RTN","VEFAALR9",211,0)
 ...S FOLLOWU=$P(FOLLUPP1,"*",4)
"RTN","VEFAALR9",212,0)
 ...I FOLLOWU'="" D
"RTN","VEFAALR9",213,0)
 ....S FOLLOWU=1
"RTN","VEFAALR9",214,0)
 ...E  D
"RTN","VEFAALR9",215,0)
 ....S FOLLOWU=0
"RTN","VEFAALR9",216,0)
 ...I FOLLUPPR'="" S FOLLUPPR=$P($G(^VA(200,FOLLUPPR,0)),"^",1)_" - "_FOLLUPPR
"RTN","VEFAALR9",217,0)
 ...;W !,"RECORD=",RECORD
"RTN","VEFAALR9",218,0)
 ...;W !,"RECORD1=",RECORD1
"RTN","VEFAALR9",219,0)
 ...;Q
"RTN","VEFAALR9",220,0)
 ...;
"RTN","VEFAALR9",221,0)
 ...;CHECK IF NO INITDATE ESTABLISHED YET OR REMINDER DIALOG VALUE CLEARED
"RTN","VEFAALR9",222,0)
 ...;W !,RECORD1
"RTN","VEFAALR9",223,0)
 ...I (RECORD1="3^2")!(RECORD1="3^3") W !,"ALERTID=",ALERTID Q
"RTN","VEFAALR9",224,0)
 ...I (FATSTAT=3)&(FATPROV=2) Q
"RTN","VEFAALR9",225,0)
 ...I (FATSTAT=3)&(FATPROV=3) Q
"RTN","VEFAALR9",226,0)
 ...;
"RTN","VEFAALR9",227,0)
 ...;VEFA AWARE ALERT CACHE ( 2 WEEKS OF DATA AT MOST). WILL TRUNCATE AT END AS WELL
"RTN","VEFAALR9",228,0)
 ...;AND WRITE WITH UPDATE ^DIE EITHER ADD NEW RECORD OR UPDATE RECORD INTO.
"RTN","VEFAALR9",229,0)
 ...;ADD IN FIELD NUMBER ORDER
"RTN","VEFAALR9",230,0)
 ...K FDA,FDAIEN,OROUT
"RTN","VEFAALR9",231,0)
 ...S FILE=19008.2
"RTN","VEFAALR9",232,0)
 ...S FDA(45,FILE,"?+1,",.01)=ALERTID   ;NAME ALERTID
"RTN","VEFAALR9",233,0)
 ...S FDA(45,FILE,"?+1,",1)=DATETIME  ; DATE CREATED
"RTN","VEFAALR9",234,0)
 ...S FDA(45,FILE,"?+1,",2)=FACNAME   ; FACILITY NAME
"RTN","VEFAALR9",235,0)
 ...S FDA(45,FILE,"?+1,",3)=SERVICE     ; SERVICE
"RTN","VEFAALR9",236,0)
 ...S FDA(45,FILE,"?+1,",4)=PROVIDER   ;ORDERING PROVIDER HOPEFULLY OR EVENTUALLY
"RTN","VEFAALR9",237,0)
 ...S FDA(45,FILE,"?+1,",5)=LISTVALUE         ; ALL RECIPIENTS,GENERATED WHILE QUEUED
"RTN","VEFAALR9",238,0)
 ...S FDA(45,FILE,"?+1,",6)=PATIENT   ; 
"RTN","VEFAALR9",239,0)
 ...S FDA(45,FILE,"?+1,",7)=ALERTC     ; ALERT CATEGORY
"RTN","VEFAALR9",240,0)
 ...S FDA(45,FILE,"?+1,",8)=ALERTTYP   ;ALERT TYPE
"RTN","VEFAALR9",241,0)
 ...S FDA(45,FILE,"?+1,",9)=VEFASYS   ;  
"RTN","VEFAALR9",242,0)
 ...S FDA(45,FILE,"?+1,",10)=VEFAPROC   ; DATE/TIME 
"RTN","VEFAALR9",243,0)
 ...S FDA(45,FILE,"?+1,",11)=VEFADELE     ; DATE/TIME 
"RTN","VEFAALR9",244,0)
 ...S FDA(45,FILE,"?+1,",12)=FATSTAT   ;FAT STATUS
"RTN","VEFAALR9",245,0)
 ...S FDA(45,FILE,"?+1,",13)=FATPROV   ; FAT PROVIDER
"RTN","VEFAALR9",246,0)
 ...S FDA(45,FILE,"?+1,",14)=FOLLUPPR   ; FOLLOWUP PROVIDER FOR ALERT
"RTN","VEFAALR9",247,0)
 ...S FDA(45,FILE,"?+1,",16)=CLINIC   ;  
"RTN","VEFAALR9",248,0)
 ...S FDA(45,FILE,"?+1,",17)=PATIENTID   ;  
"RTN","VEFAALR9",249,0)
 ...S FDA(45,FILE,"?+1,",18)=ORIGINATOR   ; 
"RTN","VEFAALR9",250,0)
 ...;S FDA(45,FILE,"?+1,",19)=GENERATED BY PERSON CL   ;
"RTN","VEFAALR9",251,0)
 ...S FDA(45,FILE,"?+1,",20)=STATION   ;
"RTN","VEFAALR9",252,0)
 ...S FDA(45,FILE,"?+1,",21)=FOLLGT7D   ;    
"RTN","VEFAALR9",253,0)
 ...S FDA(45,FILE,"?+1,",22)=ACKGT7D   ; 
"RTN","VEFAALR9",254,0)
 ...S FDA(45,FILE,"?+1,",23)=$$ALERTVAL(D0)
"RTN","VEFAALR9",255,0)
 ...S FDA(45,FILE,"?+1,",24)=FOLLOWU
"RTN","VEFAALR9",256,0)
 ...;MOD 8/21/14 GOW ORIG ALERT TYPE
"RTN","VEFAALR9",257,0)
 ...S FDA(45,FILE,"?+1,",25)=ORGATYP
"RTN","VEFAALR9",258,0)
 ...;END MOD
"RTN","VEFAALR9",259,0)
 ...D UPDATE^DIE("","FDA(45)","FDAIEN","OROUT(45)")
"RTN","VEFAALR9",260,0)
 ...I $D(OROUT(45,"DIERR")) W !,"AWARE ALERT CACHE, NAME ALERTID ERROR= ",ALERTID," ",DATETIME," ",OROUT(45,"DIERR",1,"TEXT",1) Q
"RTN","VEFAALR9",261,0)
 ...S ALERTIDN=FDAIEN(1)
"RTN","VEFAALR9",262,0)
 ...K FDA(45),OROUT(45)
"RTN","VEFAALR9",263,0)
 ...K FDA,FDAIEN,OROUT
"RTN","VEFAALR9",264,0)
 ...S FILE=19008.215 ; FOLLOW UP ACTION MULTIPLE
"RTN","VEFAALR9",265,0)
 ...;S FDAIEN(1)=ALERTIDN
"RTN","VEFAALR9",266,0)
 ...S COUNT1=2
"RTN","VEFAALR9",267,0)
 ...F  S VALUE=$P(RECORD1,";",COUNT1) Q:(VALUE="")  D
"RTN","VEFAALR9",268,0)
 ....;
"RTN","VEFAALR9",269,0)
 ....S FDAIEN(1)=ALERTIDN
"RTN","VEFAALR9",270,0)
 ....;FOLLOW-UP ACTION(S)
"RTN","VEFAALR9",271,0)
 ....;W !,"VALUE=",VALUE
"RTN","VEFAALR9",272,0)
 ....S FDA(46,FILE,"?+2,"_FDAIEN(1)_",",.01)=$P(VALUE,"*",1)
"RTN","VEFAALR9",273,0)
 ....S FDA(46,FILE,"?+2,"_FDAIEN(1)_",",1)=$P(VALUE,"*",2) ;DATETIME  ; ALERT FIRST DISPLAYED
"RTN","VEFAALR9",274,0)
 ....;//S FDA(46,FILE,"?+2,"_FDAIEN(1)_",",.01)=VALUE
"RTN","VEFAALR9",275,0)
 ....;//S FDA(46,FILE,"?+2,"_FDAIEN(1)_",",.02)=DATETIME  ; ALERT FIRST DISPLAYED
"RTN","VEFAALR9",276,0)
 ....D UPDATE^DIE("","FDA(46)","FDAIEN","OROUT(46)")
"RTN","VEFAALR9",277,0)
 ....S COUNT1=COUNT1+1
"RTN","VEFAALR9",278,0)
 ....I $D(OROUT(46,"DIERR")) W !,"AWARE ALERT CACHE, FOLLOW-UP ACTION ERROR= ",VALUE," ",OROUT(46,"DIERR",1,"TEXT",1) Q
"RTN","VEFAALR9",279,0)
 ....;S RECIPINT=FDAIEN(2)
"RTN","VEFAALR9",280,0)
 ....K FDA(46),OROUT(46)
"RTN","VEFAALR9",281,0)
 ....K FDA,FDAIEN,OROUT
"RTN","VEFAALR9",282,0)
 ....;S COUNT1=COUNT1+1
"RTN","VEFAALR9",283,0)
 ...;
"RTN","VEFAALR9",284,0)
 ;UPDATE NEXT LAST START DATE
"RTN","VEFAALR9",285,0)
 ;ADJUST TO MAKE IT 30 DAYS BACK IF NEEDED ( IF MACHINE WAS DOWN ACROSS A DAY OR BROUGHT DOWN FOR MAINTENANCE)
"RTN","VEFAALR9",286,0)
 ;WELL WITH RPC INTO VISTA TO GET OLDEST DATA
"RTN","VEFAALR9",287,0)
 ;D NOW^%DTC S DATEEND=%
"RTN","VEFAALR9",288,0)
 ;;S X1=DATEEND
"RTN","VEFAALR9",289,0)
 ;;S X1=%,X2=1 D C^%DTC S DATESTRT=X
"RTN","VEFAALR9",290,0)
 ;;K X1,X2
"RTN","VEFAALR9",291,0)
 S $P(^DIZ(19008.1,1,0),"^",2)=PRSTDATE  ; START PROCESSED DATE/TIME
"RTN","VEFAALR9",292,0)
 ;MOD 8/21/14 GOW ADD END PROCESS DATE TIME TO DETERMINE DURATION (END PROCESS DATE/TIME-
"RTN","VEFAALR9",293,0)
 ;START PROCESS DATE/TIME) IT TAKES TO COLLECT THE DATA ( CAN BE UNDER LOADED CONDITIONS
"RTN","VEFAALR9",294,0)
 ;LIKE MIRRORED PRODUCTION LEVEL DATA LOADED INTO THE TEST ACCOUNT). COMPARE TO TIME 
"RTN","VEFAALR9",295,0)
 ;PERIOD OF TASK SCHEDULE DURATION PERIOD. THIS CAN ALSO BE CALCULATED IN PRODUCTION.
"RTN","VEFAALR9",296,0)
 ;GOAL IS FOR DURATION TO BE A LITTLE LESS THAN TASK SCHEDULE FREQUENCY (UNDER PEAK 
"RTN","VEFAALR9",297,0)
 ;CONDITIONS).
"RTN","VEFAALR9",298,0)
 D NOW^%DTC S DATEEND=%
"RTN","VEFAALR9",299,0)
 S $P(^DIZ(19008.1,1,0),"^",5)=DATEEND  ; END PROCESSED DATE/TIME
"RTN","VEFAALR9",300,0)
 ;END MOD
"RTN","VEFAALR9",301,0)
 ;MOD 8/22/14 GOW UNLOCK
"RTN","VEFAALR9",302,0)
 ;
"RTN","VEFAALR9",303,0)
 L -^XTMP("VEFAALR4")
"RTN","VEFAALR9",304,0)
 ;
"RTN","VEFAALR9",305,0)
 ;END MOD
"RTN","VEFAALR9",306,0)
 Q
"RTN","VEFAALR9",307,0)
ALERT2(X) ;D0 AS X
"RTN","VEFAALR9",308,0)
 N VEFACNT,VEFACAT,VEFANOTF,VEFACATY,VEFAALNT,VEFADSPL,VEFACATN,VEFAUTCA,VEFAENTR,VEFANAME
"RTN","VEFAALR9",309,0)
 N D0
"RTN","VEFAALR9",310,0)
 ;MOD 8/7/14 GOW
"RTN","VEFAALR9",311,0)
 N VEFACATT
"RTN","VEFAALR9",312,0)
 ;END MOD
"RTN","VEFAALR9",313,0)
 S D0=X
"RTN","VEFAALR9",314,0)
 S VEFACATN=""
"RTN","VEFAALR9",315,0)
 S VEFANAME=""
"RTN","VEFAALR9",316,0)
 S VEFACATY=0  ; NOT CATEGORY CLASS
"RTN","VEFAALR9",317,0)
 ;GET NOTIFICATION TYPE FOR THIS ALERT
"RTN","VEFAALR9",318,0)
 S VEFAALNT=$P($P($P($G(^XTV(8992.1,D0,0)),"^",1),";",1),",",3)
"RTN","VEFAALR9",319,0)
 ;GET DISPLAY EXT THIS TYPE OF ALERT
"RTN","VEFAALR9",320,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,1)),"^",1)
"RTN","VEFAALR9",321,0)
 S VEFACAT=0
"RTN","VEFAALR9",322,0)
 F  S VEFACAT=$O(^DIZ(19008,"B",VEFACAT)) Q:(VEFACAT="")!(VEFACATY=1)  D
"RTN","VEFAALR9",323,0)
 .S VEFACNT=0
"RTN","VEFAALR9",324,0)
 .S VEFACNT=$O(^DIZ(19008,"B",VEFACAT,VEFACNT)) D
"RTN","VEFAALR9",325,0)
 ..;GET NOTIFICATION TYPE
"RTN","VEFAALR9",326,0)
 ..S VEFANOTF=$P($G(^DIZ(19008,VEFACNT,1)),"^",2)
"RTN","VEFAALR9",327,0)
 ..I VEFANOTF=VEFAALNT D
"RTN","VEFAALR9",328,0)
 ...I VEFACATY'=1 S VEFACATY=2
"RTN","VEFAALR9",329,0)
 ...S VEFACATN=$P($G(^DIZ(19008,VEFACNT,0)),"^",1)
"RTN","VEFAALR9",330,0)
 ...I VEFADSPL[VEFACATN D
"RTN","VEFAALR9",331,0)
 ....I VEFACATY'=1 S VEFACATY=3
"RTN","VEFAALR9",332,0)
 ....; LOOP THROUGH UNIQUE VEFA TRACKED CRITICAL ALERTS
"RTN","VEFAALR9",333,0)
 ....S VEFAUTCA=0
"RTN","VEFAALR9",334,0)
 ....F  S VEFAUTCA=$O(^DIZ(19007,"B",VEFAUTCA)) Q:(VEFAUTCA="")!(VEFACATY=1)  D
"RTN","VEFAALR9",335,0)
 .....;GET ENTRY
"RTN","VEFAALR9",336,0)
 .....S VEFAENTR=0
"RTN","VEFAALR9",337,0)
 .....;MOD 8/9/2014 GOW CHECK FOR DUPLICATE ALERT TYPES
"RTN","VEFAALR9",338,0)
 .....;S VEFAENTR=$O(^DIZ(19007,"B",VEFAUTCA,VEFAENTR))
"RTN","VEFAALR9",339,0)
 .....F  S VEFAENTR=$O(^DIZ(19007,"B",VEFAUTCA,VEFAENTR)) Q:(VEFAENTR="")!(VEFACATY=1)  D
"RTN","VEFAALR9",340,0)
 ......S VEFANAME=$P(^DIZ(19007,VEFAENTR,0),"^",1)
"RTN","VEFAALR9",341,0)
 ......;MOD 8/7/14 GOW GET ALERT CATEGORY POINTER
"RTN","VEFAALR9",342,0)
 ......S VEFACATT=$P(^DIZ(19007,VEFAENTR,3),"^",3)
"RTN","VEFAALR9",343,0)
 ......;I (VEFADSPL[VEFANAME)S VEFACATY=1
"RTN","VEFAALR9",344,0)
 ......I (VEFADSPL[VEFANAME)&(VEFACATT=VEFACNT) S VEFACATY=1
"RTN","VEFAALR9",345,0)
 .....;END MOD
"RTN","VEFAALR9",346,0)
 I (VEFACATY=2)!(VEFACATY=3) S VEFACATY=0
"RTN","VEFAALR9",347,0)
 Q VEFACATN_"^"_VEFANAME
"RTN","VEFAALR9",348,0)
ORDERCK2(X) ;
"RTN","VEFAALR9",349,0)
 ;RETURN LIST OF ORDER FOLLOWUP ACTION THAT HAVE BEEN DONE. FROM ACKNOWLEDGED (DELETED) ALERT DATE TIME OR CURENT TIME BACK TO DATE OF ALERT
"RTN","VEFAALR9",350,0)
 N D0,RY,VEFADFN,VEFAPRV,VEFADTIM,VEFARETN,VEFAFOLP,ZP,RY,VEFADSPL,VEFADELD
"RTN","VEFAALR9",351,0)
 N VEFANAME
"RTN","VEFAALR9",352,0)
 S D0=X
"RTN","VEFAALR9",353,0)
 S VEFADFN=$P($G(^XTV(8992.1,D0,0)),"^",4)
"RTN","VEFAALR9",354,0)
 S VEFADTIM=$P($P($G(^XTV(8992.1,D0,0)),"^",1),";",3)
"RTN","VEFAALR9",355,0)
 S VEFARETN=$$SERVIC1^VEFAALR1(X)
"RTN","VEFAALR9",356,0)
 S VEFANAME=$P(VEFARETN,"^",3)
"RTN","VEFAALR9",357,0)
 S VEFAPRV=$P(VEFARETN,"^",2)
"RTN","VEFAALR9",358,0)
 S VEFADSPL=$P($G(^XTV(8992.1,D0,0)),"^",1)
"RTN","VEFAALR9",359,0)
 ;W !,"VEFADSPL=",VEFADSPL
"RTN","VEFAALR9",360,0)
 ;GET ACKNOWLEDGED(DELETED) DATE (IF ANY)
"RTN","VEFAALR9",361,0)
 S VEFADELD=$$STATUS1^VEFAALR1(X)
"RTN","VEFAALR9",362,0)
 S VEFADELD="" ; $P(VEFADELD,"^",3) 2/24/15
"RTN","VEFAALR9",363,0)
 S ZP=VEFADFN_"^"_VEFAPRV_"^"_VEFANAME_"^"_VEFADTIM_"^"_VEFADELD
"RTN","VEFAALR9",364,0)
 ;W !,"ZP=",ZP
"RTN","VEFAALR9",365,0)
 S RY=""
"RTN","VEFAALR9",366,0)
 D LKPORDCK^VEFAALR4(.RY,ZP)  ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and RETURN list of 
"RTN","VEFAALR9",367,0)
 ;any ORDERS by ordering provider user (DUZ) that have been made from list of available FAT (Follow-up Alert Tracking) orders in in specifi defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALR9",368,0)
 ; multiples(and fields)with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list 
"RTN","VEFAALR9",369,0)
 ;to be compared with any actual orders NOT by any ordering provider user(s) (DUZ) made after the date/time of the actual critical alert UP to NOW or
"RTN","VEFAALR9",370,0)
 ;to date of acknowledgement(deletion) OR now time (if not passed). Do this search in reverse chronological order.
"RTN","VEFAALR9",371,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALR9",372,0)
 ; INPUT 
"RTN","VEFAALR9",373,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT ^ DATE ACKNOWLEDGED(DELETED) 
"RTN","VEFAALR9",374,0)
 ; RETURN
"RTN","VEFAALR9",375,0)
 ;  RY= ORDERING PROVIDER OF ORDER/FOLLOW-UP ACTION (IF ANY) THEN "*" AND ACKGT7D FLAG(0 OR 1) THEN "*" AND * FOLLGT7D ( 0 OR 1))
"RTN","VEFAALR9",376,0)
 ;  FOLLOWED BY ";" AND THEN CONCATENATED STRING OF ACTUAL ORDERS MADE EACH SEPARATED WITH ";"
"RTN","VEFAALR9",377,0)
 ;  EACH FOLLOWED UP ACTION HAS SECONDARY PIECE DELIMITED BY '*" FOR DATE/TIME OF FOLLOWUP ACTION ACTIVITY
"RTN","VEFAALR9",378,0)
 ;
"RTN","VEFAALR9",379,0)
 Q RY
"RTN","VEFAALR9",380,0)
ALERTVAL(D0) ;
"RTN","VEFAALR9",381,0)
 N RET,ALERTDT,ALERTSDT,ALERTEDT,DISPLYTX,TEST,DFN,TYPLAB,TESTDT
"RTN","VEFAALR9",382,0)
 ;
"RTN","VEFAALR9",383,0)
 N ITEM
"RTN","VEFAALR9",384,0)
 ;MOD 8/8/14 GOW
"RTN","VEFAALR9",385,0)
 N OVER
"RTN","VEFAALR9",386,0)
 ;END MOD
"RTN","VEFAALR9",387,0)
 ;GET ALERT DATE/TIME
"RTN","VEFAALR9",388,0)
 ;ALERT ID REPRESENTATION AS IN "OR,3,57;20364;3140209.164349"
"RTN","VEFAALR9",389,0)
 ;GET NOTIFICATION TYPE
"RTN","VEFAALR9",390,0)
 ; IF CRITICAL LABS USE LAB API TO RETURN ALERT VALUES
"RTN","VEFAALR9",391,0)
 S RET=""
"RTN","VEFAALR9",392,0)
 S DISPLYTX=$P($G(^XTV(8992.1,D0,1)),"^",1)
"RTN","VEFAALR9",393,0)
 S DFN=$P($G(^XTV(8992.1,D0,0)),"^",4)
"RTN","VEFAALR9",394,0)
 I DISPLYTX["Critical labs -" D
"RTN","VEFAALR9",395,0)
 .;
"RTN","VEFAALR9",396,0)
 .K ^TMP("LRRR",$J)
"RTN","VEFAALR9",397,0)
 .S TEST=$P(DISPLYTX,"[",2) S TEST=$P(TEST,"]",1)
"RTN","VEFAALR9",398,0)
 .S TYPLAB=$P($G(^XTV(8992.1,D0,2)),";",4)  ; IE CH,MI,AP,BB ETC
"RTN","VEFAALR9",399,0)
 .S ALERTEDT=$P($G(^XTV(8992.1,D0,2)),";",5) S ALERTEDT=$P(ALERTEDT,"@",1) ;REVERSE TIME
"RTN","VEFAALR9",400,0)
 .S TESTDT=ALERTEDT
"RTN","VEFAALR9",401,0)
 .;CONVERT TO REGULAR DATE/TIME
"RTN","VEFAALR9",402,0)
 .S X1=9999999 S X1=X1-ALERTEDT S ALERTSDT=X1 S X2=.01 D C^%DTC S ALERTEDT=X
"RTN","VEFAALR9",403,0)
 .S X1=ALERTSDT S X2=-.01 D C^%DTC S ALERTSDT=X
"RTN","VEFAALR9",404,0)
 .;W !,"DFN=",DFN," ALERTSDT=",ALERTSDT," ALERTEDT=",ALERTEDT," TYPLAB=",TYPLAB," TEST=",TEST
"RTN","VEFAALR9",405,0)
 .;D RR^LR7OR1(DFN,,SDATE,EDATE,"CH",TEST,,,,)
"RTN","VEFAALR9",406,0)
 .;D NOW^%DTC S ALERTEDT=%
"RTN","VEFAALR9",407,0)
 .D RR^LR7OR1(DFN,,ALERTSDT,ALERTEDT,TYPLAB,TEST,,,,)
"RTN","VEFAALR9",408,0)
 .;W !
"RTN","VEFAALR9",409,0)
 .;ZW ^TMP("LRRR",$J)
"RTN","VEFAALR9",410,0)
 .S ITEM=0
"RTN","VEFAALR9",411,0)
 .;MOD 8/8/14  GOW
"RTN","VEFAALR9",412,0)
 .S OVER=0
"RTN","VEFAALR9",413,0)
 .;F  S ITEM=$O(^TMP("LRRR",$J,DFN,"CH",TESTDT,ITEM)) Q:(ITEM="")!(ITEM="N")  D
"RTN","VEFAALR9",414,0)
 .F  S ITEM=$O(^TMP("LRRR",$J,DFN,"CH",TESTDT,ITEM)) Q:(ITEM="")!(ITEM="N")!(OVER=1)  D
"RTN","VEFAALR9",415,0)
 ..;END MOD
"RTN","VEFAALR9",416,0)
 ..S RET=$P($G(^TMP("LRRR",$J,DFN,"CH",TESTDT,ITEM)),"^",2)_" "_$P($G(^TMP("LRRR",$J,DFN,"CH",TESTDT,ITEM)),"^",3)
"RTN","VEFAALR9",417,0)
 ..;MOD 8/8/14 GOW
"RTN","VEFAALR9",418,0)
 ..;CHOOSE FIRST CRITICAL ( POSITIVE) VALUE FOR ANY XN SUCH X3(MEANING 3 REPEAT TESTS)
"RTN","VEFAALR9",419,0)
 ..;LIKE FOR OCCULT BLOOD X3 MAILER LAB TEST
"RTN","VEFAALR9",420,0)
 ..I $P($G(^TMP("LRRR",$J,DFN,"CH",TESTDT,ITEM)),"^",3)'="" S OVER=1
"RTN","VEFAALR9",421,0)
 .;S RET=
"RTN","VEFAALR9",422,0)
 .;I (RET'="")&(TEST="PROSTATE SPECIFIC ANTIGEN") S RET="PSA POSITIVE"  ; SINCE SIMULATED LAB TESTER USES NUMERIC VALUES 
"RTN","VEFAALR9",423,0)
 .I (RET'="")&(TEST="OCCULT BLOOD") S RET="POSITIVE"  ; SINCE SIMULATED LAB TESTER USES NUMERIC VALUES 
"RTN","VEFAALR9",424,0)
 .;AS METHOD FOR GENERATING ALERTS. IN PRODUCTION RESULTS WILL ALREADY BE ASCII VALUE "POSITIVE" NOT NUMERIC VALUE
"RTN","VEFAALR9",425,0)
 .K ^TMP("LRRR",$J)
"RTN","VEFAALR9",426,0)
 ;ABNORMAL IMAGING SET BELOW
"RTN","VEFAALR9",427,0)
 I DISPLYTX["Abnl Imaging Reslt, Needs Attn:" S RET="ABNORMAL"
"RTN","VEFAALR9",428,0)
 ;MOD 8/8/14 GOW 
"RTN","VEFAALR9",429,0)
 I DISPLYTX["Amended/Abnormal Imaging Results:" S RET="ABNORMAL"
"RTN","VEFAALR9",430,0)
 ;END MOD
"RTN","VEFAALR9",431,0)
 Q RET
"RTN","VEFAALRA")
0^22^B103624988
"RTN","VEFAALRA",1,0)
VEFAALRA ;GOW/THC VEFA - Module for AWARE KB Editor Validator. GETPROG, READPROG, LKPORD
"RTN","VEFAALRA",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALRA",3,0)
 ;; 
"RTN","VEFAALRA",4,0)
GETPROG(REC) ;
"RTN","VEFAALRA",5,0)
 N COUNT,COUNTS
"RTN","VEFAALRA",6,0)
 K ^TMP($J,"PROGNOTE")
"RTN","VEFAALRA",7,0)
 S COUNTS=0
"RTN","VEFAALRA",8,0)
 S COUNT=0 F  S COUNT=$O(^PXRMD(801.41,REC,25,COUNT)) Q:COUNT=""  D
"RTN","VEFAALRA",9,0)
 .S ^TMP($J,"PROGNOTE",COUNT)=$G(^PXRMD(801.41,REC,25,COUNT,0))
"RTN","VEFAALRA",10,0)
 .S COUNTS=COUNT
"RTN","VEFAALRA",11,0)
 S ^TMP($J,"PROGNOTE","COUNT")=COUNTS
"RTN","VEFAALRA",12,0)
 Q
"RTN","VEFAALRA",13,0)
WRITPROG(REC,SUBVAL,IENP) ;
"RTN","VEFAALRA",14,0)
 N COUNT,SUBREC,ICOUNTS,ICOUNT
"RTN","VEFAALRA",15,0)
 I SUBVAL="19007.01" S SUBREC=1
"RTN","VEFAALRA",16,0)
 I SUBVAL="19007.02" S SUBREC=2
"RTN","VEFAALRA",17,0)
 I SUBVAL="19007.03" S SUBREC=4
"RTN","VEFAALRA",18,0)
 S COUNT=$G(^TMP($J,"PROGNOTE","COUNT"))
"RTN","VEFAALRA",19,0)
 I COUNT=0 D
"RTN","VEFAALRA",20,0)
 .K ^DIZ(19007,REC,SUBREC,IENP,2)
"RTN","VEFAALRA",21,0)
 .I SUBVAL="19007.01" S ^DIZ(19007,REC,SUBREC,IENP,2,0)="^19007.15^^^"
"RTN","VEFAALRA",22,0)
 .I SUBVAL="19007.02" S ^DIZ(19007,REC,SUBREC,IENP,2,0)="^19007.25^^^"
"RTN","VEFAALRA",23,0)
 .I SUBVAL="19007.03" S ^DIZ(19007,REC,SUBREC,IENP,2,0)="^19007.35^^^"
"RTN","VEFAALRA",24,0)
 E  D
"RTN","VEFAALRA",25,0)
 .S ICOUNTS=""
"RTN","VEFAALRA",26,0)
 .K ^DIZ(19007,REC,SUBREC,IENP,2)
"RTN","VEFAALRA",27,0)
 .S ICOUNT=0 F  S ICOUNT=$O(^TMP($J,"PROGNOTE",ICOUNT)) Q:(ICOUNT="")!(ICOUNT="COUNT")  D
"RTN","VEFAALRA",28,0)
 ..S ^DIZ(19007,REC,SUBREC,IENP,2,ICOUNT,0)=$G(^TMP($J,"PROGNOTE",ICOUNT))
"RTN","VEFAALRA",29,0)
 ..S ICOUNTS=ICOUNT
"RTN","VEFAALRA",30,0)
 .I SUBVAL="19007.01" S ^DIZ(19007,REC,SUBREC,IENP,2,0)="^19007.15^"_ICOUNTS_"^"_ICOUNTS_"^"_DT_"^"
"RTN","VEFAALRA",31,0)
 .I SUBVAL="19007.02" S ^DIZ(19007,REC,SUBREC,IENP,2,0)="^19007.25^"_ICOUNTS_"^"_ICOUNTS_"^"_DT_"^"
"RTN","VEFAALRA",32,0)
 .I SUBVAL="19007.03" S ^DIZ(19007,REC,SUBREC,IENP,2,0)="^19007.35^"_ICOUNTS_"^"_ICOUNTS_"^"_DT_"^"
"RTN","VEFAALRA",33,0)
 K ^TMP($J,"PROGNOTE")
"RTN","VEFAALRA",34,0)
 Q
"RTN","VEFAALRA",35,0)
TEST1 ;
"RTN","VEFAALRA",36,0)
 D GETPROG(495)  ; GET PROGRESS NOTE TEXT FROM REMINDER DIALOG ELEMENT
"RTN","VEFAALRA",37,0)
 D WRITPROG(2,"19007.01",2) ;WRITE INTO ALERT TYPE FILE
"RTN","VEFAALRA",38,0)
 Q
"RTN","VEFAALRA",39,0)
TEST(VEFADFN) ;
"RTN","VEFAALRA",40,0)
 N RY,VEFAADTT,VISITPTR
"RTN","VEFAALRA",41,0)
 ;
"RTN","VEFAALRA",42,0)
 N COUNTER1,FOLLOWUP,OVERFLAG,REVERST,VHEALFT,VHEALTH
"RTN","VEFAALRA",43,0)
 S RY=0
"RTN","VEFAALRA",44,0)
 D
"RTN","VEFAALRA",45,0)
 .D
"RTN","VEFAALRA",46,0)
 ..D
"RTN","VEFAALRA",47,0)
 ...D
"RTN","VEFAALRA",48,0)
 ....D
"RTN","VEFAALRA",49,0)
 .....S VHEALTH=""
"RTN","VEFAALRA",50,0)
 .....S VEFAADTT=3110504.0117
"RTN","VEFAALRA",51,0)
 .....S OVERFLAG=0
"RTN","VEFAALRA",52,0)
 .....F  S VHEALTH=$O(^AUPNVHF("C",VEFADFN,VHEALTH),-1) Q:(VHEALTH="")!(OVERFLAG=1)  D
"RTN","VEFAALRA",53,0)
 ......S VISITPTR=$P($G(^AUPNVHF(VHEALTH,0)),"^",3)
"RTN","VEFAALRA",54,0)
 ......I VISITPTR'="" S REVERST=$P($G(^AUPNVSIT(VISITPTR,0)),"^",1)
"RTN","VEFAALRA",55,0)
 ......W !,"REVERST=",REVERST
"RTN","VEFAALRA",56,0)
 ......I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALRA",57,0)
 ......S VHEALFT=$P($G(^AUPNVHF(VHEALTH,0)),"^",1)
"RTN","VEFAALRA",58,0)
 ......;CHECK IF THIS HEALTH FACTOR WITHIN DATE/TIME ALLOWED IS ONE OF FOLLOWUP ACTION HEALTH FACTORS
"RTN","VEFAALRA",59,0)
 ......S COUNTER1=0
"RTN","VEFAALRA",60,0)
 ......F  S COUNTER1=$O(^TMP($J,"FOLLOWUPITEM",COUNTER1)) Q:(COUNTER1="")  D
"RTN","VEFAALRA",61,0)
 .......S FOLLOWUP=$G(^TMP($J,"FOLLOWUPITEM",COUNTER1))
"RTN","VEFAALRA",62,0)
 .......W !,"FOLLOWUP=",FOLLOWUP
"RTN","VEFAALRA",63,0)
 .......W !,"VHEALFT=",VHEALFT
"RTN","VEFAALRA",64,0)
 .......I FOLLOWUP[VHEALFT D
"RTN","VEFAALRA",65,0)
 ........W !,FOLLOWUP
"RTN","VEFAALRA",66,0)
 ........S RY=2_"^"_1
"RTN","VEFAALRA",67,0)
 Q RY
"RTN","VEFAALRA",68,0)
LKPORD(RY,ZP) ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and check whether 
"RTN","VEFAALRA",69,0)
 ;any ORDERS by ordering provider user (DUZ)have been made from list of orders in in a possible defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALRA",70,0)
 ;(field), and with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list to be compared with any actual orders 
"RTN","VEFAALRA",71,0)
 ;by this user (DUZ) made after the date/time of the actual critical alert. 
"RTN","VEFAALRA",72,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALRA",73,0)
 ; if 
"RTN","VEFAALRA",74,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT  ^ DELETED DATE/IME
"RTN","VEFAALRA",75,0)
 ;  RY= 0 (1ST PIECE=0) NO ORDERS FOUND YET
"RTN","VEFAALRA",76,0)
 ;  RY= 0_"^"_3  ; (1ST PIECE=0)MEANS ORDER(S) FOUND BUT NONE NOT COMPLETED OR READY FOR SIG OR NONE OF THOSE COMPLETED WITH SIG REQUIRED HAVE SIGNATURE
"RTN","VEFAALRA",77,0)
 ;  RY =2_"^"_1  (1ST PIECE=2) if at least one ORDER OR FOLLOWUP ACTION found satisfying criteria complete/signed
"RTN","VEFAALRA",78,0)
 ;  RY= 3_"^"_2  ;(1ST PIECE=3) MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALRA",79,0)
 ;  RY= 3_"^"_3  ; (1ST PIECE=3)MEANS NO REMINDER DIALOG FOUND IN ALERT TRACKINg FILE FOR THIS TYPE OF ALERT
"RTN","VEFAALRA",80,0)
 ;
"RTN","VEFAALRA",81,0)
 N VEFADFN,VEFADUZ,VEFAALRT,VEFAADTT,VEFARMDL
"RTN","VEFAALRA",82,0)
 N VEFACNT,VEFACNT1,VEFACNT2
"RTN","VEFAALRA",83,0)
 N DISABLE,REMDIALG,DIALOGTY,DIALOGEL,RESOLTYP,ORDRITM,COUNTER,CNTORD,CNT1,ORDER,CNTTIMO,CNTTIMA,REVERST,CNTPAT,ORDERCK
"RTN","VEFAALRA",84,0)
 N RYY,ACTION,ACTIONK,SIGSTAT
"RTN","VEFAALRA",85,0)
 N FOLLUPCT,FOLLOWAC
"RTN","VEFAALRA",86,0)
 N VHEALTH,OVERFLAG,VHEALF,FOLLOWUP,VISITPTR
"RTN","VEFAALRA",87,0)
 N DELETEDT
"RTN","VEFAALRA",88,0)
 N ACTIVE,COUNTER1,ORDERITEM,REMTYPE,VHEALFT
"RTN","VEFAALRA",89,0)
 N INITDATE
"RTN","VEFAALRA",90,0)
 ;K RY
"RTN","VEFAALRA",91,0)
 S RY=0
"RTN","VEFAALRA",92,0)
 S COUNTER=0 ; FOR ORDERS
"RTN","VEFAALRA",93,0)
 S COUNTER1=0  ; FOR FOLLOWUP ACTIONS
"RTN","VEFAALRA",94,0)
 K ^TMP($J,"ORDERITEM")
"RTN","VEFAALRA",95,0)
 K ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALRA",96,0)
 S VEFADFN=$P(ZP,U,1) S VEFADUZ=$P(ZP,U,2) S VEFAALRT=$P(ZP,U,3) S VEFAADTT=$P(ZP,U,4) S DELETEDT=$P(ZP,U,5)
"RTN","VEFAALRA",97,0)
 ;
"RTN","VEFAALRA",98,0)
 ;first CHECK if type of alert if in VEFA ALERT TRACKING file
"RTN","VEFAALRA",99,0)
 S VEFACNT=0
"RTN","VEFAALRA",100,0)
 ;
"RTN","VEFAALRA",101,0)
 S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALRA",102,0)
 S ACTIVE=0
"RTN","VEFAALRA",103,0)
 S INITDATE=0
"RTN","VEFAALRA",104,0)
 I VEFACNT'="" D
"RTN","VEFAALRA",105,0)
 .S ACTIVE=$P($G(^DIZ(19007,VEFACNT,3)),"^",5)
"RTN","VEFAALRA",106,0)
 .I ACTIVE="" S ACTIVE=0
"RTN","VEFAALRA",107,0)
 .S INITDATE=$P($G(^DIZ(19007,VEFACNT,3)),"^",4)
"RTN","VEFAALRA",108,0)
 .I INITDATE="" S INITDATE=0
"RTN","VEFAALRA",109,0)
 ;I (VEFACNT'="")&(ACTIVE) D
"RTN","VEFAALRA",110,0)
 I (VEFACNT'="")&(INITDATE'=0)&(VEFAADTT>INITDATE) D
"RTN","VEFAALRA",111,0)
 .;
"RTN","VEFAALRA",112,0)
 .; RECORD # in VEFA TRACKED ALERTS file
"RTN","VEFAALRA",113,0)
 .; get reminder dialog 
"RTN","VEFAALRA",114,0)
 .S VEFARMDL=$P($G(^DIZ(19007,VEFACNT,3)),U,1) ;
"RTN","VEFAALRA",115,0)
 .I VEFARMDL'="" D
"RTN","VEFAALRA",116,0)
 ..;
"RTN","VEFAALRA",117,0)
 ..;GO TO FILE 801.41
"RTN","VEFAALRA",118,0)
 ..;CHECK IF DISABLED
"RTN","VEFAALRA",119,0)
 ..S DISABLE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,3)
"RTN","VEFAALRA",120,0)
 ..I (DISABLE=0)!(DISABLE="") D
"RTN","VEFAALRA",121,0)
 ...;
"RTN","VEFAALRA",122,0)
 ...;CHECK REMINDER TYPE AS "REMINDER DIALOG"
"RTN","VEFAALRA",123,0)
 ...S REMTYPE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,4)
"RTN","VEFAALRA",124,0)
 ...I REMTYPE="R" D
"RTN","VEFAALRA",125,0)
 ....;
"RTN","VEFAALRA",126,0)
 ....; LOOK THROUGH DIALOG GROUPS AND THEIR ELEMENTS TO FIND ORDERABLE ANY ORDER ITEMS.
"RTN","VEFAALRA",127,0)
 ....S VEFACNT=0
"RTN","VEFAALRA",128,0)
 ....F  S VEFACNT=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT)) Q:VEFACNT=""  D
"RTN","VEFAALRA",129,0)
 .....;GET INTERNAL ENTRY #
"RTN","VEFAALRA",130,0)
 .....S VEFACNT1=0
"RTN","VEFAALRA",131,0)
 .....S VEFACNT1=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT,VEFACNT1))
"RTN","VEFAALRA",132,0)
 .....;
"RTN","VEFAALRA",133,0)
 .....I VEFACNT1'="" D
"RTN","VEFAALRA",134,0)
 ......; GET DIALOG GROUP OR DIRECT DIALOG ELEMENT (ASSUME FOR NOW ONLY DIALOG GROUP WITH ORDERS)
"RTN","VEFAALRA",135,0)
 ......S REMDIALG=$P($G(^PXRMD(801.41,VEFARMDL,10,VEFACNT1,0)),U,2)
"RTN","VEFAALRA",136,0)
 ......;
"RTN","VEFAALRA",137,0)
 ......I REMDIALG'="" D
"RTN","VEFAALRA",138,0)
 .......; CHECK IF DIALOG GROUP
"RTN","VEFAALRA",139,0)
 .......S DIALOGTY=$P($G(^PXRMD(801.41,REMDIALG,0)),U,4)
"RTN","VEFAALRA",140,0)
 .......I DIALOGTY="G" D   ; DIALOG GROUP
"RTN","VEFAALRA",141,0)
 ........;
"RTN","VEFAALRA",142,0)
 ........S VEFACNT2=0 ; GET DIALOG ELEMENTS INSIDE THIS DIALOG GROUP
"RTN","VEFAALRA",143,0)
 ........F  S VEFACNT2=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2)) Q:VEFACNT2=""  D
"RTN","VEFAALRA",144,0)
 .........;GET INTERNAL ENTRY #
"RTN","VEFAALRA",145,0)
 .........S DIALOGEL=0
"RTN","VEFAALRA",146,0)
 .........S DIALOGEL=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2,DIALOGEL))
"RTN","VEFAALRA",147,0)
 .........; DIALOG ELEMENT
"RTN","VEFAALRA",148,0)
 .........;
"RTN","VEFAALRA",149,0)
 .........S DIALOGEL=$P($G(^PXRMD(801.41,REMDIALG,10,DIALOGEL,0)),U,2)
"RTN","VEFAALRA",150,0)
 .........;
"RTN","VEFAALRA",151,0)
 .........;CHECK "ORDER" RESOLUTION TYPE FIRST
"RTN","VEFAALRA",152,0)
 .........S RESOLTYP=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,3)
"RTN","VEFAALRA",153,0)
 .........I RESOLTYP=3 D
"RTN","VEFAALRA",154,0)
 ..........;GET ORDERABLE ITEMS FILE ENTRY AS POSSIBLE FOLLOW-UP ACTION CHOICE. STORE INTO ^TMP($J,"ORDERITEM,COUNTER) ARRAY
"RTN","VEFAALRA",155,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7)
"RTN","VEFAALRA",156,0)
 ..........; NOW LOOK AT ORDERS IF ANY AND CHECK DATE/TIME > DATE/TIME OF PASSED CRIT ALERT
"RTN","VEFAALRA",157,0)
 ..........S COUNTER=COUNTER+1
"RTN","VEFAALRA",158,0)
 ..........;
"RTN","VEFAALRA",159,0)
 ..........S ^TMP($J,"ORDERITEM",COUNTER)=ORDERITEM
"RTN","VEFAALRA",160,0)
 ..........;new section
"RTN","VEFAALRA",161,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALRA",162,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALRA",163,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALRA",164,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALRA",165,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALRA",166,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALRA",167,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALRA",168,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALRA",169,0)
 ..........;end section
"RTN","VEFAALRA",170,0)
 .........E  D
"RTN","VEFAALRA",171,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALRA",172,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALRA",173,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALRA",174,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALRA",175,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALRA",176,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALRA",177,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALRA",178,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALRA",179,0)
 ....;  NOW GET ORDERS BY PATIENT AND PROVIDER (DUZ) DOESN'T CARE AS ORDER COULD BE MADE AMONG ANY PROVIDE IN OE/RR GROUP DEFINED
"RTN","VEFAALRA",180,0)
 ....; FOR SPECIFIC CRIT ALERT PROCESSING.BUT SHOULD MOST LIKELY BE MADE BY ORDERING PROVIDER. GET ORDERS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALRA",181,0)
 ....;UNTIL DATE/TIME OF ANY ORDER < 
"RTN","VEFAALRA",182,0)
 ....;DATE/TIME OF CRIT ALERT,OR NO ORDER FOUND IS ENCOUNTERED. SEARCH AMONG ORDERITEM LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALRA",183,0)
 ....;GO BY PATIENT FIRST
"RTN","VEFAALRA",184,0)
 ....S CNTTIMO=0  ; DATE/TIME OF ORDER ABD CNTTIMA DATE/TIME OF UNACK CRIT ALERT
"RTN","VEFAALRA",185,0)
 ....S CNTPAT=VEFADFN_";DPT("
"RTN","VEFAALRA",186,0)
 ....;
"RTN","VEFAALRA",187,0)
 ....F  S CNTTIMO=$O(^OR(100,"AC",CNTPAT,CNTTIMO)) S REVERST=9999999-CNTTIMO Q:(CNTTIMO="")!(VEFAADTT>REVERST)!(RY="0_""^""_3")!(RY="2_""^""_1")  D
"RTN","VEFAALRA",188,0)
 .....S ORDER=0
"RTN","VEFAALRA",189,0)
 .....I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALRA",190,0)
 .....S ORDER=$O(^OR(100,"AC",CNTPAT,CNTTIMO,ORDER))
"RTN","VEFAALRA",191,0)
 .....;
"RTN","VEFAALRA",192,0)
 .....I ORDER'="" D
"RTN","VEFAALRA",193,0)
 ......;
"RTN","VEFAALRA",194,0)
 ......S CNT1=0  ; SEARCH MULTIPLE ORDERABLE ITEMS WITHIN 1 ORDER
"RTN","VEFAALRA",195,0)
 ......F  S CNT1=$O(^OR(100,ORDER,.1,"B",CNT1)) Q:(CNT1="")  D
"RTN","VEFAALRA",196,0)
 .......S CNTORD=CNT1
"RTN","VEFAALRA",197,0)
 .......;
"RTN","VEFAALRA",198,0)
 .......;S CNTORD=$P($G(^OR(100,ORDER,.1,CNT1,0)),"^",1)
"RTN","VEFAALRA",199,0)
 .......;CHECK IF AT LEAST ONE ORDERABLE ITEM OF ORDER AMONG LIST OF ORDERABLE ITEMS FOR FOLLOW-UP ACTION
"RTN","VEFAALRA",200,0)
 .......S COUNTER=0
"RTN","VEFAALRA",201,0)
 .......F  S COUNTER=$O(^TMP($J,"ORDERITEM",COUNTER)) Q:COUNTER=""  D
"RTN","VEFAALRA",202,0)
 ........S ORDERCK=$G(^TMP($J,"ORDERITEM",COUNTER))
"RTN","VEFAALRA",203,0)
 ........;
"RTN","VEFAALRA",204,0)
 ........I ORDERCK=CNTORD D
"RTN","VEFAALRA",205,0)
 .........S RYY=2  ; FOUND
"RTN","VEFAALRA",206,0)
 .........S SIGSTAT=1
"RTN","VEFAALRA",207,0)
 .........;NOT CHECK IF SIGNATURE REQUIRED AND SIGNATURE ITSELF
"RTN","VEFAALRA",208,0)
 .........I $P($G(^OR(100,ORDER,0)),"^",16)=2 D      ;ORES
"RTN","VEFAALRA",209,0)
 ..........S ACTION=0
"RTN","VEFAALRA",210,0)
 ..........S SIGSTAT=0
"RTN","VEFAALRA",211,0)
 ..........F  S ACTION=$O(^OR(100,ORDER,8,ACTION)) Q:(ACTION="")!(ACTION="C")  D
"RTN","VEFAALRA",212,0)
 ...........S ACTIONK=ACTION
"RTN","VEFAALRA",213,0)
 ...........S SIGSTAT=$P($G(^OR(100,ORDER,8,ACTION,0)),"^",4)
"RTN","VEFAALRA",214,0)
 ..........; CHECK FOR SIG STAT=1 FOR SIGNED ORDER ("ELECTRONIC") 
"RTN","VEFAALRA",215,0)
 ..........I RY'[1 S RY=RYY_"^"_SIGSTAT  ;SIGSTAT = 1 MEANS NO SIG REQUIRED OR SIG REQUIRED AND FOUND 
"RTN","VEFAALRA",216,0)
 .........E  D
"RTN","VEFAALRA",217,0)
 ..........S RY=RYY_"^"_1
"RTN","VEFAALRA",218,0)
 .........;
"RTN","VEFAALRA",219,0)
 ......;
"RTN","VEFAALRA",220,0)
 ......I RY'=0 I RY'[1 S RY=0_"^"_3      ; IE. IF RY NOT= 2_"^"_1 S RY=0_"^"_3
"RTN","VEFAALRA",221,0)
 ....;
"RTN","VEFAALRA",222,0)
 ....I RY=0 D
"RTN","VEFAALRA",223,0)
 .....;
"RTN","VEFAALRA",224,0)
 .....;  NOW GET V HEALTH FACTORS BY PATIENT 
"RTN","VEFAALRA",225,0)
 .....; FOR SPECIFIC CRIT ALERT PROCESSING.GET V HEALTH FACTORS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALRA",226,0)
 .....;UNTIL DATE/TIME OF ANY FOLLOWUP ACTION (V HEALTH FACTOR)< 
"RTN","VEFAALRA",227,0)
 .....;DATE/TIME OF CRIT ALERT,OR NO V  HEALTH FACTOR FOUND IS ENCOUNTERED. SEARCH AMONG FOLLOWUP LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALRA",228,0)
 .....;GO BY PATIENT FIRST
"RTN","VEFAALRA",229,0)
 .....S VHEALTH=""
"RTN","VEFAALRA",230,0)
 .....S OVERFLAG=0
"RTN","VEFAALRA",231,0)
 .....F  S VHEALTH=$O(^AUPNVHF("C",VEFADFN,VHEALTH),-1) Q:(VHEALTH="")!(OVERFLAG=1)  D
"RTN","VEFAALRA",232,0)
 ......S VISITPTR=$P($G(^AUPNVHF(VHEALTH,0)),"^",3)
"RTN","VEFAALRA",233,0)
 ......I VISITPTR'="" S REVERST=$P($G(^AUPNVSIT(VISITPTR,0)),"^",1)
"RTN","VEFAALRA",234,0)
 ......;
"RTN","VEFAALRA",235,0)
 ......;
"RTN","VEFAALRA",236,0)
 ......I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALRA",237,0)
 ......I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALRA",238,0)
 ......S VHEALFT=$P($G(^AUPNVHF(VHEALTH,0)),"^",1)
"RTN","VEFAALRA",239,0)
 ......;
"RTN","VEFAALRA",240,0)
 ......;CHECK IF THIS HEALTH FACTOR WITHIN DATE/TIME ALLOWED IS ONE OF FOLLOWUP ACTION HEALTH FACTORS
"RTN","VEFAALRA",241,0)
 ......S COUNTER1=0
"RTN","VEFAALRA",242,0)
 ......F  S COUNTER1=$O(^TMP($J,"FOLLOWUPITEM",COUNTER1)) Q:(COUNTER1="")  D
"RTN","VEFAALRA",243,0)
 .......S FOLLOWUP=$G(^TMP($J,"FOLLOWUPITEM",COUNTER1))
"RTN","VEFAALRA",244,0)
 .......;
"RTN","VEFAALRA",245,0)
 .......I FOLLOWUP[VHEALFT D
"RTN","VEFAALRA",246,0)
 ........S RY=2_"^"_1
"RTN","VEFAALRA",247,0)
 ....;
"RTN","VEFAALRA",248,0)
 ....;
"RTN","VEFAALRA",249,0)
 ....;
"RTN","VEFAALRA",250,0)
 ....;
"RTN","VEFAALRA",251,0)
 .E  D
"RTN","VEFAALRA",252,0)
 ..S RY=3_"^"_3  ; MEANS NO REMINDER DIALOG FOUND
"RTN","VEFAALRA",253,0)
 E  D
"RTN","VEFAALRA",254,0)
 .S RY=3_"^"_2  ; MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALRA",255,0)
 Q
"RTN","VEFAALRE")
0^7^B244082712
"RTN","VEFAALRE",1,0)
VEFAALRE ;IHV/VEFA - RPC Routine for CPRS COM OBJECT [ 12/01/2010 ]
"RTN","VEFAALRE",2,0)
 ;;1.0;VEFA;**1**;1-MAY-11;Build 33
"RTN","VEFAALRE",3,0)
 ;
"RTN","VEFAALRE",4,0)
LKPORD(RY,ZP) ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and check whether 
"RTN","VEFAALRE",5,0)
 ;any ORDERS by ordering provider user (DUZ)have been made from list of orders in in a possible defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALRE",6,0)
 ;(field), and with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list to be compared with any actual orders 
"RTN","VEFAALRE",7,0)
 ;by this user (DUZ) made after the date/time of the actual critical alert. 
"RTN","VEFAALRE",8,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALRE",9,0)
 ; if 
"RTN","VEFAALRE",10,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT 
"RTN","VEFAALRE",11,0)
 ;  RY= 0 (1ST PIECE=0) NO ORDERS FOUND YET
"RTN","VEFAALRE",12,0)
 ;  RY= 0_"^"_3  ; (1ST PIECE=0)MEANS ORDER(S) FOUND BUT NONE NOT COMPLETED OR READY FOR SIG OR NONE OF THOSE COMPLETED WITH SIG REQUIRED HAVE SIGNATURE
"RTN","VEFAALRE",13,0)
 ;  RY =2_"^"_1  (1ST PIECE=2) if at least one ORDER OR FOLLOWUP ACTION found satisfying criteria complete/signed
"RTN","VEFAALRE",14,0)
 ;  RY= 3_"^"_2  ;(1ST PIECE=3) MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALRE",15,0)
 ;  RY= 3_"^"_3  ; (1ST PIECE=3)MEANS NO REMINDER DIALOG FOUND IN ALERT TRACKINg FILE FOR THIS TYPE OF ALERT
"RTN","VEFAALRE",16,0)
 ;
"RTN","VEFAALRE",17,0)
 N VEFADFN,VEFADUZ,VEFAALRT,VEFAADTT,VEFARMDL
"RTN","VEFAALRE",18,0)
 N VEFACNT,VEFACNT1,VEFACNT2
"RTN","VEFAALRE",19,0)
 N DISABLE,REMDIALG,DIALOGTY,DIALOGEL,RESOLTYP,ORDRITM,COUNTER,CNTORD,CNT1,ORDER,CNTTIMO,CNTTIMA,REVERST,CNTPAT,ORDERCK
"RTN","VEFAALRE",20,0)
 N RYY,ACTION,ACTIONK,SIGSTAT
"RTN","VEFAALRE",21,0)
 N FOLLUPCT,FOLLOWAC
"RTN","VEFAALRE",22,0)
 N VHEALTH,OVERFLAG,VHEALF,FOLLOWUP,VISITPTR,ACTIVE
"RTN","VEFAALRE",23,0)
 N ORDERITEM,REMTYPE,VHEALFT
"RTN","VEFAALRE",24,0)
 ;K RY
"RTN","VEFAALRE",25,0)
 S RY=0
"RTN","VEFAALRE",26,0)
 S COUNTER=0 ; FOR ORDERS
"RTN","VEFAALRE",27,0)
 S COUNTER1=0  ; FOR FOLLOWUP ACTIONS
"RTN","VEFAALRE",28,0)
 K ^TMP($J,"ORDERITEM")
"RTN","VEFAALRE",29,0)
 K ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALRE",30,0)
 S VEFADFN=$P(ZP,U,1) S VEFADUZ=$P(ZP,U,2) S VEFAALRT=$P(ZP,U,3) S VEFAADTT=$P(ZP,U,4)
"RTN","VEFAALRE",31,0)
 ;
"RTN","VEFAALRE",32,0)
 ;first CHECK if type of alert if in VEFA ALERT TRACKING file
"RTN","VEFAALRE",33,0)
 S VEFACNT=0
"RTN","VEFAALRE",34,0)
 ;
"RTN","VEFAALRE",35,0)
 S ACTIVE=0
"RTN","VEFAALRE",36,0)
 ;CHECK IF ACTIVE
"RTN","VEFAALRE",37,0)
 S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALRE",38,0)
 I VEFACNT'="" D
"RTN","VEFAALRE",39,0)
 .S ACTIVE=$P($G(^DIZ(19007,VEFACNT,3)),"^",5)
"RTN","VEFAALRE",40,0)
 .I ACTIVE="" S ACTIVE=0
"RTN","VEFAALRE",41,0)
 I (VEFACNT'="")&(ACTIVE) D
"RTN","VEFAALRE",42,0)
 .;
"RTN","VEFAALRE",43,0)
 .; RECORD # in VEFA TRACKED ALERTS file
"RTN","VEFAALRE",44,0)
 .; get reminder dialog 
"RTN","VEFAALRE",45,0)
 .S VEFARMDL=$P($G(^DIZ(19007,VEFACNT,3)),U,1) ;
"RTN","VEFAALRE",46,0)
 .I VEFARMDL'="" D
"RTN","VEFAALRE",47,0)
 ..;
"RTN","VEFAALRE",48,0)
 ..;GO TO FILE 801.41
"RTN","VEFAALRE",49,0)
 ..;CHECK IF DISABLED
"RTN","VEFAALRE",50,0)
 ..S DISABLE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,3)
"RTN","VEFAALRE",51,0)
 ..I (DISABLE=0)!(DISABLE="") D
"RTN","VEFAALRE",52,0)
 ...;
"RTN","VEFAALRE",53,0)
 ...;CHECK REMINDER TYPE AS "REMINDER DIALOG"
"RTN","VEFAALRE",54,0)
 ...S REMTYPE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,4)
"RTN","VEFAALRE",55,0)
 ...I REMTYPE="R" D
"RTN","VEFAALRE",56,0)
 ....;
"RTN","VEFAALRE",57,0)
 ....; LOOK THROUGH DIALOG GROUPS AND THEIR ELEMENTS TO FIND ORDERABLE ANY ORDER ITEMS.
"RTN","VEFAALRE",58,0)
 ....S VEFACNT=0
"RTN","VEFAALRE",59,0)
 ....F  S VEFACNT=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT)) Q:VEFACNT=""  D
"RTN","VEFAALRE",60,0)
 .....;GET INTERNAL ENTRY #
"RTN","VEFAALRE",61,0)
 .....S VEFACNT1=0
"RTN","VEFAALRE",62,0)
 .....S VEFACNT1=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT,VEFACNT1))
"RTN","VEFAALRE",63,0)
 .....;
"RTN","VEFAALRE",64,0)
 .....I VEFACNT1'="" D
"RTN","VEFAALRE",65,0)
 ......; GET DIALOG GROUP OR DIRECT DIALOG ELEMENT (ASSUME FOR NOW ONLY DIALOG GROUP WITH ORDERS)
"RTN","VEFAALRE",66,0)
 ......S REMDIALG=$P($G(^PXRMD(801.41,VEFARMDL,10,VEFACNT1,0)),U,2)
"RTN","VEFAALRE",67,0)
 ......;
"RTN","VEFAALRE",68,0)
 ......I REMDIALG'="" D
"RTN","VEFAALRE",69,0)
 .......; CHECK IF DIALOG GROUP
"RTN","VEFAALRE",70,0)
 .......S DIALOGTY=$P($G(^PXRMD(801.41,REMDIALG,0)),U,4)
"RTN","VEFAALRE",71,0)
 .......I DIALOGTY="G" D   ; DIALOG GROUP
"RTN","VEFAALRE",72,0)
 ........;
"RTN","VEFAALRE",73,0)
 ........S VEFACNT2=0 ; GET DIALOG ELEMENTS INSIDE THIS DIALOG GROUP
"RTN","VEFAALRE",74,0)
 ........F  S VEFACNT2=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2)) Q:VEFACNT2=""  D
"RTN","VEFAALRE",75,0)
 .........;GET INTERNAL ENTRY #
"RTN","VEFAALRE",76,0)
 .........S DIALOGEL=0
"RTN","VEFAALRE",77,0)
 .........S DIALOGEL=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2,DIALOGEL))
"RTN","VEFAALRE",78,0)
 .........; DIALOG ELEMENT
"RTN","VEFAALRE",79,0)
 .........;
"RTN","VEFAALRE",80,0)
 .........S DIALOGEL=$P($G(^PXRMD(801.41,REMDIALG,10,DIALOGEL,0)),U,2)
"RTN","VEFAALRE",81,0)
 .........;
"RTN","VEFAALRE",82,0)
 .........;CHECK "ORDER" RESOLUTION TYPE FIRST
"RTN","VEFAALRE",83,0)
 .........S RESOLTYP=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,3)
"RTN","VEFAALRE",84,0)
 .........I RESOLTYP=3 D
"RTN","VEFAALRE",85,0)
 ..........;GET ORDERABLE ITEMS FILE ENTRY AS POSSIBLE FOLLOW-UP ACTION CHOICE. STORE INTO ^TMP($J,"ORDERITEM,COUNTER) ARRAY
"RTN","VEFAALRE",86,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7)
"RTN","VEFAALRE",87,0)
 ..........; NOW LOOK AT ORDERS IF ANY AND CHECK DATE/TIME > DATE/TIME OF PASSED CRIT ALERT
"RTN","VEFAALRE",88,0)
 ..........S COUNTER=COUNTER+1
"RTN","VEFAALRE",89,0)
 ..........;
"RTN","VEFAALRE",90,0)
 ..........S ^TMP($J,"ORDERITEM",COUNTER)=ORDERITEM
"RTN","VEFAALRE",91,0)
 ..........;new section. Also allow health factor to resolve with non-specifc orderable item (like anti-biotics in general)
"RTN","VEFAALRE",92,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALRE",93,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALRE",94,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALRE",95,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALRE",96,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALRE",97,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALRE",98,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALRE",99,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALRE",100,0)
 ..........;end new section
"RTN","VEFAALRE",101,0)
 .........E  D
"RTN","VEFAALRE",102,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALRE",103,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALRE",104,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALRE",105,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALRE",106,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALRE",107,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALRE",108,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALRE",109,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALRE",110,0)
 ....;  NOW GET ORDERS BY PATIENT AND PROVIDER (DUZ) DOESN'T CARE AS ORDER COULD BE MADE AMONG ANY PROVIDE IN OE/RR GROUP DEFINED
"RTN","VEFAALRE",111,0)
 ....; FOR SPECIFIC CRIT ALERT PROCESSING.BUT SHOULD MOST LIKELY BE MADE BY ORDERING PROVIDER. GET ORDERS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALRE",112,0)
 ....;UNTIL DATE/TIME OF ANY ORDER < 
"RTN","VEFAALRE",113,0)
 ....;DATE/TIME OF CRIT ALERT,OR NO ORDER FOUND IS ENCOUNTERED. SEARCH AMONG ORDERITEM LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALRE",114,0)
 ....;GO BY PATIENT FIRST
"RTN","VEFAALRE",115,0)
 ....S CNTTIMO=0  ; DATE/TIME OF ORDER ABD CNTTIMA DATE/TIME OF UNACK CRIT ALERT
"RTN","VEFAALRE",116,0)
 ....S CNTPAT=VEFADFN_";DPT("
"RTN","VEFAALRE",117,0)
 ....;
"RTN","VEFAALRE",118,0)
 ....F  S CNTTIMO=$O(^OR(100,"AC",CNTPAT,CNTTIMO)) S REVERST=9999999-CNTTIMO Q:(CNTTIMO="")!(VEFAADTT>REVERST)!(RY="0_""^""_3")!(RY="2_""^""_1")  D
"RTN","VEFAALRE",119,0)
 .....S ORDER=0
"RTN","VEFAALRE",120,0)
 .....S ORDER=$O(^OR(100,"AC",CNTPAT,CNTTIMO,ORDER))
"RTN","VEFAALRE",121,0)
 .....;
"RTN","VEFAALRE",122,0)
 .....;
"RTN","VEFAALRE",123,0)
 .....I ORDER'="" D
"RTN","VEFAALRE",124,0)
 ......;
"RTN","VEFAALRE",125,0)
 ......S CNT1=0  ; SEARCH MULTIPLE ORDERABLE ITEMS WITHIN 1 ORDER
"RTN","VEFAALRE",126,0)
 ......F  S CNT1=$O(^OR(100,ORDER,.1,"B",CNT1)) Q:(CNT1="")  D
"RTN","VEFAALRE",127,0)
 .......S CNTORD=CNT1
"RTN","VEFAALRE",128,0)
 .......;
"RTN","VEFAALRE",129,0)
 .......;S CNTORD=$P($G(^OR(100,ORDER,.1,CNT1,0)),"^",1)
"RTN","VEFAALRE",130,0)
 .......;CHECK IF AT LEAST ONE ORDERABLE ITEM OF ORDER AMONG LIST OF ORDERABLE ITEMS FOR FOLLOW-UP ACTION
"RTN","VEFAALRE",131,0)
 .......S COUNTER=0
"RTN","VEFAALRE",132,0)
 .......F  S COUNTER=$O(^TMP($J,"ORDERITEM",COUNTER)) Q:COUNTER=""  D
"RTN","VEFAALRE",133,0)
 ........S ORDERCK=$G(^TMP($J,"ORDERITEM",COUNTER))
"RTN","VEFAALRE",134,0)
 ........;
"RTN","VEFAALRE",135,0)
 ........I ORDERCK=CNTORD D
"RTN","VEFAALRE",136,0)
 .........S RYY=2  ; FOUND
"RTN","VEFAALRE",137,0)
 .........S SIGSTAT=1
"RTN","VEFAALRE",138,0)
 .........;NOT CHECK IF SIGNATURE REQUIRED AND SIGNATURE ITSELF
"RTN","VEFAALRE",139,0)
 .........I $P($G(^OR(100,ORDER,0)),"^",16)=2 D      ;ORES
"RTN","VEFAALRE",140,0)
 ..........S ACTION=0
"RTN","VEFAALRE",141,0)
 ..........S SIGSTAT=0
"RTN","VEFAALRE",142,0)
 ..........F  S ACTION=$O(^OR(100,ORDER,8,ACTION)) Q:(ACTION="")!(ACTION="C")  D
"RTN","VEFAALRE",143,0)
 ...........S ACTIONK=ACTION
"RTN","VEFAALRE",144,0)
 ...........S SIGSTAT=$P($G(^OR(100,ORDER,8,ACTION,0)),"^",4)
"RTN","VEFAALRE",145,0)
 ..........; CHECK FOR SIG STAT=1 FOR SIGNED ORDER ("ELECTRONIC") 
"RTN","VEFAALRE",146,0)
 ..........I RY'[1 S RY=RYY_"^"_SIGSTAT  ;SIGSTAT = 1 MEANS NO SIG REQUIRED OR SIG REQUIRED AND FOUND 
"RTN","VEFAALRE",147,0)
 .........E  D
"RTN","VEFAALRE",148,0)
 ..........S RY=RYY_"^"_1
"RTN","VEFAALRE",149,0)
 .........;
"RTN","VEFAALRE",150,0)
 ......;
"RTN","VEFAALRE",151,0)
 ......I RY'=0 I RY'[1 S RY=0_"^"_3      ; IE. IF RY NOT= 2_"^"_1 S RY=0_"^"_3
"RTN","VEFAALRE",152,0)
 ....;
"RTN","VEFAALRE",153,0)
 ....I RY=0 D
"RTN","VEFAALRE",154,0)
 .....;
"RTN","VEFAALRE",155,0)
 .....;  NOW GET V HEALTH FACTORS BY PATIENT 
"RTN","VEFAALRE",156,0)
 .....; FOR SPECIFIC CRIT ALERT PROCESSING.GET V HEALTH FACTORS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALRE",157,0)
 .....;UNTIL DATE/TIME OF ANY FOLLOWUP ACTION (V HEALTH FACTOR)< 
"RTN","VEFAALRE",158,0)
 .....;DATE/TIME OF CRIT ALERT,OR NO V  HEALTH FACTOR FOUND IS ENCOUNTERED. SEARCH AMONG FOLLOWUP LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALRE",159,0)
 .....;GO BY PATIENT FIRST
"RTN","VEFAALRE",160,0)
 .....S VHEALTH=""
"RTN","VEFAALRE",161,0)
 .....S OVERFLAG=0
"RTN","VEFAALRE",162,0)
 .....F  S VHEALTH=$O(^AUPNVHF("C",VEFADFN,VHEALTH),-1) Q:(VHEALTH="")!(OVERFLAG=1)  D
"RTN","VEFAALRE",163,0)
 ......S VISITPTR=$P($G(^AUPNVHF(VHEALTH,0)),"^",3)
"RTN","VEFAALRE",164,0)
 ......I VISITPTR'="" S REVERST=$P($G(^AUPNVSIT(VISITPTR,0)),"^",1)
"RTN","VEFAALRE",165,0)
 ......;
"RTN","VEFAALRE",166,0)
 ......;
"RTN","VEFAALRE",167,0)
 ......I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALRE",168,0)
 ......S VHEALFT=$P($G(^AUPNVHF(VHEALTH,0)),"^",1)
"RTN","VEFAALRE",169,0)
 ......;
"RTN","VEFAALRE",170,0)
 ......;CHECK IF THIS HEALTH FACTOR WITHIN DATE/TIME ALLOWED IS ONE OF FOLLOWUP ACTION HEALTH FACTORS
"RTN","VEFAALRE",171,0)
 ......S COUNTER1=0
"RTN","VEFAALRE",172,0)
 ......F  S COUNTER1=$O(^TMP($J,"FOLLOWUPITEM",COUNTER1)) Q:(COUNTER1="")  D
"RTN","VEFAALRE",173,0)
 .......S FOLLOWUP=$G(^TMP($J,"FOLLOWUPITEM",COUNTER1))
"RTN","VEFAALRE",174,0)
 .......;
"RTN","VEFAALRE",175,0)
 .......I FOLLOWUP[VHEALFT D
"RTN","VEFAALRE",176,0)
 ........S RY=2_"^"_1
"RTN","VEFAALRE",177,0)
 ....;
"RTN","VEFAALRE",178,0)
 ....;
"RTN","VEFAALRE",179,0)
 ....;
"RTN","VEFAALRE",180,0)
 ....;
"RTN","VEFAALRE",181,0)
 .E  D
"RTN","VEFAALRE",182,0)
 ..S RY=3_"^"_3  ; MEANS NO REMINDER DIALOG FOUND
"RTN","VEFAALRE",183,0)
 E  D
"RTN","VEFAALRE",184,0)
 .S RY=3_"^"_2  ; MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALRE",185,0)
 Q
"RTN","VEFAALRE",186,0)
LKPORDCK(RY,ZP) ;Do a lookup for specific critical alert TYPE, and associated date/time of a real unacknowledged alert,and RETURN list of 
"RTN","VEFAALRE",187,0)
 ;any ORDERS by ordering provider user (DUZ) that have been made from list of available FAT (Follow-up Alert Tracking) orders in in specifi defined VEFA ALERT TRACKING entry's Reminder Dialog 
"RTN","VEFAALRE",188,0)
 ; multiples(and fields)with a Reminder Dialog, the dialog elements thereof containing the ORDER types (orderable iems) for such list 
"RTN","VEFAALRE",189,0)
 ;to be compared with any actual orders by ordering provider user(s) (DUZ) made after the date/time of the actual critical alert UP to NOW or
"RTN","VEFAALRE",190,0)
 ;to date of acknowledgement(deletion) OR now time (if not passed). Do this search in reverse chronological order.
"RTN","VEFAALRE",191,0)
 ;First Verify also that type of alert passed is in VEFA ALERT TRACKING file for "followup" purposes, and has defined REMINDER DIALOG
"RTN","VEFAALRE",192,0)
 ; INPUT 
"RTN","VEFAALRE",193,0)
 ;  ZP = DFN ^ DUZ ^ TYPE OF ALERT ^ DATE/TIME OF UNACK CRIT ALERT ^ DATE ACKNOWLEDGED(DELETED) 
"RTN","VEFAALRE",194,0)
 ; RETURN
"RTN","VEFAALRE",195,0)
 ;  RY= PROVIDER FOR ORDERS/FOLLOW-UPS  & THEN CONCATENATED STRING OF ACTUAL ORDERS MADE EACH SPEARATED WITH ";"
"RTN","VEFAALRE",196,0)
 ;
"RTN","VEFAALRE",197,0)
 ;
"RTN","VEFAALRE",198,0)
 N VEFADFN,VEFADUZ,VEFAALRT,VEFAADTT,VEFARMDL
"RTN","VEFAALRE",199,0)
 N VEFACNT,VEFACNT1,VEFACNT2
"RTN","VEFAALRE",200,0)
 N DISABLE,REMDIALG,DIALOGTY,DIALOGEL,RESOLTYP,ORDRITM,COUNTER,CNTORD,CNT1,ORDER,CNTTIMO,CNTTIMA,REVERST,CNTPAT,ORDERCK,COUNTERF
"RTN","VEFAALRE",201,0)
 N RYY,ACTION,ACTIONK,SIGSTAT
"RTN","VEFAALRE",202,0)
 N DELETEDT,ORDRITEM
"RTN","VEFAALRE",203,0)
 N FOLLUPCT,FOLLOWAC
"RTN","VEFAALRE",204,0)
 N VHEALTH,OVERFLAG,VHEALF,FOLLOWUP,VISITPTR
"RTN","VEFAALRE",205,0)
 N FOLLOWU1
"RTN","VEFAALRE",206,0)
 N AGENTPRM,AGENTPRV,COUNTER1,ACTIVE
"RTN","VEFAALRE",207,0)
 ;K RY
"RTN","VEFAALRE",208,0)
 S RY=0
"RTN","VEFAALRE",209,0)
 S AGENTPRV=""
"RTN","VEFAALRE",210,0)
 S COUNTER=0
"RTN","VEFAALRE",211,0)
 S COUNTER1=0
"RTN","VEFAALRE",212,0)
 K ^TMP($J,"ORDERITEM")
"RTN","VEFAALRE",213,0)
 K ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALRE",214,0)
 K ^TMP($J,"ORDERITEMFOUND")
"RTN","VEFAALRE",215,0)
 S VEFADFN=$P(ZP,U,1) S VEFADUZ=$P(ZP,U,2) S VEFAALRT=$P(ZP,U,3) S VEFAADTT=$P(ZP,U,4) S DELETEDT=$P(ZP,U,5)
"RTN","VEFAALRE",216,0)
 ;
"RTN","VEFAALRE",217,0)
 ;first CHECK if type of alert if in VEFA ALERT TRACKING file
"RTN","VEFAALRE",218,0)
 S VEFACNT=0
"RTN","VEFAALRE",219,0)
 ;
"RTN","VEFAALRE",220,0)
 S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALRE",221,0)
 S ACTIVE=0
"RTN","VEFAALRE",222,0)
 ;CHECK IF ACTIVE
"RTN","VEFAALRE",223,0)
 ;S VEFACNT=$O(^DIZ(19007,"B",VEFAALRT,VEFACNT))
"RTN","VEFAALRE",224,0)
 I VEFACNT'="" D
"RTN","VEFAALRE",225,0)
 .S ACTIVE=$P($G(^DIZ(19007,VEFACNT,3)),"^",5)
"RTN","VEFAALRE",226,0)
 .I ACTIVE="" S ACTIVE=0
"RTN","VEFAALRE",227,0)
 I (VEFACNT'="")&(ACTIVE) D
"RTN","VEFAALRE",228,0)
 .;
"RTN","VEFAALRE",229,0)
 .; RECORD # in VEFA TRACKED ALERTS file
"RTN","VEFAALRE",230,0)
 .; get reminder dialog 
"RTN","VEFAALRE",231,0)
 .S VEFARMDL=$P($G(^DIZ(19007,VEFACNT,3)),U,1) ;
"RTN","VEFAALRE",232,0)
 .I VEFARMDL'="" D
"RTN","VEFAALRE",233,0)
 ..;
"RTN","VEFAALRE",234,0)
 ..;GO TO FILE 801.41
"RTN","VEFAALRE",235,0)
 ..;CHECK IF DISABLED
"RTN","VEFAALRE",236,0)
 ..S DISABLE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,3)
"RTN","VEFAALRE",237,0)
 ..I (DISABLE=0)!(DISABLE="") D
"RTN","VEFAALRE",238,0)
 ...;
"RTN","VEFAALRE",239,0)
 ...;CHECK REMINDER TYPE AS "REMINDER DIALOG"
"RTN","VEFAALRE",240,0)
 ...S REMTYPE=$P($G(^PXRMD(801.41,VEFARMDL,0)),U,4)
"RTN","VEFAALRE",241,0)
 ...I REMTYPE="R" D
"RTN","VEFAALRE",242,0)
 ....;
"RTN","VEFAALRE",243,0)
 ....; LOOK THROUGH DIALOG GROUPS AND THEIR ELEMENTS TO FIND ORDERABLE ANY ORDER ITEMS.
"RTN","VEFAALRE",244,0)
 ....S VEFACNT=0
"RTN","VEFAALRE",245,0)
 ....F  S VEFACNT=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT)) Q:VEFACNT=""  D
"RTN","VEFAALRE",246,0)
 .....;GET INTERNAL ENTRY #
"RTN","VEFAALRE",247,0)
 .....S VEFACNT1=0
"RTN","VEFAALRE",248,0)
 .....S VEFACNT1=$O(^PXRMD(801.41,VEFARMDL,10,"B",VEFACNT,VEFACNT1))
"RTN","VEFAALRE",249,0)
 .....;
"RTN","VEFAALRE",250,0)
 .....I VEFACNT1'="" D
"RTN","VEFAALRE",251,0)
 ......; GET DIALOG GROUP OR DIRECT DIALOG ELEMENT (ASSUME FOR NOW ONLY DIALOG GROUP WITH ORDERS)
"RTN","VEFAALRE",252,0)
 ......S REMDIALG=$P($G(^PXRMD(801.41,VEFARMDL,10,VEFACNT1,0)),U,2)
"RTN","VEFAALRE",253,0)
 ......;
"RTN","VEFAALRE",254,0)
 ......I REMDIALG'="" D
"RTN","VEFAALRE",255,0)
 .......; CHECK IF DIALOG GROUP
"RTN","VEFAALRE",256,0)
 .......S DIALOGTY=$P($G(^PXRMD(801.41,REMDIALG,0)),U,4)
"RTN","VEFAALRE",257,0)
 .......I DIALOGTY="G" D   ; DIALOG GROUP
"RTN","VEFAALRE",258,0)
 ........;
"RTN","VEFAALRE",259,0)
 ........S VEFACNT2=0 ; GET DIALOG ELEMENTS INSIDE THIS DIALOG GROUP
"RTN","VEFAALRE",260,0)
 ........F  S VEFACNT2=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2)) Q:VEFACNT2=""  D
"RTN","VEFAALRE",261,0)
 .........;GET INTERNAL ENTRY #
"RTN","VEFAALRE",262,0)
 .........S DIALOGEL=0
"RTN","VEFAALRE",263,0)
 .........S DIALOGEL=$O(^PXRMD(801.41,REMDIALG,10,"B",VEFACNT2,DIALOGEL))
"RTN","VEFAALRE",264,0)
 .........; DIALOG ELEMENT
"RTN","VEFAALRE",265,0)
 .........;
"RTN","VEFAALRE",266,0)
 .........S DIALOGEL=$P($G(^PXRMD(801.41,REMDIALG,10,DIALOGEL,0)),U,2)
"RTN","VEFAALRE",267,0)
 .........;
"RTN","VEFAALRE",268,0)
 .........;CHECK "ORDER" RESOLUTION TYPE FIRST
"RTN","VEFAALRE",269,0)
 .........S RESOLTYP=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,3)
"RTN","VEFAALRE",270,0)
 .........I RESOLTYP=3 D
"RTN","VEFAALRE",271,0)
 ..........;GET ORDERABLE ITEMS FILE ENTRY AS POOSIBLE FOLLOW-UP ACTION CHOICE. STORE INTO ^TMP($J,"ORDERITEM,COUNTER) ARRAY
"RTN","VEFAALRE",272,0)
 ..........S ORDERITEM=$P($G(^PXRMD(801.41,DIALOGEL,1)),U,7)
"RTN","VEFAALRE",273,0)
 ..........; NOW LOOK AT ORDERS IF ANY AND CHECK DATE/TIME > DATE/TIME OF PASSED CRIT ALERT
"RTN","VEFAALRE",274,0)
 ..........S COUNTER=COUNTER+1
"RTN","VEFAALRE",275,0)
 ..........;
"RTN","VEFAALRE",276,0)
 ..........S ^TMP($J,"ORDERITEM",COUNTER)=ORDERITEM
"RTN","VEFAALRE",277,0)
 ..........;new section to allow health factor to resolve with non-specific orderable item (like anti-biotics in general)
"RTN","VEFAALRE",278,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALRE",279,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALRE",280,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALRE",281,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALRE",282,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALRE",283,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALRE",284,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALRE",285,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALRE",286,0)
 ..........;end section
"RTN","VEFAALRE",287,0)
 .........E  D
"RTN","VEFAALRE",288,0)
 ..........S FOLLUPCT=0
"RTN","VEFAALRE",289,0)
 ..........F  S FOLLUPCT=$O(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT)) Q:(FOLLUPCT="")!(FOLLUPCT="B")  D
"RTN","VEFAALRE",290,0)
 ...........S FOLLOWAC=$P($G(^PXRMD(801.41,DIALOGEL,3,FOLLUPCT,0)),"^",1)  ;DYNAMIC POINTER
"RTN","VEFAALRE",291,0)
 ...........;LOOK FOR V HEALTH FACTOR TYPE ONLY
"RTN","VEFAALRE",292,0)
 ...........;GET FOLLOUP ACTION HEALTH FACTOR AS ADDITIONAL FINDING TYPE IN FORM "500156;AUTTHF(" WHERE NUMERIC LIKE 500156 IS INTERNAL # FOR HEALTH FACTOR ENTRY
"RTN","VEFAALRE",293,0)
 ...........I FOLLOWAC["AUTTHF(" D
"RTN","VEFAALRE",294,0)
 ............S COUNTER1=COUNTER1+1
"RTN","VEFAALRE",295,0)
 ............S ^TMP($J,"FOLLOWUPITEM",COUNTER1)=FOLLOWAC
"RTN","VEFAALRE",296,0)
 ....;  NOW GET ORDERS BY PATIENT AND PROVIDER (DUZ) DOESN'T CARE AS ORDER COULD BE MADE AMONG ANY PROVIDER IN OE/RR GROUP DEFINED
"RTN","VEFAALRE",297,0)
 ....; 
"RTN","VEFAALRE",298,0)
 ....; FOR SPECIFIC CRIT ALERT PROCESSING.BUT SHOULD MOST LIKELY BE MADE BY ORDERING PROVIDER. GET ORDERS STARTING IN REVERSE TIME
"RTN","VEFAALRE",299,0)
 ....; ORDER UNTIL DATE/TIME OF ANY ORDER < 
"RTN","VEFAALRE",300,0)
 ....;DATE/TIME OF CRIT ALERT,OR NO ORDER FOUND IS ENCOUNTERED. SEARCH AMONG ORDERITEM LIST F FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALRE",301,0)
 ....;GO BY PATIENT FIRST
"RTN","VEFAALRE",302,0)
 ....S CNTTIMO=0  ; DATE/TIME OF ORDER ABD CNTTIMA DATE/TIME OF UNACK CRIT ALERT
"RTN","VEFAALRE",303,0)
 ....S CNTPAT=VEFADFN_";DPT("
"RTN","VEFAALRE",304,0)
 ....;
"RTN","VEFAALRE",305,0)
 ....;W !
"RTN","VEFAALRE",306,0)
 ....;ZW ^TMP($J,"ORDERITEM")
"RTN","VEFAALRE",307,0)
 ....;S COUNTERF=0  ; COUNTER OF ORDERS FOUND
"RTN","VEFAALRE",308,0)
 ....F  S CNTTIMO=$O(^OR(100,"AC",CNTPAT,CNTTIMO)) S REVERST=9999999-CNTTIMO Q:(CNTTIMO="")!(VEFAADTT>REVERST)  D
"RTN","VEFAALRE",309,0)
 .....;CHECK ONLY IS LESS THAN DELETED DATE/TIME IF PASSED
"RTN","VEFAALRE",310,0)
 .....I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALRE",311,0)
 .....I VEFAADTT>REVERST Q
"RTN","VEFAALRE",312,0)
 .....S ORDER=0
"RTN","VEFAALRE",313,0)
 .....S ORDER=$O(^OR(100,"AC",CNTPAT,CNTTIMO,ORDER))
"RTN","VEFAALRE",314,0)
 .....;
"RTN","VEFAALRE",315,0)
 .....;
"RTN","VEFAALRE",316,0)
 .....I ORDER'="" D
"RTN","VEFAALRE",317,0)
 ......;S AGENTPRM=$P($G(^OR(100,D0,0)),"^",4) ; MAYBE PROVIDER
"RTN","VEFAALRE",318,0)
 ......S CNT1=0  ; SEARCH MULTIPLE ORDERABLE ITEMS WITHIN 1 ORDER
"RTN","VEFAALRE",319,0)
 ......F  S CNT1=$O(^OR(100,ORDER,.1,"B",CNT1)) Q:(CNT1="")  D
"RTN","VEFAALRE",320,0)
 .......S CNTORD=CNT1
"RTN","VEFAALRE",321,0)
 .......;
"RTN","VEFAALRE",322,0)
 .......;S CNTORD=$P($G(^OR(100,ORDER,.1,CNT1,0)),"^",1)
"RTN","VEFAALRE",323,0)
 .......;CHECK AMONG ALL ACTUAL ORDERABLE ITEMS OF ORDER AMONG LIST OF ORDERABLE ITEMS FOR FOLLOW-UP ACTION.LIST ONLY ONE OCCURENCE IN ARRAY
"RTN","VEFAALRE",324,0)
 .......S COUNTER=0
"RTN","VEFAALRE",325,0)
 .......F  S COUNTER=$O(^TMP($J,"ORDERITEM",COUNTER)) Q:COUNTER=""  D
"RTN","VEFAALRE",326,0)
 ........S ORDERCK=$G(^TMP($J,"ORDERITEM",COUNTER))
"RTN","VEFAALRE",327,0)
 ........;
"RTN","VEFAALRE",328,0)
 ........I ORDERCK=CNTORD D
"RTN","VEFAALRE",329,0)
 .........;S AGENTPRV=$P($G(^OR(100,D0,0)),"^",4) ; ACTUAL AGENT PROVIDER OF ORDER
"RTN","VEFAALRE",330,0)
 .........S RYY=2  ; FOUND
"RTN","VEFAALRE",331,0)
 .........;ORDERABLE ITEM NAME
"RTN","VEFAALRE",332,0)
 .........I ORDERCK'="" D
"RTN","VEFAALRE",333,0)
 ..........S ORDRITEM=$P($G(^ORD(101.43,ORDERCK,0)),"^",1)
"RTN","VEFAALRE",334,0)
 ..........S ^TMP($J,"ORDERITEMFOUND",ORDRITEM)=""
"RTN","VEFAALRE",335,0)
 ..........I ($P($G(^OR(100,ORDER,0)),"^",4)'="")&(AGENTPRV="") S AGENTPRV=$P($G(^OR(100,ORDER,0)),"^",4) ; ACTUAL AGENT PROVIDER OF ORDER
"RTN","VEFAALRE",336,0)
 ..........;W !,"AGENTPRV=",AGENTPRV
"RTN","VEFAALRE",337,0)
 .........S SIGSTAT=1
"RTN","VEFAALRE",338,0)
 .........;NOT CHECK IF SIGNATURE REQUIRED AND SIGNATURE ITSELF
"RTN","VEFAALRE",339,0)
 .........I $P($G(^OR(100,ORDER,0)),"^",16)=2 D      ;ORES
"RTN","VEFAALRE",340,0)
 ..........S ACTION=0
"RTN","VEFAALRE",341,0)
 ..........S SIGSTAT=0
"RTN","VEFAALRE",342,0)
 ..........F  S ACTION=$O(^OR(100,ORDER,8,ACTION)) Q:(ACTION="")!(ACTION="C")  D
"RTN","VEFAALRE",343,0)
 ...........S ACTIONK=ACTION
"RTN","VEFAALRE",344,0)
 ...........S SIGSTAT=$P($G(^OR(100,ORDER,8,ACTION,0)),"^",4)
"RTN","VEFAALRE",345,0)
 ..........; CHECK FOR SIG STAT=1 FOR SIGNED ORDER ("ELECTRONIC") 
"RTN","VEFAALRE",346,0)
 ..........I RY'[1 S RY=RYY_"^"_SIGSTAT  ;SIGSTAT = 1 MEANS NO SIG REQUIRED OR SIG REQUIRED AND FOUND 
"RTN","VEFAALRE",347,0)
 .........E  D
"RTN","VEFAALRE",348,0)
 ..........S RY=RYY_"^"_1
"RTN","VEFAALRE",349,0)
 .........;
"RTN","VEFAALRE",350,0)
 ......;
"RTN","VEFAALRE",351,0)
 ......I RY'=0 I RY'[1 S RY=0_"^"_3      ; IE. IF RY NOT= 2_"^"_1 S RY=0_"^"_3
"RTN","VEFAALRE",352,0)
 ....;
"RTN","VEFAALRE",353,0)
 ....D
"RTN","VEFAALRE",354,0)
 .....;
"RTN","VEFAALRE",355,0)
 .....;  NOW GET V HEALTH FACTORS BY PATIENT 
"RTN","VEFAALRE",356,0)
 .....; FOR SPECIFIC CRIT ALERT PROCESSING.GET V HEALTH FACTORS STARTING IN REVERSE TIME ORDER 
"RTN","VEFAALRE",357,0)
 .....;UNTIL DATE/TIME OF ANY FOLLOWUP ACTION (V HEALTH FACTOR)< 
"RTN","VEFAALRE",358,0)
 .....;DATE/TIME OF CRIT ALERT,OR NO V  HEALTH FACTOR FOUND IS ENCOUNTERED. SEARCH AMONG FOLLOWUP LIST FOUND BEFORE END OF SEARCH IS OVER.
"RTN","VEFAALRE",359,0)
 .....;GO BY PATIENT FIRST
"RTN","VEFAALRE",360,0)
 .....S VHEALTH=999999999999
"RTN","VEFAALRE",361,0)
 .....S OVERFLAG=0
"RTN","VEFAALRE",362,0)
 .....;W !
"RTN","VEFAALRE",363,0)
 .....;ZW ^TMP($J,"FOLLOWUPITEM")
"RTN","VEFAALRE",364,0)
 .....F  S VHEALTH=$O(^AUPNVHF("C",VEFADFN,VHEALTH),-1) Q:(VHEALTH="")!(OVERFLAG=1)  D
"RTN","VEFAALRE",365,0)
 ......S VISITPTR=$P($G(^AUPNVHF(VHEALTH,0)),"^",3)
"RTN","VEFAALRE",366,0)
 ......I VISITPTR'="" S REVERST=$P($G(^AUPNVSIT(VISITPTR,0)),"^",1)
"RTN","VEFAALRE",367,0)
 ......;
"RTN","VEFAALRE",368,0)
 ......;
"RTN","VEFAALRE",369,0)
 ......I VEFAADTT>REVERST S OVERFLAG=1 Q
"RTN","VEFAALRE",370,0)
 ......I DELETEDT'="" I '(REVERST<DELETEDT) Q
"RTN","VEFAALRE",371,0)
 ......S VHEALFT=$P($G(^AUPNVHF(VHEALTH,0)),"^",1)
"RTN","VEFAALRE",372,0)
 ......;;;;;I VHEALFT=500158 S ^XTMP("AAA4","500158")=VEFADFN_"^"_VHEALTH
"RTN","VEFAALRE",373,0)
 ......;CHECK IF THIS HEALTH FACTOR WITHIN DATE/TIME ALLOWED IS ONE OF FOLLOWUP ACTION HEALTH FACTORS
"RTN","VEFAALRE",374,0)
 ......S COUNTER1=0
"RTN","VEFAALRE",375,0)
 ......F  S COUNTER1=$O(^TMP($J,"FOLLOWUPITEM",COUNTER1)) Q:(COUNTER1="")  D
"RTN","VEFAALRE",376,0)
 .......S FOLLOWUP=$G(^TMP($J,"FOLLOWUPITEM",COUNTER1))
"RTN","VEFAALRE",377,0)
 .......;S ^XTMP("AAAA",COUNTER1)=FOLLOWUP_"^"_VHEALFT
"RTN","VEFAALRE",378,0)
 .......I FOLLOWUP[VHEALFT D
"RTN","VEFAALRE",379,0)
 ........S FOLLOWU1=$P(FOLLOWUP,";",1)
"RTN","VEFAALRE",380,0)
 ........I FOLLOWU1'="" D
"RTN","VEFAALRE",381,0)
 .........S FOLLOWU1=$P($G(^AUTTHF(FOLLOWU1,0)),"^",1)
"RTN","VEFAALRE",382,0)
 .........I ($P($G(^AUPNVHF(VHEALTH,12)),"^",4)'="")&(AGENTPRV="") S AGENTPRV=$P($G(^AUPNVHF(VHEALTH,12)),"^",4) ;
"RTN","VEFAALRE",383,0)
 .........;W !,"AGENTPRV=",AGENTPRV
"RTN","VEFAALRE",384,0)
 .........S ^TMP($J,"ORDERITEMFOUND",FOLLOWU1)=""   ; S RY=2_"^"_1
"RTN","VEFAALRE",385,0)
 ....;
"RTN","VEFAALRE",386,0)
 ....;
"RTN","VEFAALRE",387,0)
 ....;
"RTN","VEFAALRE",388,0)
 ....;
"RTN","VEFAALRE",389,0)
 .E  D
"RTN","VEFAALRE",390,0)
 ..S RY=3_"^"_3  ; MEANS NO REMINDER DIALOG FOUND
"RTN","VEFAALRE",391,0)
 E  D
"RTN","VEFAALRE",392,0)
 .S RY=3_"^"_2  ; MEANS NO ALERT TRACKING FILE ENTRY FOUND FOR THIS TYPE OF ALERT 
"RTN","VEFAALRE",393,0)
 ;DO LOOP OF ORDERS FOUND RETURNED CONCATENATED WITH ";"
"RTN","VEFAALRE",394,0)
 S RY=""
"RTN","VEFAALRE",395,0)
 S RY=AGENTPRV_";"
"RTN","VEFAALRE",396,0)
 S COUNTERF=0
"RTN","VEFAALRE",397,0)
 F  S COUNTERF=$O(^TMP($J,"ORDERITEMFOUND",COUNTERF)) Q:COUNTERF=""  D
"RTN","VEFAALRE",398,0)
 .S RY=RY_COUNTERF_";"
"RTN","VEFAALRE",399,0)
 Q
"RTN","VEFACSP1")
0^15^B21989402
"RTN","VEFACSP1",1,0)
VEFACSP1 ;WOIFO/BT - VEFA AWARE COMMON API CALLED BY CSP PAGE ; 01/22/2014
"RTN","VEFACSP1",2,0)
 ;;1.0;VEFA ALRE;**1**;MAY 1, 2011;Build 33
"RTN","VEFACSP1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","VEFACSP1",4,0)
 ;;
"RTN","VEFACSP1",5,0)
 ; External Reference DBIA#
"RTN","VEFACSP1",6,0)
 ; ------------------------
"RTN","VEFACSP1",7,0)
 ; #2240  - $$ENCRYP^XUSRB1 (Supported)
"RTN","VEFACSP1",8,0)
 ; #2343  - NAME^XUSER      (Supported)
"RTN","VEFACSP1",9,0)
 ; #2882  - CHECKAV^XUSRB   (Controlled Subs)
"RTN","VEFACSP1",10,0)
 ; #4054  - VALIDAV^XUSRB   (Controlled Subs)
"RTN","VEFACSP1",11,0)
 ; #4440  - $$PROD^XUPROD   (Supported)
"RTN","VEFACSP1",12,0)
 ; #4762  - ^XTV(8989.3,1,"XUS") (Controlled Subs)
"RTN","VEFACSP1",13,0)
 ; #10097 - GETENV^%ZOSV    (Supported)
"RTN","VEFACSP1",14,0)
 ; #10103 - DT^XLFDT        (Supported)
"RTN","VEFACSP1",15,0)
 ; #10104 - UP^XLFSTR       (Supported)
"RTN","VEFACSP1",16,0)
 ; #10035 - ^DPT( reference (Supported)
"RTN","VEFACSP1",17,0)
 ; Request ICR for $P(VA(200,,0),U)
"RTN","VEFACSP1",18,0)
 QUIT
"RTN","VEFACSP1",19,0)
 ;
"RTN","VEFACSP1",20,0)
GETENV(SERVER,VOLBOX,UCI,PROD) ;get environment vars
"RTN","VEFACSP1",21,0)
 ;INPUT
"RTN","VEFACSP1",22,0)
 ;   NONE
"RTN","VEFACSP1",23,0)
 ;OUTPUT
"RTN","VEFACSP1",24,0)
 ;   SERVER  : Local VistA Server
"RTN","VEFACSP1",25,0)
 ;   VOLBOX  : Volume BOX pair
"RTN","VEFACSP1",26,0)
 ;   UCI     : VistA Instance
"RTN","VEFACSP1",27,0)
 ;   PROD    : Production Account Indicator
"RTN","VEFACSP1",28,0)
 ;
"RTN","VEFACSP1",29,0)
 N U S U="^"
"RTN","VEFACSP1",30,0)
 N Y D GETENV^%ZOSV
"RTN","VEFACSP1",31,0)
 S SERVER=$P(Y,U,3)
"RTN","VEFACSP1",32,0)
 S VOLBOX=$P(Y,U,4)
"RTN","VEFACSP1",33,0)
 S UCI=$P(Y,U,1)
"RTN","VEFACSP1",34,0)
 S PROD=$$PROD^XUPROD(1)
"RTN","VEFACSP1",35,0)
 QUIT
"RTN","VEFACSP1",36,0)
 ;
"RTN","VEFACSP1",37,0)
GETDUZ(ACCESS,VERIFY,MSG) ;Get DUZ based on Access and Verify codes
"RTN","VEFACSP1",38,0)
 ;INPUT
"RTN","VEFACSP1",39,0)
 ;  ACCESS  : User Access Code
"RTN","VEFACSP1",40,0)
 ;  VERIFY  : User Verify Code
"RTN","VEFACSP1",41,0)
 ;OUTPUT
"RTN","VEFACSP1",42,0)
 ;  MSG     : Error Message
"RTN","VEFACSP1",43,0)
 ;RETURN
"RTN","VEFACSP1",44,0)
 ;  DUZ  (User ID)
"RTN","VEFACSP1",45,0)
 ;
"RTN","VEFACSP1",46,0)
 S U="^"
"RTN","VEFACSP1",47,0)
 N Y D GETENV^%ZOSV
"RTN","VEFACSP1",48,0)
 N XUENV S XUENV=Y
"RTN","VEFACSP1",49,0)
 N XQVOL,XUVOL S (XQVOL,XUVOL)=$P(Y,U,2)
"RTN","VEFACSP1",50,0)
 N XUCI S XUCI=$P(Y,U,1)
"RTN","VEFACSP1",51,0)
 N AVENC S AVENC=$$ENCRYP^XUSRB1(ACCESS_";"_VERIFY)
"RTN","VEFACSP1",52,0)
 N XWBSTATE S XWBSTATE("XUS XOPT")=$G(^XTV(8989.3,1,"XUS"))
"RTN","VEFACSP1",53,0)
 N RET D VALIDAV^XUSRB(.RET,AVENC)
"RTN","VEFACSP1",54,0)
 S MSG=$G(RET(3))
"RTN","VEFACSP1",55,0)
 QUIT +$G(RET(0))
"RTN","VEFACSP1",56,0)
 ;
"RTN","VEFACSP1",57,0)
GETSITE() ; Get Local VistA site
"RTN","VEFACSP1",58,0)
 QUIT $P(^XTV(8989.3,1,"XUS"),"^",17)
"RTN","VEFACSP1",59,0)
 ;
"RTN","VEFACSP1",60,0)
GETNAMES(VEFARSLT,FILE,SEARCH) ;Get all names for FILE
"RTN","VEFACSP1",61,0)
 ;INPUT
"RTN","VEFACSP1",62,0)
 ;  FILE   : File Number
"RTN","VEFACSP1",63,0)
 ;  SEARCH : Start With value
"RTN","VEFACSP1",64,0)
 ;OUTPUT
"RTN","VEFACSP1",65,0)
 ;  VEFARSLT : Reference Array containing the filtered names for the FILE
"RTN","VEFACSP1",66,0)
 ;
"RTN","VEFACSP1",67,0)
 QUIT:'$D(FILE)
"RTN","VEFACSP1",68,0)
 N IENS S IENS=""
"RTN","VEFACSP1",69,0)
 N FIELDS S FIELDS=".01"
"RTN","VEFACSP1",70,0)
 N FLAGS S FLAGS=""
"RTN","VEFACSP1",71,0)
 N NUMBER S NUMBER=""
"RTN","VEFACSP1",72,0)
 N FROM,PART
"RTN","VEFACSP1",73,0)
 I $D(SEARCH) D
"RTN","VEFACSP1",74,0)
 . S:$L(SEARCH)>1 FROM(1)=$E(SEARCH,1,$L(SEARCH)-1)
"RTN","VEFACSP1",75,0)
 . S PART(1)=SEARCH
"RTN","VEFACSP1",76,0)
 N INDEX S INDEX="B"
"RTN","VEFACSP1",77,0)
 N IDENT S IDENT=""
"RTN","VEFACSP1",78,0)
 N TARGET,ERR
"RTN","VEFACSP1",79,0)
 ;
"RTN","VEFACSP1",80,0)
 D LIST^DIC(FILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFACSP1",81,0)
 ;
"RTN","VEFACSP1",82,0)
 N ID S ID=""
"RTN","VEFACSP1",83,0)
 ;
"RTN","VEFACSP1",84,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFACSP1",85,0)
 . N NAME S NAME=$$QUOTE(TARGET("DILIST","ID",ID,.01))
"RTN","VEFACSP1",86,0)
 . S:NAME'="" VEFARSLT(NAME)=""
"RTN","VEFACSP1",87,0)
 QUIT
"RTN","VEFACSP1",88,0)
 ;
"RTN","VEFACSP1",89,0)
QUOTE(STR) ;Replace quotes and line feed characters in STR with HTML chars 
"RTN","VEFACSP1",90,0)
 ;INPUT
"RTN","VEFACSP1",91,0)
 ;  STR : String wirth potential quotes and linefeed
"RTN","VEFACSP1",92,0)
 ;RETURN
"RTN","VEFACSP1",93,0)
 ;  The transformed String with html chars
"RTN","VEFACSP1",94,0)
 ;
"RTN","VEFACSP1",95,0)
 N RESULT S RESULT=""
"RTN","VEFACSP1",96,0)
 N NEWINDEX S NEWINDEX=0
"RTN","VEFACSP1",97,0)
 N INDEX
"RTN","VEFACSP1",98,0)
 ;
"RTN","VEFACSP1",99,0)
 F INDEX=1:1:$L(STR) D
"RTN","VEFACSP1",100,0)
 . I $E(STR,INDEX)=$C(34)!($E(STR,INDEX)="'") D  QUIT
"RTN","VEFACSP1",101,0)
 . . S NEWINDEX=NEWINDEX+1
"RTN","VEFACSP1",102,0)
 . . S $E(RESULT,NEWINDEX)="\"
"RTN","VEFACSP1",103,0)
 . . S NEWINDEX=NEWINDEX+1
"RTN","VEFACSP1",104,0)
 . . S $E(RESULT,NEWINDEX)=$E(STR,INDEX)
"RTN","VEFACSP1",105,0)
 . I $E(STR,INDEX)=$C(10) D  QUIT
"RTN","VEFACSP1",106,0)
 . . S NEWINDEX=NEWINDEX+1
"RTN","VEFACSP1",107,0)
 . . S $E(RESULT,NEWINDEX)="\n"
"RTN","VEFACSP1",108,0)
 . . S NEWINDEX=NEWINDEX+1
"RTN","VEFACSP1",109,0)
 . S NEWINDEX=NEWINDEX+1
"RTN","VEFACSP1",110,0)
 . S $E(RESULT,NEWINDEX)=$E(STR,INDEX)
"RTN","VEFACSP1",111,0)
 ;
"RTN","VEFACSP1",112,0)
 QUIT RESULT
"RTN","VEFACSP1",113,0)
 ;
"RTN","VEFACSP1",114,0)
GETSRCH(VEFARSLT,FILE,SEARCH,FILTER,ATYPE,DLGFILE) ;Get all names for FILE start with SEARCH and filter the records with FILEMAN's screen value FILTER
"RTN","VEFACSP1",115,0)
 ;INPUT
"RTN","VEFACSP1",116,0)
 ;  FILE   : File Number
"RTN","VEFACSP1",117,0)
 ;  SEARCH : Start with value
"RTN","VEFACSP1",118,0)
 ;  FILTER : FILEMAN screen value
"RTN","VEFACSP1",119,0)
 ;  ATYPE  : Alert Type. It's used for File 801.41 (Reminder Dialog) only
"RTN","VEFACSP1",120,0)
 ;  DLGFILE: Dialog File 19007.01, 19007.02, 19007.03
"RTN","VEFACSP1",121,0)
 ;OUTPUT
"RTN","VEFACSP1",122,0)
 ;  VEFARSLT : Reference Array containing the "filtered" name values
"RTN","VEFACSP1",123,0)
 ;
"RTN","VEFACSP1",124,0)
 QUIT:'$D(FILE)
"RTN","VEFACSP1",125,0)
 QUIT:'$D(SEARCH)
"RTN","VEFACSP1",126,0)
 S ATYPE=$G(ATYPE)
"RTN","VEFACSP1",127,0)
 S DLGFILE=$G(DLGFILE)
"RTN","VEFACSP1",128,0)
 N IENS S IENS=""
"RTN","VEFACSP1",129,0)
 N FIELDS S FIELDS="@;.01"
"RTN","VEFACSP1",130,0)
 N FLAGS S FLAGS=""
"RTN","VEFACSP1",131,0)
 N NUMBER S NUMBER=""
"RTN","VEFACSP1",132,0)
 N FROM S:$L(SEARCH)>1 FROM(1)=$E(SEARCH,1,$L(SEARCH)-1)
"RTN","VEFACSP1",133,0)
 N PART S PART(1)=SEARCH
"RTN","VEFACSP1",134,0)
 N INDEX S INDEX="B"
"RTN","VEFACSP1",135,0)
 N IDENT S IDENT=""
"RTN","VEFACSP1",136,0)
 N TARGET,ERR
"RTN","VEFACSP1",137,0)
 N SCREEN 
"RTN","VEFACSP1",138,0)
 S:$G(FILTER)'="" SCREEN=FILTER
"RTN","VEFACSP1",139,0)
 ;
"RTN","VEFACSP1",140,0)
 D LIST^DIC(FILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFACSP1",141,0)
 ;
"RTN","VEFACSP1",142,0)
 N LAST S LAST=$O(TARGET("DILIST","ID"," "),-1)
"RTN","VEFACSP1",143,0)
 N ID S ID=""
"RTN","VEFACSP1",144,0)
 ;
"RTN","VEFACSP1",145,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFACSP1",146,0)
 . N IEN S IEN=TARGET("DILIST",2,ID)
"RTN","VEFACSP1",147,0)
 . N NAME S NAME=$$QUOTE(TARGET("DILIST","ID",ID,.01))
"RTN","VEFACSP1",148,0)
 . N SEQ S SEQ=IEN
"RTN","VEFACSP1",149,0)
 . I DLGFILE,ATYPE S SEQ=$$GETSEQ2^VEFAKB01(DLGFILE,ATYPE,NAME) QUIT:SEQ=0
"RTN","VEFACSP1",150,0)
 . N LINE S LINE="  {"_"ien:'"_IEN_"',"_"seq:'"_SEQ_"',"_"name:'"_NAME_"'}"
"RTN","VEFACSP1",151,0)
 . I ID<LAST S LINE=LINE_","
"RTN","VEFACSP1",152,0)
 . S VEFARSLT(ID)=LINE
"RTN","VEFACSP1",153,0)
 QUIT
"RTN","VEFACSP1",154,0)
 ;
"RTN","VEFACSP1",155,0)
GETSEQ(DLGFILE,ATYPE,NAME) ;
"RTN","VEFACSP1",156,0)
 N SEQ S SEQ=$$GETSEQ2^VEFAKB01(DLGFILE,ATYPE,NAME)
"RTN","VEFACSP1",157,0)
 I SEQ>0 S SEQ=" (#"_SEQ_")"
"RTN","VEFACSP1",158,0)
 Q SEQ
"RTN","VEFACSP1",159,0)
 ;
"RTN","VEFACSP1",160,0)
GETNAME(DUZ) ;Return User Name
"RTN","VEFACSP1",161,0)
 QUIT $P(^VA(200,DUZ,0),U)
"RTN","VEFACSP1",162,0)
 ;QUIT $$UP^XLFSTR($$NAME^XUSER(DUZ,"F"))
"RTN","VEFACSP1",163,0)
 ;
"RTN","VEFACSP1",164,0)
GTDLGIEN(TYPEIEN,FILEIDX,NAME) ; Return Alert Type's Dialog Text IEN
"RTN","VEFACSP1",165,0)
 QUIT $O(^DIZ(19007,TYPEIEN,FILEIDX,"B",NAME,0))
"RTN","VEFACSP1",166,0)
 ;
"RTN","VEFACSP1",167,0)
JSBOOL(BOOLSTR) ;Return javascript boolean
"RTN","VEFACSP1",168,0)
 QUIT $S($$UP^XLFSTR(BOOLSTR)="YES":"true",1:"false")
"RTN","VEFACSP1",169,0)
 ;
"RTN","VEFACSP1",170,0)
GETPTINF(DFN) ;Return patient Information
"RTN","VEFACSP1",171,0)
 QUIT:'$G(DFN) ""
"RTN","VEFACSP1",172,0)
 QUIT $P(^DPT(DFN,0),"^")
"RTN","VEFAKB01")
0^16^B27573667
"RTN","VEFAKB01",1,0)
VEFAKB01 ;WOIFO/BT - VEFA AWARE KB EDITOR API CALLED BY CSP PAGE; 01/22/2014
"RTN","VEFAKB01",2,0)
 ;;1.0;VEFA ALRE;**1**;MAY 1, 2011;Build 33
"RTN","VEFAKB01",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","VEFAKB01",4,0)
 ;;
"RTN","VEFAKB01",5,0)
 ; External Reference DBIA#
"RTN","VEFAKB01",6,0)
 ; ------------------------
"RTN","VEFAKB01",7,0)
 ; #2056   - GET1^DIQ (Supported)
"RTN","VEFAKB01",8,0)
 ; #2056   - GETS^DIQ (Supported)
"RTN","VEFAKB01",9,0)
 ; #2051   - LIST^DIC (Supported)
"RTN","VEFAKB01",10,0)
 ; #10104  - UP^XLFSTR (Supported)
"RTN","VEFAKB01",11,0)
 ;
"RTN","VEFAKB01",12,0)
GETALCAT(VEFARSLT) ; RETURN all ALert Categories
"RTN","VEFAKB01",13,0)
 ; INPUT : NONE
"RTN","VEFAKB01",14,0)
 ; OUTPUT
"RTN","VEFAKB01",15,0)
 ;   VEFARSLT : Reference Array containing all Alert Categories
"RTN","VEFAKB01",16,0)
 ;
"RTN","VEFAKB01",17,0)
 K VEFARSLT
"RTN","VEFAKB01",18,0)
 N FILE S FILE="19008"
"RTN","VEFAKB01",19,0)
 N IENS S IENS=""
"RTN","VEFAKB01",20,0)
 N FIELDS S FIELDS=".01;1;2;3;4"
"RTN","VEFAKB01",21,0)
 N FLAGS S FLAGS=""
"RTN","VEFAKB01",22,0)
 N NUMBER S NUMBER=""
"RTN","VEFAKB01",23,0)
 N FROM,PART
"RTN","VEFAKB01",24,0)
 N INDEX S INDEX="#"
"RTN","VEFAKB01",25,0)
 N SCREEN
"RTN","VEFAKB01",26,0)
 N IDENT S IDENT=""
"RTN","VEFAKB01",27,0)
 N TARGET,ERR
"RTN","VEFAKB01",28,0)
 ;
"RTN","VEFAKB01",29,0)
 D LIST^DIC(FILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFAKB01",30,0)
 N LAST S LAST=$O(TARGET("DILIST","ID"," "),-1)
"RTN","VEFAKB01",31,0)
 N ID S ID=""
"RTN","VEFAKB01",32,0)
 ;
"RTN","VEFAKB01",33,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFAKB01",34,0)
 . N IEN S IEN=TARGET("DILIST",2,ID)
"RTN","VEFAKB01",35,0)
 . N NAME S NAME=TARGET("DILIST","ID",ID,.01)
"RTN","VEFAKB01",36,0)
 . N DELALERT S DELALERT=TARGET("DILIST","ID",ID,1)
"RTN","VEFAKB01",37,0)
 . N ACTION S ACTION=TARGET("DILIST","ID",ID,2)
"RTN","VEFAKB01",38,0)
 . S ACTION=$S($$UP^XLFSTR(ACTION)="YES":"true",1:"false")
"RTN","VEFAKB01",39,0)
 . N DESCR S DESCR=TARGET("DILIST","ID",ID,3)
"RTN","VEFAKB01",40,0)
 . N NOTFTYPE S NOTFTYPE=TARGET("DILIST","ID",ID,4)
"RTN","VEFAKB01",41,0)
 . N NOTFDESC S NOTFDESC=NOTFTYPE
"RTN","VEFAKB01",42,0)
 . S:NOTFTYPE'="" NOTFDESC=$P($G(^ORD(100.9,NOTFTYPE,0)),U)
"RTN","VEFAKB01",43,0)
 . N LINE S LINE="  {"
"RTN","VEFAKB01",44,0)
 . S LINE=LINE_"ien:'"_IEN_"',"
"RTN","VEFAKB01",45,0)
 . S LINE=LINE_"name:'"_$$QUOTE^VEFACSP1(NAME)_"',"
"RTN","VEFAKB01",46,0)
 . S LINE=LINE_"descr:'"_$$QUOTE^VEFACSP1(DESCR)_"',"
"RTN","VEFAKB01",47,0)
 . S LINE=LINE_"delAlert:'"_$$QUOTE^VEFACSP1(DELALERT)_"',"
"RTN","VEFAKB01",48,0)
 . S LINE=LINE_"action:'"_ACTION_"',"
"RTN","VEFAKB01",49,0)
 . S LINE=LINE_"notfType:'"_NOTFTYPE_"',"
"RTN","VEFAKB01",50,0)
 . S LINE=LINE_"notfTypeDescr:'"_$$QUOTE^VEFACSP1(NOTFDESC)_"'}"
"RTN","VEFAKB01",51,0)
 . S:ID<LAST LINE=LINE_","
"RTN","VEFAKB01",52,0)
 . S VEFARSLT(ID)=LINE
"RTN","VEFAKB01",53,0)
 QUIT
"RTN","VEFAKB01",54,0)
 ;
"RTN","VEFAKB01",55,0)
GETALTYP(VEFARSLT) ; Return all Alert Types
"RTN","VEFAKB01",56,0)
 K VEFARSLT
"RTN","VEFAKB01",57,0)
 N FILE S FILE="19007"
"RTN","VEFAKB01",58,0)
 N IENS S IENS=""
"RTN","VEFAKB01",59,0)
 N FIELDS S FIELDS=".01;3;4;5;6;7"
"RTN","VEFAKB01",60,0)
 N FLAGS S FLAGS=""
"RTN","VEFAKB01",61,0)
 N NUMBER S NUMBER=""
"RTN","VEFAKB01",62,0)
 N FROM,PART
"RTN","VEFAKB01",63,0)
 N INDEX S INDEX="#"
"RTN","VEFAKB01",64,0)
 N SCREEN
"RTN","VEFAKB01",65,0)
 N IDENT S IDENT=""
"RTN","VEFAKB01",66,0)
 N TARGET,ERR
"RTN","VEFAKB01",67,0)
 ;
"RTN","VEFAKB01",68,0)
 D LIST^DIC(FILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFAKB01",69,0)
 N LAST S LAST=$O(TARGET("DILIST","ID"," "),-1)
"RTN","VEFAKB01",70,0)
 N ID S ID=""
"RTN","VEFAKB01",71,0)
 ;
"RTN","VEFAKB01",72,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFAKB01",73,0)
 . N IEN S IEN=TARGET("DILIST",2,ID)
"RTN","VEFAKB01",74,0)
 . N NAME S NAME=TARGET("DILIST","ID",ID,.01)
"RTN","VEFAKB01",75,0)
 . N ACTIVE S ACTIVE=TARGET("DILIST","ID",ID,7)
"RTN","VEFAKB01",76,0)
 . S ACTIVE=$S($$UP^XLFSTR(ACTIVE)="YES":"true",1:"false")
"RTN","VEFAKB01",77,0)
 . N REMDLG S REMDLG=TARGET("DILIST","ID",ID,3)
"RTN","VEFAKB01",78,0)
 . N TIU S TIU=TARGET("DILIST","ID",ID,4)
"RTN","VEFAKB01",79,0)
 . N CAT S CAT=TARGET("DILIST","ID",ID,5)
"RTN","VEFAKB01",80,0)
 . N INITDT S INITDT=TARGET("DILIST","ID",ID,6)
"RTN","VEFAKB01",81,0)
 . N LINE S LINE="  {"
"RTN","VEFAKB01",82,0)
 . S LINE=LINE_"ien:'"_IEN_"',"
"RTN","VEFAKB01",83,0)
 . S LINE=LINE_"name:'"_$$QUOTE^VEFACSP1(NAME)_"',"
"RTN","VEFAKB01",84,0)
 . S LINE=LINE_"active:'"_ACTIVE_"',"
"RTN","VEFAKB01",85,0)
 . S LINE=LINE_"remDlg:'"_$$QUOTE^VEFACSP1(REMDLG)_"',"
"RTN","VEFAKB01",86,0)
 . S LINE=LINE_"tiu:'"_$$QUOTE^VEFACSP1(TIU)_"',"
"RTN","VEFAKB01",87,0)
 . S LINE=LINE_"alertCat:'"_$$QUOTE^VEFACSP1(CAT)_"',"
"RTN","VEFAKB01",88,0)
 . S LINE=LINE_"initDate:'"_INITDT_"'}"
"RTN","VEFAKB01",89,0)
 . S:ID<LAST LINE=LINE_","
"RTN","VEFAKB01",90,0)
 . S VEFARSLT(ID)=LINE
"RTN","VEFAKB01",91,0)
 QUIT
"RTN","VEFAKB01",92,0)
 ;
"RTN","VEFAKB01",93,0)
GETREC(VEFARSLT,FILE,IENS,PRGNOTES) ;get Order Dialog Text for FILE,IENS and stored in VEFARSLT
"RTN","VEFAKB01",94,0)
 QUIT:$G(FILE)=""!($G(IENS)="")
"RTN","VEFAKB01",95,0)
 K VEFARSLT
"RTN","VEFAKB01",96,0)
 S PRGNOTES=""
"RTN","VEFAKB01",97,0)
 N FLDS S FLDS=".01;1;.5;2;1.5;4;3.5;6;.3;.7;5;.4"
"RTN","VEFAKB01",98,0)
 S:FILE'=19007.03 FLDS=FLDS_";7"
"RTN","VEFAKB01",99,0)
 N FLAGS S FLAGS=""
"RTN","VEFAKB01",100,0)
 N TARGET,ERR
"RTN","VEFAKB01",101,0)
 ;
"RTN","VEFAKB01",102,0)
 D GETS^DIQ(FILE,IENS,FLDS,FLAGS,"TARGET","ERR")
"RTN","VEFAKB01",103,0)
 QUIT:'$D(TARGET)
"RTN","VEFAKB01",104,0)
 ;
"RTN","VEFAKB01",105,0)
 N FLDIDX F FLDIDX=.01,1,.5,2,1.5,4,3.5,6,.3,.7,7,.4 S VEFARSLT(FLDIDX)=$$QUOTE^VEFACSP1($G(TARGET(FILE,IENS,FLDIDX)))
"RTN","VEFAKB01",106,0)
 ;
"RTN","VEFAKB01",107,0)
 ;Use IEN as sequence # if doesn't exist
"RTN","VEFAKB01",108,0)
 I VEFARSLT(.4)="" S VEFARSLT(.4)=$$GETSEQ(FILE,IENS)
"RTN","VEFAKB01",109,0)
 ; 
"RTN","VEFAKB01",110,0)
 N NOTE S NOTE=$G(TARGET(FILE,IENS,5))
"RTN","VEFAKB01",111,0)
 QUIT:NOTE=""
"RTN","VEFAKB01",112,0)
 ;
"RTN","VEFAKB01",113,0)
 N ARRTXT M ARRTXT=@NOTE
"RTN","VEFAKB01",114,0)
 N LST S LST=$o(ARRTXT(""),-1)
"RTN","VEFAKB01",115,0)
 N IDX F IDX=1:1:LST S PRGNOTES=PRGNOTES_$$QUOTE^VEFACSP1(ARRTXT(IDX)) I IDX<LST S PRGNOTES=PRGNOTES_"\n"
"RTN","VEFAKB01",116,0)
 QUIT
"RTN","VEFAKB01",117,0)
 ;
"RTN","VEFAKB01",118,0)
GETNAME(IEN) ;return name of Alert Type
"RTN","VEFAKB01",119,0)
 QUIT:$G(IEN)="" ""
"RTN","VEFAKB01",120,0)
 QUIT $$GET1^DIQ(19007,IEN,.01,"E")
"RTN","VEFAKB01",121,0)
 ;
"RTN","VEFAKB01",122,0)
GETSEQ(FILE,IENS) ;return sequence #
"RTN","VEFAKB01",123,0)
 S U="^"
"RTN","VEFAKB01",124,0)
 N IEN S IEN=$P(IENS,",",2)
"RTN","VEFAKB01",125,0)
 N GRP S GRP=$P(FILE,"19007.0",2)
"RTN","VEFAKB01",126,0)
 QUIT:'GRP +IENS
"RTN","VEFAKB01",127,0)
 ;
"RTN","VEFAKB01",128,0)
 ; -- get reminder dialog ien (root)
"RTN","VEFAKB01",129,0)
 N RMDLG S RMDLG=$$GET1^DIQ(19007,IEN,3,"I")
"RTN","VEFAKB01",130,0)
 QUIT:'RMDLG +IENS
"RTN","VEFAKB01",131,0)
 ;
"RTN","VEFAKB01",132,0)
 ; -- get order/follow-up/comment dialog group ien
"RTN","VEFAKB01",133,0)
 N D0 S D0=$P($G(^PXRMD(801.41,RMDLG,10,GRP,0)),U,2)
"RTN","VEFAKB01",134,0)
 QUIT:'D0 +IENS
"RTN","VEFAKB01",135,0)
 ;
"RTN","VEFAKB01",136,0)
 ; -- get element (order/follow-up/comment dialog)
"RTN","VEFAKB01",137,0)
 N ORDLG S ORDLG=$$GET1^DIQ(FILE,IENS,.3,"I")
"RTN","VEFAKB01",138,0)
 QUIT:ORDLG="" +IENS
"RTN","VEFAKB01",139,0)
 S ORDLG=$O(^PXRMD(801.41,"B",ORDLG,0))
"RTN","VEFAKB01",140,0)
 QUIT:'ORDLG +IENS
"RTN","VEFAKB01",141,0)
 ;
"RTN","VEFAKB01",142,0)
 ; -- get item ien
"RTN","VEFAKB01",143,0)
 N D1 S D1=$O(^PXRMD(801.41,D0,10,"D",ORDLG,""))
"RTN","VEFAKB01",144,0)
 QUIT:'D1 +IENS
"RTN","VEFAKB01",145,0)
 ;
"RTN","VEFAKB01",146,0)
 ; -- get sequence number
"RTN","VEFAKB01",147,0)
 N SEQ S SEQ=$P($G(^PXRMD(801.41,D0,10,D1,0)),U)
"RTN","VEFAKB01",148,0)
 QUIT:'SEQ +IENS
"RTN","VEFAKB01",149,0)
 QUIT SEQ
"RTN","VEFAKB01",150,0)
 ;
"RTN","VEFAKB01",151,0)
GETSEQ2(FILE,ALERTTYP,ITEM) ;Return sequence # based on alert type and item (desired reminder element)
"RTN","VEFAKB01",152,0)
 N GRP S GRP=$P(FILE,"19007.0",2)
"RTN","VEFAKB01",153,0)
 QUIT:'GRP 0
"RTN","VEFAKB01",154,0)
 QUIT:ALERTTYP="" 0
"RTN","VEFAKB01",155,0)
 QUIT:ITEM="" 0
"RTN","VEFAKB01",156,0)
 ;
"RTN","VEFAKB01",157,0)
 ; -- get reminder dialog ien (root)
"RTN","VEFAKB01",158,0)
 N RMDLG S RMDLG=$$GET1^DIQ(19007,ALERTTYP,3,"I")
"RTN","VEFAKB01",159,0)
 QUIT:'RMDLG 0
"RTN","VEFAKB01",160,0)
 ;
"RTN","VEFAKB01",161,0)
 ; -- get order/follow-up/comment dialog group ien
"RTN","VEFAKB01",162,0)
 N D0 S D0=$P($G(^PXRMD(801.41,RMDLG,10,GRP,0)),U,2)
"RTN","VEFAKB01",163,0)
 QUIT:'D0 0
"RTN","VEFAKB01",164,0)
 ;
"RTN","VEFAKB01",165,0)
 ; -- get element (order/follow-up/comment dialog)
"RTN","VEFAKB01",166,0)
 N ORDDLG S ORDLG=$O(^PXRMD(801.41,"B",ITEM,0))
"RTN","VEFAKB01",167,0)
 QUIT:'ORDLG 0
"RTN","VEFAKB01",168,0)
 ;
"RTN","VEFAKB01",169,0)
 ; -- get item ien
"RTN","VEFAKB01",170,0)
 N D1 S D1=$O(^PXRMD(801.41,D0,10,"D",ORDLG,""))
"RTN","VEFAKB01",171,0)
 QUIT:'D1 0
"RTN","VEFAKB01",172,0)
 ;
"RTN","VEFAKB01",173,0)
 ; -- get sequence number
"RTN","VEFAKB01",174,0)
 N SEQ S SEQ=$P($G(^PXRMD(801.41,D0,10,D1,0)),U)
"RTN","VEFAKB01",175,0)
 QUIT SEQ
"RTN","VEFAKB02")
0^17^B126966783
"RTN","VEFAKB02",1,0)
VEFAKB02 ;WOIFO/BT - VEFA AWARE KB EDITOR ALERT TYPE API CALLED BY CSP PAGE; 01/22/2014
"RTN","VEFAKB02",2,0)
 ;;1.0;VEFA ALRE;**1**;MAY 1, 2011;Build 33
"RTN","VEFAKB02",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","VEFAKB02",4,0)
 ;;
"RTN","VEFAKB02",5,0)
 ; External Reference DBIA#
"RTN","VEFAKB02",6,0)
 ; ------------------------
"RTN","VEFAKB02",7,0)
 ; #2051   - LIST^DIC (Supported)
"RTN","VEFAKB02",8,0)
 ; #2053   - FILE^DIE (Supported)
"RTN","VEFAKB02",9,0)
 ; #2053   - UPDATE^DIE (Supported)
"RTN","VEFAKB02",10,0)
 ; #2056   - GETS^DIQ (Supported)
"RTN","VEFAKB02",11,0)
 ; #10103  - FMTE^XLFDT (Supported)
"RTN","VEFAKB02",12,0)
 ; #10103  - DT^XLFDT (Supported)
"RTN","VEFAKB02",13,0)
 ; #10104  - UP^XLFSTR (Supported)
"RTN","VEFAKB02",14,0)
 ;
"RTN","VEFAKB02",15,0)
GETATFRM(VEFARSLT,IENS,DTINIT,ACTIVE,SITE) ;get Alert Type info and stored in VEFARSLT
"RTN","VEFAKB02",16,0)
 ;INPUT
"RTN","VEFAKB02",17,0)
 ;  IENS : Record ID of the Alert Type
"RTN","VEFAKB02",18,0)
 ;OUTPUT
"RTN","VEFAKB02",19,0)
 ;  VEFARSLT : Reference Array by field contaiing the field value
"RTN","VEFAKB02",20,0)
 ;  DTINIT  : Initiation Date
"RTN","VEFAKB02",21,0)
 ;  ACTIVE  : Alert Type active (true/false) indicator
"RTN","VEFAKB02",22,0)
 ;  SITE   : Site Number where the Alert Type is created
"RTN","VEFAKB02",23,0)
 ;
"RTN","VEFAKB02",24,0)
 K VEFARSLT
"RTN","VEFAKB02",25,0)
 QUIT:$G(IENS)=""
"RTN","VEFAKB02",26,0)
 N FILE S FILE=19007
"RTN","VEFAKB02",27,0)
 S PRGNOTES=""
"RTN","VEFAKB02",28,0)
 N FLDS S FLDS=".01;3;4;5;6;7;8;9;10;11;16;17;18;19"
"RTN","VEFAKB02",29,0)
 N FLAGS S FLAGS="EI"
"RTN","VEFAKB02",30,0)
 N TARGET,ERR
"RTN","VEFAKB02",31,0)
 ;
"RTN","VEFAKB02",32,0)
 D GETS^DIQ(FILE,IENS,FLDS,FLAGS,"TARGET","ERR")
"RTN","VEFAKB02",33,0)
 QUIT:'$D(TARGET)
"RTN","VEFAKB02",34,0)
 ;
"RTN","VEFAKB02",35,0)
 N FLDIDX
"RTN","VEFAKB02",36,0)
 F FLDIDX=.01,3:1:5,8,9:1:11 S VEFARSLT(FLDIDX)=$$QUOTE^VEFACSP1($G(TARGET(FILE,IENS,FLDIDX,"E")))
"RTN","VEFAKB02",37,0)
 F FLDIDX=16:1:19 S VEFARSLT(FLDIDX)=$$QUOTE^VEFACSP1($G(TARGET(FILE,IENS,FLDIDX,"I")))
"RTN","VEFAKB02",38,0)
 S DTINIT=$G(TARGET(FILE,IENS,6,"I"))
"RTN","VEFAKB02",39,0)
 S:DTINIT'="" DTINIT=$$FMTE^XLFDT(DTINIT,5)
"RTN","VEFAKB02",40,0)
 S ACTIVE=$G(TARGET(FILE,IENS,7,"I"))
"RTN","VEFAKB02",41,0)
 S ACTIVE=$S(ACTIVE:"true",1:"false")
"RTN","VEFAKB02",42,0)
 S SITE=$G(TARGET(FILE,IENS,8,"I"))
"RTN","VEFAKB02",43,0)
 ;S SITE=SITE_" - "_$P(^DIC(4,SITE,0),U)
"RTN","VEFAKB02",44,0)
 QUIT
"RTN","VEFAKB02",45,0)
 ;
"RTN","VEFAKB02",46,0)
GETATLST(VEFARSLT,FILE,IENS) ;get all dialogs (oreder/follow-up/comments) for FILE's IENS
"RTN","VEFAKB02",47,0)
 ;INPUT
"RTN","VEFAKB02",48,0)
 ;  FILE : Alert Type Sub file (Order/follow-up/comments)
"RTN","VEFAKB02",49,0)
 ;  IENS : Alert Type Record ID
"RTN","VEFAKB02",50,0)
 ;OUTPUT
"RTN","VEFAKB02",51,0)
 ;  VEFARSLT : Reference Array contaiing all dialog text records
"RTN","VEFAKB02",52,0)
 ;
"RTN","VEFAKB02",53,0)
 K VEFARSLT
"RTN","VEFAKB02",54,0)
 QUIT:$G(FILE)=""
"RTN","VEFAKB02",55,0)
 QUIT:$G(IENS)=""
"RTN","VEFAKB02",56,0)
 N FIELDS S FIELDS=".01;1;.5;2;1.5;4;3.5;.4"
"RTN","VEFAKB02",57,0)
 N FLAGS S FLAGS=""
"RTN","VEFAKB02",58,0)
 N NUMBER S NUMBER=""
"RTN","VEFAKB02",59,0)
 N FROM,PART
"RTN","VEFAKB02",60,0)
 N INDEX S INDEX="#"
"RTN","VEFAKB02",61,0)
 N SCREEN
"RTN","VEFAKB02",62,0)
 N IDENT S IDENT=""
"RTN","VEFAKB02",63,0)
 N TARGET,ERR
"RTN","VEFAKB02",64,0)
 ;
"RTN","VEFAKB02",65,0)
 D LIST^DIC(FILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFAKB02",66,0)
 N LAST S LAST=$O(TARGET("DILIST","ID"," "),-1)
"RTN","VEFAKB02",67,0)
 N ID S ID=""
"RTN","VEFAKB02",68,0)
 ;
"RTN","VEFAKB02",69,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFAKB02",70,0)
 . N IEN S IEN=TARGET("DILIST",2,ID)
"RTN","VEFAKB02",71,0)
 . N NAME S NAME=TARGET("DILIST","ID",ID,.01)
"RTN","VEFAKB02",72,0)
 . N DISPGRP S DISPGRP=TARGET("DILIST","ID",ID,1)
"RTN","VEFAKB02",73,0)
 . N ITMNAME S ITMNAME=TARGET("DILIST","ID",ID,.5)
"RTN","VEFAKB02",74,0)
 . N DLGGRP S DLGGRP=TARGET("DILIST","ID",ID,2)
"RTN","VEFAKB02",75,0)
 . N ORDDLG S ORDDLG=TARGET("DILIST","ID",ID,1.5)
"RTN","VEFAKB02",76,0)
 . N ADDFIND S ADDFIND=TARGET("DILIST","ID",ID,4)
"RTN","VEFAKB02",77,0)
 . N PKG S PKG=TARGET("DILIST","ID",ID,3.5)
"RTN","VEFAKB02",78,0)
 . N SEQ S SEQ=TARGET("DILIST","ID",ID,.4)
"RTN","VEFAKB02",79,0)
 . N LINE S LINE="  {"
"RTN","VEFAKB02",80,0)
 . S LINE=LINE_"ien:'"_IEN_"',"
"RTN","VEFAKB02",81,0)
 . S LINE=LINE_"boxText:'"_$$QUOTE^VEFACSP1(NAME)_"',"
"RTN","VEFAKB02",82,0)
 . S LINE=LINE_"seq:'"_$$QUOTE^VEFACSP1(SEQ)_"',"
"RTN","VEFAKB02",83,0)
 . S LINE=LINE_"ordItemDispGrp:'"_$$QUOTE^VEFACSP1(DISPGRP)_"',"
"RTN","VEFAKB02",84,0)
 . S LINE=LINE_"ordItemName:'"_$$QUOTE^VEFACSP1(ITMNAME)_"',"
"RTN","VEFAKB02",85,0)
 . S LINE=LINE_"ordDlgDispGrp:'"_$$QUOTE^VEFACSP1(DLGGRP)_"',"
"RTN","VEFAKB02",86,0)
 . S LINE=LINE_"ordDlg:'"_$$QUOTE^VEFACSP1(ORDDLG)_"',"
"RTN","VEFAKB02",87,0)
 . S LINE=LINE_"AddFind:'"_$$QUOTE^VEFACSP1(ADDFIND)_"',"
"RTN","VEFAKB02",88,0)
 . S LINE=LINE_"OrdDlgPkg:'"_$$QUOTE^VEFACSP1(PKG)_"'}"
"RTN","VEFAKB02",89,0)
 . S:ID<LAST LINE=LINE_","
"RTN","VEFAKB02",90,0)
 . S VEFARSLT(ID)=LINE
"RTN","VEFAKB02",91,0)
 QUIT
"RTN","VEFAKB02",92,0)
 ;
"RTN","VEFAKB02",93,0)
SAVATFRM(TODO,FILE,IEN,RECORD,MSG) ;save alert type reminder dialog text
"RTN","VEFAKB02",94,0)
 ;INPUT
"RTN","VEFAKB02",95,0)
 ;  TODO   : add or edit
"RTN","VEFAKB02",96,0)
 ;  FILE   : File Number 
"RTN","VEFAKB02",97,0)
 ;  IEN    : ID of Alert Type to save
"RTN","VEFAKB02",98,0)
 ;  RECORD : Alert Type Record to save
"RTN","VEFAKB02",99,0)
 ;OUTPUT
"RTN","VEFAKB02",100,0)
 ;  MSG    : Error Message
"RTN","VEFAKB02",101,0)
 ;RETURN
"RTN","VEFAKB02",102,0)
 ;  1 - success
"RTN","VEFAKB02",103,0)
 ;  0 - failed
"RTN","VEFAKB02",104,0)
 ;
"RTN","VEFAKB02",105,0)
 S MSG=""
"RTN","VEFAKB02",106,0)
 I $G(FILE)="" S MSG="Invalid FILE" QUIT 0
"RTN","VEFAKB02",107,0)
 I $G(IEN)="" S MSG="Invalid IEN" QUIT 0
"RTN","VEFAKB02",108,0)
 N NAME S NAME=$P(RECORD,"^",1)
"RTN","VEFAKB02",109,0)
 N REMDLG S REMDLG=$P(RECORD,"^",2)
"RTN","VEFAKB02",110,0)
 N TIU S TIU=$P(RECORD,"^",3)
"RTN","VEFAKB02",111,0)
 N CAT S CAT=$P(RECORD,"^",4)
"RTN","VEFAKB02",112,0)
 N INITDT S INITDT=$P(RECORD,"^",5)
"RTN","VEFAKB02",113,0)
 N MNE S MNE=$P(RECORD,"^",6)
"RTN","VEFAKB02",114,0)
 N SITE S SITE=$P(RECORD,"^",7) ;$P(^XTV(8989.3,1,"XUS"),"^",17)
"RTN","VEFAKB02",115,0)
 N ACTIVE S ACTIVE=$p(RECORD,"^",8)
"RTN","VEFAKB02",116,0)
 N DESCR S DESCR=$p(RECORD,"^",9)
"RTN","VEFAKB02",117,0)
 N GENNAME S GENNAME=$p(RECORD,"^",10)
"RTN","VEFAKB02",118,0)
 N DIAGCINC S DIAGCINC=$p(RECORD,"^",11)
"RTN","VEFAKB02",119,0)
 N STOPCINC S STOPCINC=$p(RECORD,"^",12)
"RTN","VEFAKB02",120,0)
 N RPTTINC S RPTTINC=$p(RECORD,"^",13)
"RTN","VEFAKB02",121,0)
 N IMPTINC S IMPTINC=$p(RECORD,"^",14)
"RTN","VEFAKB02",122,0)
 N RPTFILT S RPTFILT=$p(RECORD,"^",15)
"RTN","VEFAKB02",123,0)
 N IMPFILT S IMPFILT=$p(RECORD,"^",16)
"RTN","VEFAKB02",124,0)
 ; 
"RTN","VEFAKB02",125,0)
 N ERR,FDA
"RTN","VEFAKB02",126,0)
 S FDA(FILE,IEN_",",.01)=NAME
"RTN","VEFAKB02",127,0)
 S FDA(FILE,IEN_",",3)=REMDLG
"RTN","VEFAKB02",128,0)
 S FDA(FILE,IEN_",",4)=TIU
"RTN","VEFAKB02",129,0)
 S FDA(FILE,IEN_",",5)=CAT
"RTN","VEFAKB02",130,0)
 S FDA(FILE,IEN_",",7)=ACTIVE
"RTN","VEFAKB02",131,0)
 S FDA(FILE,IEN_",",8)=SITE
"RTN","VEFAKB02",132,0)
 S FDA(FILE,IEN_",",9)=MNE
"RTN","VEFAKB02",133,0)
 S FDA(FILE,IEN_",",10)=DESCR
"RTN","VEFAKB02",134,0)
 S FDA(FILE,IEN_",",11)=GENNAME
"RTN","VEFAKB02",135,0)
 S FDA(FILE,IEN_",",16)=DIAGCINC
"RTN","VEFAKB02",136,0)
 S FDA(FILE,IEN_",",17)=STOPCINC
"RTN","VEFAKB02",137,0)
 S FDA(FILE,IEN_",",18)=RPTTINC
"RTN","VEFAKB02",138,0)
 S FDA(FILE,IEN_",",19)=IMPTINC
"RTN","VEFAKB02",139,0)
 ;
"RTN","VEFAKB02",140,0)
 I TODO="edit" D FILE^DIE("E","FDA","ERR")
"RTN","VEFAKB02",141,0)
 I TODO="add" D
"RTN","VEFAKB02",142,0)
 . S FDA(FILE,IEN_",",6)=INITDT
"RTN","VEFAKB02",143,0)
 . D UPDATE^DIE("E","FDA","","ERR")
"RTN","VEFAKB02",144,0)
 ;
"RTN","VEFAKB02",145,0)
 I $D(ERR) D
"RTN","VEFAKB02",146,0)
 . N ERNO S ERNO=$O(ERR("DIERR",0))
"RTN","VEFAKB02",147,0)
 . S MSG=ERR("DIERR",ERNO,"TEXT",1)
"RTN","VEFAKB02",148,0)
 QUIT:MSG'="" 0
"RTN","VEFAKB02",149,0)
 ;
"RTN","VEFAKB02",150,0)
 I TODO="edit" D
"RTN","VEFAKB02",151,0)
 . N MSG1 S MSG1=$$SAVEFILT(19007.014,IEN,8,RPTFILT)
"RTN","VEFAKB02",152,0)
 . N MSG2 S MSG2=$$SAVEFILT(19007.015,IEN,9,IMPFILT)
"RTN","VEFAKB02",153,0)
 . I MSG1'="" S MSG=MSG1
"RTN","VEFAKB02",154,0)
 . I MSG2'="" S MSG=MSG_"; "_MSG2
"RTN","VEFAKB02",155,0)
 QUIT:MSG'="" 0
"RTN","VEFAKB02",156,0)
 ;
"RTN","VEFAKB02",157,0)
 I NAME="@" S MSG="Alert Type is deleted successfully"
"RTN","VEFAKB02",158,0)
 I NAME'="@" S MSG="Alert Type is "_$S(TODO="add":"added",1:"updated")_" successfully"
"RTN","VEFAKB02",159,0)
 ;
"RTN","VEFAKB02",160,0)
 QUIT 1
"RTN","VEFAKB02",161,0)
 ;
"RTN","VEFAKB02",162,0)
SAVEFILT(SUBFIL,TYPIEN,IDX,FILTER) ;Save Report Text and Impression text
"RTN","VEFAKB02",163,0)
 ;Delete existing previous filter
"RTN","VEFAKB02",164,0)
 N D1 S D1=0
"RTN","VEFAKB02",165,0)
 F  S D1=$O(^DIZ(19007,TYPIEN,IDX,D1)) Q:'D1  D
"RTN","VEFAKB02",166,0)
 . N FDA,ERR
"RTN","VEFAKB02",167,0)
 . S FDA(SUBFIL,D1_","_TYPIEN_",",.01)="@"
"RTN","VEFAKB02",168,0)
 . D FILE^DIE("E","FDA","ERR")
"RTN","VEFAKB02",169,0)
 ;
"RTN","VEFAKB02",170,0)
 ;Add new filter
"RTN","VEFAKB02",171,0)
 N IDX
"RTN","VEFAKB02",172,0)
 F IDX=1:1:$L(FILTER,$C(10)) D
"RTN","VEFAKB02",173,0)
 . N FDA,ERR
"RTN","VEFAKB02",174,0)
 . S FDA(SUBFIL,"+1,"_TYPIEN_",",.01)=$P(FILTER,$C(10),IDX)
"RTN","VEFAKB02",175,0)
 . D UPDATE^DIE("E","FDA","","ERR")
"RTN","VEFAKB02",176,0)
 QUIT ""
"RTN","VEFAKB02",177,0)
 ;
"RTN","VEFAKB02",178,0)
SAVDLG(TODO,FILE,RECORD,TYPEIEN,FILEIDX,IEN,MSG) ; save order/followup/comments dialog
"RTN","VEFAKB02",179,0)
 ;INPUT
"RTN","VEFAKB02",180,0)
 ;  TODO    : add or edit
"RTN","VEFAKB02",181,0)
 ;  FILE    : Sub File Number 
"RTN","VEFAKB02",182,0)
 ;  RECORD  : Alert Type Record to save
"RTN","VEFAKB02",183,0)
 ;  TYPEIEN : Record ID of Alert Type to save
"RTN","VEFAKB02",184,0)
 ;  FILEIDX : Subscript Index representing the Sub File
"RTN","VEFAKB02",185,0)
 ;  IEN     : Record ID of the dialog text
"RTN","VEFAKB02",186,0)
 ;OUTPUT
"RTN","VEFAKB02",187,0)
 ;  MSG     : Error Message
"RTN","VEFAKB02",188,0)
 ;RETURN
"RTN","VEFAKB02",189,0)
 ;  1 - success
"RTN","VEFAKB02",190,0)
 ;  0 - failed
"RTN","VEFAKB02",191,0)
 ;
"RTN","VEFAKB02",192,0)
 I $G(FILE)=""!($G(FILEIDX)="") S MSG="Invalid FILE" QUIT 0
"RTN","VEFAKB02",193,0)
 I $G(TYPEIEN)="" S MSG="Invalid Alert Type IEN" QUIT 0
"RTN","VEFAKB02",194,0)
 S IEN=$G(IEN)
"RTN","VEFAKB02",195,0)
 N NAME S NAME=$P(RECORD,"^",1)
"RTN","VEFAKB02",196,0)
 N DISPGRP S DISPGRP=$P(RECORD,"^",2)
"RTN","VEFAKB02",197,0)
 N ITMNAME S ITMNAME=$P(RECORD,"^",3)
"RTN","VEFAKB02",198,0)
 N DLGGRP S DLGGRP=$P(RECORD,"^",4)
"RTN","VEFAKB02",199,0)
 N ORDDLG S ORDDLG=$P(RECORD,"^",5)
"RTN","VEFAKB02",200,0)
 N ADDFIND S ADDFIND=$P(RECORD,"^",6)
"RTN","VEFAKB02",201,0)
 N PKG S PKG=$P(RECORD,"^",7)
"RTN","VEFAKB02",202,0)
 N CMT S CMT=$P(RECORD,"^",8)
"RTN","VEFAKB02",203,0)
 N DESIRED S DESIRED=$P(RECORD,"^",9)
"RTN","VEFAKB02",204,0)
 N ITEMREQ S ITEMREQ=$P(RECORD,"^",10)
"RTN","VEFAKB02",205,0)
 N SEQ S SEQ=$P(RECORD,"^",11)
"RTN","VEFAKB02",206,0)
 ;
"RTN","VEFAKB02",207,0)
 N ERR,FDA,IENS
"RTN","VEFAKB02",208,0)
 I TODO="edit" S IENS=IEN_","_TYPEIEN
"RTN","VEFAKB02",209,0)
 I TODO="add" S IENS="+1,"_TYPEIEN
"RTN","VEFAKB02",210,0)
 S FDA(FILE,IENS_",",.01)=NAME
"RTN","VEFAKB02",211,0)
 S FDA(FILE,IENS_",",1)=DISPGRP
"RTN","VEFAKB02",212,0)
 S FDA(FILE,IENS_",",.5)=ITMNAME
"RTN","VEFAKB02",213,0)
 S FDA(FILE,IENS_",",2)=DLGGRP
"RTN","VEFAKB02",214,0)
 S FDA(FILE,IENS_",",1.5)=ORDDLG
"RTN","VEFAKB02",215,0)
 S FDA(FILE,IENS_",",4)=ADDFIND
"RTN","VEFAKB02",216,0)
 S FDA(FILE,IENS_",",3.5)=PKG
"RTN","VEFAKB02",217,0)
 S FDA(FILE,IENS_",",6)=CMT
"RTN","VEFAKB02",218,0)
 S FDA(FILE,IENS_",",.3)=DESIRED
"RTN","VEFAKB02",219,0)
 S FDA(FILE,IENS_",",.7)=ITEMREQ
"RTN","VEFAKB02",220,0)
 S FDA(FILE,IENS_",",.4)=SEQ
"RTN","VEFAKB02",221,0)
 ;
"RTN","VEFAKB02",222,0)
 I TODO="edit" D FILE^DIE("E","FDA","ERR")
"RTN","VEFAKB02",223,0)
 I TODO="add" D UPDATE^DIE("E","FDA","","ERR")
"RTN","VEFAKB02",224,0)
 ;
"RTN","VEFAKB02",225,0)
 I $D(ERR) D
"RTN","VEFAKB02",226,0)
 . N ERNO S ERNO=$O(ERR("DIERR",0))
"RTN","VEFAKB02",227,0)
 . S MSG=ERR("DIERR",ERNO,"TEXT",1)
"RTN","VEFAKB02",228,0)
 QUIT:$D(ERR) 0
"RTN","VEFAKB02",229,0)
 ;
"RTN","VEFAKB02",230,0)
 S:NAME="@" MSG="Dialog Text is deleted successfully"
"RTN","VEFAKB02",231,0)
 QUIT:NAME="@" 1
"RTN","VEFAKB02",232,0)
 ;
"RTN","VEFAKB02",233,0)
 S MSG="Dialog Text is "_$S(TODO="add":"added",1:"updated")_" successfully"
"RTN","VEFAKB02",234,0)
 I TODO="add" S IEN=$O(^DIZ(19007,TYPEIEN,FILEIDX,"B",NAME,0))
"RTN","VEFAKB02",235,0)
 ;
"RTN","VEFAKB02",236,0)
 ;I IEN D
"RTN","VEFAKB02",237,0)
 ;. N WPTXT S WPTXT(1)=PRGNOTE
"RTN","VEFAKB02",238,0)
 ;. S IENS=IEN_ ","_TYPEIEN
"RTN","VEFAKB02",239,0)
 ;. D WP^DIE(FILE,IENS_",",5,"","WPTXT","ERR")
"RTN","VEFAKB02",240,0)
 ;. I $D(ERR) S MSG="Problem saving WP field",IEN=""
"RTN","VEFAKB02",241,0)
 ;
"RTN","VEFAKB02",242,0)
 QUIT IEN
"RTN","VEFAKB02",243,0)
 ;
"RTN","VEFAKB02",244,0)
INACTV(NAME) ;deactivate Alert Type - caller must provide Alert Type NAME value
"RTN","VEFAKB02",245,0)
 ;INPUT
"RTN","VEFAKB02",246,0)
 ;  NAME : Alert Type Name
"RTN","VEFAKB02",247,0)
 ;OUTPUT
"RTN","VEFAKB02",248,0)
 ;  ACTIVE field of Alert Type set to 0 (false)
"RTN","VEFAKB02",249,0)
 ;
"RTN","VEFAKB02",250,0)
 QUIT:$G(NAME)=""
"RTN","VEFAKB02",251,0)
 N IEN S IEN=$O(^DIZ(19007,"B",NAME,0))
"RTN","VEFAKB02",252,0)
 QUIT:'IEN
"RTN","VEFAKB02",253,0)
 N FDA S FDA(19007,IEN_",",7)=0
"RTN","VEFAKB02",254,0)
 N ERR D FILE^DIE("","FDA","ERR")
"RTN","VEFAKB02",255,0)
 QUIT
"RTN","VEFAKB02",256,0)
 ;
"RTN","VEFAKB02",257,0)
UPINITDT(NAME) ;Update Initiation Date
"RTN","VEFAKB02",258,0)
 ;INPUT
"RTN","VEFAKB02",259,0)
 ;  NAME : Alert Type Name
"RTN","VEFAKB02",260,0)
 ;OUTPUT
"RTN","VEFAKB02",261,0)
 ;  Initiation Date field of Alert Type set to the current date
"RTN","VEFAKB02",262,0)
 ;
"RTN","VEFAKB02",263,0)
 QUIT:$G(NAME)=""
"RTN","VEFAKB02",264,0)
 N IEN S IEN=$O(^DIZ(19007,"B",NAME,0))
"RTN","VEFAKB02",265,0)
 QUIT:'IEN
"RTN","VEFAKB02",266,0)
 N U S U="^"
"RTN","VEFAKB02",267,0)
 N DTINIT S DTINIT=$P($G(^DIZ(19007,IEN,3)),U,4)
"RTN","VEFAKB02",268,0)
 QUIT:(DTINIT'="")
"RTN","VEFAKB02",269,0)
 N ACTIVE S ACTIVE=$P($G(^DIZ(19007,IEN,3)),U,5)
"RTN","VEFAKB02",270,0)
 QUIT:'ACTIVE
"RTN","VEFAKB02",271,0)
 N FDA S FDA(19007,IEN_",",6)=$$DT^XLFDT
"RTN","VEFAKB02",272,0)
 N ERR D FILE^DIE("","FDA","ERR")
"RTN","VEFAKB02",273,0)
 QUIT
"RTN","VEFAKB02",274,0)
 ;
"RTN","VEFAKB02",275,0)
DELORDLG(FILE,TYPEIEN,ORDIEN) ;delete order dialog box text
"RTN","VEFAKB02",276,0)
 ;INPUT
"RTN","VEFAKB02",277,0)
 ;  FILE   :  Alert Type Sub File for (Order/Follow-up/Comments) dialog
"RTN","VEFAKB02",278,0)
 ;  TYPIEN : Alert Type Record ID (IEN)
"RTN","VEFAKB02",279,0)
 ;  ORDIEN : Alert Type Dialog Record ID
"RTN","VEFAKB02",280,0)
 ;OUTPUT
"RTN","VEFAKB02",281,0)
 ;  Alert Type Dialog Record with IENS (TYPIEN, ordien) removed from Alert Type file
"RTN","VEFAKB02",282,0)
 ;
"RTN","VEFAKB02",283,0)
 N IENS S IENS=ORDIEN_","_TYPEIEN
"RTN","VEFAKB02",284,0)
 N FDA S FDA(FILE,IENS_",",.01)="@"
"RTN","VEFAKB02",285,0)
 N ERR D FILE^DIE("","FDA","ERR")
"RTN","VEFAKB02",286,0)
 ;
"RTN","VEFAKB02",287,0)
 N MSG S MSG="Dialog Text is deleted successfully"
"RTN","VEFAKB02",288,0)
 I $D(ERR) D
"RTN","VEFAKB02",289,0)
 . N ERNO S ERNO=$O(ERR("DIERR",0))
"RTN","VEFAKB02",290,0)
 . S MSG=ERR("DIERR",ERNO,"TEXT",1)
"RTN","VEFAKB02",291,0)
 ;
"RTN","VEFAKB02",292,0)
 QUIT MSG
"RTN","VEFAKB02",293,0)
 ;
"RTN","VEFAKB02",294,0)
CPYALTYP(TYPIEN,MSG) ;copy Alert Type
"RTN","VEFAKB02",295,0)
 ;INPUT
"RTN","VEFAKB02",296,0)
 ;   TYPIEN : Alert Type Record ID (IEN)
"RTN","VEFAKB02",297,0)
 ;OUTPUT
"RTN","VEFAKB02",298,0)
 ;   MSG: Successfull or Error Message
"RTN","VEFAKB02",299,0)
 ;RETURN
"RTN","VEFAKB02",300,0)
 ;    1 : Success
"RTN","VEFAKB02",301,0)
 ;    0 : Failed
"RTN","VEFAKB02",302,0)
 ;
"RTN","VEFAKB02",303,0)
 N FILE S FILE=19007
"RTN","VEFAKB02",304,0)
 N IEN S IEN=TYPIEN_","
"RTN","VEFAKB02",305,0)
 N ALERTTYP D GETS^DIQ(19007,IEN,".01;3;4;5;7;8;9;10;11","E","ALERTTYP")
"RTN","VEFAKB02",306,0)
 S NAME="*"_$G(ALERTTYP(FILE,IEN,.01,"E"))
"RTN","VEFAKB02",307,0)
 I $O(^DIZ(19007,"B",NAME,0)) S MSG="Copy failed. Alert Type: "_NAME_" Exists" QUIT 0
"RTN","VEFAKB02",308,0)
 ;
"RTN","VEFAKB02",309,0)
 N FDA,ERR
"RTN","VEFAKB02",310,0)
 S FDA(FILE,"+1,",.01)=NAME
"RTN","VEFAKB02",311,0)
 S FDA(FILE,"+1,",3)=$G(ALERTTYP(FILE,IEN,3,"E")) ;REM DLG
"RTN","VEFAKB02",312,0)
 S FDA(FILE,"+1,",4)=$G(ALERTTYP(FILE,IEN,4,"E")) ;TIU
"RTN","VEFAKB02",313,0)
 S FDA(FILE,"+1,",5)=$G(ALERTTYP(FILE,IEN,5,"E")) ;CATEGORY
"RTN","VEFAKB02",314,0)
 S FDA(FILE,"+1,",7)="NO" ;ACTIVE
"RTN","VEFAKB02",315,0)
 S FDA(FILE,"+1,",8)=$G(ALERTTYP(FILE,IEN,8,"E")) ;SITE
"RTN","VEFAKB02",316,0)
 S FDA(FILE,"+1,",9)=$G(ALERTTYP(FILE,IEN,9,"E")) ;MNEMONIC
"RTN","VEFAKB02",317,0)
 S FDA(FILE,"+1,",10)=$G(ALERTTYP(FILE,IEN,10,"E")) ;DESCR
"RTN","VEFAKB02",318,0)
 S FDA(FILE,"+1,",11)=$G(ALERTTYP(FILE,IEN,11,"E")) ;GENNAME
"RTN","VEFAKB02",319,0)
 D UPDATE^DIE("E","FDA","","ERR")
"RTN","VEFAKB02",320,0)
 ;
"RTN","VEFAKB02",321,0)
 I $D(ERR) D
"RTN","VEFAKB02",322,0)
 . N ERNO S ERNO=$O(ERR("DIERR",0))
"RTN","VEFAKB02",323,0)
 . S MSG=ERR("DIERR",ERNO,"TEXT",1)
"RTN","VEFAKB02",324,0)
 I '$D(ERR) D
"RTN","VEFAKB02",325,0)
 . S MSG="Alert Type is copied successfully. New Alert Type: "_NAME
"RTN","VEFAKB02",326,0)
 . N NEWIEN S NEWIEN=$O(^DIZ(19007,"B",NAME,0))
"RTN","VEFAKB02",327,0)
 . N OK1 S OK1=$$CPYDLG(19007.01,TYPIEN,NEWIEN,1) ; copy order dialog
"RTN","VEFAKB02",328,0)
 . N OK2 S OK2=$$CPYDLG(19007.02,TYPIEN,NEWIEN,2) ; copy follow-up dialog
"RTN","VEFAKB02",329,0)
 . N OK4 S OK4=$$CPYDLG(19007.03,TYPIEN,NEWIEN,4) ; copy comment dialog
"RTN","VEFAKB02",330,0)
 . I 'OK1!'OK2!'OK4 S ERR=1,MSG="Alert Type is copied but there is at least one error copying Dialogs. New Alert Type: "_NAME
"RTN","VEFAKB02",331,0)
 ;
"RTN","VEFAKB02",332,0)
 QUIT '$D(ERR)
"RTN","VEFAKB02",333,0)
 ;
"RTN","VEFAKB02",334,0)
CPYDLG(SUBFILE,TYPIEN,NEWIEN,IDX) ; copy dialog
"RTN","VEFAKB02",335,0)
 ;INPUT
"RTN","VEFAKB02",336,0)
 ;   SUBFILE : Order/Followup/Comment Dialog
"RTN","VEFAKB02",337,0)
 ;   TYPIEN  : Alert Type Record ID (IEN) to copy from
"RTN","VEFAKB02",338,0)
 ;   NEWIEN  : Alert Type Record ID (IEN) to copy TO
"RTN","VEFAKB02",339,0)
 ;   IDX     : Subfile Index number
"RTN","VEFAKB02",340,0)
 ;RETURN
"RTN","VEFAKB02",341,0)
 ;   0       : Failed
"RTN","VEFAKB02",342,0)
 ;   1       : Success
"RTN","VEFAKB02",343,0)
 ;
"RTN","VEFAKB02",344,0)
 N ERR S ERR=0
"RTN","VEFAKB02",345,0)
 N IENS S IENS="+1,"_NEWIEN_","
"RTN","VEFAKB02",346,0)
 N SEQ S SEQ=0
"RTN","VEFAKB02",347,0)
 F  S SEQ=$O(^DIZ(19007,TYPIEN,IDX,SEQ)) Q:'SEQ  D
"RTN","VEFAKB02",348,0)
 . N FRMIEN S FRMIENS=SEQ_","_TYPIEN_","
"RTN","VEFAKB02",349,0)
 . N DLG D GETS^DIQ(SUBFILE,FRMIENS,".01;1;.5;2;1.5;4;3.5;6;.3;.7;5;.4","E","DLG")
"RTN","VEFAKB02",350,0)
 . S FDA(SUBFILE,IENS,.01)=$G(DLG(SUBFILE,FRMIENS,.01,"E")) ;NAME
"RTN","VEFAKB02",351,0)
 . S FDA(SUBFILE,IENS,1)=$G(DLG(SUBFILE,FRMIENS,1,"E")) ;DISPGRP
"RTN","VEFAKB02",352,0)
 . S FDA(SUBFILE,IENS,.5)=$G(DLG(SUBFILE,FRMIENS,.5,"E")) ;ITMNAME
"RTN","VEFAKB02",353,0)
 . S FDA(SUBFILE,IENS,2)=$G(DLG(SUBFILE,FRMIENS,2,"E")) ;DLGGRP
"RTN","VEFAKB02",354,0)
 . S FDA(SUBFILE,IENS,1.5)=$G(DLG(SUBFILE,FRMIENS,1.5,"E")) ;ORDDLG
"RTN","VEFAKB02",355,0)
 . S FDA(SUBFILE,IENS,4)=$G(DLG(SUBFILE,FRMIENS,4,"E")) ;ADDFIND
"RTN","VEFAKB02",356,0)
 . S FDA(SUBFILE,IENS,3.5)=$G(DLG(SUBFILE,FRMIENS,3.5,"E")) ;PKG
"RTN","VEFAKB02",357,0)
 . S FDA(SUBFILE,IENS,6)=$G(DLG(SUBFILE,FRMIENS,6,"E")) ;CMT
"RTN","VEFAKB02",358,0)
 . S FDA(SUBFILE,IENS,.3)=$G(DLG(SUBFILE,FRMIENS,.3,"E")) ;DESIRED
"RTN","VEFAKB02",359,0)
 . S FDA(SUBFILE,IENS,.7)=$G(DLG(SUBFILE,FRMIENS,.7,"E")) ;ITEMREQ
"RTN","VEFAKB02",360,0)
 . S FDA(SUBFILE,IENS,.4)=$G(DLG(SUBFILE,FRMIENS,.4,"E")) ;SEQ
"RTN","VEFAKB02",361,0)
 . N SAVERR D UPDATE^DIE("E","FDA","","SAVERR")
"RTN","VEFAKB02",362,0)
 . I $D(SAVERR) S ERR=1
"RTN","VEFAKB02",363,0)
 ;
"RTN","VEFAKB02",364,0)
 QUIT 'ERR
"RTN","VEFAKB02",365,0)
 ;
"RTN","VEFAKB02",366,0)
DELALTYP(TYPIEN,MSG) ;delete Alert Type
"RTN","VEFAKB02",367,0)
 ;INPUT
"RTN","VEFAKB02",368,0)
 ;   TYPIEN : Alert Type Record ID (IEN)
"RTN","VEFAKB02",369,0)
 ;OUTPUT
"RTN","VEFAKB02",370,0)
 ;   MSG: Successfull or Error Message
"RTN","VEFAKB02",371,0)
 ;RETURN
"RTN","VEFAKB02",372,0)
 ;    1 : Success
"RTN","VEFAKB02",373,0)
 ;    0 : Failed
"RTN","VEFAKB02",374,0)
 ;
"RTN","VEFAKB02",375,0)
 N FDA S FDA(19007,TYPIEN_",",.01)="@"
"RTN","VEFAKB02",376,0)
 N ERR D FILE^DIE("","FDA","ERR")
"RTN","VEFAKB02",377,0)
 ;
"RTN","VEFAKB02",378,0)
 S MSG="Alert Type is deleted successfully"
"RTN","VEFAKB02",379,0)
 I $D(ERR) D
"RTN","VEFAKB02",380,0)
 . N ERNO S ERNO=$O(ERR("DIERR",0))
"RTN","VEFAKB02",381,0)
 . S MSG=ERR("DIERR",ERNO,"TEXT",1)
"RTN","VEFAKB02",382,0)
 ;
"RTN","VEFAKB02",383,0)
 QUIT '$D(ERR)
"RTN","VEFAKB02",384,0)
 ;
"RTN","VEFAKB02",385,0)
GETATIEN(NAME) ; Given Name, return Alert Type IEN
"RTN","VEFAKB02",386,0)
 QUIT $O(^DIZ(19007,"B",NAME,0))	
"RTN","VEFAKB03")
0^23^B12180480
"RTN","VEFAKB03",1,0)
VEFAKB03 ;WOIFO/BT - VEFA AWARE KB EDITOR ALERT TYPE API CALLED BY CSP PAGE; 01/20/2015
"RTN","VEFAKB03",2,0)
 ;;1.0;VEFA ALRE;**1**;Jan 20, 2015;Build 33
"RTN","VEFAKB03",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","VEFAKB03",4,0)
 ;
"RTN","VEFAKB03",5,0)
ADDCODE(TYPEIEN,FILE,CODE) ;Add Diag Code or Stop Code
"RTN","VEFAKB03",6,0)
 ;INPUT
"RTN","VEFAKB03",7,0)
 ;  TYPEIEN : Record ID/IEN of Alert Type
"RTN","VEFAKB03",8,0)
 ;  FILE    : Diag Code or Stop Code File Number
"RTN","VEFAKB03",9,0)
 ;  CODE    : Diag Code ot Stop Code to save
"RTN","VEFAKB03",10,0)
 ;RETURN
"RTN","VEFAKB03",11,0)
 ;  1 - success
"RTN","VEFAKB03",12,0)
 ;  Error Message - failed
"RTN","VEFAKB03",13,0)
 ;
"RTN","VEFAKB03",14,0)
 N SUBFILE S SUBFILE=$S(FILE=78.3:19007.012,1:19007.013)
"RTN","VEFAKB03",15,0)
 N ERR,RESULT
"RTN","VEFAKB03",16,0)
 N IENS S IENS="+1,"_TYPEIEN
"RTN","VEFAKB03",17,0)
 N FDA S FDA(SUBFILE,IENS_",",.01)=CODE
"RTN","VEFAKB03",18,0)
 D UPDATE^DIE("E","FDA","","ERR")
"RTN","VEFAKB03",19,0)
 ;
"RTN","VEFAKB03",20,0)
 I '$D(ERR) S RESULT=1
"RTN","VEFAKB03",21,0)
 I $D(ERR) D
"RTN","VEFAKB03",22,0)
 . N ERNO S ERNO=$O(ERR("DIERR",0))
"RTN","VEFAKB03",23,0)
 . S RESULT=ERR("DIERR",ERNO,"TEXT",1)
"RTN","VEFAKB03",24,0)
 ;
"RTN","VEFAKB03",25,0)
 QUIT RESULT
"RTN","VEFAKB03",26,0)
 ;
"RTN","VEFAKB03",27,0)
DELCODE(TYPEIEN,FILE,CODE) ;Delete Diag Code or Stop Code
"RTN","VEFAKB03",28,0)
 ;INPUT
"RTN","VEFAKB03",29,0)
 ;  TYPEIEN : Record ID/IEN of Alert Type 
"RTN","VEFAKB03",30,0)
 ;  FILE    : Diag Code or Stop Code File Number
"RTN","VEFAKB03",31,0)
 ;  CODE    : Diag Code ot Stop Code to delete
"RTN","VEFAKB03",32,0)
 ;RETURN
"RTN","VEFAKB03",33,0)
 ;  1 - success
"RTN","VEFAKB03",34,0)
 ;  Error Message - failed
"RTN","VEFAKB03",35,0)
 ;
"RTN","VEFAKB03",36,0)
 N SUBFILE,IDX,IEN,CODEIEN
"RTN","VEFAKB03",37,0)
 I FILE=78.3 D
"RTN","VEFAKB03",38,0)
 . S SUBFILE=19007.012
"RTN","VEFAKB03",39,0)
 . S IDX=6
"RTN","VEFAKB03",40,0)
 . S CODEIEN=$O(^RA(FILE,"B",$E(CODE,1,30),0))
"RTN","VEFAKB03",41,0)
 I FILE=71.5 D
"RTN","VEFAKB03",42,0)
 . S SUBFILE=19007.013
"RTN","VEFAKB03",43,0)
 . S IDX=7
"RTN","VEFAKB03",44,0)
 . S CODEIEN=$O(^DIC(40.7,"B",CODE,0))
"RTN","VEFAKB03",45,0)
 ;
"RTN","VEFAKB03",46,0)
 QUIT:'CODEIEN CODE_" no longer exist"
"RTN","VEFAKB03",47,0)
 ;
"RTN","VEFAKB03",48,0)
 N IDX S IDX=$S(FILE=78.3:6,1:7)
"RTN","VEFAKB03",49,0)
 N ERR,RESULT
"RTN","VEFAKB03",50,0)
 N IEN S IEN=$O(^DIZ(19007,TYPEIEN,IDX,"B",CODEIEN,0))
"RTN","VEFAKB03",51,0)
 N IENS S IENS=IEN_","_TYPEIEN
"RTN","VEFAKB03",52,0)
 N FDA S FDA(SUBFILE,IENS_",",.01)="@"
"RTN","VEFAKB03",53,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","VEFAKB03",54,0)
 ;
"RTN","VEFAKB03",55,0)
 I '$D(ERR) S RESULT=1
"RTN","VEFAKB03",56,0)
 I $D(ERR) D
"RTN","VEFAKB03",57,0)
 . N ERNO S ERNO=$O(ERR("DIERR",0))
"RTN","VEFAKB03",58,0)
 . S RESULT=ERR("DIERR",ERNO,"TEXT",1)
"RTN","VEFAKB03",59,0)
 ;
"RTN","VEFAKB03",60,0)
 QUIT RESULT
"RTN","VEFAKB03",61,0)
 ;
"RTN","VEFAKB03",62,0)
GETCODES(VEFARSLT,FILE,IENS) ;get all dialogs (oreder/follow-up/comments) for FILE's IENS
"RTN","VEFAKB03",63,0)
 ;INPUT
"RTN","VEFAKB03",64,0)
 ;  FILE : Alert Type Sub file (Order/follow-up/comments)
"RTN","VEFAKB03",65,0)
 ;  IENS : Alert Type Record ID
"RTN","VEFAKB03",66,0)
 ;OUTPUT
"RTN","VEFAKB03",67,0)
 ;  VEFARSLT : Reference Array contaiing all dialog text records
"RTN","VEFAKB03",68,0)
 ;
"RTN","VEFAKB03",69,0)
 K VEFARSLT
"RTN","VEFAKB03",70,0)
 QUIT:$G(FILE)=""
"RTN","VEFAKB03",71,0)
 QUIT:$G(IENS)=""
"RTN","VEFAKB03",72,0)
 ;
"RTN","VEFAKB03",73,0)
 N SUBFILE,IDX,IEN,CODEIEN
"RTN","VEFAKB03",74,0)
 I FILE=78.3 S SUBFILE=19007.012
"RTN","VEFAKB03",75,0)
 I FILE=71.5 S SUBFILE=19007.013
"RTN","VEFAKB03",76,0)
 ;
"RTN","VEFAKB03",77,0)
 N FIELDS S FIELDS=".01E"
"RTN","VEFAKB03",78,0)
 N FLAGS S FLAGS=""
"RTN","VEFAKB03",79,0)
 N NUMBER S NUMBER=""
"RTN","VEFAKB03",80,0)
 N FROM,PART
"RTN","VEFAKB03",81,0)
 N INDEX S INDEX="#"
"RTN","VEFAKB03",82,0)
 N SCREEN
"RTN","VEFAKB03",83,0)
 N IDENT S IDENT=""
"RTN","VEFAKB03",84,0)
 N TARGET,ERR
"RTN","VEFAKB03",85,0)
 ;
"RTN","VEFAKB03",86,0)
 D LIST^DIC(SUBFILE,IENS,FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFAKB03",87,0)
 N LAST S LAST=$O(TARGET("DILIST","ID"," "),-1)
"RTN","VEFAKB03",88,0)
 N ID S ID=""
"RTN","VEFAKB03",89,0)
 N CNT S CNT=0
"RTN","VEFAKB03",90,0)
 ;
"RTN","VEFAKB03",91,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFAKB03",92,0)
 . S CNT=CNT+1
"RTN","VEFAKB03",93,0)
 . N NAME S NAME=TARGET("DILIST","ID",ID,.01)
"RTN","VEFAKB03",94,0)
 . N LINE S LINE="  {"
"RTN","VEFAKB03",95,0)
 . S LINE=LINE_"ien:'"_CNT_"',"
"RTN","VEFAKB03",96,0)
 . S LINE=LINE_"code:'"_$$QUOTE^VEFACSP1(NAME)_"'}"
"RTN","VEFAKB03",97,0)
 . S:ID<LAST LINE=LINE_","
"RTN","VEFAKB03",98,0)
 . S VEFARSLT(ID)=LINE
"RTN","VEFAKB03",99,0)
 QUIT
"RTN","VEFAKB03",100,0)
 ;
"RTN","VEFAKB03",101,0)
GETTEXT(TYPIEN,SUBFILE,FILTER) ;get Report Text filter or Impression text filter
"RTN","VEFAKB03",102,0)
 N FIELDS S FIELDS=".01E"
"RTN","VEFAKB03",103,0)
 N FLAGS S FLAGS=""
"RTN","VEFAKB03",104,0)
 N NUMBER S NUMBER=""
"RTN","VEFAKB03",105,0)
 N FROM,PART
"RTN","VEFAKB03",106,0)
 N INDEX S INDEX="#"
"RTN","VEFAKB03",107,0)
 N SCREEN
"RTN","VEFAKB03",108,0)
 N IDENT S IDENT=""
"RTN","VEFAKB03",109,0)
 N TARGET,ERR,NAME
"RTN","VEFAKB03",110,0)
 ;
"RTN","VEFAKB03",111,0)
 D LIST^DIC(SUBFILE,","_TYPIEN_",",FIELDS,FLAGS,NUMBER,.FROM,.PART,INDEX,.SCREEN,IDENT,"TARGET","ERR")
"RTN","VEFAKB03",112,0)
 N ID S ID=""
"RTN","VEFAKB03",113,0)
 S FILTER=""
"RTN","VEFAKB03",114,0)
 ;
"RTN","VEFAKB03",115,0)
 F  S ID=$O(TARGET("DILIST","ID",ID)) Q:ID=""  D
"RTN","VEFAKB03",116,0)
 . S NAME=TARGET("DILIST","ID",ID,.01)
"RTN","VEFAKB03",117,0)
 . S FILTER=FILTER_$$QUOTE^VEFACSP1(NAME)_"\n"
"RTN","VEFAKB03",118,0)
 ;
"RTN","VEFAKB03",119,0)
 S:FILTER'="" FILTER=$P(FILTER,"\n",1,$L(FILTER,"\n")-1)
"RTN","VEFAKB03",120,0)
 QUIT
"SEC","^DIC",19007,19007,0,"AUDIT")
@
"SEC","^DIC",19007,19007,0,"DD")
@
"SEC","^DIC",19007,19007,0,"DEL")
@
"SEC","^DIC",19007,19007,0,"LAYGO")
@
"SEC","^DIC",19007,19007,0,"RD")
#
"SEC","^DIC",19007,19007,0,"WR")
#
"SEC","^DIC",19008,19008,0,"AUDIT")
@
"SEC","^DIC",19008,19008,0,"DD")
@
"SEC","^DIC",19008,19008,0,"DEL")
@
"SEC","^DIC",19008,19008,0,"LAYGO")
@
"SEC","^DIC",19008,19008,0,"RD")
#
"SEC","^DIC",19008,19008,0,"WR")
#
"SEC","^DIC",19008.1,19008.1,0,"AUDIT")
@
"SEC","^DIC",19008.1,19008.1,0,"DD")
@
"SEC","^DIC",19008.1,19008.1,0,"DEL")
@
"SEC","^DIC",19008.1,19008.1,0,"LAYGO")
@
"SEC","^DIC",19008.1,19008.1,0,"RD")
#
"SEC","^DIC",19008.1,19008.1,0,"WR")
#
"SEC","^DIC",19008.2,19008.2,0,"AUDIT")
@
"SEC","^DIC",19008.2,19008.2,0,"DD")
@
"SEC","^DIC",19008.2,19008.2,0,"DEL")
@
"SEC","^DIC",19008.2,19008.2,0,"LAYGO")
@
"SEC","^DIC",19008.2,19008.2,0,"RD")
#
"SEC","^DIC",19008.2,19008.2,0,"WR")
#
"VER")
8.0^22.0
"^DD",101.15,101.15,0)
FIELD^^2^5
"^DD",101.15,101.15,0,"DT")
3010621
"^DD",101.15,101.15,0,"IX","B",101.15,.01)

"^DD",101.15,101.15,0,"NM","OE/RR COM OBJECTS")

"^DD",101.15,101.15,0,"PT",8927,.17)

"^DD",101.15,101.15,0,"VRPK")
OR
"^DD",101.15,101.15,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",101.15,101.15,.01,1,0)
^.1^^0
"^DD",101.15,101.15,.01,1,1,0)
101.15^B
"^DD",101.15,101.15,.01,1,1,1)
S ^ORD(101.15,"B",$E(X,1,30),DA)=""
"^DD",101.15,101.15,.01,1,1,2)
K ^ORD(101.15,"B",$E(X,1,30),DA)
"^DD",101.15,101.15,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",101.15,101.15,.01,"DT")
3010629
"^DD",101.15,101.15,.02,0)
OBJECT GUID^RF^^0;2^K:$L(X)>38!($L(X)<38)!'(X?1"{"8(1U,1N)1"-"4(1U,1N)1"-"4(1U,1N)1"-"4(1U,1N)1"-"12(1U,1N)1"}") X
"^DD",101.15,101.15,.02,3)
Enter Valid GUI in {XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX} format
"^DD",101.15,101.15,.02,21,0)
^.001^1^1^3010620^^^^
"^DD",101.15,101.15,.02,21,1,0)
COM Object GUID
"^DD",101.15,101.15,.02,"DT")
3010620
"^DD",101.15,101.15,.03,0)
INACTIVE^S^I:INACTIVE;^0;3^Q
"^DD",101.15,101.15,.03,3)
Inactivate COM Object
"^DD",101.15,101.15,.03,"DT")
3010620
"^DD",101.15,101.15,.04,0)
PARAM1^F^^0;4^K:$L(X)>30!($L(X)<1) X
"^DD",101.15,101.15,.04,3)
Answer must be 1-30 characters in length.
"^DD",101.15,101.15,.04,21,0)
^.001^1^1^3010621^^
"^DD",101.15,101.15,.04,21,1,0)
Optional parameter to pass to COM object as PARAM1 
"^DD",101.15,101.15,.04,"DT")
3010621
"^DD",101.15,101.15,2,0)
DESCRIPTION^101.152^^2;0
"^DD",101.15,101.15,2,21,0)
^^2^2^3010628^
"^DD",101.15,101.15,2,21,1,0)
Optional description of COM Object.  Should include any contact
"^DD",101.15,101.15,2,21,2,0)
information for vendor or other provider of the COM Object.
"^DD",101.15,101.152,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",101.15,101.152,0,"DT")
3010620
"^DD",101.15,101.152,0,"NM","DESCRIPTION")

"^DD",101.15,101.152,0,"UP")
101.15
"^DD",101.15,101.152,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",101.15,101.152,.01,3)
COM Object Description
"^DD",101.15,101.152,.01,21,0)
^^1^1^3010620^
"^DD",101.15,101.152,.01,21,1,0)
COM Object Description
"^DD",101.15,101.152,.01,"DT")
3010620
"^DD",19007,19007,0)
FIELD^^19^21
"^DD",19007,19007,0,"DDA")
N
"^DD",19007,19007,0,"DT")
3150120
"^DD",19007,19007,0,"IX","B",19007,.01)

"^DD",19007,19007,0,"NM","VEFA Tracked Critical Alert")

"^DD",19007,19007,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3) X
"^DD",19007,19007,.01,1,0)
^.1
"^DD",19007,19007,.01,1,1,0)
19007^B
"^DD",19007,19007,.01,1,1,1)
S ^DIZ(19007,"B",$E(X,1,30),DA)=""
"^DD",19007,19007,.01,1,1,2)
K ^DIZ(19007,"B",$E(X,1,30),DA)
"^DD",19007,19007,.01,3)
Answer must be 3-30 characters in length.
"^DD",19007,19007,.01,"DT")
3140812
"^DD",19007,19007,1,0)
Orders Dialog Box Text^19007.01A^^1;0
"^DD",19007,19007,1,"DT")
3110106
"^DD",19007,19007,2,0)
Followup Dialog Box Text^19007.02A^^2;0
"^DD",19007,19007,2.5,0)
Comments Dialog Box Text^19007.03A^^4;0
"^DD",19007,19007,2.5,3)
Answer must be 3-65 characters in length.
"^DD",19007,19007,2.5,"DT")
3131206
"^DD",19007,19007,3,0)
Reminder Dialog^P801.41'X^PXRMD(801.41,^3;1^K:$$REMDIAL^VEFAALR4(X) X
"^DD",19007,19007,3,"DT")
3140312
"^DD",19007,19007,4,0)
TIU TEMPLATE^P8927'^TIU(8927,^3;2^Q
"^DD",19007,19007,4,"DT")
3110117
"^DD",19007,19007,5,0)
Alert Category^P19008'^DIZ(19008,^3;3^Q
"^DD",19007,19007,5,"DT")
3110309
"^DD",19007,19007,6,0)
INITIATION DATE^DX^^3;4^S %DT="E" D ^%DT S X=Y K:(Y<1)!($$INITDAT^VEFAALR4(DA)) X
"^DD",19007,19007,6,21,0)
^.001^1^1^3110421^^
"^DD",19007,19007,6,21,1,0)
DATE THIS TYPE TRACKING BEGINS
"^DD",19007,19007,6,"DT")
3140212
"^DD",19007,19007,7,0)
ACTIVE^S^0:NO;1:YES;^3;5^Q
"^DD",19007,19007,7,"DT")
3110814
"^DD",19007,19007,8,0)
AWARE Source Site^RF^^3;8^K:$L(X)>8!($L(X)<3) X
"^DD",19007,19007,8,3)
Answer must be 3-8 characters in length.
"^DD",19007,19007,8,"DT")
3131207
"^DD",19007,19007,9,0)
ALERT TYPE MNEMONIC^RF^^3;9^K:$L(X)>4!($L(X)<3) X
"^DD",19007,19007,9,3)
Answer must be 3-4 characters in length.
"^DD",19007,19007,9,"DT")
3140208
"^DD",19007,19007,10,0)
Description^F^^5;1^K:$L(X)>40!($L(X)<3) X
"^DD",19007,19007,10,3)
Answer must be 3-40 characters in length.
"^DD",19007,19007,10,"DT")
3140314
"^DD",19007,19007,11,0)
GENERIC NAME^RF^^5;2^K:$L(X)>30!($L(X)<3) X
"^DD",19007,19007,11,3)
Answer must be 3-30 characters in length.
"^DD",19007,19007,11,"DT")
3140812
"^DD",19007,19007,12,0)
Criteria Diag Code (imaging)^19007.012PA^^6;0
"^DD",19007,19007,12,"DT")
3150104
"^DD",19007,19007,13,0)
Criteria Stop Code (imaging)^19007.013PA^^7;0
"^DD",19007,19007,14,0)
Criteria Report Text (imaging)^19007.014A^^8;0
"^DD",19007,19007,14,"DT")
3150104
"^DD",19007,19007,15,0)
Criteria Impression (imaging)^19007.015A^^9;0
"^DD",19007,19007,16,0)
DIAG CODE FILTER INCLUSION^S^A:Include All Codes;I:Include Codes in the List;E:Exclude Codes in the List;^10;1^Q
"^DD",19007,19007,16,3)
Choose Diag Code Filter Inclusion (A=Include All, I=Include Codes In the List, E=Exclude Codes in the List).
"^DD",19007,19007,16,21,0)
^.001^5^5^3150302^^^
"^DD",19007,19007,16,21,1,0)
This field indicates what kind of filtering applied against the Criteria 
"^DD",19007,19007,16,21,2,0)
Diag Code multiple. The value will be used during alert filtering 
"^DD",19007,19007,16,21,3,0)
process. A = Include All Alerts (no filtering), I = Include only 
"^DD",19007,19007,16,21,4,0)
alerts with diag codes in the Criteria Diag Code multiple, E = Exlude 
"^DD",19007,19007,16,21,5,0)
only alerts with diag codes in the Criteria Diag Code multiple.
"^DD",19007,19007,16,"DT")
3150120
"^DD",19007,19007,17,0)
STOP CODE FILTER INCLUSION^S^A:Include All Stop Codes;I:Include Stop Codes in the List;E:Exclude Stop Codes in the List;^10;2^Q
"^DD",19007,19007,17,3)
Choose Stop Code Filter Inclusion. (A=All Codes,I=Include Codes in the List,E=Exclude Codes in the List).
"^DD",19007,19007,17,21,0)
^^5^5^3150120^
"^DD",19007,19007,17,21,1,0)
This field indicates what kind of filtering applied against the Criteria
"^DD",19007,19007,17,21,2,0)
Stop Code multiple. The value will be used during alert filtering
"^DD",19007,19007,17,21,3,0)
process. A = Include All Alerts (no filtering), I = Include only
"^DD",19007,19007,17,21,4,0)
alerts with Stop codes in the Criteria Stop Code multiple, E = Exlude
"^DD",19007,19007,17,21,5,0)
only alerts with Stop codes in the Criteria Stop Code multiple.
"^DD",19007,19007,17,"DT")
3150120
"^DD",19007,19007,18,0)
REPORT TEXT FILTER INCLUSION^S^A:Include All Report text;I:Include Report text in the List;E:Exclude Report text in the List;^10;3^Q
"^DD",19007,19007,18,3)
Choose Report Text Filter Inclusion (A=Include All,I=Include Codes in the List,E=Exlude Codes in the List).
"^DD",19007,19007,18,21,0)
^.001^5^5^3150303^^^
"^DD",19007,19007,18,21,1,0)
This field indicates what kind of filtering applied against the Criteria
"^DD",19007,19007,18,21,2,0)
Report text multiple. The value will be used during alert filtering
"^DD",19007,19007,18,21,3,0)
process. A = Include All Alerts (no filtering), I = Include only
"^DD",19007,19007,18,21,4,0)
alerts with Report text in the Criteria Report Text multiple, E = Exlude
"^DD",19007,19007,18,21,5,0)
only alerts with Report text in the Criteria Report text  multiple.
"^DD",19007,19007,18,"DT")
3150120
"^DD",19007,19007,19,0)
IMPRESSION FILTER INCLUSION^S^A:Include All Impression texts;I:Include Impression text in the List;E:Exclude Impression etxt in the List;^10;4^Q
"^DD",19007,19007,19,3)
Choose Impression Filter Inclusion (A=Include All,I=Include Codes in the List,E=Exlude Codes inthe List).
"^DD",19007,19007,19,21,0)
^.001^5^5^3150318^^^^
"^DD",19007,19007,19,21,1,0)
This field indicates what kind of filtering applied against the Criteria
"^DD",19007,19007,19,21,2,0)
Impression multiple. The value will be used during alert filtering
"^DD",19007,19007,19,21,3,0)
process. A = Include All Alerts (no filtering), I = Include only
"^DD",19007,19007,19,21,4,0)
alerts with Impression in the Criteria Impression  multiple, E = Exlude
"^DD",19007,19007,19,21,5,0)
only alerts with Impression Text in the Criteria Impression multiple.
"^DD",19007,19007,19,"DT")
3150120
"^DD",19007,19007.01,0)
Orders Dialog Box Text SUB-FIELD^^.4^13
"^DD",19007,19007.01,0,"DT")
3141022
"^DD",19007,19007.01,0,"IX","B",19007.01,.01)

"^DD",19007,19007.01,0,"NM","Orders Dialog Box Text")

"^DD",19007,19007.01,0,"UP")
19007
"^DD",19007,19007.01,.01,0)
Order/Followup Dialog Box Text^RF^^0;1^K:$L(X)>240!($L(X)<1) X
"^DD",19007,19007.01,.01,1,0)
^.1
"^DD",19007,19007.01,.01,1,1,0)
19007.01^B
"^DD",19007,19007.01,.01,1,1,1)
S ^DIZ(19007,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",19007,19007.01,.01,1,1,2)
K ^DIZ(19007,DA(1),1,"B",$E(X,1,30),DA)
"^DD",19007,19007.01,.01,3)
Answer must be 1-240 characters in length.
"^DD",19007,19007.01,.01,"DT")
3131207
"^DD",19007,19007.01,.3,0)
Desired Element Name^RFX^^3;2^S X=$$CHKNAME^VEFAALR4(DA(1),X) K:$L(X)>63!($L(X)<3) X
"^DD",19007,19007.01,.3,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.01,.3,"DT")
3140314
"^DD",19007,19007.01,.4,0)
Sequence Number^NJ8,3^^3;5^K:+X'=X!(X>9999)!(X<.001)!(X?.E1"."4N.N) X
"^DD",19007,19007.01,.4,3)
Type a number between .001 and 9999, 3 decimal digits.
"^DD",19007,19007.01,.4,"DT")
3141022
"^DD",19007,19007.01,.5,0)
Orderable Item Name^FX^^1;2^K:$L(X)>63!($L(X)<3)!($$CHKNAM^ORUTL(X,";^")) X
"^DD",19007,19007.01,.5,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.01,.5,"DT")
3131206
"^DD",19007,19007.01,.7,0)
Orderable Item Required^RS^0:No;1:Yes;^3;3^Q
"^DD",19007,19007.01,.7,"DT")
3131215
"^DD",19007,19007.01,1,0)
Orderable Item Display Group^P100.98'^ORD(100.98,^1;1^Q
"^DD",19007,19007.01,1,"DT")
3131206
"^DD",19007,19007.01,1.5,0)
Order Dialog^F^^1;4^K:$L(X)>63!($L(X)<3) X
"^DD",19007,19007.01,1.5,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.01,1.5,"DT")
3131215
"^DD",19007,19007.01,2,0)
Order Dialog Display Group^P100.98'^ORD(100.98,^1;3^Q
"^DD",19007,19007.01,2,"DT")
3131206
"^DD",19007,19007.01,3.5,0)
Desired Order Dialog Package^P9.4'^DIC(9.4,^1;7^Q
"^DD",19007,19007.01,3.5,"DT")
3140218
"^DD",19007,19007.01,4,0)
Additional Finding^F^^1;5^K:$L(X)>45!($L(X)<9) X
"^DD",19007,19007.01,4,3)
Answer must be 9-45 characters in length.
"^DD",19007,19007.01,4,"DT")
3140208
"^DD",19007,19007.01,5,0)
Progress Note Text^19007.15^^2;0
"^DD",19007,19007.01,5,3)
Answer must be 3-80 characters in length.
"^DD",19007,19007.01,5,"DT")
3131215
"^DD",19007,19007.01,6,0)
Comment Text Box^F^^3;1^K:$L(X)>15!($L(X)<3) X
"^DD",19007,19007.01,6,3)
Answer must be 3-15 characters in length.
"^DD",19007,19007.01,6,"DT")
3131215
"^DD",19007,19007.01,7,0)
Actual Order Dialog Package^P9.4'^DIC(9.4,^3;4^Q
"^DD",19007,19007.01,7,"DT")
3140218
"^DD",19007,19007.012,0)
Criteria Diag Code (imaging) SUB-FIELD^^.01^1
"^DD",19007,19007.012,0,"DT")
3150106
"^DD",19007,19007.012,0,"IX","B",19007.012,.01)

"^DD",19007,19007.012,0,"NM","Criteria Diag Code (imaging)")

"^DD",19007,19007.012,0,"UP")
19007
"^DD",19007,19007.012,.01,0)
Diagnostic Code^P78.3'^RA(78.3,^0;1^Q
"^DD",19007,19007.012,.01,1,0)
^.1
"^DD",19007,19007.012,.01,1,1,0)
19007.012^B
"^DD",19007,19007.012,.01,1,1,1)
S ^DIZ(19007,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",19007,19007.012,.01,1,1,2)
K ^DIZ(19007,DA(1),6,"B",$E(X,1,30),DA)
"^DD",19007,19007.012,.01,3)

"^DD",19007,19007.012,.01,"DT")
3150106
"^DD",19007,19007.013,0)
Criteria Stop Code (imaging) SUB-FIELD^^.01^1
"^DD",19007,19007.013,0,"DT")
3150104
"^DD",19007,19007.013,0,"IX","B",19007.013,.01)

"^DD",19007,19007.013,0,"NM","Criteria Stop Code (imaging)")

"^DD",19007,19007.013,0,"UP")
19007
"^DD",19007,19007.013,.01,0)
Stop Code^P71.5'^RAMIS(71.5,^0;1^Q
"^DD",19007,19007.013,.01,1,0)
^.1
"^DD",19007,19007.013,.01,1,1,0)
19007.013^B
"^DD",19007,19007.013,.01,1,1,1)
S ^DIZ(19007,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",19007,19007.013,.01,1,1,2)
K ^DIZ(19007,DA(1),7,"B",$E(X,1,30),DA)
"^DD",19007,19007.013,.01,"DT")
3150104
"^DD",19007,19007.014,0)
Criteria Report Text (imaging) SUB-FIELD^^.01^1
"^DD",19007,19007.014,0,"DT")
3150104
"^DD",19007,19007.014,0,"IX","B",19007.014,.01)

"^DD",19007,19007.014,0,"NM","Criteria Report Text (imaging)")

"^DD",19007,19007.014,0,"UP")
19007
"^DD",19007,19007.014,.01,0)
Report Text^F^^0;1^K:$L(X)>80!($L(X)<3) X
"^DD",19007,19007.014,.01,1,0)
^.1
"^DD",19007,19007.014,.01,1,1,0)
19007.014^B
"^DD",19007,19007.014,.01,1,1,1)
S ^DIZ(19007,DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",19007,19007.014,.01,1,1,2)
K ^DIZ(19007,DA(1),8,"B",$E(X,1,30),DA)
"^DD",19007,19007.014,.01,3)
Answer must be 3-80 characters in length.
"^DD",19007,19007.014,.01,"DT")
3150104
"^DD",19007,19007.015,0)
Criteria Impression (imaging) SUB-FIELD^^.01^1
"^DD",19007,19007.015,0,"DT")
3150104
"^DD",19007,19007.015,0,"IX","B",19007.015,.01)

"^DD",19007,19007.015,0,"NM","Criteria Impression (imaging)")

"^DD",19007,19007.015,0,"UP")
19007
"^DD",19007,19007.015,.01,0)
Impression Text^F^^0;1^K:$L(X)>80!($L(X)<3) X
"^DD",19007,19007.015,.01,1,0)
^.1
"^DD",19007,19007.015,.01,1,1,0)
19007.015^B
"^DD",19007,19007.015,.01,1,1,1)
S ^DIZ(19007,DA(1),9,"B",$E(X,1,30),DA)=""
"^DD",19007,19007.015,.01,1,1,2)
K ^DIZ(19007,DA(1),9,"B",$E(X,1,30),DA)
"^DD",19007,19007.015,.01,3)
Answer must be 3-80 characters in length.
"^DD",19007,19007.015,.01,"DT")
3150104
"^DD",19007,19007.02,0)
Followup Dialog Box Text SUB-FIELD^^.4^13
"^DD",19007,19007.02,0,"DT")
3141022
"^DD",19007,19007.02,0,"IX","B",19007.02,.01)

"^DD",19007,19007.02,0,"NM","Followup Dialog Box Text")

"^DD",19007,19007.02,0,"UP")
19007
"^DD",19007,19007.02,.01,0)
Followup/Order Dialog Box Text^RF^^0;1^K:$L(X)>240!($L(X)<1) X
"^DD",19007,19007.02,.01,1,0)
^.1
"^DD",19007,19007.02,.01,1,1,0)
19007.02^B
"^DD",19007,19007.02,.01,1,1,1)
S ^DIZ(19007,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",19007,19007.02,.01,1,1,2)
K ^DIZ(19007,DA(1),2,"B",$E(X,1,30),DA)
"^DD",19007,19007.02,.01,3)
Answer must be 1-240 characters in length.
"^DD",19007,19007.02,.01,"DT")
3131207
"^DD",19007,19007.02,.3,0)
Desired Element Name^RFX^^3;2^S X=$$CHKNAME^VEFAALR4(DA(1),X) K:$L(X)>63!($L(X)<3) X
"^DD",19007,19007.02,.3,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.02,.3,"DT")
3140314
"^DD",19007,19007.02,.4,0)
Sequence Number^NJ8,3^^3;5^K:+X'=X!(X>9999)!(X<.001)!(X?.E1"."4N.N) X
"^DD",19007,19007.02,.4,3)
Type a number between .001 and 9999, 3 decimal digits.
"^DD",19007,19007.02,.4,"DT")
3141022
"^DD",19007,19007.02,.5,0)
Orderable Item Name^FX^^1;3^K:$L(X)>63!($L(X)<3)!($$CHKNAM^ORUTL(X,";^")) X
"^DD",19007,19007.02,.5,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.02,.5,"DT")
3131207
"^DD",19007,19007.02,.7,0)
Orderable Item Required^RS^0:No;1:Yes;^3;3^Q
"^DD",19007,19007.02,.7,"DT")
3131215
"^DD",19007,19007.02,1,0)
Orderable Item Display Group^P100.98'^ORD(100.98,^1;1^Q
"^DD",19007,19007.02,1,"DT")
3131207
"^DD",19007,19007.02,1.5,0)
Order Dialog^F^^1;2^K:$L(X)>63!($L(X)<3) X
"^DD",19007,19007.02,1.5,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.02,1.5,"DT")
3131215
"^DD",19007,19007.02,2,0)
Order Dialog Display Group^P100.98'^ORD(100.98,^1;4^Q
"^DD",19007,19007.02,2,"DT")
3131207
"^DD",19007,19007.02,3.5,0)
Desired Order Dialog Package^P9.4'^DIC(9.4,^1;5^Q
"^DD",19007,19007.02,3.5,"DT")
3140218
"^DD",19007,19007.02,4,0)
Additional Finding^F^^1;6^K:$L(X)>45!($L(X)<9) X
"^DD",19007,19007.02,4,3)
Answer must be 9-45 characters in length.
"^DD",19007,19007.02,4,"DT")
3140208
"^DD",19007,19007.02,5,0)
Progress Note Text^19007.25^^2;0
"^DD",19007,19007.02,5,3)
Answer must be 3-80 characters in length.
"^DD",19007,19007.02,5,"DT")
3131207
"^DD",19007,19007.02,6,0)
Comment Text Box^F^^3;1^K:$L(X)>15!($L(X)<3) X
"^DD",19007,19007.02,6,3)
Answer must be 3-15 characters in length.
"^DD",19007,19007.02,6,"DT")
3131215
"^DD",19007,19007.02,7,0)
Actual Order Dialog Package^P9.4'^DIC(9.4,^3;4^Q
"^DD",19007,19007.02,7,"DT")
3140218
"^DD",19007,19007.03,0)
Comments Dialog Box Text SUB-FIELD^^.4^13
"^DD",19007,19007.03,0,"DT")
3141022
"^DD",19007,19007.03,0,"IX","B",19007.03,.01)

"^DD",19007,19007.03,0,"NM","Comments Dialog Box Text")

"^DD",19007,19007.03,0,"UP")
19007
"^DD",19007,19007.03,.01,0)
Comments Dialog Box Text^F^^0;1^K:$L(X)>80!($L(X)<3) X
"^DD",19007,19007.03,.01,1,0)
^.1
"^DD",19007,19007.03,.01,1,1,0)
19007.03^B
"^DD",19007,19007.03,.01,1,1,1)
S ^DIZ(19007,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",19007,19007.03,.01,1,1,2)
K ^DIZ(19007,DA(1),4,"B",$E(X,1,30),DA)
"^DD",19007,19007.03,.01,3)
Answer must be 3-80 characters in length.
"^DD",19007,19007.03,.01,"DT")
3131215
"^DD",19007,19007.03,.3,0)
Desired Element Name^RFX^^3;2^S X=$$CHKNAME^VEFAALR4(DA(1),X) K:$L(X)>63!($L(X)<3) X
"^DD",19007,19007.03,.3,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.03,.3,"DT")
3140314
"^DD",19007,19007.03,.4,0)
Sequence Number^NJ8,3^^3;5^K:+X'=X!(X>9999)!(X<.001)!(X?.E1"."4N.N) X
"^DD",19007,19007.03,.4,3)
Type a number between .001 and 9999, 3 decimal digits.
"^DD",19007,19007.03,.4,"DT")
3141022
"^DD",19007,19007.03,.5,0)
Orderable Item Name^F^^1;2^K:$L(X)>63!($L(X)<3) X
"^DD",19007,19007.03,.5,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.03,.5,"DT")
3131215
"^DD",19007,19007.03,.7,0)
Orderable Item Required^RS^0:No;1:Yes;^3;3^Q
"^DD",19007,19007.03,.7,"DT")
3131215
"^DD",19007,19007.03,1,0)
Orderable Item Display Group^P100.98'^ORD(100.98,^1;1^Q
"^DD",19007,19007.03,1,"DT")
3131215
"^DD",19007,19007.03,1.5,0)
Order Dialog^F^^1;4^K:$L(X)>63!($L(X)<3) X
"^DD",19007,19007.03,1.5,3)
Answer must be 3-63 characters in length.
"^DD",19007,19007.03,1.5,"DT")
3131215
"^DD",19007,19007.03,2,0)
Order Dialog Display Group^P100.98'^ORD(100.98,^1;3^Q
"^DD",19007,19007.03,2,"DT")
3131215
"^DD",19007,19007.03,3.5,0)
Order Dialog Package^P9.4'^DIC(9.4,^1;7^Q
"^DD",19007,19007.03,3.5,"DT")
3131215
"^DD",19007,19007.03,4,0)
Additional Finding^F^^1;5^K:$L(X)>45!($L(X)<9) X
"^DD",19007,19007.03,4,3)
Answer must be 9-45 characters in length.
"^DD",19007,19007.03,4,"DT")
3140208
"^DD",19007,19007.03,5,0)
Progress Note Text^19007.35^^2;0
"^DD",19007,19007.03,6,0)
Comment Text Box^F^^3;1^K:$L(X)>15!($L(X)<3) X
"^DD",19007,19007.03,6,3)
Answer must be 3-15 characters in length.
"^DD",19007,19007.03,6,"DT")
3131215
"^DD",19007,19007.03,7,0)
Actual Order Dialog Package^P9.4'^DIC(9.4,^3;4^Q
"^DD",19007,19007.03,7,"DT")
3140311
"^DD",19007,19007.15,0)
Progress Note Text SUB-FIELD^^.01^1
"^DD",19007,19007.15,0,"DT")
3131215
"^DD",19007,19007.15,0,"NM","Progress Note Text")

"^DD",19007,19007.15,0,"UP")
19007.01
"^DD",19007,19007.15,.01,0)
Progress Note Text^W^^0;1^Q
"^DD",19007,19007.15,.01,"DT")
3131215
"^DD",19007,19007.25,0)
Progress Note Text SUB-FIELD^^.01^1
"^DD",19007,19007.25,0,"DT")
3131215
"^DD",19007,19007.25,0,"NM","Progress Note Text")

"^DD",19007,19007.25,0,"UP")
19007.02
"^DD",19007,19007.25,.01,0)
Progress Note Text^W^^0;1^Q
"^DD",19007,19007.25,.01,"DT")
3131215
"^DD",19007,19007.35,0)
Progress Note Text SUB-FIELD^^.01^1
"^DD",19007,19007.35,0,"DT")
3131215
"^DD",19007,19007.35,0,"NM","Progress Note Text")

"^DD",19007,19007.35,0,"UP")
19007.03
"^DD",19007,19007.35,.01,0)
Progress Note Text^W^^0;1^Q
"^DD",19007,19007.35,.01,"DT")
3131215
"^DD",19008,19008,0)
FIELD^^4^5
"^DD",19008,19008,0,"DDA")
N
"^DD",19008,19008,0,"DT")
3110410
"^DD",19008,19008,0,"IX","B",19008,.01)

"^DD",19008,19008,0,"NM","VEFA CRITICAL ALERT CATEGORY")

"^DD",19008,19008,0,"PT",19007,5)

"^DD",19008,19008,.01,0)
NAME^RFXI^^0;1^K:$L(X)>60!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",19008,19008,.01,1,0)
^.1
"^DD",19008,19008,.01,1,1,0)
19008^B
"^DD",19008,19008,.01,1,1,1)
S ^DIZ(19008,"B",$E(X,1,60),DA)=""
"^DD",19008,19008,.01,1,1,2)
K ^DIZ(19008,"B",$E(X,1,60),DA)
"^DD",19008,19008,.01,3)
NAME MUST BE 3-60 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",19008,19008,.01,"DT")
3110313
"^DD",19008,19008,1,0)
DELETE ALERT^S^0:NO;1:YES-I(INFORMATIONAL ONLY);2:YES- NORMAL NON-CONDITIONAL ALERT;3:YES-BOTH OR ANY TYPE OF ALERT;^0;2^Q
"^DD",19008,19008,1,"DT")
3110309
"^DD",19008,19008,2,0)
UPON FOLLOW-UP ACTION^S^0:NO;1:YES;^0;3^Q
"^DD",19008,19008,2,21,0)
^^2^2^3110309^
"^DD",19008,19008,2,21,1,0)
UPON COMPLETED/SIGNED FOLLOW-UP ORDER IN VEFA Tracked Alerts file entry.
"^DD",19008,19008,2,21,2,0)
For entries in this file belonging to this VEFA ALERT CATEGORY
"^DD",19008,19008,2,"DT")
3110828
"^DD",19008,19008,3,0)
DESCRIPTION^F^^1;1^K:$L(X)>40!($L(X)<3) X
"^DD",19008,19008,3,3)
Answer must be 3-40 characters in length.
"^DD",19008,19008,3,21,0)
^^1^1^3110309^
"^DD",19008,19008,3,21,1,0)
Description of general category "class" of alert
"^DD",19008,19008,3,"DT")
3110309
"^DD",19008,19008,4,0)
NOTIFICATION TYPE^RNJ3,0X^^1;2^K:($$CHKNOTI^VEFAALR4(DA,X))!(+X'=X)!(X>904)!(X<3)!(X?.E1"."1N.N) X
"^DD",19008,19008,4,3)
Type a number between 3 and 904, 0 decimal digits.
"^DD",19008,19008,4,"DT")
3140217
"^DD",19008.1,19008.1,0)
FIELD^^8^6
"^DD",19008.1,19008.1,0,"DDA")
N
"^DD",19008.1,19008.1,0,"DT")
3140824
"^DD",19008.1,19008.1,0,"IX","B",19008.1,.01)

"^DD",19008.1,19008.1,0,"NM","VEFA AWARE ALERT PARAMETER")

"^DD",19008.1,19008.1,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",19008.1,19008.1,.01,1,0)
^.1
"^DD",19008.1,19008.1,.01,1,1,0)
19008.1^B
"^DD",19008.1,19008.1,.01,1,1,1)
S ^DIZ(19008.1,"B",$E(X,1,30),DA)=""
"^DD",19008.1,19008.1,.01,1,1,2)
K ^DIZ(19008.1,"B",$E(X,1,30),DA)
"^DD",19008.1,19008.1,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",19008.1,19008.1,1,0)
LAST PROCESS START DATE TIME^DI^^0;2^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",19008.1,19008.1,1,"DT")
3140513
"^DD",19008.1,19008.1,5,0)
LAST EXTRACT DATE TIME^DI^^0;6^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",19008.1,19008.1,5,"DT")
3140513
"^DD",19008.1,19008.1,6,0)
CACHE WINDOW^RNJ4,0^^0;3^K:+X'=X!(X>1000)!(X<1)!(X?.E1"."1N.N) X
"^DD",19008.1,19008.1,6,3)
Type a number between 1 and 1000, 0 decimal digits.
"^DD",19008.1,19008.1,6,"DT")
3140328
"^DD",19008.1,19008.1,7,0)
END DATE^D^^0;4^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",19008.1,19008.1,7,"DT")
3140824
"^DD",19008.1,19008.1,8,0)
LAST PROCESS END DATE TIME^D^^0;5^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",19008.1,19008.1,8,"DT")
3140822
"^DD",19008.2,19008.2,0)
FIELD^^25^26
"^DD",19008.2,19008.2,0,"DDA")
N
"^DD",19008.2,19008.2,0,"DT")
3140821
"^DD",19008.2,19008.2,0,"ID",1)
W "   ",$$FMTE^DILIBF($P(^(0),U,2),6)
"^DD",19008.2,19008.2,0,"ID",4)
W "   ",$P(^(0),U,5)
"^DD",19008.2,19008.2,0,"IX","B",19008.2,.01)

"^DD",19008.2,19008.2,0,"IX","C",19008.2,1)

"^DD",19008.2,19008.2,0,"IX","D",19008.2,4)

"^DD",19008.2,19008.2,0,"NM","VEFA AWARE ALERT CACHE")

"^DD",19008.2,19008.2,.01,0)
ALERTID^RF^^0;1^K:$L(X)>80!($L(X)<3) X
"^DD",19008.2,19008.2,.01,1,0)
^.1
"^DD",19008.2,19008.2,.01,1,1,0)
19008.2^B
"^DD",19008.2,19008.2,.01,1,1,1)
S ^DIZ(19008.2,"B",$E(X,1,80),DA)=""
"^DD",19008.2,19008.2,.01,1,1,2)
K ^DIZ(19008.2,"B",$E(X,1,80),DA)
"^DD",19008.2,19008.2,.01,3)
Answer must be 3-80 characters in length.
"^DD",19008.2,19008.2,.01,"DT")
3131124
"^DD",19008.2,19008.2,1,0)
DATETIME^RD^^0;2^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",19008.2,19008.2,1,1,0)
^.1
"^DD",19008.2,19008.2,1,1,1,0)
19008.2^C
"^DD",19008.2,19008.2,1,1,1,1)
S ^DIZ(19008.2,"C",$E(X,1,30),DA)=""
"^DD",19008.2,19008.2,1,1,1,2)
K ^DIZ(19008.2,"C",$E(X,1,30),DA)
"^DD",19008.2,19008.2,1,1,1,"DT")
3131124
"^DD",19008.2,19008.2,1,3)

"^DD",19008.2,19008.2,1,"DT")
3131124
"^DD",19008.2,19008.2,2,0)
FACILITY NAME^RF^^0;3^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,2,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,2,"DT")
3131123
"^DD",19008.2,19008.2,3,0)
SERVICE^F^^0;4^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,3,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,3,"DT")
3131123
"^DD",19008.2,19008.2,4,0)
ORDERING PROVIDER^F^^0;5^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,4,1,0)
^.1
"^DD",19008.2,19008.2,4,1,1,0)
19008.2^D
"^DD",19008.2,19008.2,4,1,1,1)
S ^DIZ(19008.2,"D",$E(X,1,45),DA)=""
"^DD",19008.2,19008.2,4,1,1,2)
K ^DIZ(19008.2,"D",$E(X,1,45),DA)
"^DD",19008.2,19008.2,4,1,1,"DT")
3131125
"^DD",19008.2,19008.2,4,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,4,"DT")
3131125
"^DD",19008.2,19008.2,5,0)
ALERT RECIPIENTS^F^^1;1^K:$L(X)>80!($L(X)<3) X
"^DD",19008.2,19008.2,5,3)
Answer must be 3-80 characters in length.
"^DD",19008.2,19008.2,5,"DT")
3131217
"^DD",19008.2,19008.2,6,0)
PATIENT^RF^^1;2^K:$L(X)>60!($L(X)<3) X
"^DD",19008.2,19008.2,6,3)
Answer must be 3-60 characters in length.
"^DD",19008.2,19008.2,6,"DT")
3131123
"^DD",19008.2,19008.2,7,0)
ALERT CATEGORY^RF^^1;3^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,7,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,7,"DT")
3131123
"^DD",19008.2,19008.2,8,0)
ALERT TYPE^RF^^1;4^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,8,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,8,"DT")
3131123
"^DD",19008.2,19008.2,9,0)
UNACKSTATUS^F^^2;1^K:$L(X)>80!($L(X)<3) X
"^DD",19008.2,19008.2,9,3)
Answer must be 3-80 characters in length.
"^DD",19008.2,19008.2,9,"DT")
3131217
"^DD",19008.2,19008.2,10,0)
ACKRENEWDATE^D^^2;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",19008.2,19008.2,10,3)

"^DD",19008.2,19008.2,10,"DT")
3140128
"^DD",19008.2,19008.2,11,0)
DELETEDATE^D^^2;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",19008.2,19008.2,11,3)

"^DD",19008.2,19008.2,11,"DT")
3140128
"^DD",19008.2,19008.2,12,0)
FAT STATUS^F^^2;4^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,12,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,12,"DT")
3131123
"^DD",19008.2,19008.2,13,0)
FAT PROVIDER^F^^3;1^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,13,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,13,"DT")
3131123
"^DD",19008.2,19008.2,14,0)
FOLLOW-UP PROVIDER ID^F^^3;2^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,14,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,14,"DT")
3131217
"^DD",19008.2,19008.2,15,0)
FOLLOWUP ACTIONS^19008.215A^^4;0
"^DD",19008.2,19008.2,16,0)
CLINIC^F^^5;1^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,16,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,16,"DT")
3131124
"^DD",19008.2,19008.2,17,0)
PATIENTID^NJ14,0^^5;2^K:+X'=X!(X>99999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",19008.2,19008.2,17,3)
Type a Number between 1 and 99999999999999, 0 Decimal Digits
"^DD",19008.2,19008.2,17,"DT")
3131124
"^DD",19008.2,19008.2,18,0)
ALERT RESULTOR^F^^5;3^K:$L(X)>80!($L(X)<3) X
"^DD",19008.2,19008.2,18,3)
Answer must be 3-80 characters in length.
"^DD",19008.2,19008.2,18,"DT")
3131217
"^DD",19008.2,19008.2,19,0)
RESULTOR PERSON CLASS^F^^5;4^K:$L(X)>80!($L(X)<3) X
"^DD",19008.2,19008.2,19,3)
Answer must be 3-80 characters in length.
"^DD",19008.2,19008.2,19,"DT")
3131217
"^DD",19008.2,19008.2,20,0)
ALERT TYPE ORIG STATION^F^^5;5^K:$L(X)>15!($L(X)<3) X
"^DD",19008.2,19008.2,20,3)
Answer must be 3-15 characters in length.
"^DD",19008.2,19008.2,20,"DT")
3131222
"^DD",19008.2,19008.2,21,0)
FOLLOWUP>7D^S^0:NO;1:YES;^5;6^Q
"^DD",19008.2,19008.2,21,"DT")
3140123
"^DD",19008.2,19008.2,22,0)
ACK>7D^S^0:NO;1:YES;^5;7^Q
"^DD",19008.2,19008.2,22,"DT")
3140123
"^DD",19008.2,19008.2,23,0)
ALERTVALUE^F^^6;1^K:$L(X)>60!($L(X)<3) X
"^DD",19008.2,19008.2,23,3)
Answer must be 3-60 characters in length.
"^DD",19008.2,19008.2,23,"DT")
3140128
"^DD",19008.2,19008.2,24,0)
FOLLOW-UPS^S^0:NO;1:YES;^6;2^Q
"^DD",19008.2,19008.2,24,"DT")
3140328
"^DD",19008.2,19008.2,25,0)
ORIG ALERT TYPE^F^^6;3^K:$L(X)>45!($L(X)<3) X
"^DD",19008.2,19008.2,25,3)
Answer must be 3-45 characters in length.
"^DD",19008.2,19008.2,25,"DT")
3140821
"^DD",19008.2,19008.215,0)
FOLLOWUP ACTIONS SUB-FIELD^^1^2
"^DD",19008.2,19008.215,0,"DT")
3131123
"^DD",19008.2,19008.215,0,"IX","B",19008.215,.01)

"^DD",19008.2,19008.215,0,"NM","FOLLOWUP ACTIONS")

"^DD",19008.2,19008.215,0,"UP")
19008.2
"^DD",19008.2,19008.215,.01,0)
FOLLOWUP ACTIONS^F^^0;1^K:$L(X)>80!($L(X)<3) X
"^DD",19008.2,19008.215,.01,1,0)
^.1
"^DD",19008.2,19008.215,.01,1,1,0)
19008.215^B
"^DD",19008.2,19008.215,.01,1,1,1)
S ^DIZ(19008.2,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",19008.2,19008.215,.01,1,1,2)
K ^DIZ(19008.2,DA(1),4,"B",$E(X,1,30),DA)
"^DD",19008.2,19008.215,.01,3)
Answer must be 3-80 characters in length.
"^DD",19008.2,19008.215,.01,"DT")
3131123
"^DD",19008.2,19008.215,1,0)
DATE/TIME^D^^0;2^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",19008.2,19008.215,1,"DT")
3131123
"^DIC",101.15,101.15,0)
OE/RR COM OBJECTS^101.15
"^DIC",101.15,101.15,0,"GL")
^ORD(101.15,
"^DIC",101.15,"B","OE/RR COM OBJECTS",101.15)

"^DIC",19007,19007,0)
VEFA Tracked Critical Alert^19007
"^DIC",19007,19007,0,"GL")
^DIZ(19007,
"^DIC",19007,19007,"%",0)
^1.005^^0
"^DIC",19007,"B","VEFA Tracked Critical Alert",19007)

"^DIC",19008,19008,0)
VEFA CRITICAL ALERT CATEGORY^19008
"^DIC",19008,19008,0,"GL")
^DIZ(19008,
"^DIC",19008,19008,"%D",0)
^1.001^1^1^3140824^^^^
"^DIC",19008,19008,"%D",1,0)
GENERAL CATEGORES LIKE "CRITICAL LABS" "ABNORMAL IMAGES' FOR CRITICAL ALRERT  FOLLOWUP ACTIONS
"^DIC",19008,"B","VEFA CRITICAL ALERT CATEGORY",19008)

"^DIC",19008.1,19008.1,0)
VEFA AWARE ALERT PARAMETER^19008.1
"^DIC",19008.1,19008.1,0,"GL")
^DIZ(19008.1,
"^DIC",19008.1,19008.1,"%",0)
^1.005^^
"^DIC",19008.1,"B","VEFA AWARE ALERT PARAMETER",19008.1)

"^DIC",19008.2,19008.2,0)
VEFA AWARE ALERT CACHE^19008.2
"^DIC",19008.2,19008.2,0,"GL")
^DIZ(19008.2,
"^DIC",19008.2,"B","VEFA AWARE ALERT CACHE",19008.2)

**END**
**END**
