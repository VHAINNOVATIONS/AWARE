KIDS Distribution saved on Aug 24, 2014@21:07:15
Lab and Abnormal Image Test Alert Generation 1.5
**KIDS**:VEFA ZEVH 1.5^

**INSTALL NAME**
VEFA ZEVH 1.5
"BLD",8873,0)
VEFA ZEVH 1.5^^0^3140824^n
"BLD",8873,4,0)
^9.64PA^^
"BLD",8873,6.3)
8
"BLD",8873,"KRN",0)
^9.67PA^779.2^20
"BLD",8873,"KRN",.4,0)
.4
"BLD",8873,"KRN",.401,0)
.401
"BLD",8873,"KRN",.402,0)
.402
"BLD",8873,"KRN",.403,0)
.403
"BLD",8873,"KRN",.5,0)
.5
"BLD",8873,"KRN",.84,0)
.84
"BLD",8873,"KRN",3.6,0)
3.6
"BLD",8873,"KRN",3.8,0)
3.8
"BLD",8873,"KRN",9.2,0)
9.2
"BLD",8873,"KRN",9.8,0)
9.8
"BLD",8873,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",8873,"KRN",9.8,"NM",1,0)
LRZORD^^0^B65736758
"BLD",8873,"KRN",9.8,"NM",2,0)
LRZORD1^^0^B27399035
"BLD",8873,"KRN",9.8,"NM",3,0)
LRZOE^^0^B25859095
"BLD",8873,"KRN",9.8,"NM",4,0)
LRZOE2^^0^B13493436
"BLD",8873,"KRN",9.8,"NM",5,0)
RADZVEFA^^0^B42759552
"BLD",8873,"KRN",9.8,"NM",6,0)
LRZOS^^0^B30649212
"BLD",8873,"KRN",9.8,"NM",7,0)
LRZVER1^^0^B30341470
"BLD",8873,"KRN",9.8,"NM",8,0)
LRZVER2^^0^B8377204
"BLD",8873,"KRN",9.8,"NM",9,0)
LRZVER3^^0^B49940990
"BLD",8873,"KRN",9.8,"NM",10,0)
LRZVER4^^0^B83521480
"BLD",8873,"KRN",9.8,"NM",11,0)
LRZVER5^^0^B83422732
"BLD",8873,"KRN",9.8,"NM","B","LRZOE",3)

"BLD",8873,"KRN",9.8,"NM","B","LRZOE2",4)

"BLD",8873,"KRN",9.8,"NM","B","LRZORD",1)

"BLD",8873,"KRN",9.8,"NM","B","LRZORD1",2)

"BLD",8873,"KRN",9.8,"NM","B","LRZOS",6)

"BLD",8873,"KRN",9.8,"NM","B","LRZVER1",7)

"BLD",8873,"KRN",9.8,"NM","B","LRZVER2",8)

"BLD",8873,"KRN",9.8,"NM","B","LRZVER3",9)

"BLD",8873,"KRN",9.8,"NM","B","LRZVER4",10)

"BLD",8873,"KRN",9.8,"NM","B","LRZVER5",11)

"BLD",8873,"KRN",9.8,"NM","B","RADZVEFA",5)

"BLD",8873,"KRN",19,0)
19
"BLD",8873,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",8873,"KRN",19,"NM",1,0)
ZZVEHU LAB DATA ENTRY^^0
"BLD",8873,"KRN",19,"NM",3,0)
ZZVEFA ENTER IMAGING ALERT^^0
"BLD",8873,"KRN",19,"NM","B","ZZVEFA ENTER IMAGING ALERT",3)

"BLD",8873,"KRN",19,"NM","B","ZZVEHU LAB DATA ENTRY",1)

"BLD",8873,"KRN",19.1,0)
19.1
"BLD",8873,"KRN",101,0)
101
"BLD",8873,"KRN",409.61,0)
409.61
"BLD",8873,"KRN",771,0)
771
"BLD",8873,"KRN",779.2,0)
779.2
"BLD",8873,"KRN",870,0)
870
"BLD",8873,"KRN",8989.51,0)
8989.51
"BLD",8873,"KRN",8989.52,0)
8989.52
"BLD",8873,"KRN",8994,0)
8994
"BLD",8873,"KRN","B",.4,.4)

"BLD",8873,"KRN","B",.401,.401)

"BLD",8873,"KRN","B",.402,.402)

"BLD",8873,"KRN","B",.403,.403)

"BLD",8873,"KRN","B",.5,.5)

"BLD",8873,"KRN","B",.84,.84)

"BLD",8873,"KRN","B",3.6,3.6)

"BLD",8873,"KRN","B",3.8,3.8)

"BLD",8873,"KRN","B",9.2,9.2)

"BLD",8873,"KRN","B",9.8,9.8)

"BLD",8873,"KRN","B",19,19)

"BLD",8873,"KRN","B",19.1,19.1)

"BLD",8873,"KRN","B",101,101)

"BLD",8873,"KRN","B",409.61,409.61)

"BLD",8873,"KRN","B",771,771)

"BLD",8873,"KRN","B",779.2,779.2)

"BLD",8873,"KRN","B",870,870)

"BLD",8873,"KRN","B",8989.51,8989.51)

"BLD",8873,"KRN","B",8989.52,8989.52)

"BLD",8873,"KRN","B",8994,8994)

"KRN",19,13440,-1)
0^1
"KRN",19,13440,0)
ZZVEHU LAB DATA ENTRY^Enter lab data for VEHU patients^^R^^^^^^^^
"KRN",19,13440,1,0)
^^2^2^3061214^
"KRN",19,13440,1,1,0)
This option can be used to enter lab data on a group of patients in
"KRN",19,13440,1,2,0)
the usual VEHU range of patients. 
"KRN",19,13440,25)
VEHU^LRZORD
"KRN",19,13440,99.1)
63227,59951
"KRN",19,13440,"U")
ENTER LAB DATA FOR VEHU PATIEN
"KRN",19,14287,-1)
0^3
"KRN",19,14287,0)
ZZVEFA ENTER IMAGING ALERT^Critical Abnormal Imaging Results Alert^^R^^^^^^^^
"KRN",19,14287,25)
IMAGEGEN^RADZVEFA
"KRN",19,14287,99.1)
63249,45219
"KRN",19,14287,"U")
CRITICAL ABNORMAL IMAGING RESU
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","LRZOE")
0^3^B25859095
"RTN","LRZOE",1,0)
LRZOE ;DALOI/CJS/FHS-LAB ORDER ENTRY AND ACCESSION ;12/6/06 17:45
"RTN","LRZOE",2,0)
 ;;5.2;LAB SERVICE;**100,121,201,221,263,286**;Sep 27, 1994;Build 8
"RTN","LRZOE",3,0)
 K LRORIFN,LRNATURE,LREND,LRORDRR
"RTN","LRZOE",4,0)
 S LRLWC="WC"
"RTN","LRZOE",5,0)
 D ^LRPARAM
"RTN","LRZOE",6,0)
 I $G(LREND) S LREND=0 Q
"RTN","LRZOE",7,0)
L5 ;
"RTN","LRZOE",8,0)
NEXT ;from LROE1
"RTN","LRZOE",9,0)
 K DIR
"RTN","LRZOE",10,0)
 I $D(LROESTAT) D:$P(LRPARAM,U,14) ^LRCAPV I $G(LREND) K LRLONG,LRPANEL Q
"RTN","LRZOE",11,0)
 S (LRODT,X,DT)=$$DT^XLFDT(),LRODT0=$$FMTE^XLFDT(DT,5)
"RTN","LRZOE",12,0)
 I '$D(^LRO(69,DT,1,0)) S ^LRO(69,DT,0)=DT,^LRO(69,DT,1,0)="^69.01PA^^",^LRO(69,"B",DT,DT)=""
"RTN","LRZOE",13,0)
 I $D(^LAB(69.9,1,"RO")),+$H'=+$P(^("RO"),U) D
"RTN","LRZOE",14,0)
 . W $C(7),!,"ROLLOVER ",$S($P(^("RO"),U,2):"IS RUNNING.",1:"HAS NOT RUN.")," ACCESSIONING SHOULDN'T BE DONE NOW.",$C(7),!
"RTN","LRZOE",15,0)
 . S DIR("A")="  Are you sure you want to continue",DIR(0)="Y",DIR("B")="No"
"RTN","LRZOE",16,0)
 I $T D ^DIR G END:$D(DIRUT) I Y'=1 W !,"OK, try later." Q
"RTN","LRZOE",17,0)
 S X="T-7",%DT="" D ^%DT S LRTM7=+Y
"RTN","LRZOE",18,0)
 ;W @IOF
"RTN","LRZOE",19,0)
 K DIC,LRSND,LRSN
"RTN","LRZOE",20,0)
 S (LRORD,LRZORD)=$O(^TMP("LRVEHU",$J,0)) Q:'LRORD  ;; JFR
"RTN","LRZOE",21,0)
 W:0 @IOF S M9=0 G QUICK^LROE1:LRORD=""
"RTN","LRZOE",22,0)
 S:LRORD?.N LRORD=+LRORD IF LRORD'?.N D QMSG G NEXT
"RTN","LRZOE",23,0)
 I '$D(^LRO(69,"C",LRORD)) W !!?10,"No order exist with that number ",$C(7),! G NEXT
"RTN","LRZOE",24,0)
 S (LRCHK,LRNONE)=1,(M9,LRODT)=0
"RTN","LRZOE",25,0)
 F  S LRODT=+$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LRZOE",26,0)
 . S DA=0 F  S DA=$O(^LRO(69,"C",LRORD,LRODT,DA)) Q:DA<1  S LRCHK=LRCHK-1 S:LRNONE'=2 LRNONE=0 D LROE2
"RTN","LRZOE",27,0)
 I LRNONE=2 W !,"The order has already been",$S(LRCHK<1:" partially",1:"")," accessioned." H 1
"RTN","LRZOE",28,0)
 I LRNONE=1 W !,"No order exists with that number." H 1 G NEXT
"RTN","LRZOE",29,0)
 I '$$GOT(LRORD,LRODT) G NEXT
"RTN","LRZOE",30,0)
 L +^LRO(69,"C",LRORD):1
"RTN","LRZOE",31,0)
 I '$T W !?5,"Someone else is editing this Order",!!,$C(7) G NEXT
"RTN","LRZOE",32,0)
 K %DT
"RTN","LRZOE",33,0)
 S LRSTATUS="C",%DT("B")=""
"RTN","LRZOE",34,0)
 D TIME K %DT
"RTN","LRZOE",35,0)
 D:$G(LRCDT)<1 UNL69 G NEXT:LRCDT<1
"RTN","LRZOE",36,0)
 S LRTIM=+LRCDT
"RTN","LRZOE",37,0)
 ;S:'$P(^LRO(69,LRODT,1,LRSN,0),U,8) $P(^(0),U,8)=LRTIM
"RTN","LRZOE",38,0)
 S LRUN=$P(LRCDT,U,2) K LRCDT,LRSN
"RTN","LRZOE",39,0)
MORE I M9>1 K DIR S DIR("A")="Do you have the entire order",DIR(0)="Y" D ^DIR K DIR S:Y=1 M9=0
"RTN","LRZOE",40,0)
 I $D(DIRUT) D UNL69 G NEXT
"RTN","LRZOE",41,0)
 S (LRODT,LRSND)=0
"RTN","LRZOE",42,0)
 F  S LRODT=$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LRZOE",43,0)
 . S LRSND=0
"RTN","LRZOE",44,0)
 . F  S LRSND=$O(^LRO(69,"C",LRORD,LRODT,LRSND)) Q:LRSND<1  D
"RTN","LRZOE",45,0)
 . . S LRSN(LRSND)=LRSND,LRSN=LRSND
"RTN","LRZOE",46,0)
 . . K LRAA D Q15^LRZOE2 K LRSN
"RTN","LRZOE",47,0)
 D TASK,UNL69
"RTN","LRZOE",48,0)
 Q
"RTN","LRZOE",49,0)
 ;
"RTN","LRZOE",50,0)
LROE2 ;
"RTN","LRZOE",51,0)
 I $D(^LRO(69,LRODT,1,DA,1)),$P(^(1),U,4)="C" S LRNONE=2,LRCHK=LRCHK+1
"RTN","LRZOE",52,0)
 K LRSN
"RTN","LRZOE",53,0)
 S (LRSN,LRSN(DA))=+DA
"RTN","LRZOE",54,0)
 I '$D(^LRO(69,LRODT,1,LRSN,0)) Q
"RTN","LRZOE",55,0)
 S M9=$G(M9)+1,LRZX=^LRO(69,LRODT,1,LRSN,0),LRDFN=+LRZX,LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX S LRWRDS=LRWRD ;W !,PNM,?30,SSN 
"RTN","LRZOE",56,0)
 ;W ?45,"Requesting location: ",$P(LRZX,U,7) S Y=$P(LRZX,U,5) D DD^LRX W !,"Date/Time Ordered: ",Y,?45,"By: ",$S($D(^VA(200,+$P(LRZX,U,2),0)):$P(^(0),U),1:"")
"RTN","LRZOE",57,0)
 S LRSVSN=LRSN D ORDER^LRZOS S LRSN=LRSVSN ; JFR 
"RTN","LRZOE",58,0)
 Q
"RTN","LRZOE",59,0)
 ;
"RTN","LRZOE",60,0)
 ;
"RTN","LRZOE",61,0)
QMSG W !,"Enter the order entry number assigned when the test was ordered."
"RTN","LRZOE",62,0)
 W:'$D(LRLONG) !,"If the test has not been ordered, type the RETURN key to order the test."
"RTN","LRZOE",63,0)
 W !,"To exit, type the ""^"" key and RETURN key."
"RTN","LRZOE",64,0)
 Q
"RTN","LRZOE",65,0)
 ;
"RTN","LRZOE",66,0)
 ;
"RTN","LRZOE",67,0)
YN R X:DTIME S:'$T DTOUT=1 Q:X=""!(X["N")!(X["Y")
"RTN","LRZOE",68,0)
 W !,"Answer 'Y' or 'N': " G YN
"RTN","LRZOE",69,0)
 ;
"RTN","LRZOE",70,0)
 ;
"RTN","LRZOE",71,0)
EN ;
"RTN","LRZOE",72,0)
LROEN S LRNCWL=1
"RTN","LRZOE",73,0)
 D LRZOE,END K LRNCWL
"RTN","LRZOE",74,0)
 Q
"RTN","LRZOE",75,0)
 ;
"RTN","LRZOE",76,0)
 ;
"RTN","LRZOE",77,0)
EN01 ; ENTER ORDER # THEN ENTER DATA
"RTN","LRZOE",78,0)
STAT ;
"RTN","LRZOE",79,0)
 D ^LRPARAM
"RTN","LRZOE",80,0)
 I '$D(LRLABKY) W !!?10,"You do not have the proper security Keys",! Q
"RTN","LRZOE",81,0)
 ;
"RTN","LRZOE",82,0)
 ; Select peforming laboratory
"RTN","LRZOE",83,0)
 ;S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LRZOE",84,0)
 S X=DUZ(2)
"RTN","LRZOE",85,0)
 I X<1 D END Q
"RTN","LRZOE",86,0)
 I X'=DUZ(2) N LRPL S LRPL=X
"RTN","LRZOE",87,0)
 ;
"RTN","LRZOE",88,0)
 S LRLONG="",LRPANEL=0,LROESTAT=""
"RTN","LRZOE",89,0)
 S %H=$H-60 D YMD^LRX S LRTM60=9999999-X
"RTN","LRZOE",90,0)
 D LRZOE K LRTM60,LRLONG,LREND,LROESTAT
"RTN","LRZOE",91,0)
 D END
"RTN","LRZOE",92,0)
 Q
"RTN","LRZOE",93,0)
 ;
"RTN","LRZOE",94,0)
 ;
"RTN","LRZOE",95,0)
TIME ;from LROE1, LRORD1
"RTN","LRZOE",96,0)
 S %DT="ST" ;W !,"Collection Date@Time: ",$S($D(%DT("B")):%DT("B"),1:"NOW"),"//" R X:DTIME I '$T!(X="^") S LRCDT=-1 Q
"RTN","LRZOE",97,0)
 ;S:X="" X=$S($D(%DT("B")):%DT("B"),1:"N")
"RTN","LRZOE",98,0)
 S X=$G(^TMP("LRVEHU",$J,"COLL")) ; JFR   stuff collection time
"RTN","LRZOE",99,0)
 I X["@U",$P(X,"@U",2)="" S X=$P(X,"@U",1) D ^%DT G TIME:Y<1 S LRCDT=+Y_"^1" Q
"RTN","LRZOE",100,0)
 S:X="U" LRCDT=DT_"^1"
"RTN","LRZOE",101,0)
 I X'="U" D ^%DT D:X'["?" TIME1 G TIME:X["?" S LRCDT=+Y_"^" G TIME:Y'["."
"RTN","LRZOE",102,0)
 Q
"RTN","LRZOE",103,0)
 ;
"RTN","LRZOE",104,0)
TIME1 S X1=X,Y1=Y D TIME2 S X=X1,Y=Y1 K X1,Y1
"RTN","LRZOE",105,0)
 Q
"RTN","LRZOE",106,0)
 ;
"RTN","LRZOE",107,0)
TIME2 S X="N",%DT="ST" D ^%DT Q:Y1'>Y  F  W !,"You have specified a collection time in the future.  Are you sure" S %=2 D YN^DICN Q:%  W !,"Answer 'Y'es or 'N'o."
"RTN","LRZOE",108,0)
 S:%'=1 X="?" S X1=X
"RTN","LRZOE",109,0)
 Q
"RTN","LRZOE",110,0)
 ;
"RTN","LRZOE",111,0)
 ;
"RTN","LRZOE",112,0)
TASK ;
"RTN","LRZOE",113,0)
 K LRLABLIO
"RTN","LRZOE",114,0)
 I $D(LRLABLIO),$D(LRLBL) S ZTRTN="ENT^LRLABLD",ZTDTH=$H,ZTDESC="LAB LABELS",ZTIO=LRLABLIO,ZTSAVE("LRLBL(")="" D ^%ZTLOAD
"RTN","LRZOE",115,0)
 K LRLBL
"RTN","LRZOE",116,0)
 I $D(LRCSQ),'$O(^XTMP("LRCAP",LRCSQ,DUZ,0)) K ^XTMP("LRCAP",LRCSQ,DUZ),LRCSQ
"RTN","LRZOE",117,0)
 I $D(LRCSQ),$P($G(^LRO(68,+LRAA,0)),U,16) D STD^LRCAPV
"RTN","LRZOE",118,0)
 D STOP^LRCAPV K LRCOM,LRSPCDSC,LRCCOM,LRTCOM
"RTN","LRZOE",119,0)
 Q
"RTN","LRZOE",120,0)
 ;
"RTN","LRZOE",121,0)
 ;
"RTN","LRZOE",122,0)
END K DIR,DIRUT,GOT
"RTN","LRZOE",123,0)
 D ^LRORDK,LROEND^LRORDK,STOP^LRCAPV
"RTN","LRZOE",124,0)
 Q
"RTN","LRZOE",125,0)
 ;
"RTN","LRZOE",126,0)
 ;
"RTN","LRZOE",127,0)
GOT(ORD,ODT) ;See if all tests have been canceled
"RTN","LRZOE",128,0)
 N I,SN,ODT
"RTN","LRZOE",129,0)
 S (GOT,ODT,SN)=0
"RTN","LRZOE",130,0)
 F  S ODT=$O(^LRO(69,"C",ORD,ODT)) Q:ODT<1  D
"RTN","LRZOE",131,0)
 . S SN=0 F  S SN=$O(^LRO(69,"C",ORD,ODT,SN)) Q:SN<1!(GOT)  D
"RTN","LRZOE",132,0)
 . . Q:'$D(^LRO(69,ODT,1,SN,0))
"RTN","LRZOE",133,0)
 . . S I=0 F  S I=$O(^LRO(69,ODT,1,SN,2,I)) Q:I<1  I $D(^(I,0)),'$P(^(0),"^",11) S GOT=1 Q
"RTN","LRZOE",134,0)
 Q GOT
"RTN","LRZOE",135,0)
 ;
"RTN","LRZOE",136,0)
 ;
"RTN","LRZOE",137,0)
UNL69 ;
"RTN","LRZOE",138,0)
 L -^LRO(69,"C",+$G(LRORD))
"RTN","LRZOE",139,0)
 Q
"RTN","LRZOE2")
0^4^B13493436
"RTN","LRZOE2",1,0)
LRZOE2 ;DALISC/FHS - CONTINUED MORE ORDER ENTRY ; 12/7/06 09:27
"RTN","LRZOE2",2,0)
 ;;5.2;LAB SERVICE;**121**;Sep 27, 1994;Build 8
"RTN","LRZOE2",3,0)
 ;Formerly apart of LROE1
"RTN","LRZOE2",4,0)
Q15 ;from LROE1
"RTN","LRZOE2",5,0)
 Q:'$D(^LRO(69,LRODT,1,LRSN,0))
"RTN","LRZOE2",6,0)
 I $D(^LRO(69,LRODT,1,LRSN,1)),$P(^(1),"^",4)="U" W !,"This specimen has already been marked as UNCOLLECTED. Are you sure" S %=2 D YN^DICN Q:%'=1  S ^(1)=LRTIM_"^^"_DUZ,DA=LRSN,DA(1)=LRODT,DIE="^LRO(69,"_DA(1)_",1,",DR=16 D ^DIE
"RTN","LRZOE2",7,0)
 I M9>1 D LRSPEC^LROE1 S S1=$S($D(^LAB(61,+LRSPEC,0)):$P(^(0),U),1:""),S2=$P(^LAB(62,LRSAMP,0),U),S4=$P(^(0),U,3),S3=S1_$S(S1'=S2:"  "_S2,1:"") W !,"Do you have the  ",S3,"  ",S4 K S1,S2,S3,S4 S %=2 D YN^DICN G Q15:%=0 Q:%'=1
"RTN","LRZOE2",8,0)
 S DA=DT,LRDFN=+^LRO(69,LRODT,1,LRSN,0),LRDPF=+$P(^LR(LRDFN,0),U,2)
"RTN","LRZOE2",9,0)
 IF '$D(^LRO(69,LRODT,1,LRSN,1)) S LRSTATUS="C",DA=LRODT I '$D(LRSND) D P15^LROE1 Q:LRCDT<1
"RTN","LRZOE2",10,0)
 I $D(LRSND),$P(^LRO(69,LRODT,1,LRSN,0),U,4)="LC",$D(^(1)) S LRLLOC=$P(^(0),U,7),LROLLOC=$P(^(0),U,9),LRNT=$S($D(LRNT):LRNT,$D(LRTIM):LRTIM,$D(LRCDT):+LRCDT,1:"") D P15^LRPHITEM G PH
"RTN","LRZOE2",11,0)
 I $D(LRSND) N COMB S COMB=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",7) S ^LRO(69,LRODT,1,LRSN,1)=LRTIM_"^"_LRUN_"^"_DUZ_"^"_LRSTATUS_"^^^"_COMB_"^"_DUZ(2) S:LRSTATUS="C" ^LRO(69,"AA",+$G(^LRO(69,LRODT,1,LRSN,.1)),LRODT_"|"_LRSN)=""
"RTN","LRZOE2",12,0)
PH G Q16:LRORD D ORDER^LROW2 G Q16A
"RTN","LRZOE2",13,0)
Q16 S J=0 D CHECK^LROW2 I J D BAD^LROW2
"RTN","LRZOE2",14,0)
Q16A I $D(LRLONG),$D(LRSND) S LRSN=LRSND,^TMP("LROE",$J,"LRORD")=LRORD_U_LRODT_U_LRTIM_U_PNM_U_SSN
"RTN","LRZOE2",15,0)
 K DR S LRTSTS=0
"RTN","LRZOE2",16,0)
 S LRSN=0 F  S LRSN=$O(LRSN(LRSN)) Q:'LRSN  D Q17
"RTN","LRZOE2",17,0)
 I $D(LRLONG),$D(LRSND) S LRSN=LRSND D LROE S X=^TMP("LROE",$J,"LRORD"),LRORD=+X,LRODT=$P(X,"^",2),LRTIM=$P(X,"^",3),LRLONG="",PNM=$P(X,"^",4),SSN=$P(X,"^",5)
"RTN","LRZOE2",18,0)
 Q
"RTN","LRZOE2",19,0)
Q17 S I=$O(^LRO(69,LRODT,1,LRSN,6,0)),J=$O(^(1)) S:'$D(IOM) IOM=80 K LRSPCDSC S:J LRSPCDSC=^(J,0) S:I DA=LRSN,DA(1)=LRODT,DR=6,DIC="^LRO(69,"_LRODT_",1," D EN^DIQ:I D LRSPEC^LROE1
"RTN","LRZOE2",20,0)
 D OLD^LRORDST K ^TMP("LR",$J,"TMP")
"RTN","LRZOE2",21,0)
 S $P(^LRO(69,LRODT,1,LRSN,1),U,4)="C",$P(^LRO(69,LRODT,1,LRSN,1),U,8)=DUZ(2),^LRO(69,"AA",+$G(^LRO(69,LRODT,1,LRSN,.1)),LRODT_"|"_LRSN)=""
"RTN","LRZOE2",22,0)
 Q
"RTN","LRZOE2",23,0)
LROE ;from LROE1  ;;;;JFR copied from LRFAST to reduce mods
"RTN","LRZOE2",24,0)
 S LRLLOC=$P(^LRO(69,LRODT,1,LRSN,0),U,7) S:'$L(LRLLOC) LRLLOC=0 K LROE
"RTN","LRZOE2",25,0)
 S I1=0 F  S I1=$O(^LRO(69,LRODT,1,LRSN,2,I1)) Q:I1<1!($G(LREND))  S X=^(I1,0) I $P(X,U,4) S LRAA=$P(X,U,4),LRAN=$P(X,U,5),LRAD=$P(X,U,3) I '$D(LROE(LRAD_LRAA_LRAN)) S LROE(LRAD_LRAA_LRAN)="" D LROE1
"RTN","LRZOE2",26,0)
 G QUIT^LRFAST
"RTN","LRZOE2",27,0)
 ;
"RTN","LRZOE2",28,0)
 ;
"RTN","LRZOE2",29,0)
LROE1 S LRX=$G(^LRO(68,LRAA,0))
"RTN","LRZOE2",30,0)
 S LRIDIV=$S($L($P(LRX,U,19)):$P(LRX,U,19),1:"CP")
"RTN","LRZOE2",31,0)
 D:$P(LRPARAM,U,14)&($P($G(^LRO(68,LRAA,0)),U,16)) ^LRCAPV
"RTN","LRZOE2",32,0)
 I $G(LREND) Q
"RTN","LRZOE2",33,0)
 ; Check for different performing lab.
"RTN","LRZOE2",34,0)
 I $G(LRPL) N LRDUZ S LRDUZ(2)=LRPL
"RTN","LRZOE2",35,0)
 ;
"RTN","LRZOE2",36,0)
 S LRUID=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,.3),"^")
"RTN","LRZOE2",37,0)
 I $P(LRX,U,2)="CH" D ^LRZVER1
"RTN","LRZOE2",38,0)
 K LRX
"RTN","LRZOE2",39,0)
 Q
"RTN","LRZOE2",40,0)
 ;
"RTN","LRZORD")
0^1^B65736758
"RTN","LRZORD",1,0)
LRZORD ;DALOI/CJS,NTEO/JFR - LAZY ACCESSION LOGGING ;12/6/06 13:14; [12/27/09 5:21pm]
"RTN","LRZORD",2,0)
 ;;5.2;LAB SERVICE;**100,121,153,286**;Sep 27, 1994;Build 8
"RTN","LRZORD",3,0)
 ;;
"RTN","LRZORD",4,0)
VEHU ; Entry point for jamming in labs
"RTN","LRZORD",5,0)
 ; get test (one only for now)
"RTN","LRZORD",6,0)
 ; show test range
"RTN","LRZORD",7,0)
 ; ask for result range
"RTN","LRZORD",8,0)
 ; get collection date/time
"RTN","LRZORD",9,0)
 ; get patient list
"RTN","LRZORD",10,0)
 ; rock & roll
"RTN","LRZORD",11,0)
 K ^TMP("LRZSTIK",$J),^TMP("LRVEHU",$J)
"RTN","LRZORD",12,0)
 N LRZPT,LRVEHU,LRZONE,DIR,Y,DUOUT,DTOUT,DIRUT
"RTN","LRZORD",13,0)
 N LRBLOOD,LRDT0,LRLABKY,LRPARAM,LRPLASMA,LRSERUM,LRODT0,LRSND
"RTN","LRZORD",14,0)
 N LRUNKNOW,LRURINE,LRVIDO,LRVIDOF,LRAL,LRALL,LRCMTDSP,LRFLG,LRNGS
"RTN","LRZORD",15,0)
 D ^LRPARAM I $G(LREND) D KILL Q
"RTN","LRZORD",16,0)
 D GET I '$D(^TMP("LRZSTIK",$J)) W !,"No test selected, you lose!" Q
"RTN","LRZORD",17,0)
 S ^TMP("LRVEHU",$J,"RNG")=$$RNG
"RTN","LRZORD",18,0)
 I '$L(^TMP("LRVEHU",$J,"RNG")) W !,"No result entered, can't continue" D KILL Q
"RTN","LRZORD",19,0)
 S ^TMP("LRVEHU",$J,"I")=$P(^VA(200,+DUZ,0),U,2)
"RTN","LRZORD",20,0)
 ;S ^TMP("LRVEHU",$J,"I")=$P(^VA(200,+1,0),U,2)
"RTN","LRZORD",21,0)
 S ^TMP("LRVEHU",$J,"COLL")=$$COLLDT
"RTN","LRZORD",22,0)
 I '$L(^TMP("LRVEHU",$J,"COLL")) W !,"No collection date/time entered, gotta go!" D KILL Q
"RTN","LRZORD",23,0)
 W !!
"RTN","LRZORD",24,0)
 W "Provider Selection:"
"RTN","LRZORD",25,0)
 K LRSRNB
"RTN","LRZORD",26,0)
 D ALSP("Providers with ORES key^Provider","^VA(200,",.LRSRNB)
"RTN","LRZORD",27,0)
 I LRSRNB["^" D KILL Q
"RTN","LRZORD",28,0)
 ;ZW LRSRNB
"RTN","LRZORD",29,0)
 S LRVEHU=1
"RTN","LRZORD",30,0)
 D PT
"RTN","LRZORD",31,0)
 I '$D(^TMP("LRVEHU",$J,"PT")) W !,"No patients selected!",!,"Outta Here!" D KILL Q
"RTN","LRZORD",32,0)
 W !
"RTN","LRZORD",33,0)
 S DIR(0)="YA",DIR("A")="Are you ready to proceed? "
"RTN","LRZORD",34,0)
 D ^DIR
"RTN","LRZORD",35,0)
 I $D(DTOUT)!($D(DUOUT))!('$G(Y)) W !!,"OK! No data entered." H 1 D KILL Q
"RTN","LRZORD",36,0)
 S LRZPT=0
"RTN","LRZORD",37,0)
 ;Q  ; JFR QUIT TO TEST ALL DATA COLLECTION
"RTN","LRZORD",38,0)
 F  S LRZPT=$O(^TMP("LRVEHU",$J,"PT",LRZPT)) Q:'LRZPT  D
"RTN","LRZORD",39,0)
 . S LRWP=1
"RTN","LRZORD",40,0)
 . M ^TMP("LRSTIK",$J)=^TMP("LRZSTIK",$J)
"RTN","LRZORD",41,0)
 . D ^LRPARAM
"RTN","LRZORD",42,0)
 . D EN
"RTN","LRZORD",43,0)
 . S ^TMP("LRVEHU",$J,"R")=$$RAND($P(^TMP("LRVEHU",$J,"RNG"),U,1),$P(^TMP("LRVEHU",$J,"RNG"),U,2))
"RTN","LRZORD",44,0)
 . D STAT^LRZOE
"RTN","LRZORD",45,0)
 . K ^TMP("LRVEHU",$J,LRZORD),LRZORD,LRZONE
"RTN","LRZORD",46,0)
 . D ^LRORDK
"RTN","LRZORD",47,0)
 . W !,$$CJ^XLFSTR("************************************************",80),!
"RTN","LRZORD",48,0)
 . Q
"RTN","LRZORD",49,0)
 D KILL
"RTN","LRZORD",50,0)
 K LRVEHU
"RTN","LRZORD",51,0)
 Q
"RTN","LRZORD",52,0)
 ;
"RTN","LRZORD",53,0)
EN ;;from LROR4
"RTN","LRZORD",54,0)
 K DIC,LRURG,LRSAME,LRCOM,LRNATURE,LRTCOM
"RTN","LRZORD",55,0)
 S LRORDR="WC"
"RTN","LRZORD",56,0)
 S LRORDTIM=""
"RTN","LRZORD",57,0)
 I $D(LRADDTST) Q:LRADDTST=""
"RTN","LRZORD",58,0)
 S LRFIRST=1,LRODT=DT,U="^",LRECT=0,LROUTINE=$P(^LAB(69.9,1,3),U,2)
"RTN","LRZORD",59,0)
 S:$G(LRORDRR)="R" LRECT=1,LRFIRST=0
"RTN","LRZORD",60,0)
 I LRORDR="SP" S LRLWC="SP"
"RTN","LRZORD",61,0)
 I LRORDR="WC" S LRLWC="WC"
"RTN","LRZORD",62,0)
L5 S Y=$$NOW^XLFDT S LRORDTIM=$P(Y,".",2),LRODT=$P(Y,".",1),X1=Y,X2=DT D ^%DTC ;;  JFR  def order time
"RTN","LRZORD",63,0)
 G KILL:LRWP<1
"RTN","LRZORD",64,0)
 S:'$D(^LRO(69,LRODT,0)) ^(0)=$P(^LRO(69,0),U,1,2)_U_LRODT_U_(1+$P(^(0),U,4)),^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)=""
"RTN","LRZORD",65,0)
 S LRURG="",LRAD=DT,LRWPD=LRWP\2+(LRWP#2) ; D ^LRZORD1 Q
"RTN","LRZORD",66,0)
 N IENN
"RTN","LRZORD",67,0)
 ;ZW LRSRNB
"RTN","LRZORD",68,0)
 S IENN=0
"RTN","LRZORD",69,0)
 F  S IENN=$O(LRSRNB(IENN)) Q:IENN=""  D
"RTN","LRZORD",70,0)
 .D ^LRZORD1
"RTN","LRZORD",71,0)
 ;NEW BELOW
"RTN","LRZORD",72,0)
 ;K LRAD,LRADDTST,LRBLEND,
"RTN","LRZORD",73,0)
 Q
"RTN","LRZORD",74,0)
G0 ;
"RTN","LRZORD",75,0)
G1 ;
"RTN","LRZORD",76,0)
GET ;
"RTN","LRZORD",77,0)
 N DIC,X,Y,DUOUT,DTOUT
"RTN","LRZORD",78,0)
 S LRORDR="WC"
"RTN","LRZORD",79,0)
 S DIC("S")="I $P(^(0),U,4)=""CH"""_$S('$D(LRLABKY):",""NO""'[$P(^(0),U,3)",'$P(LRLABKY,U,3):",""N""'[$P(^(0),U,3)",1:"")
"RTN","LRZORD",80,0)
 S DIC="^LAB(60,",DIC(0)="AEMOQZ"
"RTN","LRZORD",81,0)
 D ^DIC I Y<1 Q
"RTN","LRZORD",82,0)
 S LRWP=1,LRY=Y
"RTN","LRZORD",83,0)
 S ^TMP("LRZSTIK",$J,LRWP)=$P(LRY,U,1,2)
"RTN","LRZORD",84,0)
 ; "B" Used to lookup by number user enters.
"RTN","LRZORD",85,0)
 S ^TMP("LRZSTIK",$J,"B",LRWP)=LRWP
"RTN","LRZORD",86,0)
 ; "C" Used by LEDI (LRORDB)
"RTN","LRZORD",87,0)
 S ^TMP("LRZSTIK",$J,"C",+LRY,LRWP)=""
"RTN","LRZORD",88,0)
 S LRTSTS=+^TMP("LRZSTIK",$J,LRWP) D SAMP
"RTN","LRZORD",89,0)
 S:+LRSAMP=-1&(LRSPEC=-1) LRWP=LRWP-1
"RTN","LRZORD",90,0)
 G GET:+LRSAMP=-1&(LRSPEC=-1)
"RTN","LRZORD",91,0)
 S ^TMP("LRZSTIK",$J,LRWP)=^TMP("LRZSTIK",$J,LRWP)_U_LRSAMP_U_U_LRSPEC
"RTN","LRZORD",92,0)
 W !!
"RTN","LRZORD",93,0)
 W !,"Reference Ranges for this test and Specimen:",!
"RTN","LRZORD",94,0)
 N LRZSP S LRZSP=$O(^LAB(60,+LRY,1,"B",LRSPEC,0)),LRZSP=$G(^LAB(60,+LRY,1,LRZSP,0))
"RTN","LRZORD",95,0)
 W !,"Reference Low: ",$P(LRZSP,U,2)
"RTN","LRZORD",96,0)
 W !,"Reference High: ",$P(LRZSP,U,3)
"RTN","LRZORD",97,0)
 W !,"Critical Low: ",$P(LRZSP,U,4)
"RTN","LRZORD",98,0)
 W !,"Critical High: ",$P(LRZSP,U,5),!!
"RTN","LRZORD",99,0)
 Q
"RTN","LRZORD",100,0)
 ;
"RTN","LRZORD",101,0)
RNG() ;
"RTN","LRZORD",102,0)
 N LRZRES
"RTN","LRZORD",103,0)
 N DIR,X,Y,DUOUT,DTOUT
"RTN","LRZORD",104,0)
 W !,"If you want the same value for all patients, enter it for both high and low",!
"RTN","LRZORD",105,0)
 S DIR(0)="N^::2",DIR("A")="Enter the low result to enter for this test"
"RTN","LRZORD",106,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) K ^TMP("LRSTIK",$J) Q ""
"RTN","LRZORD",107,0)
 S LRZRES=Y
"RTN","LRZORD",108,0)
 S DIR(0)="NA^"_LRZRES_"::2"
"RTN","LRZORD",109,0)
 S DIR("A")="Enter the high result for this test: " D ^DIR
"RTN","LRZORD",110,0)
 I $D(DTOUT)!($D(DUOUT)) K ^TMP("LRSTIK",$J) Q ""
"RTN","LRZORD",111,0)
 S LRZRES=LRZRES_U_Y
"RTN","LRZORD",112,0)
 Q LRZRES
"RTN","LRZORD",113,0)
 ;
"RTN","LRZORD",114,0)
KILL D ^LRORDK,LROEND^LRORDK K ^TMP("LRVEHU",$J),^TMP("LRSTIK",$J) D HOME^%ZIS Q
"RTN","LRZORD",115,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")!($E(%)="^")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRZORD",116,0)
 Q
"RTN","LRZORD",117,0)
 ;
"RTN","LRZORD",118,0)
RAND(LOW,HIGH) ; GET RANGE
"RTN","LRZORD",119,0)
 N DIFF,NEWVAL,LOWDEC,HIGHDEC,NEWDEC,LDEC
"RTN","LRZORD",120,0)
 S DIFF=HIGH-LOW
"RTN","LRZORD",121,0)
 I DIFF=0 Q LOW
"RTN","LRZORD",122,0)
 I DIFF<1 S DIFF=1
"RTN","LRZORD",123,0)
 S NEWVAL=LOW+$R(DIFF)
"RTN","LRZORD",124,0)
 S LOWDEC=$P(LOW,".",2)
"RTN","LRZORD",125,0)
 S HIGHDEC=$P(HIGH,".",2)
"RTN","LRZORD",126,0)
 I 'HIGHDEC,'LOWDEC Q NEWVAL
"RTN","LRZORD",127,0)
 S LDEC=$S($L(LOWDEC)=2:2,$L(HIGHDEC)=2:2,1:1)
"RTN","LRZORD",128,0)
 I LDEC=2 S NEWDEC=$R(100)
"RTN","LRZORD",129,0)
 I LDEC=1 S NEWDEC=$R(10)
"RTN","LRZORD",130,0)
 S NEWVAL=NEWVAL+("."_NEWDEC)
"RTN","LRZORD",131,0)
 S $P(NEWVAL,".",2)=$E(+$P(NEWVAL,".",2),1,LDEC)
"RTN","LRZORD",132,0)
 I NEWVAL>HIGH S NEWVAL=HIGH
"RTN","LRZORD",133,0)
 Q NEWVAL
"RTN","LRZORD",134,0)
 ;
"RTN","LRZORD",135,0)
ALSP(PRPT,FILE,ARR) ; Selection of (A)LL or (S)pecific values from a given file
"RTN","LRZORD",136,0)
 ; Input: PRPT  - Piece 1: Label for the PROMPT to be asked for the 
"RTN","LRZORD",137,0)
 ;                         selection (in the plural) - e.g. "Providers"
"RTN","LRZORD",138,0)
 ;                Piece 2: Singular of piece 1 -  e.g. "Provider"
"RTN","LRZORD",139,0)
 ;                Example: "Specialties^Specialty"
"RTN","LRZORD",140,0)
 ;        FILE  - File global root (e.g., "^IBE(356.8," ) that the values
"RTN","LRZORD",141,0)
 ;                will be selected from
"RTN","LRZORD",142,0)
 ;        ARR   - Name of the array that will contain the specific values
"RTN","LRZORD",143,0)
 ;                (must be passed as a reference value ".ARR")
"RTN","LRZORD",144,0)
 ; Output: ARR  - "S" - Specific values OR "^"
"RTN","LRZORD",145,0)
 ;                The values will be returned in the array indicated in
"RTN","LRZORD",146,0)
 ;                ARR parameter 
"RTN","LRZORD",147,0)
 ;
"RTN","LRZORD",148,0)
 N DIC,PRL,SNG,X
"RTN","LRZORD",149,0)
 K ARR S PRL=$P(PRPT,"^"),SNG=$P(PRPT,"^",2) S:SNG="" SNG=PRL
"RTN","LRZORD",150,0)
 ;ALSP1 W !!,"Run report for (A)LL or (S)PECIFIC "_PRL_": A// "
"RTN","LRZORD",151,0)
 ;R X:DTIME I '$T!(X["^") S ARR="^" G QALSP
"RTN","LRZORD",152,0)
 ;S X=$S(X="":"A",1:$E(X)) I "AaSs"'[X D HALSP G ALSP1
"RTN","LRZORD",153,0)
 ;W " ",$S("Ss"[X:"SPECIFIC",1:"ALL") I "Aa"[X K ARR S ARR="A" G QALSP
"RTN","LRZORD",154,0)
 S ARR="S"
"RTN","LRZORD",155,0)
ALSP2 S DIC=FILE,DIC(0)="AEQMZ"
"RTN","LRZORD",156,0)
 S DIC("A")="   Select a"_$S($O(ARR(""))'="":"nother",1:"")_" "
"RTN","LRZORD",157,0)
 S DIC("A")=DIC("A")_SNG_": "
"RTN","LRZORD",158,0)
 D ^DIC K DIC I $D(DTOUT)!($D(DUOUT)) K ARR S ARR="^" G QALSP
"RTN","LRZORD",159,0)
 I Y'>0 G QALSP ; G ALSP1:$O(ARR(""))="" G QALSP
"RTN","LRZORD",160,0)
 I $D(ARR(+Y)) D  G ALSP2
"RTN","LRZORD",161,0)
 . W !!?3,"Already selected. Choose another "_SNG,*7,!
"RTN","LRZORD",162,0)
 S ARR(+Y)="" Q ; ONLY ALLOW 1 PATIENT PER PATIENT PER TIME OF LAB RESULTING ALERT G ALSP2
"RTN","LRZORD",163,0)
 ;
"RTN","LRZORD",164,0)
QALSP Q
"RTN","LRZORD",165,0)
 ;
"RTN","LRZORD",166,0)
PT N PTARR
"RTN","LRZORD",167,0)
 W !!,"Select patients to enter the selected lab result for. Select numbers between"
"RTN","LRZORD",168,0)
 W !,"0 and 950 with the number corresponding to the VeHU patient that you want to"
"RTN","LRZORD",169,0)
 W !,"update.  For example, choosing number 12 will update VeHU patient twelve"
"RTN","LRZORD",170,0)
 W !,"(LAST 6 digits of SSN. Test patients SSN assumed XXX and leading zeros up to 6 digits OR ""66600"""_"L4."
"RTN","LRZORD",171,0)
 W !,"Twelve is XXX000012 for SSN)",!!
"RTN","LRZORD",172,0)
 S DIR("A")="Select patient(s) to be updated"
"RTN","LRZORD",173,0)
 S DIR(0)="LO^0:950" D ^DIR K DIR Q:Y=""!($D(DUOUT))!($D(DTOUT))
"RTN","LRZORD",174,0)
 D PARSE(Y,.PTARR) S J=0 F  S J=$O(Y(J)) Q:'+J  D PARSE(Y(J),.PTARR)
"RTN","LRZORD",175,0)
 M ^TMP("LRVEHU",$J,"PT")=PTARR
"RTN","LRZORD",176,0)
 Q
"RTN","LRZORD",177,0)
 ;
"RTN","LRZORD",178,0)
PARSE(ARRAY,LIST) ;
"RTN","LRZORD",179,0)
 N NUM,R,LNUM,L4,SSN
"RTN","LRZORD",180,0)
 S NUM=$L(ARRAY,",")-1
"RTN","LRZORD",181,0)
 F R=1:1:NUM S LNUM=$P(ARRAY,",",R) S L4=$S(LNUM=0:"0000",1:$E("000",1,(4-$L(LNUM)))_LNUM) D
"RTN","LRZORD",182,0)
 .S SSN="66600"_L4
"RTN","LRZORD",183,0)
 .I $D(^DPT("SSN",SSN)) S LIST($O(^DPT("SSN",SSN,0)))=""
"RTN","LRZORD",184,0)
 Q
"RTN","LRZORD",185,0)
 ;
"RTN","LRZORD",186,0)
COLLDT() ; get d/t to stuff in for collection date@time
"RTN","LRZORD",187,0)
 ;
"RTN","LRZORD",188,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT
"RTN","LRZORD",189,0)
 W !
"RTN","LRZORD",190,0)
 S DIR(0)="D^:NOW:ETR",DIR("A")="Enter the date/time of collection for all results"
"RTN","LRZORD",191,0)
 D ^DIR
"RTN","LRZORD",192,0)
 I $D(DTOUT)!($D(DUOUT)) Q ""
"RTN","LRZORD",193,0)
 Q Y(0)
"RTN","LRZORD",194,0)
 ;
"RTN","LRZORD",195,0)
SAMP ; copy of GS^LRORD3
"RTN","LRZORD",196,0)
 N X,Y,DIC,DTOUT,DUOUT,J
"RTN","LRZORD",197,0)
 S LRSAMP=-1,LRSPEC=-1 S:$D(LRSAME) LRSAMP=$P(LRSAME,U),LRSPEC=$P(LRSAME,U,2)
"RTN","LRZORD",198,0)
 K %
"RTN","LRZORD",199,0)
 S J=$O(^LAB(60,LRTSTS,3,0)) G GSNO:J<1 S LRCSN=1,LRUNQ=+$P(^LAB(60,LRTSTS,0),U,8),LRCS(1)=+^(3,J,0) S X=$P(^LAB(62,LRCS(1),0),U) W:'$D(LRSAME) !,$S(LRUNQ:"The Sample ",1:""),"Is ",X,"   ",$P(^(0),U,3)
"RTN","LRZORD",200,0)
 G G2S:LRUNQ Q:$D(LRSAME)  W " the correct sample to collect? Y//" D % G G2S:%'["N"
"RTN","LRZORD",201,0)
 F  S J=$O(^LAB(60,LRTSTS,3,J)) Q:J<1  S LRCSN=LRCSN+1,LRCS(LRCSN)=+^(J,0)
"RTN","LRZORD",202,0)
 G GSNO:LRCSN<2
"RTN","LRZORD",203,0)
 W ! F I=1:1:LRCSN W !,I," ",$P(^LAB(62,LRCS(I),0),U),"  ",$P(^(0),U,3)
"RTN","LRZORD",204,0)
 ;K I,LRCS
"RTN","LRZORD",205,0)
 R !,"Choose one: ",X:DTIME IF X>0&(X<(LRCSN+1)) S LRCSN=+X G G2S
"RTN","LRZORD",206,0)
GSNO ;
"RTN","LRZORD",207,0)
 Q:$D(LRSAME)  S LRCSN=1,LRCS(1)=-1,DIC="^LAB(62,",DIC(0)="AEMOQ" D ^DIC K DIC S LRCS(1)=+Y
"RTN","LRZORD",208,0)
G2S S LRSAMP=LRCS(LRCSN) I LRSAMP<1 S Y=-1,LROT="" G G3S
"RTN","LRZORD",209,0)
 I $P(^LAB(62,LRSAMP,0),U,2)'="" S LRSPEC=+$P(^(0),U,2) G G4S
"RTN","LRZORD",210,0)
W18A S DIC="^LAB(61,",DIC(0)="EMOQ",D="E" R !,"Select SITE/SPECIMEN: ",X:DTIME
"RTN","LRZORD",211,0)
 D IX^DIC:X="?" G W18A:X="?" D ^DIC K DIC G W18A:'($D(DUOUT)!$D(DTOUT))&(Y<0) I $D(DTOUT)!$D(DUOUT) S LREND=1 K D Q
"RTN","LRZORD",212,0)
 I LRUNKNOW=+Y W !,"Unknown is not allowed." G W18A
"RTN","LRZORD",213,0)
G3S S LRSPEC=+Y
"RTN","LRZORD",214,0)
 I +LRSAMP=-1&(LRSPEC=-1),$D(LROT) W !,"Sample and source incompletely defined, test skipped." Q
"RTN","LRZORD",215,0)
G4S Q:+LRSAMP=-1&(LRSPEC=-1)!$D(LRSAME)!$D(LRBLEND)
"RTN","LRZORD",216,0)
 Q
"RTN","LRZORD1")
0^2^B27399035
"RTN","LRZORD1",1,0)
LRZORD1 ;DALOI/RWF,NTEO/JFR - LAZY ACCESSION LOGGING ; 12/6/06 18:59
"RTN","LRZORD1",2,0)
 ;;5.2;LAB SERVICE;**1,8,121,153,201,286**;Sep 27, 1994;Build 8
"RTN","LRZORD1",3,0)
 ;7/12/14 GOW MOD TO REPORT ROUTING LOCATION VARIABLE
"RTN","LRZORD1",4,0)
L2 Q:$G(LREND)
"RTN","LRZORD1",5,0)
 K LROT,LRSAME,LRKIL,LRGCOM,LRCCOM,LR696IEN,LRNATURE,DGSENFLG
"RTN","LRZORD1",6,0)
 S LRWPC=LRWP G:$D(LROR) LRFIRST
"RTN","LRZORD1",7,0)
 ;I '$D(LRADDTST) K DFN,DIC S PNM="",DIC(0)="EMQ"_$S($P(LRPARAM,U,6)&$D(LRLABKY):"L",1:"") W ! D ^LRDPA I (LRDFN=-1)!$D(DUOUT)!$D(DTOUT) Q
"RTN","LRZORD1",8,0)
 K DFN,DIC,X
"RTN","LRZORD1",9,0)
 S X="`"_LRZPT
"RTN","LRZORD1",10,0)
 S PNM="",DIC(0)="EMQ",DGSENFLG=1 D EN^LRDPA ; JFR must default patient
"RTN","LRZORD1",11,0)
 I '+DFN G DROP
"RTN","LRZORD1",12,0)
 I $D(LRADDTST),LRADDTST="" Q
"RTN","LRZORD1",13,0)
 S LRORDR="WC"
"RTN","LRZORD1",14,0)
 S:'$D(LREND) LREND=0 I LRORDR="" D COLTY^LRWU G DROP:LREND
"RTN","LRZORD1",15,0)
 ;B
"RTN","LRZORD1",16,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LRZORD1",17,0)
Q12 D LOC
"RTN","LRZORD1",18,0)
Q11 D PRAC G DROP:LREND
"RTN","LRZORD1",19,0)
 K T,TT,LRDMAX,LRDTST,LRTMAX
"RTN","LRZORD1",20,0)
 S DA=0
"RTN","LRZORD1",21,0)
 F  S DA=$O(^LRO(69,LRODT,1,"AA",LRDFN,DA)) Q:DA<1  I $S($D(^LRO(69,LRODT,1,DA,1)):$P(^(1),U,4)'="U",1:1) S S=$S($D(^LRO(69,LRODT,1,DA,4,1,0)):+^(0),1:0) D
"RTN","LRZORD1",22,0)
 . S I=0 F  S I=$O(^LRO(69,LRODT,1,DA,2,I)) Q:I<1  I $D(^(I,0)) S T(+^(0),DA)=S,X=+^(0) S:'$D(TT(X,S)) TT(X,S)=0 S TT(X,S)=TT(X,S)+1
"RTN","LRZORD1",23,0)
 K DIC
"RTN","LRZORD1",24,0)
 I $D(LRADDTST) S LRORD=+LRADDTST,LRADDTST="" G LRFIRST
"RTN","LRZORD1",25,0)
 D ORDER^LROW2
"RTN","LRZORD1",26,0)
 ;
"RTN","LRZORD1",27,0)
LRFIRST S LRSX=1 G Q13:'LRFIRST!(LRWP<2)
"RTN","LRZORD1",28,0)
 W !,"Choose one (or more, separated by commas)  ('*' AFTER NUMBER TO CHANGE URGENCY) "
"RTN","LRZORD1",29,0)
 F I=1:1:LRWPD D
"RTN","LRZORD1",30,0)
 . N X
"RTN","LRZORD1",31,0)
 . S X=^TMP("LRSTIK",$J,"B",I)
"RTN","LRZORD1",32,0)
 . W !,X,?4,$P(^TMP("LRSTIK",$J,X),U,2)
"RTN","LRZORD1",33,0)
 . S X=$G(^TMP("LRSTIK",$J,"B",I+LRWPD))
"RTN","LRZORD1",34,0)
 . I X W ?39," ",X,?44,$P(^TMP("LRSTIK",$J,X),U,2)
"RTN","LRZORD1",35,0)
Q13 S LREDO=0
"RTN","LRZORD1",36,0)
LEDI ;
"RTN","LRZORD1",37,0)
 ;
"RTN","LRZORD1",38,0)
 ; If LEDI accessioning then check for pending orders in file #69.6
"RTN","LRZORD1",39,0)
 I $G(LRRSTAT)="I",$G(LRRSITE("SMID"))'="",$G(LRSD("RUID"))'="" D  I $O(LROT(0)) G BAR
"RTN","LRZORD1",40,0)
 . D EN^LRORDB(LRSD("RUID"),LRRSITE("SMID"))
"RTN","LRZORD1",41,0)
 G:LRWP'>1 Q13A
"RTN","LRZORD1",42,0)
 W ! W:'LRFIRST "'?' for list,  " S LRFIRST=0
"RTN","LRZORD1",43,0)
 R "TEST number(s): ",LRSX:DTIME S:LRSX["?" LRFIRST=1 G LRFIRST:LRFIRST
"RTN","LRZORD1",44,0)
 I LRSX=""!(LRSX["^") G BAR
"RTN","LRZORD1",45,0)
 F I=1:1:$L(LRSX,",") D  Q:LREDO
"RTN","LRZORD1",46,0)
 . S LRSSX=$P(LRSX,",",I)
"RTN","LRZORD1",47,0)
 . I LRSSX'?1.3N.1"*" S LREDO=1 Q
"RTN","LRZORD1",48,0)
 . S LRSSX=$P(LRSSX,"*")
"RTN","LRZORD1",49,0)
 . I '$D(^TMP("LRSTIK",$J,LRSSX)) S LREDO=1
"RTN","LRZORD1",50,0)
Q13A I LREDO W !,"Something was mistyped, try again." G Q13
"RTN","LRZORD1",51,0)
 F LRK=1:1 S LRSSX=$P(LRSX,",",LRK) Q:LRSSX=""  D
"RTN","LRZORD1",52,0)
 . N X
"RTN","LRZORD1",53,0)
 . S LRST=$S(LRSSX["*":1,1:0),LRSSX=+LRSSX
"RTN","LRZORD1",54,0)
 . S X=^TMP("LRSTIK",$J,LRSSX)
"RTN","LRZORD1",55,0)
 . S LRSAMP=$P(X,U,3),LRSPEC=$P(X,U,5),LRTSTS=+X
"RTN","LRZORD1",56,0)
 . D Q20^LRORDD
"RTN","LRZORD1",57,0)
BAR ;S LRM=LRWPC+1,K=0 W !,"Other tests? N//" D % G Q14:'(%["Y")
"RTN","LRZORD1",58,0)
LRM ;D MORE^LRORD2
"RTN","LRZORD1",59,0)
 ; JFR - changed following to use stuff LRNATURE
"RTN","LRZORD1",60,0)
Q14 ;D:$P(LRPARAM,U,17) ^LRORDD D ^LRORD2A    ;JFR  testing the max order stuff
"RTN","LRZORD1",61,0)
 S LRNATURE="4^SERVICE CORRECTION^99ORN",%=1
"RTN","LRZORD1",62,0)
 G LRM:'$D(%)&($D(LROT)'=11),DROP:$O(LROT(-1))="",LRM:'$D(%),DROP:%[U K DIC G DROP:'$D(LROT)!(%["N")
"RTN","LRZORD1",63,0)
 ;W !!,"LAB Order number: ",LRORD,!!
"RTN","LRZORD1",64,0)
 S ^TMP("LRVEHU",$J,LRORD)=""
"RTN","LRZORD1",65,0)
 S LRZORD=LRORD
"RTN","LRZORD1",66,0)
 I LRECT D  G DROP:LRCDT<1
"RTN","LRZORD1",67,0)
 . I $G(LRORDRR)="R",$G(LRSD("CDT")) D  Q
"RTN","LRZORD1",68,0)
 . . S LRCDT=LRSD("CDT")_"^"
"RTN","LRZORD1",69,0)
 . . S LRORDTIM=$P(LRSD("CDT"),".",2)
"RTN","LRZORD1",70,0)
 . . I 'LRORDTIM S $P(LRCDT,"^",2)=1
"RTN","LRZORD1",71,0)
 . D TIME^LROE
"RTN","LRZORD1",72,0)
 . I LRCDT<1 Q
"RTN","LRZORD1",73,0)
 . S LRORDTIM=$P(Y,".",2)
"RTN","LRZORD1",74,0)
 D NOW^%DTC S LRNT=% S:'LRECT LRCDT=LRNT_"^1"
"RTN","LRZORD1",75,0)
 S LRIDT=9999999-LRCDT
"RTN","LRZORD1",76,0)
 D ^LRORDST Q:$D(LROR)
"RTN","LRZORD1",77,0)
 Q
"RTN","LRZORD1",78,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRZORD1",79,0)
 ;
"RTN","LRZORD1",80,0)
Q20A ;from LRORD2
"RTN","LRZORD1",81,0)
MAX ; CHECK FOR MAXIUM ORDER FREQUENCY
"RTN","LRZORD1",82,0)
 I $D(TT(LRTSTS,LRSPEC)),$D(^LAB(60,LRTSTS,3,"B",LRCS(LRCSN))) D EN2^LRORDD I %'["Y" Q
"RTN","LRZORD1",83,0)
 S I7=0 F I9=0:0 S I9=$O(T(LRTSTS,I9)) Q:I9=""  I $D(^LAB(60,LRTSTS,3,+$O(^LAB(60,LRTSTS,3,"B",LRSAMP,0)),0)),+$P(^(0),U,5),LRSPEC=T(LRTSTS,I9) S I7=1
"RTN","LRZORD1",84,0)
 I I7 W $C(7),!!,"You have a duplicate: " S LRSN=0 F  S LRSN=$O(T(LRTSTS,LRSN)) Q:LRSN<1  W "  for ",$P(^LAB(60,LRTSTS,0),U) S LRZT=LRTSTS D ORDER^LROS S LRTSTS=LRZT
"RTN","LRZORD1",85,0)
 I I7 W !,"You already have that test, do you really want another? N//" D %
"RTN","LRZORD1",86,0)
 Q
"RTN","LRZORD1",87,0)
 ;
"RTN","LRZORD1",88,0)
URGG W !,"For ",$P(^TMP("LRSTIK",$J,LRSSX),U,2)
"RTN","LRZORD1",89,0)
 D URG^LRORD2
"RTN","LRZORD1",90,0)
 Q
"RTN","LRZORD1",91,0)
 ;
"RTN","LRZORD1",92,0)
 ;
"RTN","LRZORD1",93,0)
DROP W !!,"ORDER CANCELED",$C(7),!! Q:$D(LROR)  G L2
"RTN","LRZORD1",94,0)
 ;
"RTN","LRZORD1",95,0)
 ;
"RTN","LRZORD1",96,0)
MICRO ;
"RTN","LRZORD1",97,0)
 Q
"RTN","LRZORD1",98,0)
 ;
"RTN","LRZORD1",99,0)
LOC ;get pt. location, called by LRPDA1
"RTN","LRZORD1",100,0)
 N %
"RTN","LRZORD1",101,0)
 I +LRDPF=LRDPF S LRDPF=LRDPF_^DIC(LRDPF,0,"GL")
"RTN","LRZORD1",102,0)
 S LREND=0,LRCAPLOC="Z"
"RTN","LRZORD1",103,0)
 I $D(^LR(LRDFN,.1)) S LRLLOC=^(.1)
"RTN","LRZORD1",104,0)
 S X="`23" ; JFR  whatever location var we use
"RTN","LRZORD1",105,0)
 ;7/12/14 GOW ADD CODE FOR MORE UNIVERSAL SITE REPORT ROUTING LOCATION
"RTN","LRZORD1",106,0)
LOC1 ;
"RTN","LRZORD1",107,0)
 ;OVERRIDE WITH LEGIT HOSP LOC FOR SITE
"RTN","LRZORD1",108,0)
 S DIC="^SC(",DIC(0)="QEA",DIC("A")="Enter Report Routing Location: " D ^DIC I Y=-1 G LOC1
"RTN","LRZORD1",109,0)
 S X=$P(Y,"^",1)
"RTN","LRZORD1",110,0)
 ;END MOD 
"RTN","LRZORD1",111,0)
 K DIC S DIC("S")="I '$G(^(""OOS""))"
"RTN","LRZORD1",112,0)
 S LROLLOC="",DIC=44,DIC(0)="MOQZ" S:X="" X=LRLLOC D ^DIC K DIC G LOC:X["?"
"RTN","LRZORD1",113,0)
 S:Y>0 LROLLOC=+Y,LRLLOC=$P(Y(0),U,2),LRCAPLOC=$S($L($P(Y(0),U,3)):$P(Y(0),U,3),1:LRCAPLOC)
"RTN","LRZORD1",114,0)
 ;LOCAL MOD 8/1/14
"RTN","LRZORD1",115,0)
 I $G(LRLLOC)="" S LRLLOC="GEN MED"
"RTN","LRZORD1",116,0)
 ;END LOCAL MOD
"RTN","LRZORD1",117,0)
 I $L(LRLLOC) S ^LR(LRDFN,.1)=LRLLOC
"RTN","LRZORD1",118,0)
 S ^LR(LRDFN,.092)=LRCAPLOC
"RTN","LRZORD1",119,0)
 K LRIA,LRRA I $D(^SC(+Y,"I")) S LRIA=+^("I"),LRRA=$P(^("I"),U,2)
"RTN","LRZORD1",120,0)
 K DIC,LRIA,LRRA,% Q
"RTN","LRZORD1",121,0)
 S LREND=1 K DIC,LRIA,LRRE,%
"RTN","LRZORD1",122,0)
 Q
"RTN","LRZORD1",123,0)
PRAC ;
"RTN","LRZORD1",124,0)
 N PROVIDER,IEN1
"RTN","LRZORD1",125,0)
 ; S LRPRAC=20364 Q
"RTN","LRZORD1",126,0)
 ;S LRPRAC=1 Q
"RTN","LRZORD1",127,0)
 ;S PROVIDER=LRSRNB1(IENN)
"RTN","LRZORD1",128,0)
 S PROVIDER=$P($G(^VA(200,IENN,0)),"^",1)
"RTN","LRZORD1",129,0)
 W !,"PROVIDER=",PROVIDER
"RTN","LRZORD1",130,0)
 S LRPRAC=IENN Q
"RTN","LRZORD1",131,0)
 N %
"RTN","LRZORD1",132,0)
 D:'$D(LRPARAM) ^LRPARAM K DIC S LREND=0,(VA200,DIC("B"))=""
"RTN","LRZORD1",133,0)
 S DFN=$P(^LR(LRDFN,0),U,3) S LRDPF=$P(^LR(LRDFN,0),U,2)
"RTN","LRZORD1",134,0)
 ; S X="`20364" ; JFR might need to allow provider selection
"RTN","LRZORD1",135,0)
 S X="`1" ; JFR might need to allow provider selection 
"RTN","LRZORD1",136,0)
 S DIC="^VA(200,",DIC(0)="MNQ",DIC("S")="I $D(^VA(200,""AK.PROVIDER"",$P(^(0),U))),$$ACTIVE^XUSER(Y)",LRPRAC="",DIC("A")="PROVIDER: ",D="AK.PROVIDER"
"RTN","LRZORD1",137,0)
 D ^DIC K DIC G:Y<0 QUIT
"RTN","LRZORD1",138,0)
 S:Y>0 (^LR(LRDFN,.2),LRPRAC)=+Y
"RTN","LRZORD1",139,0)
 Q
"RTN","LRZORD1",140,0)
QUIT S LREND=1 Q
"RTN","LRZOS")
0^6^B30649212
"RTN","LRZOS",1,0)
LRZOS ;SLC/CJS/DALOI/FHS-LAB ORDER STATUS ;12/7/06 13:19
"RTN","LRZOS",2,0)
 ;;5.2;LAB SERVICE;**121,153,202,210,221,263**;Sep 27, 1994;Build 8
"RTN","LRZOS",3,0)
 N LRLOOKUP S LRLOOKUP=1 ; Variable to indicate to lookup patients, prevent adding new entries in ^LRDPA
"RTN","LRZOS",4,0)
EN K DIC,LRDPAF,%DT("B") S DIC(0)="A"
"RTN","LRZOS",5,0)
 D ^LRDPA G:(LRDFN=-1)!$D(DUOUT)!$D(DTOUT) LREND D L0 G EN
"RTN","LRZOS",6,0)
L0 D ENT S %DT="" D DT^LRX
"RTN","LRZOS",7,0)
L1 S LREND=0,%DT="E",%DT("A")="DATE to begin review: " D DATE^LRWU G LREND:Y<1 S (LRSDT,LRODT)=Y S %DT="",X="T-"_$S($P($G(^LAB(69.9,1,0)),U,9):$P(^(0),U,9),1:30) D ^%DT S LRLDAT=Y
"RTN","LRZOS",8,0)
L2 S LRSN=$O(^LRO(69,LRODT,1,"AA",LRDFN,0)) I LRSN<1 S Y=LRODT D DD^LRX W !,"No orders for ",Y S X1=LRODT,X2=-1 D C^%DTC S LRODT=X I LRODT<LRLDAT W !!,"NO REMAINING ACTIVE ORDERS",! G LREND
"RTN","LRZOS",9,0)
 D WAIT:$Y>18 G LREND:LREND,L2:LRSN<1
"RTN","LRZOS",10,0)
 I LRSDT'=LRODT W !,"Orders for date: " S Y=LRODT D DD^LRX W Y," OK" S %=1 D YN^DICN I %'=1 G LREND
"RTN","LRZOS",11,0)
 D ENTRY G LREND:LREND S X1=LRODT,X2=-1 D C^%DTC S LRODT=X
"RTN","LRZOS",12,0)
 G L2
"RTN","LRZOS",13,0)
ENTRY D HED Q:LREND
"RTN","LRZOS",14,0)
 S LRSN=0 F  S LRSN=$O(^LRO(69,LRODT,1,"AA",LRDFN,LRSN)) Q:LRSN<1!($G(LREND))  D ORDER Q:$G(LREND)  D HED:$Y>(IOSL-2)
"RTN","LRZOS",15,0)
 Q
"RTN","LRZOS",16,0)
ORDER ;call with LRSN, from LROE, LROE1, LRORD1, LROW2, LROR1    ;;;;JFR   changed to eliminate writes
"RTN","LRZOS",17,0)
 K D,LRTT S LREND=0
"RTN","LRZOS",18,0)
 Q:'$D(^LRO(69,LRODT,1,LRSN,0))  S LROD0=^LRO(69,LRODT,1,LRSN,0),LROD1=$S($D(^(1)):^(1),1:""),LROD3=$S($D(^(3)):^(3),1:"")
"RTN","LRZOS",19,0)
 S X=$P(LROD0,U,6) D DOC^LRX
"RTN","LRZOS",20,0)
 S X=$P(LROD0,U,3),X=$S(X:$S($D(^LAB(62,+X,0)):$P(^(0),U),1:""),1:""),X4="" I $D(^LRO(69,LRODT,1,LRSN,4,1,0)),+^(0) S X4=+^(0),X4=$S($D(^LAB(61,X4,0)):$P(^(0),U),1:"")
"RTN","LRZOS",21,0)
 I $E($P(LROD1,U,6))="*" ;W !?3,$P(LROD1,U,6) D WAIT Q:$G(LREND)
"RTN","LRZOS",22,0)
 F  S I=$O(^LRO(69,LRODT,1,LRSN,6,I)) Q:I<1!($G(LREND))  ;W !?5,": ",^(I,0) D WAIT Q:$G(LREND)
"RTN","LRZOS",23,0)
 S LRACN=0 F  S LRACN=$O(^LRO(69,LRODT,1,LRSN,2,LRACN)) Q:LRACN<1!($G(LREND))  I $D(^(LRACN,0))#2 S LRACN0=^(0) D TEST
"RTN","LRZOS",24,0)
 Q
"RTN","LRZOS",25,0)
TEST N LRY,LRURG
"RTN","LRZOS",26,0)
 S LRROD=$P(LRACN0,U,6),(Y,LRLL,LROT,LROS,LROSD,LRURG)="",X3=0
"RTN","LRZOS",27,0)
 I $P(LRACN0,"^",11) G CANC
"RTN","LRZOS",28,0)
 S X=$P(LROD0,U,4),LROT=$S(X="WC":"Requested (WARD COL)",X="SP":"Requested (SEND PATIENT)",X="LC":"Requested (LAB COL)",X="I":"Requested (IMM LAB COL)",1:"undetermined")
"RTN","LRZOS",29,0)
 S X=$P(LROD1,U,4),(LROOS,LROS)=$S(X="C":"Collected",X="U":"Uncollected, cancelled",1:"On Collection List") S:X="C" LROT=""
"RTN","LRZOS",30,0)
 I '(+LRACN0) W !!,"BAD ORDER ",LRSN,!,$C(7) D WAIT Q
"RTN","LRZOS",31,0)
 G NOTACC:LROD1="" ;,NOTACC:$P(LROD1,"^",4)="U"
"RTN","LRZOS",32,0)
TST1 S X1=+$P(LRACN0,U,4),X2=+$P(LRACN0,U,3),X3=+$P(LRACN0,U,5)
"RTN","LRZOS",33,0)
 G NOTACC:'$D(^LRO(68,X1,1,X2,1,X3,0)),NOTACC:'$D(^(3)) S LRACD=$S($D(^(9)):^(9),1:"")
"RTN","LRZOS",34,0)
 I '$D(LRTT(X1,X2,X3)) S LRTT(X1,X2,X3)="",I=0 F  S I=$O(^LRO(68,X1,1,X2,1,X3,4,I)) Q:I<.5!($G(LREND))  S LRACC=^(I,0),LRTSTS=+LRACC D TST2
"RTN","LRZOS",35,0)
 I $E($P(LROD1,U,6))="*" W !,?20,$P(LROD1,U,6) D WAIT
"RTN","LRZOS",36,0)
 Q
"RTN","LRZOS",37,0)
TST2 ;
"RTN","LRZOS",38,0)
 N I
"RTN","LRZOS",39,0)
 S LRURG=+$P(LRACC,U,2) I LRURG>49 Q
"RTN","LRZOS",40,0)
 I 'LRTSTS W !!,"BAD ACCESSION TEST POINTER: ",LRTSTS Q
"RTN","LRZOS",41,0)
 S LROT="",LROS=LROOS,LRLL=$P(LRACC,U,3),Y=$P(LRACC,U,5) I Y S LROS=$S($E($P(LRACC,U,6))="*":$P(LRACC,U,6),1:"Test Complete") D DATE S LROSD=Y Q  ;D WRITE,COM(1.1),COM(1)
"RTN","LRZOS",42,0)
 S Y=$P(LROD3,U) D DATE S LROSD=Y I LRLL S LROS="Testing In Progress"
"RTN","LRZOS",43,0)
 I $P(LROD1,"^",4)="U" S (LROS,LROOS)=""
"RTN","LRZOS",44,0)
 D WRITE,COM(1.1),COM(1)
"RTN","LRZOS",45,0)
 Q
"RTN","LRZOS",46,0)
WRITE ;
"RTN","LRZOS",47,0)
 W !?2,$S($D(^LAB(60,+LRTSTS,0)):$P(^(0),U),1:"BAD TEST POINTER")
"RTN","LRZOS",48,0)
 I $X>20 W ! D WAIT Q:(LREND)
"RTN","LRZOS",49,0)
 W ?20,$S($D(^LAB(62.05,+LRURG,0)):$P(^(0),U),1:"")," " D WAIT Q:$G(LREND)
"RTN","LRZOS",50,0)
 I $X>28 W ! D WAIT Q:$G(LREND)
"RTN","LRZOS",51,0)
 W ?28,LROT," ",LROS,?43," ",LROSD
"RTN","LRZOS",52,0)
 W:X3 ?60," ",$S($D(^LRO(68,X1,1,X2,1,X3,.2)):^(.2),1:"")
"RTN","LRZOS",53,0)
 I LRROD W !?46,"  See order: ",LRROD D WAIT
"RTN","LRZOS",54,0)
 Q
"RTN","LRZOS",55,0)
COM(LRMMODE) ;
"RTN","LRZOS",56,0)
 ;Write comments
"RTN","LRZOS",57,0)
 ;LRMMODE=comments node to display
"RTN","LRZOS",58,0)
 N LRTSTI
"RTN","LRZOS",59,0)
 S:'$G(LRMMODE) LRMMODE=1
"RTN","LRZOS",60,0)
 S LRTSTI=$O(^LRO(69,LRODT,1,LRSN,2,"B",+LRTSTS,0)) Q:'LRTSTI
"RTN","LRZOS",61,0)
 D COMWRT(LRODT,LRSN,LRTSTI,LRMMODE,3)
"RTN","LRZOS",62,0)
 Q
"RTN","LRZOS",63,0)
COMWRT(LRODT,LRSN,LRTSTI,NODE,TAB) ;
"RTN","LRZOS",64,0)
 ;Write comment node
"RTN","LRZOS",65,0)
 I $S('LRODT:1,'LRSN:1,'LRTSTI:1,'NODE:1,1:0) Q
"RTN","LRZOS",66,0)
 Q:'$D(^LRO(69,LRODT,1,LRSN,2,LRTSTI))
"RTN","LRZOS",67,0)
 S:'$G(TAB) TAB=3
"RTN","LRZOS",68,0)
 N LRI
"RTN","LRZOS",69,0)
 S LRI=0 F  S LRI=$O(^LRO(69,LRODT,1,LRSN,2,LRTSTI,NODE,LRI)) Q:LRI<1!($G(LREND))  W:$D(^(LRI,0)) !?TAB,": "_^(0) D WAIT
"RTN","LRZOS",70,0)
 Q
"RTN","LRZOS",71,0)
NOTACC I $G(LROD3)="" S LROS="" G NO2
"RTN","LRZOS",72,0)
 I $P(LROD3,U,2)'="" S LROS=" ",Y=$P(LROD3,U,2) G NO2
"RTN","LRZOS",73,0)
 S Y=$P(LROD3,U) S LROS=" "
"RTN","LRZOS",74,0)
NO2 S:'Y Y=$P(LROD0,U,8) S Y=$S(Y:Y,+LROD3:+LROD3,+LROD1:+LROD1,1:LRODT) D DATE S LROSD=Y
"RTN","LRZOS",75,0)
 S LRTSTS=+LRACN0,LRURG=$P(LRACN0,U,2)
"RTN","LRZOS",76,0)
 S LROS=$S(LRROD:"Combined",1:LROS) S:LROS="" LROS="for: "
"RTN","LRZOS",77,0)
 I LRTSTS ;D WRITE,COM(1.1),COM(1) ;second call for backward compatibility - can be removed in future years (1/98)
"RTN","LRZOS",78,0)
 ;I $L($P(LROD1,U,6)) W !,?20,$P(LROD1,U,6) D WAIT  ;; JFR  eliminate writes
"RTN","LRZOS",79,0)
 Q
"RTN","LRZOS",80,0)
DATE S Y=$$FMTE^XLFDT(Y,"5MZ") Q
"RTN","LRZOS",81,0)
HED D WAIT:$E(IOST,1)="C"&($Y>18) Q:$G(LREND)  W @IOF,!,"  Test",?20,"Urgency",?30,"Status",?64,"Accession"
"RTN","LRZOS",82,0)
ENT ;from LROE, LROE1, LRORD1, LROW2
"RTN","LRZOS",83,0)
 Q
"RTN","LRZOS",84,0)
LREND I $E(IOST)="P" W @IOF
"RTN","LRZOS",85,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRZOS",86,0)
 K LRLDAT,LRURG,LROSD,LRTT,LROS,LROOS,LRROD,X1,X2,X3,%,A,DFN,DIC,I,K,LRACC,LRACN,LRACN0,LRDFN,LRDOC,LRDPF,LREND,LRLL,LROD0,LROD1,LROD3,LRODT,LROT,LRSDT,LRSN,LRTSTS,X,X4,Y,Z,%Y,DIWL,DIWR,DPF,PNM Q
"RTN","LRZOS",87,0)
SHOW ;call with LRSN,LRODT, from LRCENDEL, LRTSTJAN
"RTN","LRZOS",88,0)
 S LREND=0
"RTN","LRZOS",89,0)
 W !,"Order  Test",?20,"Urgency",?30,"Status",?64,"Accession" D ORDER Q
"RTN","LRZOS",90,0)
WAIT Q:$Y<(IOSL-3)  I $E(IOST)'="C" W @IOF Q
"RTN","LRZOS",91,0)
 W !,"  PRESS '^' TO STOP " R X:DTIME S:X="" X=1 S LREND=".^"[X Q:$G(LREND)  W @IOF
"RTN","LRZOS",92,0)
 Q
"RTN","LRZOS",93,0)
CANC ;For Canceled tests
"RTN","LRZOS",94,0)
 S LRTSTS=+$G(LRACN0),LROT="*Canceled by: "_$P(^VA(200,$P(LRACN0,"^",11),0),U)
"RTN","LRZOS",95,0)
 I LRTSTS D WRITE,COM(1.1),COM(1) ;second call for backward compatitility - can be removed in future years (1/98)
"RTN","LRZOS",96,0)
 Q
"RTN","LRZOS",97,0)
OERR(X) ;Get order status for predefined patient
"RTN","LRZOS",98,0)
 ;X=DFN;DPT(   <--ORVP FORMAT
"RTN","LRZOS",99,0)
 I '$G(X) W !!?5,"NO PATIENT SELECTED",! H 2 Q
"RTN","LRZOS",100,0)
 N DFN,LRDPA,LRDFN,LRDT0,VA200
"RTN","LRZOS",101,0)
 S DFN=+X,LRDPF=+$P(@("^"_$P(X,";",2)_"0)"),"^",2)_"^"_$P(X,";",2)
"RTN","LRZOS",102,0)
 D END^LRDPA
"RTN","LRZOS",103,0)
 Q:LRDFN=-1
"RTN","LRZOS",104,0)
 W !,"Lab test status for: "_$P(^DPT(DFN,0),"^")
"RTN","LRZOS",105,0)
 D L0
"RTN","LRZOS",106,0)
 Q
"RTN","LRZVER1")
0^7^B30341470
"RTN","LRZVER1",1,0)
LRZVER1 ;DALOI/FHS-LAB ROUTINE DATA VERIFICATION ; 12/7/06 08:48
"RTN","LRZVER1",2,0)
 ;;5.2;LAB SERVICE;**42,153,201,215,239,240,263,232,286**;Sep 27, 1994;Build 8
"RTN","LRZVER1",3,0)
 ;
"RTN","LRZVER1",4,0)
VER ; from LRGVP
"RTN","LRZVER1",5,0)
 S LRLLOC=0,LRCW=8,LROUTINE=$P(^LAB(69.9,1,3),U,2) I $D(^LRO(69,LRODT,1,LRSN,0)) S LRLLOC=$P(^(0),U,7) S:'$L(LRLLOC) LRLLOC=0 W !,$P(^LRO(69,LRODT,1,LRSN,1),U,6)
"RTN","LRZVER1",6,0)
 S LRCDT=$S($D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)):$P(^(3),U,1,2),1:$P(^(0),U,3)_U),LREAL=$P(LRCDT,U,2)
"RTN","LRZVER1",7,0)
 S LRCDT=+LRCDT,LRSAMP=$S($D(^LRO(69,LRODT,1,LRSN,0)):$P(^(0),U,3),1:"")
"RTN","LRZVER1",8,0)
 S LRIDT=$S($P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5):$P(^(3),U,5),1:"")
"RTN","LRZVER1",9,0)
 S:'LRIDT LRIDT=9999999-LRCDT
"RTN","LRZVER1",10,0)
 D EXP
"RTN","LRZVER1",11,0)
LD S LRSS="CH" ;ONLY WORKS FOR 'CH'
"RTN","LRZVER1",12,0)
 S LRMETH=LRSS IF $D(^LR(LRDFN,LRSS,LRIDT,0)) S LRMETH=$P($P(^(0),U,8),";",1)
"RTN","LRZVER1",13,0)
 ;W:$D(^LAB(62,+LRSAMP,0)) !,"Sample: ",$P(^(0),U)
"RTN","LRZVER1",14,0)
 K ^TMP("LR",$J,"TMP"),LRORD,LRM
"RTN","LRZVER1",15,0)
 D ^LRZVER2
"RTN","LRZVER1",16,0)
 K LRDL
"RTN","LRZVER1",17,0)
 Q
"RTN","LRZVER1",18,0)
 ;
"RTN","LRZVER1",19,0)
 ;
"RTN","LRZVER1",20,0)
EXP ; Get the list of tests for this ACC. from LRGVG1
"RTN","LRZVER1",21,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRZVER1",22,0)
 N I,N,IX,LRNLT,T1,X
"RTN","LRZVER1",23,0)
 K LRTEST,LRNAME,LRSM60
"RTN","LRZVER1",24,0)
 S LRALERT=LROUTINE,N=0,I=0,IX=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,1,0))
"RTN","LRZVER1",25,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<.5  D
"RTN","LRZVER1",26,0)
 . S X=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0))
"RTN","LRZVER1",27,0)
 . I 'X Q
"RTN","LRZVER1",28,0)
 . I $P(X,"^",6)="*Not Performed" Q
"RTN","LRZVER1",29,0)
 . S N=N+1,LRTEST(N)=I,LRNLT=$S($P(X,"^",2)>50:$P(X,U,9),1:$P(X,"^"))
"RTN","LRZVER1",30,0)
 . S LRTEST(N,"P")=LRNLT_U_$$NLT(LRNLT)
"RTN","LRZVER1",31,0)
 . S LRAL=$P(X,U,2)#50
"RTN","LRZVER1",32,0)
 . I LRAL S LRALERT=$S(LRAL<LRALERT:LRAL,1:LRALERT)
"RTN","LRZVER1",33,0)
 ;
"RTN","LRZVER1",34,0)
 S LRNTN=N
"RTN","LRZVER1",35,0)
 F T1=1:1:N I $D(^LAB(60,+LRTEST(T1),0)) D
"RTN","LRZVER1",36,0)
 . S LRTEST(T1)=LRTEST(T1)_U_^(0)
"RTN","LRZVER1",37,0)
 . S LRNAME(T1)=$P(LRTEST(T1),U,2),LRNAME(T1,+LRTEST(T1))=""
"RTN","LRZVER1",38,0)
 . S:$G(^(1,IX,3)) LRSM60(+$P(LRTEST(T1),";",2))=^(3)
"RTN","LRZVER1",39,0)
 . D EX1
"RTN","LRZVER1",40,0)
 K IX
"RTN","LRZVER1",41,0)
 N X1,X
"RTN","LRZVER1",42,0)
 S X=$P($H,","),X(1)=$P($H,",",2),I=0
"RTN","LRZVER1",43,0)
 F  S I=$O(LRSM60(I)) Q:'I  S X1=X-LRSM60(I)_","_X(1),LRSM60(I)=9999999-$$HTFM^XLFDT(X1)
"RTN","LRZVER1",44,0)
 Q
"RTN","LRZVER1",45,0)
 ;
"RTN","LRZVER1",46,0)
 ;
"RTN","LRZVER1",47,0)
EX1 ; Expand the list of tests to edit.
"RTN","LRZVER1",48,0)
 Q:'$D(LRTEST(T1))
"RTN","LRZVER1",49,0)
 S X=LRTEST(T1),^TMP("LR",$J,"VTO",+X)=$P($P(X,U,6),";",2)
"RTN","LRZVER1",50,0)
 S ^TMP("LR",$J,"VTO",+X,"P")=LRTEST(T1,"P"),S1=0,J=0
"RTN","LRZVER1",51,0)
 D EX2
"RTN","LRZVER1",52,0)
 K S1,J
"RTN","LRZVER1",53,0)
 Q
"RTN","LRZVER1",54,0)
 ;
"RTN","LRZVER1",55,0)
EX2 ;
"RTN","LRZVER1",56,0)
 S:'$D(LRCFL) LRCFL=""
"RTN","LRZVER1",57,0)
 S LRSUB=$P(X,U,6)
"RTN","LRZVER1",58,0)
 I $D(^LAB(60,+X,4)),$P(^(4),"^",2) S LRCFL=LRCFL_$P(^(4),"^",2)_U
"RTN","LRZVER1",59,0)
 ;
"RTN","LRZVER1",60,0)
 ; If atomic test then setup and quit
"RTN","LRZVER1",61,0)
 I LRSUB'="" D  Q
"RTN","LRZVER1",62,0)
 . S S2=$P(LRSUB,";",2)
"RTN","LRZVER1",63,0)
 . D:'$D(^TMP("LR",$J,"TMP",S2)) ORD
"RTN","LRZVER1",64,0)
 ;
"RTN","LRZVER1",65,0)
 ; Explode panel tests
"RTN","LRZVER1",66,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRZVER1",67,0)
 S S1=S1+1,S1(S1)=X,S1(S1,1)=J
"RTN","LRZVER1",68,0)
 S J=0
"RTN","LRZVER1",69,0)
 F  S J=$O(^LAB(60,+S1(S1),2,J)) Q:J<1  D
"RTN","LRZVER1",70,0)
 . S Y=+^(J,0),X=Y_U_^LAB(60,Y,0)
"RTN","LRZVER1",71,0)
 . I $P($G(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),4,Y,0)),"^",6)="*Not Performed" Q
"RTN","LRZVER1",72,0)
 . D EX2
"RTN","LRZVER1",73,0)
 S X=S1(S1),J=S1(S1,1),S1=S1-1
"RTN","LRZVER1",74,0)
 Q
"RTN","LRZVER1",75,0)
 ;
"RTN","LRZVER1",76,0)
 ;
"RTN","LRZVER1",77,0)
ORD ;
"RTN","LRZVER1",78,0)
 ; LRNX is set by caller
"RTN","LRZVER1",79,0)
 S LRNX=+$G(LRNX)+1,LRORD(LRNX)=S2
"RTN","LRZVER1",80,0)
 S ^TMP("LR",$J,"TMP",S2)=+X
"RTN","LRZVER1",81,0)
 ; If panel being exploded then set parent("P" node)
"RTN","LRZVER1",82,0)
 ;  to file #60 test being exploded
"RTN","LRZVER1",83,0)
 I $G(LRTEST(T1,"P")) D
"RTN","LRZVER1",84,0)
 . I +LRTEST(T1)=+LRTEST(T1,"P") S ^TMP("LR",$J,"TMP",S2,"P")=LRTEST(T1,"P")_"!"_$$RNLT(+X)
"RTN","LRZVER1",85,0)
 . E  S ^TMP("LR",$J,"TMP",S2,"P")=+LRTEST(T1)_U_$$NLT(+LRTEST(T1))_"!"_$$RNLT(+X)
"RTN","LRZVER1",86,0)
 ;
"RTN","LRZVER1",87,0)
 I $P(X,U,18) D
"RTN","LRZVER1",88,0)
 . S LRM(S2)=+X
"RTN","LRZVER1",89,0)
 . S LRM(S2,"P")=$G(^TMP("LR",$J,"TMP",S2,"P"))
"RTN","LRZVER1",90,0)
 . S LRMX(+X)=""
"RTN","LRZVER1",91,0)
 Q
"RTN","LRZVER1",92,0)
 ;
"RTN","LRZVER1",93,0)
 ;
"RTN","LRZVER1",94,0)
NLT(X) ;
"RTN","LRZVER1",95,0)
 N Y
"RTN","LRZVER1",96,0)
 S Y=$S($P($G(^LAM(+$G(^LAB(60,+X,64)),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRZVER1",97,0)
 Q Y
"RTN","LRZVER1",98,0)
 ;
"RTN","LRZVER1",99,0)
 ;
"RTN","LRZVER1",100,0)
RNLT(X) ;
"RTN","LRZVER1",101,0)
 I 'X Q ""
"RTN","LRZVER1",102,0)
 N Y
"RTN","LRZVER1",103,0)
 S Y(1)=+$P($G(^LAB(60,X,64)),U,2)
"RTN","LRZVER1",104,0)
 S Y=$S($P($G(^LAM(Y(1),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRZVER1",105,0)
 I Y S $P(Y,"!",2)=$$LNC(Y,$G(LRCDEF),$G(LRSPEC))
"RTN","LRZVER1",106,0)
 S $P(Y,"!",3)=$G(LRCDEF),$P(Y,"!",6)=X
"RTN","LRZVER1",107,0)
 Q Y
"RTN","LRZVER1",108,0)
 ;
"RTN","LRZVER1",109,0)
 ;
"RTN","LRZVER1",110,0)
LNC(LRNLT,LRCDEF,LRSPEC) ;reture the LOINC code for WKLD Code/Specimen
"RTN","LRZVER1",111,0)
 ; Call with (nlt code,method suffix,test specimen)
"RTN","LRZVER1",112,0)
 ; TA = Time Aspect
"RTN","LRZVER1",113,0)
 N X,N,Y,LRSPECN,VAL,ERR,TA S X=""
"RTN","LRZVER1",114,0)
 Q:'LRNLT X
"RTN","LRZVER1",115,0)
 K LRMSGM
"RTN","LRZVER1",116,0)
 S:$G(LRCDEF)="" LRCDEF="0000"
"RTN","LRZVER1",117,0)
 I $P(LRCDEF,".",2) S LRCDEF=$P(LRCDEF,".",2)
"RTN","LRZVER1",118,0)
 S LRCDEF=$S($P(LRNLT,".",2):$P(LRNLT,".",2),1:LRCDEF)
"RTN","LRZVER1",119,0)
 I $L(LRCDEF)'=4 S LRCDEF=LRCDEF_$E("0000",$L(LRCDEF),($L(LRCDEF-4)))
"RTN","LRZVER1",120,0)
 S LRCDEF=LRCDEF_" "
"RTN","LRZVER1",121,0)
 S LRSPEC=+LRSPEC
"RTN","LRZVER1",122,0)
 ;Get time aspect from 61
"RTN","LRZVER1",123,0)
 S TA=$$GET1^DIQ(61,LRSPEC_",",.0961,"I")
"RTN","LRZVER1",124,0)
 S LRSPECN=$S($D(^LAB(61,LRSPEC,0))#2:$$GET1^DIQ(61,LRSPEC_",",.01),1:"Unknown")
"RTN","LRZVER1",125,0)
 S LRNLT=$P(LRNLT,".")_"."
"RTN","LRZVER1",126,0)
 ;Check for WKLD CODE_LOAD/WORK LIST method suffix
"RTN","LRZVER1",127,0)
 S VAL(1)=LRNLT_LRCDEF
"RTN","LRZVER1",128,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRZVER1",129,0)
 ;Looking for specimen specific LOINC
"RTN","LRZVER1",130,0)
 I N,LRSPEC D  I X D MSG(1) Q X
"RTN","LRZVER1",131,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRZVER1",132,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRZVER1",133,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRZVER1",134,0)
 ;Looking LOINC default
"RTN","LRZVER1",135,0)
 I N S X=$$LDEF(N) I X D MSG(2) Q X
"RTN","LRZVER1",136,0)
 I LRCDEF="0000 " Q ""
"RTN","LRZVER1",137,0)
 ;Looking for WKLD CODE_GENERIC suffix
"RTN","LRZVER1",138,0)
 K VAL
"RTN","LRZVER1",139,0)
 S VAL(1)=LRNLT_"0000 "
"RTN","LRZVER1",140,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRZVER1",141,0)
 I 'N Q ""
"RTN","LRZVER1",142,0)
 ;Looking for WKLD CODE_GENERIC specimen specific LOINC
"RTN","LRZVER1",143,0)
 I LRSPEC D  I X D MSG(3) Q X
"RTN","LRZVER1",144,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRZVER1",145,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRZVER1",146,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRZVER1",147,0)
 ;Looking for WKLD CODE_GENERIC default LOINC
"RTN","LRZVER1",148,0)
 I 'X,N S X=$$LDEF(N) I X D MSG(4)
"RTN","LRZVER1",149,0)
 I 'X S X=""
"RTN","LRZVER1",150,0)
 Q X
"RTN","LRZVER1",151,0)
 ;
"RTN","LRZVER1",152,0)
 ;
"RTN","LRZVER1",153,0)
LDEF(Y) ;Find the default LOINC code for WKLD CODE
"RTN","LRZVER1",154,0)
 I 'Y Q ""
"RTN","LRZVER1",155,0)
 S X=$$GET1^DIQ(64,Y_",",25,"I")
"RTN","LRZVER1",156,0)
 I 'X S X=""
"RTN","LRZVER1",157,0)
 Q X
"RTN","LRZVER1",158,0)
 ;
"RTN","LRZVER1",159,0)
 ;
"RTN","LRZVER1",160,0)
TMPSB(LRSB) ; Get LOINC code from ^TMP("LR",$J,"TMP",LRSB,"P")
"RTN","LRZVER1",161,0)
 S NODE=$G(^TMP("LR",$J,"TMP",LRSB,"P"))
"RTN","LRZVER1",162,0)
 I 'NODE Q ""
"RTN","LRZVER1",163,0)
 S $P(NODE,"!",3)=$$LNC($P(NODE,"!",2),$G(LRCDEF),$G(LRSPEC))
"RTN","LRZVER1",164,0)
 S $P(NODE,"!",4)=$G(LRCDEF)
"RTN","LRZVER1",165,0)
 Q $P(NODE,U,2)
"RTN","LRZVER1",166,0)
 ;
"RTN","LRZVER1",167,0)
 ;
"RTN","LRZVER1",168,0)
MSG(VAL) ;Set output message
"RTN","LRZVER1",169,0)
 Q:'$G(LRMSG)
"RTN","LRZVER1",170,0)
 S LRMSGM="0-No LOINC Code Defined for "_LRNLT_LRCDEF
"RTN","LRZVER1",171,0)
 N TANAME
"RTN","LRZVER1",172,0)
 I $G(TA) S TANAME=$$GET1^DIQ(64.061,TA_",",.01,"E") ;TA Name
"RTN","LRZVER1",173,0)
 I VAL=1 S LRMSGM="1-"_LRNLT_$E(LRCDEF,1,4)_" - "_LRSPECN
"RTN","LRZVER1",174,0)
 I VAL=2 S LRMSGM="2-"_LRNLT_$E(LRCDEF,1,4)_" - Default LOINC"
"RTN","LRZVER1",175,0)
 I VAL=3 S LRMSGM="3-"_LRNLT_"0000 - "_LRSPECN
"RTN","LRZVER1",176,0)
 I VAL=4 S LRMSGM="4-"_LRNLT_"0000 - Default LOINC"
"RTN","LRZVER1",177,0)
 I $G(TA) S LRMSGM=LRMSGM_" Time Aspect "_TANAME
"RTN","LRZVER1",178,0)
 W:$G(LRDBUG) !,LRMSGM,!
"RTN","LRZVER1",179,0)
 Q
"RTN","LRZVER2")
0^8^B8377204
"RTN","LRZVER2",1,0)
LRZVER2 ;SLC/CJS - LAB ROUTINE DATA VERIFICATION ; 12/7/06 08:51
"RTN","LRZVER2",2,0)
 ;;5.2;LAB SERVICE;**153,201**;Sep 27, 1994;Build 8
"RTN","LRZVER2",3,0)
 S LRSPEC="",X=DUZ D DUZ^LRX S:'$D(LREAL) LREAL=1
"RTN","LRZVER2",4,0)
V3 G:$D(^LR(LRDFN,LRSS,LRIDT,0)) V5 G:"AP EM"[LRSS V4
"RTN","LRZVER2",5,0)
V3A IF LRSAMP'="" S LRSPEC=$P(^LAB(62,LRSAMP,0),U,2) G:$D(^LAB(61,+LRSPEC,0)) V4
"RTN","LRZVER2",6,0)
 I LRDPF'=62.3 Q:$D(LRGVP)  S DIC="^LAB(61,",DIC(0)="AEOQ" D ^DIC S LRSPEC=+Y IF LRSPEC=-1 W !,"The specimen MUST be defined." Q
"RTN","LRZVER2",7,0)
V4 I '$D(^LR(LRDFN,LRSS,0)) S ^LR(LRDFN,LRSS,0)=U_$P(^DD(63,$O(^DD(63,"GL",LRSS,0,0)),0),U,2)_U
"RTN","LRZVER2",8,0)
 L +^LR(LRDFN,LRSS) S ^LR(LRDFN,LRSS,0)=$P(^LR(LRDFN,LRSS,0),U,1,2)_U_LRIDT_U_(1+$P(^(0),U,4))
"RTN","LRZVER2",9,0)
 IF "AP EM"[LRSS S ^LR(LRDFN,LRSS,LRIDT,0)=LRCDT_U_LREAL L -^LR(LRDFN,LRSS) G V5
"RTN","LRZVER2",10,0)
 S LRVOL="" S:$D(^LRO(69,LRODT,1,LRSN,1)) LRVOL=$P(^(1),U,5) S ^LR(LRDFN,LRSS,LRIDT,0)=LRCDT_U_LREAL_U_U_U_LRSPEC_U_LRAN_U_LRVOL_U_LRMETH_U L -^LR(LRDFN,LRSS)
"RTN","LRZVER2",11,0)
V5 I LRDPF=62.3 S LRSPEC=$S($D(^LR(LRDFN,LRSS,LRIDT,0)):$P(^(0),U,5),1:"")
"RTN","LRZVER2",12,0)
 S LRLDT=LRIDT,LRVF=0 G V6:'$L($P(^LR(LRDFN,LRSS,LRIDT,0),U,3)) S LRVF=1,X=$P(^(0),U,4),T=$P(^(0),U,3)
"RTN","LRZVER2",13,0)
 W:'X&(LRDPF=62.3) !,"This control has been automatically verified" W:'X&(LRDPF'=62.3) !,"Verified"
"RTN","LRZVER2",14,0)
 I X W !,"These results have been approved by ",$S($D(^VA(200,X,0)):$P(^(0),"^",1),1:"Unknown"),!," on ",$$FMTE^XLFDT(T)
"RTN","LRZVER2",15,0)
V6 I LRDPF'=62.3 S LRSPEC=$P(^LR(LRDFN,LRSS,LRIDT,0),U,5) G:'+LRSPEC V3A
"RTN","LRZVER2",16,0)
 ;W:$D(^LAB(61,+LRSPEC,0)) !,"Specimen: ",$P(^(0),U) ; JFR comment
"RTN","LRZVER2",17,0)
 K LRNOVER I LRSS="CH",'LRVF S LRNOVER=""
"RTN","LRZVER2",18,0)
 K ^TMP("LR",$J,"VTO") S LRCFL="" D ^LRZVER3
"RTN","LRZVER2",19,0)
 K LRSA,LRSB,LRNOVER,LRACC,LRCAPWA,Y,Z,Z1,Z2,K1,LRURG
"RTN","LRZVER2",20,0)
 K DA,DIC,DIE,LRNG,LRNG2,LRNG3,LRNG4,LRNG5,LREDIT,LREXEC,DR
"RTN","LRZVER2",21,0)
 Q  ;LEAVE LRVER2, BACK TO LRVER1
"RTN","LRZVER2",22,0)
V7 ;from LRVER3
"RTN","LRZVER2",23,0)
 S LRLDT=$O(^LR(LRDFN,LRSS,LRLDT)) G V8:LRLDT<1 S:LRLDT>LRTM60 LRLDT=-1 G V8:LRLDT=-1,V7:'$D(^LR(LRDFN,LRSS,LRLDT,0)) D V9 G:$P(^LR(LRDFN,LRSS,LRLDT,0),U,5)'=LRSPEC!'$P(^(0),U,3)!'$D(LRMA) V7
"RTN","LRZVER2",24,0)
V8 S LRDAT(2)="",Z2="" I LRLDT>0 S Z2=^LR(LRDFN,"CH",LRLDT,0),X=+Z2,Z=Z2 D DAT S LRDAT(2)=LRDAT
"RTN","LRZVER2",25,0)
 S Z1=^LR(LRDFN,"CH",LRIDT,0),X=+Z1,Z=Z1 D DAT
"RTN","LRZVER2",26,0)
 Q
"RTN","LRZVER2",27,0)
DAT N LRX
"RTN","LRZVER2",28,0)
 S LRX=$$FMTE^XLFDT(X,"5M")
"RTN","LRZVER2",29,0)
 S LRDAT=$P(LRX,"/",1,2)_" "_$P(LRX,"@",2)_$S($P(Z,U,2)!(X'["."):"r",1:"d") Q
"RTN","LRZVER2",30,0)
V9 K LRMA S I=0 F  S I=$O(^TMP("LR",$J,"TMP",I)) Q:I<1  I $D(^LR(LRDFN,LRSS,LRLDT,I)) S LRMA=1 Q
"RTN","LRZVER2",31,0)
 Q
"RTN","LRZVER3")
0^9^B49940990
"RTN","LRZVER3",1,0)
LRZVER3 ;DALOI/CJS/FHS-DATA VERIFICATION ; 12/7/06 08:56
"RTN","LRZVER3",2,0)
 ;;5.2;LAB SERVICE;**42,100,121,140,171,153,221,286**;Sep 27, 1994;Build 8
"RTN","LRZVER3",3,0)
 ;
"RTN","LRZVER3",4,0)
 D V1
"RTN","LRZVER3",5,0)
 I $D(LRLOCKER)#2 L -@(LRLOCKER) K LRLOCKER
"RTN","LRZVER3",6,0)
 Q
"RTN","LRZVER3",7,0)
 ;
"RTN","LRZVER3",8,0)
 ;
"RTN","LRZVER3",9,0)
V1 I $D(LRLOCKER)#2 L -@(LRLOCKER)
"RTN","LRZVER3",10,0)
 S LRLOCKER="^LR("_LRDFN_","""_LRSS_""","_LRIDT_")"
"RTN","LRZVER3",11,0)
 L +@(LRLOCKER):1
"RTN","LRZVER3",12,0)
 I '$T W !," This entry is being edited by someone else." Q
"RTN","LRZVER3",13,0)
 I $D(LRGVP) S X="1-"_LRNTN D RANGE^LRWU2 G L10
"RTN","LRZVER3",14,0)
 S LRALL="",LRALERT=LROUTINE,LRLCT=6
"RTN","LRZVER3",15,0)
 ;
"RTN","LRZVER3",16,0)
 ; List any not performed tests.
"RTN","LRZVER3",17,0)
 S I=0
"RTN","LRZVER3",18,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<1  D
"RTN","LRZVER3",19,0)
 . S LRX=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0))
"RTN","LRZVER3",20,0)
 . I $P(LRX,"^",6)'="*Not Performed" Q
"RTN","LRZVER3",21,0)
 . W !,?3,$P(^LAB(60,I,0),"^"),?25," ",$P(LRX,"^",6)
"RTN","LRZVER3",22,0)
 . S LRLCT=LRLCT+1 D:LRLCT>22 WT^LRVER4
"RTN","LRZVER3",23,0)
 ;
"RTN","LRZVER3",24,0)
 ; No tests to edit
"RTN","LRZVER3",25,0)
 I LRNTN=0 D COM^LRVR4 G EXIT
"RTN","LRZVER3",26,0)
 ;
"RTN","LRZVER3",27,0)
 F I=1:1:LRNTN I $D(LRNAME(I)) D
"RTN","LRZVER3",28,0)
 . S LRALL=LRALL_","_I ;W !,I,"  ",LRNAME(I)
"RTN","LRZVER3",29,0)
 . I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,$O(LRNAME(I,0)),0))#2 D
"RTN","LRZVER3",30,0)
 . . S LRX=^LRO(68,LRAA,1,LRAD,1,LRAN,4,$O(LRNAME(I,0)),0)
"RTN","LRZVER3",31,0)
 . . S LRAL=$P(LRX,U,2)#50
"RTN","LRZVER3",32,0)
 . . I $P(LRX,U,5) W ?25,$S($P(LRX,U,6)'="":$P(LRX,U,6),1:" verified")
"RTN","LRZVER3",33,0)
 . . I LRAL S LRALERT=$S(LRAL<LRALERT:LRAL,1:LRALERT)
"RTN","LRZVER3",34,0)
 . S LRLCT=LRLCT+1 D:LRLCT>22 WT^LRVER4
"RTN","LRZVER3",35,0)
 ;
"RTN","LRZVER3",36,0)
 I $D(LRALERT),LRALERT<($P(LRPARAM,U,20)+1) D
"RTN","LRZVER3",37,0)
 . W !?15 W:IOST["C-" @LRVIDO
"RTN","LRZVER3",38,0)
 . W "Test ordered "_$P($G(^LAB(62.05,+LRALERT,0)),U)
"RTN","LRZVER3",39,0)
 . W:IOST["C-" @LRVIDOF W !,$C(7)
"RTN","LRZVER3",40,0)
 ;
"RTN","LRZVER3",41,0)
 S X9="" I LRNTN=1 S T1=1 G L10
"RTN","LRZVER3",42,0)
V9 S LRALL=$P(LRALL,",",2,99)
"RTN","LRZVER3",43,0)
 R !!,"TEST #(s) (or ""ALL""): ",X:DTIME S:'$T X=U S:X["A" X=LRALL
"RTN","LRZVER3",44,0)
 I X["?" W !,"Enter for example 1,2,5-9." G V9
"RTN","LRZVER3",45,0)
 Q:X[U!(X="")  D RANGE^LRWU2 G EXIT:X9="" X (X9_"S:'$D(LRNAME(T1)) X=0") G EXIT:X=0
"RTN","LRZVER3",46,0)
L10 ;
"RTN","LRZVER3",47,0)
 N LRCORECT S LRCORECT=0
"RTN","LRZVER3",48,0)
 S LRNX=0 X (X9_"D EX1^LRZVER1")
"RTN","LRZVER3",49,0)
 D V7^LRZVER2
"RTN","LRZVER3",50,0)
 S LRCMTDSP=$$CHKCDSP^LRVERA
"RTN","LRZVER3",51,0)
 K LRSA,LRSB,LRORU3
"RTN","LRZVER3",52,0)
 F LRSB=1:0 S LRSB=$O(^LR(LRDFN,LRSS,LRIDT,LRSB)) Q:LRSB<1  D
"RTN","LRZVER3",53,0)
 . S LRSB(LRSB)=^(LRSB),LRSB(LRSB,"P")=$P(LRSB(LRSB),U,3)
"RTN","LRZVER3",54,0)
 . I $D(LRNOVER) S LRNOVER(LRSB)=""
"RTN","LRZVER3",55,0)
 S LREDIT=1
"RTN","LRZVER3",56,0)
 D ^LRZVER4 ; JFR edited
"RTN","LRZVER3",57,0)
 ;
"RTN","LRZVER3",58,0)
 ; If group data review then quit before updating results
"RTN","LRZVER3",59,0)
 I $D(LRGVP) G EXIT
"RTN","LRZVER3",60,0)
 ;
"RTN","LRZVER3",61,0)
 I '$O(LRORD(0)) G EXIT
"RTN","LRZVER3",62,0)
 I '$G(LRCHG),'LRVF F LRSB=1:0 S LRSB=$O(LRSB(LRSB)) Q:LRSB<1  S:LRSB(LRSB)'="" ^LR(LRDFN,LRSS,LRIDT,LRSB)=LRSB(LRSB)
"RTN","LRZVER3",63,0)
 I $G(LRCHG) D CHG K LRCHG,LRUP I $G(LREND) S LREND=0 G EXIT
"RTN","LRZVER3",64,0)
 ;
"RTN","LRZVER3",65,0)
 I $D(LRSA),$D(LRF) K LRF S X=$P(^LR(LRDFN,LRSS,LRIDT,0),U,9) S:$L(X)&($E(X)'["-") $P(^(0),U,9)="-"_X G V11
"RTN","LRZVER3",66,0)
 G EXIT:$D(LRGVP),V11:LRVF&$D(LRSA),V1:LRVF&(LRNTN>1),EXIT:LRVF
"RTN","LRZVER3",67,0)
 ;
"RTN","LRZVER3",68,0)
NOVER I $O(LRNOVER(0)) D  G EXIT
"RTN","LRZVER3",69,0)
 . F I=0:0 S I=+$O(LRNOVER(I)) Q:I<2  W !,"Test Not Reviewed: ",$P(^DD(63.04,I,0),U) W:$D(LRSB(I))#2 " = "_$P(LRSB(I),U)_" "_$P(LRSB(I),U,2)
"RTN","LRZVER3",70,0)
 . W !,$$CJ^XLFSTR("The above test(s) have results already entered,",80)
"RTN","LRZVER3",71,0)
 . W !,$$CJ^XLFSTR("but you did not select them for review.",80)
"RTN","LRZVER3",72,0)
 . W !,$$CJ^XLFSTR(" Accession NOT approved. ",80),$C(7)
"RTN","LRZVER3",73,0)
 . W !,$$CJ^XLFSTR("You must review all results before ANY can be released.",80),!!
"RTN","LRZVER3",74,0)
 . W:$E(IOST,1,2)="C-" @LRVIDO W $$CJ^XLFSTR("Suggest you select 'ALL' tests for verification/review. ",80) W:$E(IOST,1,2)="C-" @LRVIDOF W !,$C(7)
"RTN","LRZVER3",75,0)
 I $O(LRNOVER(0)) W !,"Has not been reviewed and has data.  Not approved.",! G EXIT
"RTN","LRZVER3",76,0)
 I '$P($G(LRLABKY),U) W !,$C(7),"ENTERED BUT NOT APPROVED",! G EXIT
"RTN","LRZVER3",77,0)
 I '$O(LRSB(0)) W !?5,"Nothing verified ",$C(7),! G EXIT
"RTN","LRZVER3",78,0)
 N CNT S CNT=1
"RTN","LRZVER3",79,0)
AGAIN ;
"RTN","LRZVER3",80,0)
 I '$D(^TMP("LRVEHU",$J,"I")) R !,"Approve for release by entering your initials: ",LRINI:DTIME ;; JFR - changed
"RTN","LRZVER3",81,0)
 I $D(^TMP("LRVEHU",$J,"I")) S LRINI=^("I") ; JFR - added
"RTN","LRZVER3",82,0)
 I '$D(LRINI) S LRINI="^"
"RTN","LRZVER3",83,0)
 I $E(LRINI)="^" W !!?5,$C(7),"Nothing verified!" D READ G EXIT
"RTN","LRZVER3",84,0)
 I LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRZVER3",85,0)
 I $S($E(LRINI)="?":1,LRINI'=LRUSI&(CNT<2):1,1:0) W !,$C(7),"Please enter your correct initials" S:$E(LRINI)="?" CNT=0 S CNT=CNT+1 G AGAIN
"RTN","LRZVER3",86,0)
 W !,"  Verified!"
"RTN","LRZVER3",87,0)
 I LRINI'=LRUSI W !!?5,$C(7),"Nothing verified!" D READ G EXIT
"RTN","LRZVER3",88,0)
V11 I $D(XRTL) D T0^%ZOSV ; START RESPONSE TIME LOGGING
"RTN","LRZVER3",89,0)
 D VER^LRVER3A
"RTN","LRZVER3",90,0)
 I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D LOOK^LRCAPV1
"RTN","LRZVER3",91,0)
 N LRX
"RTN","LRZVER3",92,0)
 S LRX=0
"RTN","LRZVER3",93,0)
 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  S:'$D(^LRO(68,"AC",LRDFN,LRIDT,LRX)) ^(LRX)="" I LRVF S ^(LRX)=""
"RTN","LRZVER3",94,0)
 I $P($G(LRORU3),U,3),$O(LRSB(0)) D LRORU3
"RTN","LRZVER3",95,0)
 I $D(XRT0) S XRTN="V11^LRVER3" D T1^%ZOSV ; STOP RESPONSE TIME LOGGING
"RTN","LRZVER3",96,0)
 S LRVF=1
"RTN","LRZVER3",97,0)
 Q
"RTN","LRZVER3",98,0)
 ;
"RTN","LRZVER3",99,0)
 ;
"RTN","LRZVER3",100,0)
EXIT Q
"RTN","LRZVER3",101,0)
 ;
"RTN","LRZVER3",102,0)
 ;
"RTN","LRZVER3",103,0)
READ ;
"RTN","LRZVER3",104,0)
 N X W !!,"Press ENTER or RETURN to continue: " R X:DTIME
"RTN","LRZVER3",105,0)
 Q
"RTN","LRZVER3",106,0)
 ;
"RTN","LRZVER3",107,0)
 ;
"RTN","LRZVER3",108,0)
CHG ; Check for changes, save results and create audit trail
"RTN","LRZVER3",109,0)
 S LRUP=""
"RTN","LRZVER3",110,0)
 F  S LRCHG=$O(LRSB(LRCHG)) Q:LRCHG<1  D
"RTN","LRZVER3",111,0)
 . I '$D(LRSA(LRCHG)) S LRUP=1 Q
"RTN","LRZVER3",112,0)
 . I $P(LRSA(LRCHG),"^")=""!($P(LRSA(LRCHG),"^")="pending") S LRUP=1 Q
"RTN","LRZVER3",113,0)
 . I $P(LRSA(LRCHG),"^")'=$P(LRSB(LRCHG),"^") S LRUP=1,$P(LRSA(LRCHG,2),"^")=1 ; results changed
"RTN","LRZVER3",114,0)
 . I $P(LRSA(LRCHG),"^",2)'=$P(LRSB(LRCHG),"^",2) S LRUP=1,$P(LRSA(LRCHG,2),"^",2)=1 ; normalcy flag changed
"RTN","LRZVER3",115,0)
 . I $P(LRSA(LRCHG),"^",5)'=$P(LRSB(LRCHG),"^",5) D  ; units/normals changed
"RTN","LRZVER3",116,0)
 . . N LRX,LRY
"RTN","LRZVER3",117,0)
 . . S LRX=$$UP^XLFSTR($P(LRSA(LRCHG),"^",5)),LRX=$TR(LRX,"""")
"RTN","LRZVER3",118,0)
 . . S LRY=$$UP^XLFSTR($P(LRSB(LRCHG),"^",5)),LRY=$TR(LRY,"""")
"RTN","LRZVER3",119,0)
 . . I LRX'=LRY S LRUP=1,$P(LRSA(LRCHG,2),"^",5)=1
"RTN","LRZVER3",120,0)
 I 'LRUP S LREND=1 Q
"RTN","LRZVER3",121,0)
 S LREND=0
"RTN","LRZVER3",122,0)
 W !! W:IOST["C-" @LRVIDO W "Approve update of data by entering your initials: " W:IOST["C-" @LRVIDOF
"RTN","LRZVER3",123,0)
 R LRINI:DTIME
"RTN","LRZVER3",124,0)
 I '$T S LREND=1
"RTN","LRZVER3",125,0)
 I 'LREND,LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRZVER3",126,0)
 I LRINI'=LRUSI S LREND=1
"RTN","LRZVER3",127,0)
 I LREND W !,$C(7),"No updating occurred ",! Q
"RTN","LRZVER3",128,0)
 ;
"RTN","LRZVER3",129,0)
 F LRSB=1:0 S LRSB=$O(LRSB(LRSB)) Q:LRSB<1  D
"RTN","LRZVER3",130,0)
 . K:'$D(^LR(LRDFN,LRSS,LRIDT,LRSB)) LRSA(LRSB)
"RTN","LRZVER3",131,0)
 . S ^LR(LRDFN,LRSS,LRIDT,LRSB)=LRSB(LRSB)
"RTN","LRZVER3",132,0)
 . I $D(LRSA(LRSB,1)),$D(LRSA(LRSB,2)) D DIDLE
"RTN","LRZVER3",133,0)
 W !!
"RTN","LRZVER3",134,0)
 Q
"RTN","LRZVER3",135,0)
 ;
"RTN","LRZVER3",136,0)
 ;
"RTN","LRZVER3",137,0)
DIDLE ;
"RTN","LRZVER3",138,0)
 ; Check if no previous result or pending result - no audit trail needed
"RTN","LRZVER3",139,0)
 I $P(LRSA(LRSB),"^")=""!($P(LRSA(LRSB),"^")="pending") Q
"RTN","LRZVER3",140,0)
 ;
"RTN","LRZVER3",141,0)
 S LRF=1
"RTN","LRZVER3",142,0)
 L +^LR(LRDFN,LRSS,LRIDT):999
"RTN","LRZVER3",143,0)
NOW S LRNOW7=$$NOW^XLFDT
"RTN","LRZVER3",144,0)
 W !
"RTN","LRZVER3",145,0)
 D ^LRDIDLE0
"RTN","LRZVER3",146,0)
 I 'LROK K LRSA
"RTN","LRZVER3",147,0)
 L -^LR(LRDFN,LRSS,LRIDT)
"RTN","LRZVER3",148,0)
 S LRCORECT=1
"RTN","LRZVER3",149,0)
 Q
"RTN","LRZVER3",150,0)
 ;
"RTN","LRZVER3",151,0)
 ;
"RTN","LRZVER3",152,0)
RONLT ; (R)esolve (O)rder NLT code from file #68 original ordered test or
"RTN","LRZVER3",153,0)
 ; use default when not specified for file #60 test.
"RTN","LRZVER3",154,0)
 ;
"RTN","LRZVER3",155,0)
 N LR60,LRX,LRY,X
"RTN","LRZVER3",156,0)
 S LR60=+LRTS,LRY=$P(LRSB(LRSB),U,3)
"RTN","LRZVER3",157,0)
 ;
"RTN","LRZVER3",158,0)
 ; Try to determine order NLT from original ordered test
"RTN","LRZVER3",159,0)
 F  Q:'LR60  D
"RTN","LRZVER3",160,0)
 . S LRX=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LR60,0)),LR60=+$P(LRX,"^",9)
"RTN","LRZVER3",161,0)
 . I LR60,LR60'=$P(LRX,"^") D
"RTN","LRZVER3",162,0)
 . . S X=$$NLT^LRVER1(LR60)
"RTN","LRZVER3",163,0)
 . . I X'="" S $P(LRY,"!")=X
"RTN","LRZVER3",164,0)
 . I LR60=$P(LRX,"^") S LR60=0
"RTN","LRZVER3",165,0)
 ;
"RTN","LRZVER3",166,0)
 ; Otherwise use default for lab package
"RTN","LRZVER3",167,0)
 I $P(LRY,"!")="" S $P(LRY,"!")=$P($$DEFCODE^LA7VHLU5(LRSS,LRSB,LRY,+LRSPEC),"!")
"RTN","LRZVER3",168,0)
 ;
"RTN","LRZVER3",169,0)
 S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRZVER3",170,0)
 ;
"RTN","LRZVER3",171,0)
 Q
"RTN","LRZVER3",172,0)
 ;
"RTN","LRZVER3",173,0)
 ;
"RTN","LRZVER3",174,0)
LRORU3 ;
"RTN","LRZVER3",175,0)
SET ;
"RTN","LRZVER3",176,0)
 N LR64,LR7V,LRDN,LROTA,LRT,LRTPN,LRTPNN,LRTYPE,X
"RTN","LRZVER3",177,0)
 ;
"RTN","LRZVER3",178,0)
 ; Go through LRSB array and sort results by order NLT code
"RTN","LRZVER3",179,0)
 ; and put into ordered test array (LROTA).
"RTN","LRZVER3",180,0)
 S LRDN=0
"RTN","LRZVER3",181,0)
 F  S LRDN=$O(LRSB(LRDN)) Q:'LRDN  D
"RTN","LRZVER3",182,0)
 . I $P(LRSB(LRDN),"^")="" Q
"RTN","LRZVER3",183,0)
 . S LRTPNN=$P($P(LRSB(LRDN),U,3),"!"),LRT=+$G(^TMP("LR",$J,"TMP",LRDN))
"RTN","LRZVER3",184,0)
 . I LRTPNN="" Q
"RTN","LRZVER3",185,0)
 . S LRTYPE=$P($G(^LAB(60,LRT,0)),U,3)
"RTN","LRZVER3",186,0)
 . I LRTYPE=""!("OB"'[LRTYPE) Q
"RTN","LRZVER3",187,0)
 . S LROTA(LRTPNN,LRDN)=LRT
"RTN","LRZVER3",188,0)
 . I $D(LRSA(LRDN,2)) S LROTA(LRTPNN,LRDN,1)="C"
"RTN","LRZVER3",189,0)
 ;
"RTN","LRZVER3",190,0)
 ; For each order NLT code setup call to put results into #62.49 queue
"RTN","LRZVER3",191,0)
 S LRTPNN=""
"RTN","LRZVER3",192,0)
 F  S LRTPNN=$O(LROTA(LRTPNN)) Q:LRTPNN=""  D
"RTN","LRZVER3",193,0)
 . S LR64=+$O(^LAM("C",LRTPNN_" ",0)),LRTPN=$$GET1^DIQ(64,LR64_",",.01)
"RTN","LRZVER3",194,0)
 . K LR7V
"RTN","LRZVER3",195,0)
 . M LR7V=LROTA(LRTPNN)
"RTN","LRZVER3",196,0)
 . D SET^LA7VMSG($P(LRORU3,U,4),$P(LRORU3,U,2),$P(LRORU3,U,5),$P(LRORU3,U,3),LRTPN,LRTPNN,LRIDT,LRSS,LRDFN,LRODT,.LR7V)
"RTN","LRZVER3",197,0)
 Q
"RTN","LRZVER4")
0^10^B83521480
"RTN","LRZVER4",1,0)
LRZVER4 ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;12/7/06 09:05
"RTN","LRZVER4",2,0)
 ;;5.2;LAB SERVICE;**14,42,112,121,140,171,153,188,279,283,286**;Sep 27, 1994;Build 8
"RTN","LRZVER4",3,0)
 ;
"RTN","LRZVER4",4,0)
 N LRAMEND,LRRFLAG
"RTN","LRZVER4",5,0)
 ;
"RTN","LRZVER4",6,0)
LOOP ;
"RTN","LRZVER4",7,0)
 S LRLCT=0
"RTN","LRZVER4",8,0)
 I '$D(LRGVP) D
"RTN","LRZVER4",9,0)
 . S:$D(LRWRDS) LRWRD=LRWRDS
"RTN","LRZVER4",10,0)
 . ;W !!,PNM,"  SSN: ",SSN,"   " S LRLCT=LRLCT+1
"RTN","LRZVER4",11,0)
 . ;I LRDPF=2 W "   LOC: ",$S(LRWRD'="":LRWRD,1:$S($L($P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,7)):$P(^(0),U,7),1:"??"))
"RTN","LRZVER4",12,0)
 ;
"RTN","LRZVER4",13,0)
 ;W !,"Pat Info: ",$P($G(^LR(LRDFN,.091)),U)
"RTN","LRZVER4",14,0)
 ;W ?34," Sex: ",$S(SEX="M":"MALE",SEX="F":"FEMALE",1:SEX)
"RTN","LRZVER4",15,0)
 ;W ?48," Age: ",$$CALCAGE^LRRPU(DOB,LRCDT)," as of ",$$FMTE^XLFDT(LRCDT,"1D")
"RTN","LRZVER4",16,0)
 S LRPRAC=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,8)
"RTN","LRZVER4",17,0)
 I LRPRAC>0,LRPRAC=+LRPRAC D GETS^DIQ(200,LRPRAC_",",".01;.132;.137;.138","E","LRPRAC(LRPRAC)","LRERR")
"RTN","LRZVER4",18,0)
 ;W !,"Provider: "
"RTN","LRZVER4",19,0)
 S LRLCT=LRLCT+2
"RTN","LRZVER4",20,0)
 ;I LRPRAC'="",'$D(LRPRAC(LRPRAC,200)) W LRPRAC
"RTN","LRZVER4",21,0)
 I LRPRAC,$D(LRPRAC(LRPRAC,200)) ; D     ; JFR changed
"RTN","LRZVER4",22,0)
 . W LRPRAC(LRPRAC,200,LRPRAC_",",.01,"E"),?40," Voice pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.137,"E")
"RTN","LRZVER4",23,0)
 . W !,"   Phone: ",LRPRAC(LRPRAC,200,LRPRAC_",",.132,"E"),?38," Digital pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.138,"E")
"RTN","LRZVER4",24,0)
 . S LRLCT=LRLCT+1
"RTN","LRZVER4",25,0)
 ;
"RTN","LRZVER4",26,0)
 N PRAC,PR
"RTN","LRZVER4",27,0)
 D PRAC^LR7OMERG(LRAA,LRAD,LRAN,.PRAC)
"RTN","LRZVER4",28,0)
 I $O(PRAC(0)) D
"RTN","LRZVER4",29,0)
 . S PR=0
"RTN","LRZVER4",30,0)
 . F  S PR=$O(PRAC(PR)) Q:PR<1  I $D(^VA(200,PR,0)) W !?14,$P(^(0),"^") S LRLCT=LRLCT+1
"RTN","LRZVER4",31,0)
 W ! S LRLCT=LRLCT+1
"RTN","LRZVER4",32,0)
 S LRNX=0,LRVRM=2,T=""
"RTN","LRZVER4",33,0)
 I $P(^LR(LRDFN,LRSS,LRIDT,0),U,7)'="" D
"RTN","LRZVER4",34,0)
 . W !,"VOLUME: ",$P(^(0),U,7)
"RTN","LRZVER4",35,0)
 . S LRLCT=LRLCT+1
"RTN","LRZVER4",36,0)
 S LRACC=$P(Z1,U,6)
"RTN","LRZVER4",37,0)
 I '$G(LRZONE) D
"RTN","LRZVER4",38,0)
 . W !,"ACCESSION:",?30,$P(Z2,U,6),?44," ",LRACC
"RTN","LRZVER4",39,0)
 . W !,?30,LRDAT(2) W ?44," ",LRDAT
"RTN","LRZVER4",40,0)
 . S LRZONE=+$G(LRZONE)+2
"RTN","LRZVER4",41,0)
 S LRLCT=LRLCT+2
"RTN","LRZVER4",42,0)
 I $D(LRALERT),LRALERT<($P(LRPARAM,U,20)+1) D
"RTN","LRZVER4",43,0)
 . W !?15 W:$E(IOST,1,2)="C-" @LRVIDO
"RTN","LRZVER4",44,0)
 . W "Test ordered "_$P($G(^LAB(62.05,+LRALERT,0)),U)
"RTN","LRZVER4",45,0)
 . W:$E(IOST,1,2)="C-" @LRVIDOF,$C(7)
"RTN","LRZVER4",46,0)
 . S LRLCT=LRLCT+1
"RTN","LRZVER4",47,0)
 ;
"RTN","LRZVER4",48,0)
 I '$O(LRORD(0)) W !!?7,$C(7),"This is not a verifiable test/accession ",! Q
"RTN","LRZVER4",49,0)
V I $D(LRGVP) D V20 Q
"RTN","LRZVER4",50,0)
 G EDIT:($O(^LR(LRDFN,LRSS,LRIDT,1))=""!('LRVF&$D(LRPER)))&'$D(LRNUF)
"RTN","LRZVER4",51,0)
 K LRNUF
"RTN","LRZVER4",52,0)
 D V20,ND G V37:LRVF&'$D(X)#2,EDIT:LREDIT
"RTN","LRZVER4",53,0)
 S LRTEC=$S($D(^LRO(68,LRAA,1,LRAD,2)):$P(^(2),U),1:$S($D(LRUSI):LRUSI,1:"")),LREDIT=0
"RTN","LRZVER4",54,0)
V36 ;
"RTN","LRZVER4",55,0)
 Q:$D(LRGVP)
"RTN","LRZVER4",56,0)
 Q  ;;JFR   added to remove edit ability
"RTN","LRZVER4",57,0)
 K DIR
"RTN","LRZVER4",58,0)
 S DIR(0)="SAO^E:Edit;C:Comments;W:Workload"
"RTN","LRZVER4",59,0)
 S DIR("A")="SELECT ('E' to Edit, 'C' for Comments, 'W' Workload): "
"RTN","LRZVER4",60,0)
 D ^DIR
"RTN","LRZVER4",61,0)
 I $D(DIRUT) S X="^" G V37
"RTN","LRZVER4",62,0)
 S X=Y
"RTN","LRZVER4",63,0)
 S:$E(X)="E" LREDIT=1,X=""
"RTN","LRZVER4",64,0)
 K LRNC
"RTN","LRZVER4",65,0)
 I $E(X)="C" S LRNC=1 D COM K LRNC G V36
"RTN","LRZVER4",66,0)
 I $E(X)="W" D  G LOOP
"RTN","LRZVER4",67,0)
 . I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D STD^LRCAPV,EN^LRCAPV S LREND=0 Q
"RTN","LRZVER4",68,0)
 . W !?10," Workload is not activated."
"RTN","LRZVER4",69,0)
 S X=$S(X="@":"",X="":LRTEC,1:X),LRTEC=X
"RTN","LRZVER4",70,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,2)) ^(2)="" S ^(2)=X_U_$P(^(2),U,2,99)
"RTN","LRZVER4",71,0)
 G EDIT:LREDIT
"RTN","LRZVER4",72,0)
V37 Q  ;LEAVE LRVER4, BACK TO LRVER3
"RTN","LRZVER4",73,0)
 ;
"RTN","LRZVER4",74,0)
 ;
"RTN","LRZVER4",75,0)
V20 ;
"RTN","LRZVER4",76,0)
 I $G(LRCHG) D V21,DCOM^LRVERA Q
"RTN","LRZVER4",77,0)
 S LRNX=$O(LRORD(LRNX)) G V35:LRNX<1 D SUBS
"RTN","LRZVER4",78,0)
 G:'$G(LRTS) V20
"RTN","LRZVER4",79,0)
 I '$D(LRSB(LRSB)),'$D(^LR(LRDFN,LRSS,LRIDT,LRSB)) G V20
"RTN","LRZVER4",80,0)
 D V25^LRVER5
"RTN","LRZVER4",81,0)
 ;
"RTN","LRZVER4",82,0)
 D:$D(LRGVP) PG Q:$D(LRGVP)&($D(DTOUT)!$D(DUOUT))
"RTN","LRZVER4",83,0)
 ;
"RTN","LRZVER4",84,0)
 W !,$P(^LAB(60,+LRTS,0),U)
"RTN","LRZVER4",85,0)
 S X1=""
"RTN","LRZVER4",86,0)
 I $D(^LR(LRDFN,LRSS,+LRLDT,LRSB)) D
"RTN","LRZVER4",87,0)
 . S X1=$P(^(LRSB),U),X=X1
"RTN","LRZVER4",88,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRZVER4",89,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",X1)
"RTN","LRZVER4",90,0)
 . . I X="" S X=X1
"RTN","LRZVER4",91,0)
 . W:X'="" ?30,@LRFP
"RTN","LRZVER4",92,0)
 S (X,LRFLG)=""
"RTN","LRZVER4",93,0)
 I $D(LRSB(LRSB)) D
"RTN","LRZVER4",94,0)
 . N LRX
"RTN","LRZVER4",95,0)
 . K LRNOVER(LRSB)
"RTN","LRZVER4",96,0)
 . S (LRDL,LRX,X)=$P(LRSB(LRSB),U)
"RTN","LRZVER4",97,0)
 . S LREDIT=0,LRFLG=$P(LRSB(LRSB),U,2)
"RTN","LRZVER4",98,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRZVER4",99,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",LRX)
"RTN","LRZVER4",100,0)
 . . I X="" S X=LRX
"RTN","LRZVER4",101,0)
 . W ?44," ",@LRFP," ",LRFLG,?56," ",$P($P(LRSB(LRSB),U,5),"!",7) ;$P(LRNG,U,7)
"RTN","LRZVER4",102,0)
 . S X=LRX
"RTN","LRZVER4",103,0)
 . I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRZVER4",104,0)
 . S Y=0
"RTN","LRZVER4",105,0)
 . I LRDEL'="" S LRQ=1 X LRDEL K LRQ
"RTN","LRZVER4",106,0)
 . W "  "
"RTN","LRZVER4",107,0)
 . I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG
"RTN","LRZVER4",108,0)
 ;
"RTN","LRZVER4",109,0)
 S:$P(X,U)="" $P(LRSB(LRSB),U)=""
"RTN","LRZVER4",110,0)
 I $P(X,U)'="" D
"RTN","LRZVER4",111,0)
 . N I,LRX,LRY
"RTN","LRZVER4",112,0)
 . S $P(LRSB(LRSB),U)=X,$P(LRSB(LRSB),U,2)=LRFLG
"RTN","LRZVER4",113,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRZVER4",114,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRZVER4",115,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRZVER4",116,0)
 . I $P($P(LRSB(LRSB),U,3),"!")="" D RONLT^LRVER3
"RTN","LRZVER4",117,0)
 . D
"RTN","LRZVER4",118,0)
 . . I $P(LRSB(LRSB),U,4)!($P(LRSB(LRSB),U)="pending") Q
"RTN","LRZVER4",119,0)
 . . I '$D(LRSA(LRSB))#2 S $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ)),$P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"") Q
"RTN","LRZVER4",120,0)
 . . I $P(LRSB(LRSB),U)=$P(LRSA(LRSB),U) S:$P(LRSA(LRSB),U,4) $P(LRSB(LRSB),U,4)=$P(LRSA(LRSB),U,4) S $P(LRSA(LRSB),U,3)=$P(LRSB(LRSB),U,3) Q
"RTN","LRZVER4",121,0)
 . . S:'$P(LRSB(LRSB),U,4) $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ)),$P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"")
"RTN","LRZVER4",122,0)
 . S $P(LRSB(LRSB),U,5)=$TR(LRNGS,U,"!")
"RTN","LRZVER4",123,0)
 I '$D(LRNUF) S LRLCT=LRLCT+1 S:$X>80 LRLCT=LRLCT+1 D:LRLCT>22 WT G:$G(Y)'="^" V20
"RTN","LRZVER4",124,0)
 ;
"RTN","LRZVER4",125,0)
V35 ;
"RTN","LRZVER4",126,0)
 D LRCFL:LRCFL]""
"RTN","LRZVER4",127,0)
 D DCOM^LRVERA K LRNUF
"RTN","LRZVER4",128,0)
 Q
"RTN","LRZVER4",129,0)
 ;
"RTN","LRZVER4",130,0)
 ;
"RTN","LRZVER4",131,0)
LRCFL ;
"RTN","LRZVER4",132,0)
 S LREXEC=LRCFL D ^LREXEC:LRCFL[""
"RTN","LRZVER4",133,0)
 D:LRLCT>22 WT
"RTN","LRZVER4",134,0)
 Q
"RTN","LRZVER4",135,0)
 ;
"RTN","LRZVER4",136,0)
 ;
"RTN","LRZVER4",137,0)
EDIT ;
"RTN","LRZVER4",138,0)
 K LROUT
"RTN","LRZVER4",139,0)
 D ^LRZVER5 S LRVRM=2 G:$G(LRCHG) LOOP G LRCFL:$D(LROUT)!$D(LRPER)
"RTN","LRZVER4",140,0)
 G LOOP
"RTN","LRZVER4",141,0)
 ;
"RTN","LRZVER4",142,0)
 ;
"RTN","LRZVER4",143,0)
RANGE ;
"RTN","LRZVER4",144,0)
 N LRI,LRFIND
"RTN","LRZVER4",145,0)
 S Y=X
"RTN","LRZVER4",146,0)
 I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRZVER4",147,0)
 W "  "
"RTN","LRZVER4",148,0)
 F LRI=1:1:$L(X) S LRFIND=$E(X,LRI) Q:LRFIND?1(1N,1A,1".",1"-",1"<",1">")
"RTN","LRZVER4",149,0)
 S X=$E(X,LRI,999)
"RTN","LRZVER4",150,0)
 ;
"RTN","LRZVER4",151,0)
 ; User has indicated specific normality to set - used when entering
"RTN","LRZVER4",152,0)
 ; reference lab results and all the info to calculate is not available.
"RTN","LRZVER4",153,0)
 I $G(LRRFLAG(LRSB)) S LRFLG=$P("L^L*^H^H*","^",LRRFLAG(LRSB))
"RTN","LRZVER4",154,0)
 ;
"RTN","LRZVER4",155,0)
 E  D RANGECHK
"RTN","LRZVER4",156,0)
 I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG
"RTN","LRZVER4",157,0)
RQ S X=Y
"RTN","LRZVER4",158,0)
 Q
"RTN","LRZVER4",159,0)
 ;
"RTN","LRZVER4",160,0)
 ;
"RTN","LRZVER4",161,0)
RANGECHK ; Check result against reference ranges and set flag
"RTN","LRZVER4",162,0)
 ;
"RTN","LRZVER4",163,0)
 ;
"RTN","LRZVER4",164,0)
 ; Check for numeric abnormal results
"RTN","LRZVER4",165,0)
 I X?.1"-".N.1".".N D  Q
"RTN","LRZVER4",166,0)
 . I LRNG4'="",LRNG4?.1"-".N.1".".N,X<LRNG4 S LRFLG="L*" Q
"RTN","LRZVER4",167,0)
 . I LRNG5'="",LRNG5?.1"-".N.1".".N,X>LRNG5 S LRFLG="H*" Q
"RTN","LRZVER4",168,0)
 . I LRNG2'="",LRNG2?.1"-".N.1".".N,X<LRNG2 S LRFLG="L" Q
"RTN","LRZVER4",169,0)
 . I LRNG3'="",LRNG3?.1"-".N.1".".N,X>LRNG3 S LRFLG="H" Q
"RTN","LRZVER4",170,0)
 ;
"RTN","LRZVER4",171,0)
 ; Check for <> abnormal results
"RTN","LRZVER4",172,0)
 ; "<" results checked against low values
"RTN","LRZVER4",173,0)
 ; ">" results checked against high values
"RTN","LRZVER4",174,0)
 I X?1(1"<",1">").N.1".".N D  Q
"RTN","LRZVER4",175,0)
 . N LRX
"RTN","LRZVER4",176,0)
 . S LRX=$E(X,2,$L(X))
"RTN","LRZVER4",177,0)
 . I $E(X)="<" D  Q
"RTN","LRZVER4",178,0)
 . . I LRNG4'="",LRNG4?.N.1".".N,LRX<LRNG4 S LRFLG="L*" Q
"RTN","LRZVER4",179,0)
 . . I LRNG4'="",LRNG4?.N.1".".N,LRX=LRNG4 S LRFLG="L*" Q
"RTN","LRZVER4",180,0)
 . . I LRNG2'="",LRNG2?.N.1".".N,LRX<LRNG2 S LRFLG="L" Q
"RTN","LRZVER4",181,0)
 . . I LRNG2'="",LRNG2?.N.1".".N,LRX=LRNG2 S LRFLG="L" Q
"RTN","LRZVER4",182,0)
 . I $E(X)=">" D  Q
"RTN","LRZVER4",183,0)
 . . I LRNG5'="",LRNG5?.N.1".".N,LRX>LRNG5 S LRFLG="H*" Q
"RTN","LRZVER4",184,0)
 . . I LRNG5'="",LRNG5?.N.1".".N,LRX=LRNG5 S LRFLG="H*" Q
"RTN","LRZVER4",185,0)
 . . I LRNG3'="",LRNG3?.N.1".".N,LRX>LRNG3 S LRFLG="H" Q
"RTN","LRZVER4",186,0)
 . . I LRNG3'="",LRNG3?.N.1".".N,LRX=LRNG3 S LRFLG="H" Q
"RTN","LRZVER4",187,0)
 ;
"RTN","LRZVER4",188,0)
 ; Check for ranges, i.e. 0-5, 6-10.
"RTN","LRZVER4",189,0)
 ; Compare first value to abnormal value
"RTN","LRZVER4",190,0)
 I X?1.N1"-"1.N D  Q
"RTN","LRZVER4",191,0)
 . I LRNG4'="",LRNG4?.N.1".".N,+X<LRNG4 S LRFLG="L*" Q
"RTN","LRZVER4",192,0)
 . I LRNG5'="",LRNG5?.N.1".".N,+X>LRNG5 S LRFLG="H*" Q
"RTN","LRZVER4",193,0)
 . I LRNG2'="",LRNG2?.N.1".".N,+X<LRNG2 S LRFLG="L" Q
"RTN","LRZVER4",194,0)
 . I LRNG3'="",LRNG3?.N.1".".N,+X>LRNG3 S LRFLG="H" Q
"RTN","LRZVER4",195,0)
 ;
"RTN","LRZVER4",196,0)
 Q
"RTN","LRZVER4",197,0)
 ;
"RTN","LRZVER4",198,0)
 ;
"RTN","LRZVER4",199,0)
DISPFLG ; Display critical flags
"RTN","LRZVER4",200,0)
 ;
"RTN","LRZVER4",201,0)
 Q  ; JFR    no need for flashing on a VEHU stuff
"RTN","LRZVER4",202,0)
 I $E(IOST,1,2)="C-" W $C(7),@LRVIDO
"RTN","LRZVER4",203,0)
 W "CRITICAL ",$S($E(LRFLG,1)="L":"LOW",$E(LRFLG,1)="H":"HIGH",1:""),"!!"
"RTN","LRZVER4",204,0)
 I $E(IOST,1,2)="C-" W @LRVIDOF,$C(7),$C(7)
"RTN","LRZVER4",205,0)
 Q
"RTN","LRZVER4",206,0)
 ;
"RTN","LRZVER4",207,0)
 ;
"RTN","LRZVER4",208,0)
SUBS ;
"RTN","LRZVER4",209,0)
 S LRSB=LRORD(LRNX),LRTS=$S($D(^TMP("LR",$J,"TMP",LRSB)):^(LRSB),1:0)
"RTN","LRZVER4",210,0)
 Q
"RTN","LRZVER4",211,0)
 ;
"RTN","LRZVER4",212,0)
 ;
"RTN","LRZVER4",213,0)
ND ;
"RTN","LRZVER4",214,0)
 K X,DIR
"RTN","LRZVER4",215,0)
 Q:'LRVF
"RTN","LRZVER4",216,0)
 I '$P($G(LRLABKY),U) D  Q
"RTN","LRZVER4",217,0)
 . W !,"You're not authorized to edit verified data."
"RTN","LRZVER4",218,0)
 . S LREDIT=0
"RTN","LRZVER4",219,0)
 S DIR(0)="FO"
"RTN","LRZVER4",220,0)
 S DIR("A")="If you need to change something, enter your initials"
"RTN","LRZVER4",221,0)
 S DIR("?")="To change verified results, enter your initials."
"RTN","LRZVER4",222,0)
 D ^DIR
"RTN","LRZVER4",223,0)
 S X=Y K DIR
"RTN","LRZVER4",224,0)
 I $$UP^XLFSTR(X)'=$$UP^XLFSTR(LRUSI) S LREDIT=0 K X QUIT
"RTN","LRZVER4",225,0)
 I $D(X)#2,'$G(LRCHG) W ! D  S LRCHG=1
"RTN","LRZVER4",226,0)
 . K LRSA S LRSA=1
"RTN","LRZVER4",227,0)
 . F  S LRSA=$O(^LR(LRDFN,"CH",LRIDT,LRSA)) Q:'LRSA  S LRSA(LRSA)=^(LRSA)
"RTN","LRZVER4",228,0)
 Q
"RTN","LRZVER4",229,0)
 ;
"RTN","LRZVER4",230,0)
 ;
"RTN","LRZVER4",231,0)
WT S LRLCT=0 Q:$D(LRGVP)
"RTN","LRZVER4",232,0)
 W !,"PRESS ANY KEY TO CONTINUE, '^' TO STOP " R Y:DTIME S:'$T Y="^"
"RTN","LRZVER4",233,0)
 Q
"RTN","LRZVER4",234,0)
 ;
"RTN","LRZVER4",235,0)
 ;
"RTN","LRZVER4",236,0)
COM ;from LRVER5
"RTN","LRZVER4",237,0)
 Q:$D(LRGVP)
"RTN","LRZVER4",238,0)
 K DR
"RTN","LRZVER4",239,0)
 S DIE="^LR("_LRDFN_",""CH"",",DA=LRIDT,DA(1)=LRDFN,DR=.99
"RTN","LRZVER4",240,0)
 D ^DIE,COM1:$D(LRNC)
"RTN","LRZVER4",241,0)
 L +^LR(LRDFN,LRSS,LRIDT):5
"RTN","LRZVER4",242,0)
 I $O(^LR(LRDFN,"CH",LRIDT,1,0))="" K ^LR(LRDFN,"CH",LRIDT,1)
"RTN","LRZVER4",243,0)
 L -^LR(LRDFN,LRSS,LRIDT)
"RTN","LRZVER4",244,0)
 Q
"RTN","LRZVER4",245,0)
 ;
"RTN","LRZVER4",246,0)
 ;
"RTN","LRZVER4",247,0)
VOL ;
"RTN","LRZVER4",248,0)
 W !,"VOLUME: ",$P(^LR(LRDFN,LRSS,LRIDT,0),U,7),"//" R X:DTIME
"RTN","LRZVER4",249,0)
 G VOL:X["?" S:X'=""&(X'[U) ^(0)=$P(^(0),U,1,6)_U_X_U_$P(^(0),U,8,10)
"RTN","LRZVER4",250,0)
 G COM
"RTN","LRZVER4",251,0)
 ;
"RTN","LRZVER4",252,0)
 ;
"RTN","LRZVER4",253,0)
COM1 ;
"RTN","LRZVER4",254,0)
 N LRX Q:'$P(^LR(LRDFN,LRSS,LRIDT,0),U,3)
"RTN","LRZVER4",255,0)
 D XREF^LRVER3A
"RTN","LRZVER4",256,0)
 S LRX=0 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  S ^LRO(68,"AC",LRDFN,LRIDT,LRX)=""
"RTN","LRZVER4",257,0)
 I $L($P(^LR(LRDFN,LRSS,LRIDT,0),U,9)),$E($P(^(0),U,9))'="-" S $P(^(0),U,9)="-"_$P(^(0),U,9)
"RTN","LRZVER4",258,0)
 Q
"RTN","LRZVER4",259,0)
 ;
"RTN","LRZVER4",260,0)
 ;
"RTN","LRZVER4",261,0)
PG Q:$Y<(IOSL+5)
"RTN","LRZVER4",262,0)
 I $E(IOST,1,2)'="C-" W @IOF Q
"RTN","LRZVER4",263,0)
 D PG^LRGVP
"RTN","LRZVER4",264,0)
 Q
"RTN","LRZVER4",265,0)
 ;
"RTN","LRZVER4",266,0)
V21 ;
"RTN","LRZVER4",267,0)
 N Y,LREND
"RTN","LRZVER4",268,0)
 S LRSB=1,LRLCT=1
"RTN","LRZVER4",269,0)
 F  S LRSB=+$O(LRSB(LRSB)) Q:'LRSB!($G(LREND))  D
"RTN","LRZVER4",270,0)
 . N LRX
"RTN","LRZVER4",271,0)
 . S LRTS=$O(^LAB(60,"C","CH;"_LRSB_";1",0)) Q:'LRTS
"RTN","LRZVER4",272,0)
 . D V25^LRVER5
"RTN","LRZVER4",273,0)
 . W !,$P(^LAB(60,LRTS,0),U) S X1=""
"RTN","LRZVER4",274,0)
 . I $D(^LR(LRDFN,LRSS,+LRLDT,LRSB)) D
"RTN","LRZVER4",275,0)
 . . S X1=$P(^(LRSB),U),(LRDL,X)=X1
"RTN","LRZVER4",276,0)
 . . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRZVER4",277,0)
 . . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",X1)
"RTN","LRZVER4",278,0)
 . . . I X="" S X=X1
"RTN","LRZVER4",279,0)
 . . W:X'="" ?30,@LRFP
"RTN","LRZVER4",280,0)
 . S (LRDL,LRX,X)=$P(LRSB(LRSB),U)
"RTN","LRZVER4",281,0)
 . S LREDIT=0,LRFLG=$P(LRSB(LRSB),U,2)
"RTN","LRZVER4",282,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRZVER4",283,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",LRX)
"RTN","LRZVER4",284,0)
 . . I X="" S X=LRX
"RTN","LRZVER4",285,0)
 . W ?44," ",@LRFP," ",LRFLG,?56," ",$P(LRNG,U,7)
"RTN","LRZVER4",286,0)
 . S X=LRX
"RTN","LRZVER4",287,0)
 . I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRZVER4",288,0)
 . S Y=0
"RTN","LRZVER4",289,0)
 . I LRDEL'="" S LRQ=1 X LRDEL K LRQ
"RTN","LRZVER4",290,0)
 . W "  "
"RTN","LRZVER4",291,0)
 . I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG
"RTN","LRZVER4",292,0)
 . I '$D(LRNUF) S LRLCT=LRLCT+1 S:$X>80 LRLCT=LRLCT+1 D:LRLCT>15 WT S:$E($G(Y))="^" LREND=1
"RTN","LRZVER4",293,0)
 Q
"RTN","LRZVER5")
0^11^B83422732
"RTN","LRZVER5",1,0)
LRZVER5 ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;12/7/06 09:14
"RTN","LRZVER5",2,0)
 ;;5.2;LAB SERVICE;**42,153,283,286**;Sep 27, 1994;Build 8
"RTN","LRZVER5",3,0)
 ;
"RTN","LRZVER5",4,0)
 I $G(LRNDISP) D
"RTN","LRZVER5",5,0)
 . S LRNX=0
"RTN","LRZVER5",6,0)
 . N LRX F  S LRNX=$O(LRORD(LRNX)) Q:LRNX<1  S LRX(LRORD(LRNX))=""
"RTN","LRZVER5",7,0)
 . S LRX=0 F  S LRX=$O(LRSB(LRX)) Q:LRX<1  K:'$D(LRX(LRX)) LRSB(LRX),LRSA(LRX)
"RTN","LRZVER5",8,0)
 ;
"RTN","LRZVER5",9,0)
 ; Check for amended results that have arrived via an HL7 interface.
"RTN","LRZVER5",10,0)
 ; Only allow amended results to be verified during this session.
"RTN","LRZVER5",11,0)
 I $D(^LAH("LA7 AMENDED RESULTS",LRUID)) D
"RTN","LRZVER5",12,0)
 . S LRNX=0
"RTN","LRZVER5",13,0)
 . F  S LRNX=$O(LRORD(LRNX)) Q:'LRNX  I '$D(^LAH("LA7 AMENDED RESULTS",LRUID,LRORD(LRNX))) K LRORD(LRNX)
"RTN","LRZVER5",14,0)
 . S LRNX=0
"RTN","LRZVER5",15,0)
 . F  S LRNX=$O(LRSB(LRNX)) Q:'LRNX  I '$D(^LAH("LA7 AMENDED RESULTS",LRUID,LRNX)) K LRSB(LRNX),LRSA(LRNX)
"RTN","LRZVER5",16,0)
 ;
"RTN","LRZVER5",17,0)
 S LRNX=0,LRVRM=12
"RTN","LRZVER5",18,0)
 ;
"RTN","LRZVER5",19,0)
V40 S LRNX=$O(LRORD(LRNX)) G V44:LRNX<1 D LRSUBS
"RTN","LRZVER5",20,0)
 ;
"RTN","LRZVER5",21,0)
 ; Check if changing performing lab.
"RTN","LRZVER5",22,0)
 I $P($G(LRSB(LRSB)),"^",9),'$$PLOK^LRVERA($P(LRSB(LRSB),"^",9),$G(LRDUZ(2)),DUZ(2),LRTS) G V40
"RTN","LRZVER5",23,0)
 ;
"RTN","LRZVER5",24,0)
 D V25
"RTN","LRZVER5",25,0)
 ;
"RTN","LRZVER5",26,0)
V42 ;
"RTN","LRZVER5",27,0)
 ;
"RTN","LRZVER5",28,0)
 S (LRDL,SX,X)=$P($G(LRSB(LRSB)),U),LRDVF=0,LREDIT=0
"RTN","LRZVER5",29,0)
 S:X=""&(LRDV'="") X=LRDV,LRDVF=1 ; default value
"RTN","LRZVER5",30,0)
 S LRTEST=$P(^LAB(60,LRTS,0),U)
"RTN","LRZVER5",31,0)
 K LRNOVER(LRSB)
"RTN","LRZVER5",32,0)
 ;
"RTN","LRZVER5",33,0)
Q42 ;
"RTN","LRZVER5",34,0)
 ;
"RTN","LRZVER5",35,0)
 ; Check for amended results that have arrived via an HL7 interface.
"RTN","LRZVER5",36,0)
 I $D(^LAH("LA7 AMENDED RESULTS",LRUID,LRSB)) D  G:SX'=X!($G(LRAMEND(LRSB))) V45
"RTN","LRZVER5",37,0)
 . W !,LRTEST," " W:X'="" @LRFP
"RTN","LRZVER5",38,0)
 . D AMEND Q:$G(LRAMEND(LRSB))
"RTN","LRZVER5",39,0)
 . I SX=X W !,LRTEST," " W:X'="" @LRFP
"RTN","LRZVER5",40,0)
 ;
"RTN","LRZVER5",41,0)
 ; If entering results from a reference lab and not using normal/units
"RTN","LRZVER5",42,0)
 ; from file #60 then ask user for these values otherwise display
"RTN","LRZVER5",43,0)
 ; current file #60 values.
"RTN","LRZVER5",44,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2) D
"RTN","LRZVER5",45,0)
 . I $G(^LAB(60,+LRTS,1,+$G(LRSPEC),.1)) D  Q
"RTN","LRZVER5",46,0)
 . . D V25
"RTN","LRZVER5",47,0)
 . . W !!,"Current Ref Range: ",LRNG2,"-",LRNG3," Units: ",$P(LRNG,"^",7)
"RTN","LRZVER5",48,0)
 . . I LRNG4="",LRNG5="" Q
"RTN","LRZVER5",49,0)
 . . W !,"     Critical Low: ",LRNG4," Critical High: ",LRNG5
"RTN","LRZVER5",50,0)
 . N LRX,LRY
"RTN","LRZVER5",51,0)
 . D ASKPLNR,NORM
"RTN","LRZVER5",52,0)
 . S LRX=$P(LRNGS,"^",2,5),LRX=$TR(LRX,"^","!")
"RTN","LRZVER5",53,0)
 . S LRY=$P($G(LRSB(LRSB)),"^",5),$P(LRY,"!",2,5)=LRX
"RTN","LRZVER5",54,0)
 . S $P(LRSB(LRSB),"^",5)=LRY
"RTN","LRZVER5",55,0)
 ;
"RTN","LRZVER5",56,0)
 I '$G(LRZONE) W !,LRTEST," " W:X'="" @LRFP
"RTN","LRZVER5",57,0)
 I $D(^TMP("LRVEHU",$J,"R")) S X=^("R") ;; JFR - added
"RTN","LRZVER5",58,0)
 ;I '$D(^TMP("LRVEHU",$J,"R")) R "//",X:DTIME ;; JFR - added
"RTN","LRZVER5",59,0)
 I '$D(X) S X="^" ; JFR added to control runaway
"RTN","LRZVER5",60,0)
 I X'?.ANP W $C(7)," No Control Characters allowed." G V42
"RTN","LRZVER5",61,0)
 S:$L($G(SX))&(X="") X=SX,LRDVF=1
"RTN","LRZVER5",62,0)
 S LRDL=X I X=""&LRDVF S (LRD,X)=LRDV G V45
"RTN","LRZVER5",63,0)
Q43 G V40:X="",V45:X'["^",V44:X="^",LROUT:X="^^"
"RTN","LRZVER5",64,0)
 ;
"RTN","LRZVER5",65,0)
V43 S X=$P(X,U,2),DIC="^LAB(60,",DIC(0)="EOQZ" D ^DIC G:Y<1 Q42
"RTN","LRZVER5",66,0)
 S LRPLOC=$P(Y(0),U,5),LRSSQ=$P(LRPLOC,";",1),LRSB=$P(LRPLOC,";",2),LRTS=+Y
"RTN","LRZVER5",67,0)
 I LRSSQ="" W !,"Not in this group" G LROUT
"RTN","LRZVER5",68,0)
 I LRSS'=LRSSQ!'$D(^TMP("LR",$J,"TMP",LRSB)) W !,"Not in this group" G LROUT
"RTN","LRZVER5",69,0)
 S LRNX=0
"RTN","LRZVER5",70,0)
 F  S LRNX=$O(LRORD(LRNX)) Q:LRNX<1  Q:LRSB=LRORD(LRNX)
"RTN","LRZVER5",71,0)
 I LRNX,LRSB=LRORD(LRNX) D LRSUBS,V25 G V42
"RTN","LRZVER5",72,0)
 ;
"RTN","LRZVER5",73,0)
V44 K SX
"RTN","LRZVER5",74,0)
 ; D COM^LRVER4 ;;; JFR  - commented to stop comment prompt
"RTN","LRZVER5",75,0)
 S LRNUF=1 S:LRVF LRSA=1
"RTN","LRZVER5",76,0)
 Q
"RTN","LRZVER5",77,0)
 ;
"RTN","LRZVER5",78,0)
V45 ;
"RTN","LRZVER5",79,0)
 K LRSKIP
"RTN","LRZVER5",80,0)
 I X="@" D  G V46
"RTN","LRZVER5",81,0)
 . K:'$G(LRVF) ^LR(LRDFN,LRSS,LRIDT,LRSB)
"RTN","LRZVER5",82,0)
 . S X=$S($G(LRVF)&($D(LRSB(LRSB)))&('$D(LRM(LRSB))):"comment",$D(LRM(LRSB)):"pending",$D(LRSA(LRSB)):"canc",1:"")
"RTN","LRZVER5",83,0)
 . S $P(LRSB(LRSB),"^")=X,$P(LRSB(LRSB),"^",2)=""
"RTN","LRZVER5",84,0)
 ;
"RTN","LRZVER5",85,0)
 S LRXD=U_$P(^LAB(60,LRTS,0),U,12),LRXDP=LRXD_"0)",LRXDP=@LRXDP
"RTN","LRZVER5",86,0)
 X:'(X="*"!($E(X)="?")!(X="C")!(X="#")!(X="canc")!(X="pending")) $P(LRXDP,U,5,99)
"RTN","LRZVER5",87,0)
 I '$D(X)#2 D HELP G V42
"RTN","LRZVER5",88,0)
 I $D(X)#2,X["?" D HELP G:'($P(LRXDP,U,2)["S") V42
"RTN","LRZVER5",89,0)
 I $D(X)#2,$P(LRXDP,U,2)["S",X'="*",X'="#",X'="canc",X'="pending" D LRSET G:'$D(X)#2 V42
"RTN","LRZVER5",90,0)
 I $D(X)#2,X="C",$P(LRXDP,U,2)'["S" D COMP G V42
"RTN","LRZVER5",91,0)
 ;
"RTN","LRZVER5",92,0)
V46 ;
"RTN","LRZVER5",93,0)
 G V42:'$D(X)#2
"RTN","LRZVER5",94,0)
 I LRVF,$D(LRSB(LRSB)),$D(LRSA(LRSB)) S LRSA(LRSB,1)=LRTEST
"RTN","LRZVER5",95,0)
 S X1=$S($D(^LR(LRDFN,LRSS,+LRLDT,LRSB)):$P(^(LRSB),U),1:"")
"RTN","LRZVER5",96,0)
 S:X="*" X="canc" S:X="#" X="comment"
"RTN","LRZVER5",97,0)
 ;
"RTN","LRZVER5",98,0)
 I '$G(LRAMEND(LRSB)) S LRFLG=""
"RTN","LRZVER5",99,0)
 S Y=0 X:LRDEL'="" LRDEL
"RTN","LRZVER5",100,0)
 I '$G(LRAMEND(LRSB)) D RANGE^LRZVER4
"RTN","LRZVER5",101,0)
 ;
"RTN","LRZVER5",102,0)
 S:$P(X,U)="" $P(LRSB(LRSB),U)=""
"RTN","LRZVER5",103,0)
 I $P(X,U)'="" D
"RTN","LRZVER5",104,0)
 . S $P(LRSB(LRSB),U)=X,$P(LRSB(LRSB),U,2)=LRFLG
"RTN","LRZVER5",105,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRZVER5",106,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRZVER5",107,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRZVER5",108,0)
 . I $P($P(LRSB(LRSB),U,3),"!")="" D RONLT^LRVER3
"RTN","LRZVER5",109,0)
 . D
"RTN","LRZVER5",110,0)
 . . I '$D(LRSA(LRSB))#2 D  Q
"RTN","LRZVER5",111,0)
 . . . S $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ))
"RTN","LRZVER5",112,0)
 . . . S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),1:$G(DUZ(2)))
"RTN","LRZVER5",113,0)
 . . S:'$P(LRSB(LRSB),U,4) $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ))
"RTN","LRZVER5",114,0)
 . S $P(LRSB(LRSB),U,5)=$TR(LRNGS,U,"!")
"RTN","LRZVER5",115,0)
 . S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),1:$G(DUZ(2)))
"RTN","LRZVER5",116,0)
 G:$D(LRNUF) V44 K LRNUF G V40:'$D(LRSKIP) S X=LRSKIP G Q43:X["^",V40
"RTN","LRZVER5",117,0)
 ;
"RTN","LRZVER5",118,0)
 ;
"RTN","LRZVER5",119,0)
RANGE ;
"RTN","LRZVER5",120,0)
 S $P(LRSB(LRSB),"^")=X
"RTN","LRZVER5",121,0)
 ; If previous results from another laboratory then use normals and units
"RTN","LRZVER5",122,0)
 ; associated with those results.
"RTN","LRZVER5",123,0)
 D
"RTN","LRZVER5",124,0)
 . I $G(LRDUZ(2)),DUZ(2)'=LRDUZ(2) D PLNR^LRVR4 Q
"RTN","LRZVER5",125,0)
 . I $P(LRSB(LRSB),"^",9),DUZ(2)'=$P(LRSB(LRSB),"^",9) D PLNR^LRVR4
"RTN","LRZVER5",126,0)
 D RANGE^LRZVER4
"RTN","LRZVER5",127,0)
 Q
"RTN","LRZVER5",128,0)
 ;
"RTN","LRZVER5",129,0)
 ;
"RTN","LRZVER5",130,0)
LRSUBS ; From LRVR5
"RTN","LRZVER5",131,0)
 S LRSB=LRORD(LRNX),LRTS=$S($D(^TMP("LR",$J,"TMP",LRSB))#2:^(LRSB),1:0)
"RTN","LRZVER5",132,0)
 Q
"RTN","LRZVER5",133,0)
 ;
"RTN","LRZVER5",134,0)
 ;
"RTN","LRZVER5",135,0)
LRSET ; from above and LRVR5
"RTN","LRZVER5",136,0)
 ;
"RTN","LRZVER5",137,0)
 N I,LRERR,RESULT
"RTN","LRZVER5",138,0)
 D CHK^DIE(63.04,LRSB,"EH",X,.RESULT,"LRERR")
"RTN","LRZVER5",139,0)
 ;
"RTN","LRZVER5",140,0)
 I RESULT'="^" S X=RESULT W "  ",RESULT(0)
"RTN","LRZVER5",141,0)
 ;
"RTN","LRZVER5",142,0)
 I RESULT="^" D
"RTN","LRZVER5",143,0)
 . F I=1:1:LRERR("DIHELP") W !,LRERR("DIHELP",I)
"RTN","LRZVER5",144,0)
 . K X
"RTN","LRZVER5",145,0)
 ;
"RTN","LRZVER5",146,0)
 Q
"RTN","LRZVER5",147,0)
 ;
"RTN","LRZVER5",148,0)
 ;
"RTN","LRZVER5",149,0)
COMP ; from LRVR5
"RTN","LRZVER5",150,0)
 S X="^%ET",@^%ZOSF("TRAP")
"RTN","LRZVER5",151,0)
 R !,"Enter your computation: ",C:DTIME
"RTN","LRZVER5",152,0)
 Q:"^"[C  G CH:C="?"!(C["""") S C=$P(C," ",1)
"RTN","LRZVER5",153,0)
 S X="TRAP^LRVER5",@^%ZOSF("TRAP") D ^DIM S X="W "_C
"RTN","LRZVER5",154,0)
 I '$D(X)#2 W !,"Something's wrong with the syntax." G CH
"RTN","LRZVER5",155,0)
 F I=1:1:$L(C) I $E(C,I)?1A S I=.9 Q
"RTN","LRZVER5",156,0)
 G CH:I=.9,CH:C["/0",CH:C["\0" W !," equals ",@C G COMP
"RTN","LRZVER5",157,0)
TRAP ;
"RTN","LRZVER5",158,0)
 W !!,"Error in your mathematical formular ",!
"RTN","LRZVER5",159,0)
CH W !,"Enter for example: 5*2/4+1 and 3.5 will be returned [i.e. ((5*2)/4)+1=3.5]"
"RTN","LRZVER5",160,0)
 G COMP
"RTN","LRZVER5",161,0)
 ;
"RTN","LRZVER5",162,0)
 ;
"RTN","LRZVER5",163,0)
V25 ; From LRVER4
"RTN","LRZVER5",164,0)
 N LRTX,LRX
"RTN","LRZVER5",165,0)
 S (LRDV,LRNG,LRDEL,LRNGS)=""
"RTN","LRZVER5",166,0)
 I '$D(^LAB(60,+LRTS,0))#2 Q
"RTN","LRZVER5",167,0)
 S LRX=+$P($P(^LAB(60,+LRTS,0),U,5),";",2)
"RTN","LRZVER5",168,0)
 S LRTX=$S($L($P(^LAB(60,+LRTS,0),U,5)):$O(^LAB(60,"C",$P(^LAB(60,+LRTS,0),U,5),0)),1:+LRTS)
"RTN","LRZVER5",169,0)
 S LRFP=$P(^LAB(60,LRTX,.1),U,3)
"RTN","LRZVER5",170,0)
 I LRFP="" S LRFP="$J(X,8)"
"RTN","LRZVER5",171,0)
 ;
"RTN","LRZVER5",172,0)
 ; Normal ranges, units, delta checks and default value
"RTN","LRZVER5",173,0)
 I $D(^LAB(60,LRTX,1,+$G(LRSPEC),0)) D
"RTN","LRZVER5",174,0)
 . S LRNG=^LAB(60,LRTX,1,+$G(LRSPEC),0)
"RTN","LRZVER5",175,0)
 . S LRDEL=$G(^LAB(62.1,+$P(LRNG,U,8),1))
"RTN","LRZVER5",176,0)
 . S LRDEL(1)=$G(^LAB(62.1,+$P(LRNG,U,8),2),"Q")
"RTN","LRZVER5",177,0)
 . S X2=$P(LRNG,U,9)
"RTN","LRZVER5",178,0)
 . S LRDV=$S('$D(LRSB(LRX)):$P(LRNG,U,10),1:"")
"RTN","LRZVER5",179,0)
 ;
"RTN","LRZVER5",180,0)
 ; When entering results from a reference lab check if flag to use normals/units from file 60.
"RTN","LRZVER5",181,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2),'$G(^LAB(60,LRTX,1,+$G(LRSPEC),.1)) D PLNR^LRVR4
"RTN","LRZVER5",182,0)
 ;
"RTN","LRZVER5",183,0)
NORM ;
"RTN","LRZVER5",184,0)
 I $G(SEX)="" S SEX="M"
"RTN","LRZVER5",185,0)
 I $G(AGE)="" S AGE=99
"RTN","LRZVER5",186,0)
 S LRNGS=LRNG
"RTN","LRZVER5",187,0)
 F LRX=2:1:5 D
"RTN","LRZVER5",188,0)
 . N LRY
"RTN","LRZVER5",189,0)
 . S LRY=$P(LRNG,"^",LRX)
"RTN","LRZVER5",190,0)
 . ; enclose in quotes if text or structured numeric
"RTN","LRZVER5",191,0)
 . I LRY'="",$E(LRY)?.(1A,1"<",1">") S LRY=$C(34)_LRY_$C(34)
"RTN","LRZVER5",192,0)
 . I LRY'="",$E(LRY)'=$C(34),LRY'?.N.1".".N S @("LRY"_"="_LRY)
"RTN","LRZVER5",193,0)
 . S $P(LRNG,"^",LRX)=LRY,$P(LRNGS,"^",LRX)=LRY,@("LRNG"_LRX)=LRY
"RTN","LRZVER5",194,0)
 Q
"RTN","LRZVER5",195,0)
 ;
"RTN","LRZVER5",196,0)
 ;
"RTN","LRZVER5",197,0)
LROUT ;
"RTN","LRZVER5",198,0)
 K SX
"RTN","LRZVER5",199,0)
 S LROUT=1
"RTN","LRZVER5",200,0)
 Q
"RTN","LRZVER5",201,0)
 ;
"RTN","LRZVER5",202,0)
 ;
"RTN","LRZVER5",203,0)
HELP W !," ??",$C(7) S LRXDH=LRXD_"3)"
"RTN","LRZVER5",204,0)
 W:$D(@LRXDH) " ",@LRXDH
"RTN","LRZVER5",205,0)
 W !,"Enter * to report ""canc"" for canceled."
"RTN","LRZVER5",206,0)
 W !,"Enter # to report ""comment""."
"RTN","LRZVER5",207,0)
 W:'($P(LRXDP,U,2)["S") !,"Enter C to enter calculate mode."
"RTN","LRZVER5",208,0)
 Q
"RTN","LRZVER5",209,0)
 ;
"RTN","LRZVER5",210,0)
 ;
"RTN","LRZVER5",211,0)
AMEND ; Process amended results and prompt user
"RTN","LRZVER5",212,0)
 N LRANS,LRLL,LRSQ,LRROOT,LRX
"RTN","LRZVER5",213,0)
 ; flag to indicate if amended results have been extracted from LAH
"RTN","LRZVER5",214,0)
 S LRAMEND=0
"RTN","LRZVER5",215,0)
 ; save current value of X
"RTN","LRZVER5",216,0)
 S LRX=X
"RTN","LRZVER5",217,0)
 S LRROOT=$Q(^LAH("LA7 AMENDED RESULTS",LRUID,LRSB))
"RTN","LRZVER5",218,0)
 I LRROOT="" Q
"RTN","LRZVER5",219,0)
 I $QS(LRROOT,1)'="LA7 AMENDED RESULTS"!($QS(LRROOT,2)'=LRUID)!($QS(LRROOT,3)'=LRSB) Q
"RTN","LRZVER5",220,0)
 S LRLL=$QS(LRROOT,4),LRSQ=$QS(LRROOT,5)
"RTN","LRZVER5",221,0)
 I $D(^LAH(LRLL,1,LRSQ,LRSB)) D
"RTN","LRZVER5",222,0)
 . N DIR,DIRUT,DTOUT,DUOUT,LRJ,LRY,X,Y
"RTN","LRZVER5",223,0)
 . S LRY=^LAH(LRLL,1,LRSQ,LRSB)
"RTN","LRZVER5",224,0)
 . S DIR(0)="SOA^0:No;1:Yes;2:Keep but do not process",DIR("B")="Yes"
"RTN","LRZVER5",225,0)
 . S DIR("A",1)=" ",DIR("A",2)="Amended result: "_$P(LRY,"^")
"RTN","LRZVER5",226,0)
 . S DIR("A",2)=DIR("A",2)_"    flag: "_$S($P(LRY,"^",2)'="":$P(LRY,"^",2),1:"None")
"RTN","LRZVER5",227,0)
 . S DIR("A",2)=DIR("A",2)_"    units: "_$P($P(LRY,"^",5),"!",7)
"RTN","LRZVER5",228,0)
 . S DIR("A")="Accept amended results: "
"RTN","LRZVER5",229,0)
 . S DIR("?",1)="Answer with 0-No to not accept amended result and delete.",DIR("?",2)="1-Yes to process amended result.",DIR("?")="or 2-Keep which skips processing but leaves result for future processing."
"RTN","LRZVER5",230,0)
 . D ^DIR
"RTN","LRZVER5",231,0)
 . I $D(DIRUT) Q
"RTN","LRZVER5",232,0)
 . S LRANS=Y
"RTN","LRZVER5",233,0)
 . I LRANS=2 Q
"RTN","LRZVER5",234,0)
 . I LRANS=1 D
"RTN","LRZVER5",235,0)
 . . S LRX=$P(LRY,"^"),LRFLG=$P(LRY,"^",2),LRSB(LRSB)=LRY,LRJ=$P(LRY,"^",5)
"RTN","LRZVER5",236,0)
 . . F LRI=1,2,3,4,5,7,11,12 S $P(LRNG,"^",LRI)=$P(LRJ,"!",LRI)
"RTN","LRZVER5",237,0)
 . . S LRNGS=LRNG,(LRAMEND,LRAMEND(LRSB))=1
"RTN","LRZVER5",238,0)
 . . D LRSBCOM^LRVR4 ; also process any comments
"RTN","LRZVER5",239,0)
 . K ^LAH(LRLL,1,LRSQ,LRSB)
"RTN","LRZVER5",240,0)
 . K ^LAH("LA7 AMENDED RESULTS",LRUID,LRSB,LRLL,LRSQ)
"RTN","LRZVER5",241,0)
 . I +$O(^LAH(LRLL,1,LRSQ,1))<1 D ZAPALL^LRVR3(LRLL,LRSQ)
"RTN","LRZVER5",242,0)
 S X=LRX
"RTN","LRZVER5",243,0)
 Q
"RTN","LRZVER5",244,0)
 ;
"RTN","LRZVER5",245,0)
 ;
"RTN","LRZVER5",246,0)
ASKPLNR ; Ask user for performing lab normal ranges and units when entering
"RTN","LRZVER5",247,0)
 ; manually and not using values from file #60.
"RTN","LRZVER5",248,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LRI,LRJ,LRX,LRY,Y,X,Y
"RTN","LRZVER5",249,0)
 ;
"RTN","LRZVER5",250,0)
 S LRX=$P($G(LRSB(LRSB)),"^",5)
"RTN","LRZVER5",251,0)
 ;
"RTN","LRZVER5",252,0)
 W !!,"For test ",LRTEST
"RTN","LRZVER5",253,0)
 S DIR(0)="60.01,6"
"RTN","LRZVER5",254,0)
 I $P(LRX,"!",7)'="" S DIR("B")=$P(LRX,"!",7)
"RTN","LRZVER5",255,0)
 D ^DIR
"RTN","LRZVER5",256,0)
 I $D(DTOUT)!($D(DUOUT)) Q
"RTN","LRZVER5",257,0)
 ; Set units into component 7 of piece 5
"RTN","LRZVER5",258,0)
 S $P(LRX,"!",7)=Y,$P(LRSB(LRSB),"^",5)=LRX
"RTN","LRZVER5",259,0)
 ;
"RTN","LRZVER5",260,0)
 ; Ask normals - high/low and critical
"RTN","LRZVER5",261,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRZVER5",262,0)
 F LRJ=1,2,3,4 D  Q:$D(DTOUT)!($D(DUOUT))
"RTN","LRZVER5",263,0)
 . K DIR
"RTN","LRZVER5",264,0)
 . S DIR(0)="60.01,"_LRJ,LRI=LRJ+1
"RTN","LRZVER5",265,0)
 . I $P(LRX,"!",LRI)'="" D
"RTN","LRZVER5",266,0)
 . . S DIR("B")=$P(LRX,"!",LRI)
"RTN","LRZVER5",267,0)
 . . I $E(DIR("B"))=$C(34) Q
"RTN","LRZVER5",268,0)
 . . I DIR("B")'?.N.1".".N S DIR("B")=$C(34)_DIR("B")_$C(34) ; enclose in quotes if text
"RTN","LRZVER5",269,0)
 . D ^DIR
"RTN","LRZVER5",270,0)
 . I $D(DTOUT)!($D(DUOUT)) Q
"RTN","LRZVER5",271,0)
 . S $P(LRX,"!",LRI)=Y
"RTN","LRZVER5",272,0)
 ;
"RTN","LRZVER5",273,0)
 ; Ask user for normality in case user does not know high/low/critical.
"RTN","LRZVER5",274,0)
 S LRRFLAG(LRSB)=$$RFLAG^LRVERA($P($G(LRSB(LRSB)),"^",2))
"RTN","LRZVER5",275,0)
 ;
"RTN","LRZVER5",276,0)
 ; Update normal variable LRNG
"RTN","LRZVER5",277,0)
 I $P(LRX,"!")="" S $P(LRX,"!")=LRSPEC
"RTN","LRZVER5",278,0)
 F LRI=1,2,3,4,5,7 S $P(LRNG,"^",LRI)=$P(LRX,"!",LRI)
"RTN","LRZVER5",279,0)
 ;
"RTN","LRZVER5",280,0)
 Q
"RTN","RADZVEFA")
0^5^B42759552
"RTN","RADZVEFA",1,0)
RADZVEFA ;HISC/FPT-Radiology Utility Routine ;6/2/98  16:17
"RTN","RADZVEFA",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,5,10,65,94**;VEFA ABNORMAL IMAGE "ALERT GENERATOR" TEST PROGRAM Mar 16, 1998;Build 8
"RTN","RADZVEFA",3,0)
 ;
"RTN","RADZVEFA",4,0)
IMAGEGEN ;
"RTN","RADZVEFA",5,0)
 N PATIEN,ALERTID,DATETIME,ORDERPRV,MSGTEXT1,LAST4,LENGTH,NEWALERT,ACTIONFLG,ENTRYPNT,AROUTINE,DELWOPRC,DAYSSURG,DAYSSUPV,DAYSBREV,DATAALR
"RTN","RADZVEFA",6,0)
 N DATAALRT,PATIENT,FILE
"RTN","RADZVEFA",7,0)
 N RADIOLO,RETENTD,ALERTIDN,RECIPINT,RECIPTYP,EXIT,X1,X2,Y,ORDERP
"RTN","RADZVEFA",8,0)
 K FDA,FDAIEN,OROUT
"RTN","RADZVEFA",9,0)
REP1 S DIC=2,DIC(0)="QAEZ" K DIC("A") S DIC("A")="Select Patient for Imaging Alert : " D ^DIC
"RTN","RADZVEFA",10,0)
 I X="^" Q
"RTN","RADZVEFA",11,0)
 I Y=-1 G REP1
"RTN","RADZVEFA",12,0)
 ;
"RTN","RADZVEFA",13,0)
 ; ALERT FILE FIRST
"RTN","RADZVEFA",14,0)
 ;
"RTN","RADZVEFA",15,0)
 ;
"RTN","RADZVEFA",16,0)
 S PATIEN=$P(Y,"^",1) ; 
"RTN","RADZVEFA",17,0)
 D NOW^%DTC S DATETIME=%
"RTN","RADZVEFA",18,0)
 S X1=%,X2=14 D C^%DTC S RETENTD=X
"RTN","RADZVEFA",19,0)
 S LAST4=$E($P($G(^DPT(PATIEN,0)),"^",9),6,9)
"RTN","RADZVEFA",20,0)
 ;
"RTN","RADZVEFA",21,0)
 ; FOR NOW NO QUESTION ON ORDERING PROVIDER. ASSUMED `1 AS PROGRAMMER,ONE
"RTN","RADZVEFA",22,0)
 S ORDERPRV=1 ; ARTIFICIAL 2ND RECIPIENT AFTER RADIOLOGIST,ONE (11716) BELOW
"RTN","RADZVEFA",23,0)
 W !!
"RTN","RADZVEFA",24,0)
 W "Provider Selection:"
"RTN","RADZVEFA",25,0)
 K LRSRNB
"RTN","RADZVEFA",26,0)
 D ALSP("Providers with ORES key^Provider","^VA(200,",.LRSRNB)
"RTN","RADZVEFA",27,0)
 I LRSRNB["^" Q
"RTN","RADZVEFA",28,0)
 N IENN
"RTN","RADZVEFA",29,0)
 ;ZW LRSRNB
"RTN","RADZVEFA",30,0)
 S IENN=0
"RTN","RADZVEFA",31,0)
 F  S IENN=$O(LRSRNB(IENN)) Q:IENN=""  D
"RTN","RADZVEFA",32,0)
 .S ORDERPRV=IENN
"RTN","RADZVEFA",33,0)
 S RADIOLO=DUZ ; 11716
"RTN","RADZVEFA",34,0)
 S ALERTID="OR,"_PATIEN_",25;"_ORDERPRV_";"_DATETIME
"RTN","RADZVEFA",35,0)
 S MSGTEXT1=$G(^DPT(PATIEN,0))
"RTN","RADZVEFA",36,0)
 ;W !,MSGTEXT1
"RTN","RADZVEFA",37,0)
 S MSGTEXT1=$E(MSGTEXT1,1,9)
"RTN","RADZVEFA",38,0)
 ;W !,MSGTEXT1
"RTN","RADZVEFA",39,0)
 ;   $E($P($G(^DPT(PATIEN,0)),"^",1),1,9)
"RTN","RADZVEFA",40,0)
 S MSGTEXT1=MSGTEXT1_" ("
"RTN","RADZVEFA",41,0)
 ;   _" ("
"RTN","RADZVEFA",42,0)
 S MSGTEXT1=MSGTEXT1_$E($P($G(^DPT(PATIEN,0)),"^",1),1,1)
"RTN","RADZVEFA",43,0)
 S EXIT=1
"RTN","RADZVEFA",44,0)
 ;8/9/2014 GOW
"RTN","RADZVEFA",45,0)
 ;S MSGTEXT1=MSGTEXT1_LAST4_"): Abnl Imaging Reslt, Needs Attn: "
"RTN","RADZVEFA",46,0)
 ;END MOD
"RTN","RADZVEFA",47,0)
 ;W !!,"DO YOU WANT CHEST 2 VIEWS PA&LAT" S %=1 D YN^DICN I %=1 D
"RTN","RADZVEFA",48,0)
 W !!,"DO YOU WANT CHEST 2 VIEWS FRONT AND LATERAL" S %=1 D YN^DICN I %=1 D
"RTN","RADZVEFA",49,0)
 .;MOD 8/9/2014 GOW
"RTN","RADZVEFA",50,0)
 .S MSGTEXT1=MSGTEXT1_LAST4_"): Abnl Imaging Reslt, Needs Attn: "
"RTN","RADZVEFA",51,0)
 .;.S MSGTEXT1=MSGTEXT1_"CHEST 2 VIEWS PA&LAT" S EXIT=0
"RTN","RADZVEFA",52,0)
 .S MSGTEXT1=MSGTEXT1_"CHEST 2 VIEWS FRONT" S EXIT=0
"RTN","RADZVEFA",53,0)
 .;END MOD
"RTN","RADZVEFA",54,0)
 I EXIT=0 G OVER
"RTN","RADZVEFA",55,0)
 W !!,"DO YOU WANT MAMMOGRAM BILAT" S %=1 D YN^DICN I %=1 D
"RTN","RADZVEFA",56,0)
 .S MSGTEXT1=MSGTEXT1_"MAMMOGRAM" S EXIT=0
"RTN","RADZVEFA",57,0)
 .;S MSGTEXT1=MSGTEXT1_"MAMM BI2V" S EXIT=0
"RTN","RADZVEFA",58,0)
 I EXIT=0 G OVER
"RTN","RADZVEFA",59,0)
 ;MOD 8/9/2014 GOW
"RTN","RADZVEFA",60,0)
 ;W !!,"DO YOU WANT AMENDED CHEST 2 VIEWS PA&LAT" S %=1 D YN^DICN I %=1 D
"RTN","RADZVEFA",61,0)
 W !!,"DO YOU WANT AMENDED CHEST 2 VIEWS FRONT AND LATERAL" S %=1 D YN^DICN I %=1 D
"RTN","RADZVEFA",62,0)
 .S MSGTEXT1=MSGTEXT1_LAST4_"): Amended/Abnormal Imaging Results: "
"RTN","RADZVEFA",63,0)
 .S ALERTID="OR,"_PATIEN_",53;"_ORDERPRV_";"_DATETIME
"RTN","RADZVEFA",64,0)
 .;S MSGTEXT1=MSGTEXT1_"CHEST 2 VIEWS PA&LAT" S EXIT=0
"RTN","RADZVEFA",65,0)
 .S MSGTEXT1=MSGTEXT1_"CHEST 2 VIEWS FRO" S EXIT=0
"RTN","RADZVEFA",66,0)
 ;END MOD
"RTN","RADZVEFA",67,0)
OVER I EXIT=1 K % Q
"RTN","RADZVEFA",68,0)
 ;WRITE INTO ALERT "PROVIDER" RECORD FIRST BEFORE SUB-FILE MULTIPLE ENTRY
"RTN","RADZVEFA",69,0)
 S FILE=8992
"RTN","RADZVEFA",70,0)
 S FDA(43,FILE,"?+1,",.01)=ORDERPRV
"RTN","RADZVEFA",71,0)
 D UPDATE^DIE("","FDA(43)","FDAIEN","OROUT(43)")
"RTN","RADZVEFA",72,0)
 I $D(OROUT(43,"DIERR")) W !,"ORDERING PROVIDER ERROR= ",ORDERPRV," ",OROUT(43,"DIERR",1,"TEXT",1) Q
"RTN","RADZVEFA",73,0)
 S ORDERP=FDAIEN(1)
"RTN","RADZVEFA",74,0)
 K FDA(43),FDAIEN,OROUT(43)
"RTN","RADZVEFA",75,0)
 K %
"RTN","RADZVEFA",76,0)
 S LENGTH=$L(MSGTEXT1)
"RTN","RADZVEFA",77,0)
 ;MOD 8/9/2014
"RTN","RADZVEFA",78,0)
 ;I LENGTH>60 S MSGTEXT1=$E(MSGTEXT1,1,60)  ; W !,"OVER"
"RTN","RADZVEFA",79,0)
 I LENGTH>70 S MSGTEXT1=$E(MSGTEXT1,1,70)  ; 70 is max in DISPLAY TEXT field. W !,"OVER"
"RTN","RADZVEFA",80,0)
 ;END MOD
"RTN","RADZVEFA",81,0)
 S NEWALERT=1
"RTN","RADZVEFA",82,0)
 S ACTIONFLG="R"
"RTN","RADZVEFA",83,0)
 S ENTRYPNT="RPTRAD2"
"RTN","RADZVEFA",84,0)
 S AROUTINE="ORB3FUP2"
"RTN","RADZVEFA",85,0)
 S DELWOPRC=1 ; CAN DELETE W/O PROCESSING
"RTN","RADZVEFA",86,0)
 S DAYSSURG=1
"RTN","RADZVEFA",87,0)
 S DAYSSUPV=1
"RTN","RADZVEFA",88,0)
 S DAYSBREV=1
"RTN","RADZVEFA",89,0)
 S DATAALRT="6919591.9099~1"
"RTN","RADZVEFA",90,0)
 S PATIENT=$P($G(^DPT(PATIEN,0)),"^",1)
"RTN","RADZVEFA",91,0)
 S FDAIEN(1)=ORDERP
"RTN","RADZVEFA",92,0)
 S FILE=8992.01
"RTN","RADZVEFA",93,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.01)=DATETIME
"RTN","RADZVEFA",94,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.02)=ALERTID
"RTN","RADZVEFA",95,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.03)=MSGTEXT1
"RTN","RADZVEFA",96,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.04)=NEWALERT
"RTN","RADZVEFA",97,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.05)=ACTIONFLG
"RTN","RADZVEFA",98,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.07)=ENTRYPNT
"RTN","RADZVEFA",99,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.08)=AROUTINE
"RTN","RADZVEFA",100,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.1)=DELWOPRC
"RTN","RADZVEFA",101,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.13)=DAYSSURG
"RTN","RADZVEFA",102,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.14)=DAYSSUPV
"RTN","RADZVEFA",103,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",.15)=DAYSBREV
"RTN","RADZVEFA",104,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",1)=DATAALRT
"RTN","RADZVEFA",105,0)
 S FDA(44,FILE,"?+2,"_FDAIEN(1)_",",3.02)=PATIEN
"RTN","RADZVEFA",106,0)
 ;W !,MSGTEXT1
"RTN","RADZVEFA",107,0)
 ;Q
"RTN","RADZVEFA",108,0)
 D UPDATE^DIE("","FDA(44)","FDAIEN","OROUT(44)")
"RTN","RADZVEFA",109,0)
 I $D(OROUT(44,"DIERR")) W !,"DATE/TIME ERROR= ",DATETIME," ",OROUT(44,"DIERR",1,"TEXT",1) Q
"RTN","RADZVEFA",110,0)
 ;K FDA(44),OROUT(44)
"RTN","RADZVEFA",111,0)
 ;Q
"RTN","RADZVEFA",112,0)
 ;
"RTN","RADZVEFA",113,0)
 ; ALERT TRACKING FILE NOW
"RTN","RADZVEFA",114,0)
 ;
"RTN","RADZVEFA",115,0)
 ;
"RTN","RADZVEFA",116,0)
 ;S PKKID="OR,25"
"RTN","RADZVEFA",117,0)
 ;S DISPTXT=MSGTEXT1
"RTN","RADZVEFA",118,0)
 ;DATETIME
"RTN","RADZVEFA",119,0)
 ;ALERTID
"RTN","RADZVEFA",120,0)
 ;FIRST RECEIPIENT IS RADIOLOGIST,TWO
"RTN","RADZVEFA",121,0)
 ;S GENERBY=11716
"RTN","RADZVEFA",122,0)
 K FDA,FDAIEN,OROUT
"RTN","RADZVEFA",123,0)
 S FILE=8992.1
"RTN","RADZVEFA",124,0)
 S FDA(45,FILE,"?+1,",.01)=ALERTID   ;NAME ALERTID
"RTN","RADZVEFA",125,0)
 S FDA(45,FILE,"?+1,",.02)=DATETIME  ; DATE CREATED
"RTN","RADZVEFA",126,0)
 S FDA(45,FILE,"?+1,",.03)="OR,"_25   ; PKG ID
"RTN","RADZVEFA",127,0)
 S FDA(45,FILE,"?+1,",.04)=PATIEN     ; PATIENT
"RTN","RADZVEFA",128,0)
 S FDA(45,FILE,"?+1,",.05)=RADIOLO   ;GENERATED BY (RADIOLOGIST)
"RTN","RADZVEFA",129,0)
 S FDA(45,FILE,"?+1,",.06)=1         ; GENERATED WHILE QUEUED
"RTN","RADZVEFA",130,0)
 S FDA(45,FILE,"?+1,",.08)=RETENTD   ; RETENTION DATE
"RTN","RADZVEFA",131,0)
 S FDA(45,FILE,"?+1,",1.01)=MSGTEXT1     ; DISPLAY TEXT
"RTN","RADZVEFA",132,0)
 S FDA(45,FILE,"?+1,",1.03)=ENTRYPNT   ;ROUTINE TAG
"RTN","RADZVEFA",133,0)
 S FDA(45,FILE,"?+1,",1.04)=AROUTINE   ; ROUTINE FOR PROCESSING
"RTN","RADZVEFA",134,0)
 S FDA(45,FILE,"?+1,",2)=DATAALRT   ; DATA FOR ALERT
"RTN","RADZVEFA",135,0)
 D UPDATE^DIE("","FDA(45)","FDAIEN","OROUT(45)")
"RTN","RADZVEFA",136,0)
 I $D(OROUT(45,"DIERR")) W !,"NAME ALERTID ERROR= ",ALERTID," ",OROUT(45,"DIERR",1,"TEXT",1) Q
"RTN","RADZVEFA",137,0)
 S ALERTIDN=FDAIEN(1)
"RTN","RADZVEFA",138,0)
 K FDA(45),OROUT(45)
"RTN","RADZVEFA",139,0)
 K FDA,FDAIEN,OROUT
"RTN","RADZVEFA",140,0)
 S FILE=8992.11 ; RECIPIENT MULTIPLE
"RTN","RADZVEFA",141,0)
 S FDAIEN(1)=ALERTIDN
"RTN","RADZVEFA",142,0)
 ;RECIPIENT , FIRST PROGRAMMER,ONE AS ORDERING PROVIDER AS"INITIAL RECIPIENT" AS RECIPIENT TYPE
"RTN","RADZVEFA",143,0)
 S FDA(46,FILE,"?+2,"_FDAIEN(1)_",",.01)=ORDERPRV
"RTN","RADZVEFA",144,0)
 ;//S FDA(46,FILE,"?+2,"_FDAIEN(1)_",",.02)=DATETIME  ; ALERT FIRST DISPLAYED
"RTN","RADZVEFA",145,0)
 D UPDATE^DIE("","FDA(46)","FDAIEN","OROUT(46)")
"RTN","RADZVEFA",146,0)
 I $D(OROUT(46,"DIERR")) W !,"RECIPIENT ERROR= ",ORDERPRV," ",OROUT(46,"DIERR",1,"TEXT",1) Q
"RTN","RADZVEFA",147,0)
 S RECIPINT=FDAIEN(2)
"RTN","RADZVEFA",148,0)
 K FDA(46),OROUT(46)
"RTN","RADZVEFA",149,0)
 ; SUB FILE ENTRY RECIPIENT TYPE 
"RTN","RADZVEFA",150,0)
 K FDA,FDAIEN,OROUT
"RTN","RADZVEFA",151,0)
 S FILE=8992.111  ; RECIPIENT TYPE MULTIPLE
"RTN","RADZVEFA",152,0)
 S FDAIEN(1)=ALERTIDN
"RTN","RADZVEFA",153,0)
 S FDAIEN(2)=RECIPINT
"RTN","RADZVEFA",154,0)
 S RECIPTYP=1  ; INITIAL RECIPIENT
"RTN","RADZVEFA",155,0)
 ;RECIPIENT , FIRST PROGRAMMER,ONE AS ORDERING PROVIDER AS"INITIAL RECIPIENT" AS RECIPIENT TYPE
"RTN","RADZVEFA",156,0)
 S FDA(47,FILE,"?+3,"_FDAIEN(2)_","_FDAIEN(1)_",",.01)=RECIPTYP   ; RECIPIENT TYPE
"RTN","RADZVEFA",157,0)
 S FDA(47,FILE,"?+3,"_FDAIEN(2)_","_FDAIEN(1)_",",.04)=DATETIME  ; ALERT DATE/TIME
"RTN","RADZVEFA",158,0)
 D UPDATE^DIE("","FDA(47)","FDAIEN","OROUT(47)")
"RTN","RADZVEFA",159,0)
 I $D(OROUT(47,"DIERR")) W !,"RECIPIENT TYPE ERROR= ",DATETIME," ",OROUT(47,"DIERR",1,"TEXT",1) Q
"RTN","RADZVEFA",160,0)
 K FDA(47),OROUT(47)
"RTN","RADZVEFA",161,0)
 Q
"RTN","RADZVEFA",162,0)
DATEFMT(X) ;
"RTN","RADZVEFA",163,0)
 N DATETIME
"RTN","RADZVEFA",164,0)
 ;
"RTN","RADZVEFA",165,0)
 N Y
"RTN","RADZVEFA",166,0)
 S DATETIME=X
"RTN","RADZVEFA",167,0)
 S Y=DATETIME X ^DD("DD") S DATETIME=Y
"RTN","RADZVEFA",168,0)
 Q DATETIME
"RTN","RADZVEFA",169,0)
ALSP(PRPT,FILE,ARR) ; Selection of (A)LL or (S)pecific values from a given file
"RTN","RADZVEFA",170,0)
 ; Input: PRPT  - Piece 1: Label for the PROMPT to be asked for the 
"RTN","RADZVEFA",171,0)
 ;                         selection (in the plural) - e.g. "Providers"
"RTN","RADZVEFA",172,0)
 ;                Piece 2: Singular of piece 1 -  e.g. "Provider"
"RTN","RADZVEFA",173,0)
 ;                Example: "Specialties^Specialty"
"RTN","RADZVEFA",174,0)
 ;        FILE  - File global root (e.g., "^IBE(356.8," ) that the values
"RTN","RADZVEFA",175,0)
 ;                will be selected from
"RTN","RADZVEFA",176,0)
 ;        ARR   - Name of the array that will contain the specific values
"RTN","RADZVEFA",177,0)
 ;                (must be passed as a reference value ".ARR")
"RTN","RADZVEFA",178,0)
 ; Output: ARR  - "S" - Specific values OR "^"
"RTN","RADZVEFA",179,0)
 ;                The values will be returned in the array indicated in
"RTN","RADZVEFA",180,0)
 ;                ARR parameter 
"RTN","RADZVEFA",181,0)
 ;
"RTN","RADZVEFA",182,0)
 N DIC,PRL,SNG,X
"RTN","RADZVEFA",183,0)
 ;
"RTN","RADZVEFA",184,0)
 N Y
"RTN","RADZVEFA",185,0)
 K ARR S PRL=$P(PRPT,"^"),SNG=$P(PRPT,"^",2) S:SNG="" SNG=PRL
"RTN","RADZVEFA",186,0)
 ;ALSP1 W !!,"Run report for (A)LL or (S)PECIFIC "_PRL_": A// "
"RTN","RADZVEFA",187,0)
 ;R X:DTIME I '$T!(X["^") S ARR="^" G QALSP
"RTN","RADZVEFA",188,0)
 ;S X=$S(X="":"A",1:$E(X)) I "AaSs"'[X D HALSP G ALSP1
"RTN","RADZVEFA",189,0)
 ;W " ",$S("Ss"[X:"SPECIFIC",1:"ALL") I "Aa"[X K ARR S ARR="A" G QALSP
"RTN","RADZVEFA",190,0)
 S ARR="S"
"RTN","RADZVEFA",191,0)
ALSP2 S DIC=FILE,DIC(0)="AEQMZ"
"RTN","RADZVEFA",192,0)
 S DIC("A")="   Select a"_$S($O(ARR(""))'="":"nother",1:"")_" "
"RTN","RADZVEFA",193,0)
 S DIC("A")=DIC("A")_SNG_": "
"RTN","RADZVEFA",194,0)
 D ^DIC K DIC I $D(DTOUT)!($D(DUOUT)) K ARR S ARR="^" G QALSP
"RTN","RADZVEFA",195,0)
 I Y'>0 G QALSP ; G ALSP1:$O(ARR(""))="" G QALSP
"RTN","RADZVEFA",196,0)
 I $D(ARR(+Y)) D  G ALSP2
"RTN","RADZVEFA",197,0)
 . W !!?3,"Already selected. Choose another "_SNG,*7,!
"RTN","RADZVEFA",198,0)
 S ARR(+Y)="" K DTOUT K DUOUT Q  ; ONLY ALLOW 1 PATIENT PER PATIENT PER TIME OF LAB RESULTING ALERT G ALSP2
"RTN","RADZVEFA",199,0)
 ;
"RTN","RADZVEFA",200,0)
QALSP K DTOUT K DUOUT Q
"VER")
8.0^22.0
**END**
**END**
